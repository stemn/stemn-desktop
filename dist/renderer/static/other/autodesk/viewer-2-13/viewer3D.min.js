function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=i("DXT1"),r=i("DXT3"),s=i("DXT5"),a=new Int32Array(e,0,31);if(542327876!==a[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!a[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;var l,c=a[21],u=!1;switch(c){case o:l=8,n.format=THREE.RGB_S3TC_DXT1_Format;break;case r:l=16,n.format=THREE.RGBA_S3TC_DXT3_Format;break;case s:l=16,n.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==a[22]&&16711680&a[23]&&65280&a[24]&&255&a[25]&&4278190080&a[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(c)),n;u=!0,l=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,a[7]>0&&!1!==t&&(n.mipmapCount=Math.max(1,a[7])),n.isCubemap=!!(512&a[28]),n.width=a[4],n.height=a[3];for(var h=a[1]+4,d=n.width,p=n.height,g=n.isCubemap?6:1,m=0;m<g;m++){for(var v=0;v<n.mipmapCount;v++){if(u)f=(E=function(e,t,i,n){for(var o=i*n*4,r=new Uint8Array(e,t,o),s=new Uint8Array(o),a=0,l=0,c=0;c<n;c++)for(var u=0;u<i;u++){var h=r[l],d=r[++l],p=r[++l],g=r[++l];l++,s[a]=p,s[++a]=d,s[++a]=h,s[++a]=g,a++}return s}(e,h,d,p)).length;else var f=Math.max(4,d)/4*Math.max(4,p)/4*l,E=new Uint8Array(e,h,f);var A={data:E,width:d,height:p};n.mipmaps.push(A),h+=f,d=Math.max(.5*d,1),p=Math.max(.5*p,1)}d=n.width,p=n.height}return n}}function init_three_pvr_loader(){THREE.PVRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(e,t){var i=new Uint32Array(e,0,13),n={buffer:e,header:i,loadMipmaps:t};if(55727696===i[0])return THREE.PVRLoader._parseV3(n);if(559044176===i[11])return THREE.PVRLoader._parseV2(n);throw new Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(e){var t,i,n=e.header,o=n[12],r=n[2],s=n[6],a=n[7],l=(n[9],n[10]),c=n[11];switch(r){case 0:t=2,i=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+r)}return e.dataPtr=52+o,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,THREE.PVRLoader._extract(e)},THREE.PVRLoader._parseV2=function(e){var t,i=e.header,n=i[0],o=i[1],r=i[2],s=i[3],a=i[4],l=(i[5],i[6]),c=(i[7],i[8],i[9],i[10]),u=(i[11],i[12]),h=255&a,d=c>0;if(25===h)t=d?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,l=4;else{if(24!==h)throw new Error("pvrtc - unknown format "+h);t=d?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,l=2}return e.dataPtr=n,e.bpp=l,e.format=t,e.width=r,e.height=o,e.numSurfaces=u,e.numMipmaps=s+1,e.isCubemap=6===u,THREE.PVRLoader._extract(e)},THREE.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},i=e.buffer,n=e.dataPtr,o=e.bpp,r=e.numSurfaces,s=0,a=0,l=0,c=0,u=0,h=0;2===o?(l=8,c=4):(l=4,c=4),a=l*c*o/8,t.mipmaps.length=e.numMipmaps*r;for(var d=0;d<e.numMipmaps;){var p=e.width>>d,g=e.height>>d;h=g/c,(u=p/l)<2&&(u=2),h<2&&(h=2),s=u*h*a;for(var m=0;m<r;m++){var v={data:new Uint8Array(i,n,s),width:p,height:g};t.mipmaps[m*e.numMipmaps+d]=v,n+=s}d++}return t}}function trace(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}function init_three_triangulator(){"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function e(e,t,i){return i+":"+(e<t?e+":"+t:t+":"+e)}function t(t,i,n,o,r,s,a){this.pt1=t,this.pt2=i,this.p1=-1,this.p2=-1,this.eid1=e(n,o,a),this.eid2=e(r,s,a)}function i(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function n(e,t,i){this.pts=e,this.edges=t,this.bbox=i,this.pipResult=!1}function o(e,t){this.edges=e,this.bbox=t,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function r(e){this.indices=[],this.cset=e;var t=this.pts=e.pts;this.intervalTree=new n(e.pts,e.edges,e.bbox),this.intervalTree.build();for(h=0;h<t.length;h++)t[h].id=h;var i=new lmv_poly2tri.SweepContext([]);if(i.points_=t.slice(),e.contours)for(var o=this.cset.contours,r=0;r<o.length;r++){for(var s=o[r],a=s[0]!==s[s.length-1],l=[],c=0;c<s.length-1;c++)l.push(t[s[c]]);i.initEdges(l,a)}else for(var u=this.cset.edges,h=0;h<u.length;h++){var d=u[h];if(d.p1!=d.p2){var p=[t[d.p1],t[d.p2]];i.initEdges(p,!0)}}this.triangulate(i),this.processResult(i)}var s=Autodesk.Viewing.Private;return n.prototype.splitNode=function(e){if(!(e.bbox.min.y>=e.bbox.max.y||e.node_edges.length<3)){var t=.5*(e.bbox.min.y+e.bbox.max.y);e.left=new i,e.right=new i;for(var n=this.pts,o=e.node_edges,r=[],s=new THREE.Vector2,a=0;a<o.length;a++){var l=this.edges[o[a]],c=n[l.p1].y,u=n[l.p2].y;if(c>u){var h=c;c=u,u=h}var d=null;u<t?(e.left.node_edges.push(o[a]),d=e.left.bbox):c>t?(e.right.node_edges.push(o[a]),d=e.right.bbox):r.push(o[a]),d&&(s.set(n[l.p1].x,n[l.p1].y),d.expandByPoint(s),s.set(n[l.p2].x,n[l.p2].y),d.expandByPoint(s))}e.node_edges=r,e.left.node_edges.length&&this.splitNode(e.left),e.right.node_edges.length&&this.splitNode(e.right)}},n.prototype.build=function(){this.root=new i;for(var e=this.root.node_edges,t=0;t<this.edges.length;t++)e.push(t);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},n.prototype.pointInPolygonRec=function(e,t,i){if(e.bbox.min.y<=i&&e.bbox.max.y>=i)for(var n=this.pts,o=e.node_edges,r=0,s=o.length;r<s;r++){var a=this.edges[o[r]],l=n[a.p1],c=l.x,u=l.y,h=u>=i,d=n[a.p2],p=d.x,g=d.y,m=g>=i;h!=m&&(g-i)*(c-p)>=(p-t)*(u-g)==m&&(this.pipResult=!this.pipResult)}var v=e.left;v&&v.bbox.min.y<=i&&v.bbox.max.y>=i&&this.pointInPolygonRec(v,t,i);var f=e.right;f&&f.bbox.min.y<=i&&f.bbox.max.y>=i&&this.pointInPolygonRec(f,t,i)},n.prototype.pointInPolygon=function(e,t){return this.pipResult=!1,this.pointInPolygonRec(this.root,e,t),this.pipResult},o.prototype.getPointIndex=function(e,t,i){var n=this.idmap[i];if(void 0!==n)return n;var o,r=0|e*this.scale,s=0|t*this.scale,a=this.xymap[r];return void 0===a?(this.xymap[r]=a={},o=void 0):o=a[s],void 0===o&&(a[s]=o=this.pts.length,this.idmap[i]=o,this.pts.push({x:e,y:t})),o},o.prototype.snapEdges=function(){for(var e=0;e<this.edges.length;e++){var t=this.edges[e];t.p1=this.getPointIndex(t.pt1.x,t.pt1.y,t.eid1),t.p2=this.getPointIndex(t.pt2.x,t.pt2.y,t.eid2)}},o.prototype.sanitizeEdges=function(){for(var e={},t=[],i=0,n=this.edges.length;i<n;i++){var o=this.edges[i];if(o.p1!==o.p2){var r=Math.min(o.p1,o.p2)+":"+Math.max(o.p1,o.p2);!0!==e[r]&&(e[r]=!0,t.push(o))}}this.edges=t},o.prototype.stitchContours=function(){for(var e={},t=0;t<this.edges.length;t++){var i=this.edges[t];i.p1!==i.p2&&(void 0!==e[i.p1]?e[i.p1].push(i.p2):e[i.p1]=[i.p2],void 0!==e[i.p2]?e[i.p2].push(i.p1):e[i.p2]=[i.p1])}var n=[];for(var o in e)if(2!==e[o].length){s.logger.warn("Incomplete edge table");break}for(;;){var r=void 0;for(var o in e)if(e[o].length>1){r=o;break}if(!r)for(var o in e)if(e[o].length>0){r=o;break}if(!r)break;var a=-1,l=parseInt(r),c=e[r];for(n.push(l);c&&c.length;){var u=c.shift();if(u===a&&(u=c.shift()),void 0===u){delete e[l];break}n.push(u),0==c.length?delete e[l]:c[0]===a&&delete e[l],a=l,l=u,c=e[u]}n.length&&(this.contours.push(n),n=[])}for(var h=[],t=0;t<this.contours.length;t++)(m=this.contours[t])[0]!==m[m.length-1]&&h.push(m);if(h.length)for(var d=!0;d;){d=!1;for(var p={},g=this.contours,t=0;t<g.length;t++){var m=g[t],v=m[0],f=m[m.length-1];v!==f&&(p[v]?p[v].push(-t-1):p[v]=[-t-1],p[f]?p[f].push(t):p[f]=[t])}for(var o in p){var E=p[o];if(2==E.length){var A=void 0;if(E[0]<0&&E[1]<0){y=-E[0]-1;g[T=-E[1]-1].shift(),Array.prototype.push.apply(g[y].reverse(),g[T]),A=T}if(E[0]<0&&E[1]>0){y=-E[0]-1;g[T=E[1]].pop(),Array.prototype.push.apply(g[T],g[y]),A=y}if(E[0]>0&&E[1]<0){var y=E[0],T=-E[1]-1;g[y].pop(),Array.prototype.push.apply(g[y],g[T]),A=T}if(E[0]>0&&E[1]>0){var y=E[0],T=E[1];g[y].pop(),Array.prototype.push.apply(g[y],g[T].reverse()),A=T}void 0!==A&&(g.splice(A,1),d=!0);break}}}},r.prototype.triangulate=function(e){try{e.triangulate()}catch(e){}},r.prototype.processResult=function(e){for(var t=0;t<e.map_.length;t++){var i=e.map_[t],n=i.points_[0],o=i.points_[1],r=i.points_[2];void 0!==n.id&&void 0!==o.id&&void 0!==r.id&&this.filterFace(n.id,o.id,r.id)}},r.prototype.pointInEdgeList=function(e,t){for(var i,n,o,r,s,a,l=this.cset.pts,c=this.cset.edges,u=!1,h=0,d=c.length;h<d;++h){var p=c[h];o=l[p.p1].x,i=(r=l[p.p1].y)>=t,s=l[p.p2].x,i!=(n=(a=l[p.p2].y)>=t)&&(a-t)*(o-s)>=(s-e)*(r-a)==n&&(u=!u)}return u},r.prototype.pointInContour=function(e,t,i){var n,o,r,s,a,l,c=!1,u=this.cset.pts;r=u[i[i.length-1]].x,n=(s=u[i[i.length-1]].y)>=t;for(var h=0,d=i.length;h<d;++h)a=u[i[h]].x,n!=(o=(l=u[i[h]].y)>=t)&&(l-t)*(r-a)>=(a-e)*(s-l)==o&&(c=!c),n=o,r=a,s=l;return c},r.prototype.pointInPolygon=function(e,t){for(var i=!1,n=0;n<this.cset.contours.length;n++)this.pointInContour(e,t,this.cset.contours[n])&&(i=!i);return i},r.prototype.filterFace=function(e,t,i){var n=this.pts[e],o=this.pts[t],r=this.pts[i],s=(n.x+o.x+r.x)/3,a=(n.y+o.y+r.y)/3;if(this.intervalTree.pointInPolygon(s,a)){var l=o.x-n.x,c=o.y-n.y,u=r.x-n.x;l*(r.y-n.y)-u*c>0?this.indices.push(e,t,i):this.indices.push(e,i,t)}},{TriangulatedSurface:r,ContourSet:o,Edge:t}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function e(e){return Math.abs(e)<c}function t(t,i,n,o,r){var s=h.subVectors(n,i),a=t.normal.dot(s);if(e(a))return o.copy(i),r.copy(n),2;a=1/a;var l=-(i.dot(t.normal)*a+t.constant*a);if(l<-c||l>1+c)return 0;var u=s.multiplyScalar(l).add(i);return o.copy(u),1}function i(e,i,n,o,r,s,a,h,g){var m=e.distanceToPoint(i),v=e.distanceToPoint(n),f=e.distanceToPoint(o);if(m<-c&&v<-c&&f<-c)return null;if(m>c&&v>c&&f>c)return null;var E=Math.sign(m),A=Math.sign(v),y=Math.sign(f);if(0===E&&0===A&&0===y)return null;var T,w,b,C,S,k;if(E!==A){if(2==(M=t(e,i,n,d,p)))return void h.push(new u(i.clone(),n.clone(),r,r,s,s,g));1==M?(b=r,C=s,T=d.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(A!==y){if(2==(M=t(e,n,o,d,p)))return void h.push(new u(n.clone(),o.clone(),s,s,a,a,g));1==M?T?d.distanceTo(T)>c&&(S=s,k=a,w=d.clone()):(b=s,C=a,T=d.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(y!==E){var M=t(e,o,i,d,p);if(2==M)return void h.push(new u(o.clone(),i.clone(),a,a,r,r,g));1==M?T?d.distanceTo(T)>c&&(S=a,k=r,w=d.clone()):l.logger.warn("Unexpected single intersection point"):l.logger.warn("Unexpected zero intersections where at least one was expected")}T&&w?h.push(new u(T,w,b,C,S,k,g)):l.logger.warn("Unexpected one intersection where two were expected")}function n(e,t){g.set(t.min.x,t.min.y,t.min.z);var i=e.distanceToPoint(g),n=Math.sign(i);g.set(t.min.x,t.min.y,t.max.z);var o=e.distanceToPoint(g);return Math.sign(o)!==n||(g.set(t.min.x,t.max.y,t.min.z),o=e.distanceToPoint(g),Math.sign(o)!==n||(g.set(t.min.x,t.max.y,t.max.z),o=e.distanceToPoint(g),Math.sign(o)!==n||(g.set(t.max.x,t.min.y,t.min.z),o=e.distanceToPoint(g),Math.sign(o)!==n||(g.set(t.max.x,t.min.y,t.max.z),o=e.distanceToPoint(g),Math.sign(o)!==n||(g.set(t.max.x,t.max.y,t.min.z),o=e.distanceToPoint(g),Math.sign(o)!==n||(g.set(t.max.x,t.max.y,t.max.z),o=e.distanceToPoint(g),Math.sign(o)!==n))))))}function o(e,t,n){var o=t.geometry,r=n.length,s=o.attributes,a=t.matrixWorld;E.getInverse(a),A.copy(e).applyMatrix4(E);var l,c,u;if(void 0!==s.index){var h=s.index.array||o.ib,d=o.vb?o.vb:s.position.array,p=o.vb?o.vbstride:3,g=o.offsets;g&&0!==g.length||(g=[{start:0,count:h.length,index:0}]);for(var y=0,T=g.length;y<T;++y)for(var w=g[y].start,b=g[y].count,C=g[y].index,S=w,k=w+b;S<k;S+=3)l=C+h[S],c=C+h[S+1],u=C+h[S+2],m.x=d[l*p],m.y=d[l*p+1],m.z=d[l*p+2],v.x=d[c*p],v.y=d[c*p+1],v.z=d[c*p+2],f.x=d[u*p],f.y=d[u*p+1],f.z=d[u*p+2],i(A,m,v,f,l,c,u,n,t.fragId)}else for(var d=o.vb?o.vb:s.position.array,p=o.vb?o.vbstride:3,S=0,M=0,k=d.length;S<k;S+=3,M+=9)l=S,c=S+1,u=S+2,m.x=d[l*p],m.y=d[l*p+1],m.z=d[l*p+2],v.x=d[c*p],v.y=d[c*p+1],v.z=d[c*p+2],f.x=d[u*p],f.y=d[u*p+1],f.z=d[u*p+2],i(A,m,v,f,l,c,u,n,t.fragId);for(S=r;S<n.length;S++)n[S].pt1.applyMatrix4(a),n[S].pt2.applyMatrix4(a)}function r(e,t,i){var n=t,o=Math.sqrt(1-n*n),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,u=r*a;i.set(c*s+n,c*a-o*l,c*l+o*a,0,c*a+o*l,u*a+n,u*l-o*s,0,c*l-o*a,u*l+o*s,r*l*l+n,0,0,0,0,1)}function s(t){var i=new THREE.Vector3(0,0,1),n=t.normal.clone().cross(i);n=n.normalize();var o=i.dot(t.normal),s=new THREE.Matrix4;return e(n.x)&&e(n.y)&&e(n.z)?s.elements[14]=o*t.constant:(r(n,o,s),s.elements[14]=t.constant),s}function a(e,t,i){for(var n=0;n<t.length;n++){var o=t[n];o.pt1.applyMatrix4(e),o.pt2.applyMatrix4(e),i.expandByPoint(o.pt1),i.expandByPoint(o.pt2)}}var l=Autodesk.Viewing.Private,c=1e-10,u=Autodesk.Viewing.Private.Triangulator.Edge,h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector3,v=new THREE.Vector3,f=new THREE.Vector3,E=new THREE.Matrix4,A=new THREE.Plane;return{makePlaneBasis:s,convertToPlaneCoords:a,intersectTrianglePlane:i,intersectMeshPlane:o,intersectBoxPlane:n}}())}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(e,t,i){THREE.Mesh.call(this,e,t,!1),this.plane=i,this.planeVec=new THREE.Vector4(i.normal.x,i.normal.y,i.normal.z,i.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var e=this.plane.normal,t=-1*this.getWorldPosition().dot(e);this.planeVec.set(e.x,e.y,e.z,t),this.plane.constant=t})}function ResultCollection(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0}function init_TransformGizmos(){"use strict";var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(e,t,i,n){function o(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var i=s(e)/2/Math.PI+.5,n=a(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-n),t}function r(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);c.faces.push(n),E.copy(e).add(t).add(i).divideScalar(3);var o=s(E);c.faceVertexUvs[0].push([l(e.uv,e,o),l(t.uv,t,o),l(i.uv,i,o)])}function s(e){return Math.atan2(e.z,-e.x)}function a(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function l(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0;for(var c=this,u=0,h=e.length;u<h;u+=3)o(new THREE.Vector3(e[u],e[u+1],e[u+2]));for(var d=this.vertices,p=[],u=0,g=0,h=t.length;u<h;u+=3,g++){var m=d[t[u]],v=d[t[u+1]],f=d[t[u+2]];p[g]=new THREE.Face3(m.index,v.index,f.index,[m.clone(),v.clone(),f.clone()])}for(var E=new THREE.Vector3,u=0,h=p.length;u<h;u++)!function(e,t){for(var i=Math.pow(2,t),n=(Math.pow(4,t),o(c.vertices[e.a])),s=o(c.vertices[e.b]),a=o(c.vertices[e.c]),l=[],u=0;u<=i;u++){l[u]=[];for(var h=o(n.clone().lerp(a,u/i)),d=o(s.clone().lerp(a,u/i)),p=i-u,g=0;g<=p;g++)l[u][g]=0==g&&u==i?h:o(h.clone().lerp(d,g/p))}for(u=0;u<i;u++)for(g=0;g<2*(i-u)-1;g++){var m=Math.floor(g/2);g%2==0?r(l[u][m+1],l[u+1][m],l[u][m]):r(l[u][m+1],l[u+1][m+1],l[u+1][m])}}(p[u],n);for(var u=0,h=this.faceVertexUvs[0].length;u<h;u++){var A=this.faceVertexUvs[0][u],y=A[0].x,T=A[1].x,w=A[2].x,b=Math.max(y,Math.max(T,w)),C=Math.min(y,Math.min(T,w));b>.9&&C<.1&&(y<.2&&(A[0].x+=1),T<.2&&(A[1].x+=1),w<.2&&(A[2].x+=1))}for(var u=0,h=this.vertices.length;u<h;u++)this.vertices[u].multiplyScalar(i);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(e,t,i,n,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:o},e=e||100,t=t||40,i=i||8,n=n||6,o=o||2*Math.PI;for(var r=new THREE.Vector3,s=[],a=[],l=0;l<=i;l++)for(d=0;d<=n;d++){var c=d/n*o,u=l/i*Math.PI*2;r.x=e*Math.cos(c),r.y=e*Math.sin(c);var h=new THREE.Vector3;h.x=(e+t*Math.cos(u))*Math.cos(c),h.y=(e+t*Math.cos(u))*Math.sin(c),h.z=t*Math.sin(u),this.vertices.push(h),s.push(new THREE.Vector2(d/n,l/i)),a.push(h.clone().sub(r).normalize())}for(l=1;l<=i;l++)for(var d=1;d<=n;d++){var p=(n+1)*l+d-1,g=(n+1)*(l-1)+d-1,m=(n+1)*(l-1)+d,v=(n+1)*l+d,f=new THREE.Face3(p,g,v,[a[p].clone(),a[g].clone(),a[v].clone()]);this.faces.push(f),this.faceVertexUvs[0].push([s[p].clone(),s[g].clone(),s[v].clone()]),f=new THREE.Face3(g,m,v,[a[g].clone(),a[m].clone(),a[v].clone()]),this.faces.push(f),this.faceVertexUvs[0].push([s[g].clone(),s[m].clone(),s[v].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var i=function(e,t,i){var n=new THREE.Geometry;i=i||1;for(var o=0;o<=64*i;++o)"x"==t&&n.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&n.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&n.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e));return n},n=function(e,t,i,n,o,r){var s=new THREE.Geometry,a=new THREE.Mesh(new THREE.CylinderGeometry(e,t,i,n,o,r));return a.position.y=.5,a.updateMatrix(),s.merge(a.geometry,a.matrix),s},o=function(e){var t=new THREE.Geometry;return"X"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),t};THREE.TransformGizmo=function(){var e=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({wireframe:!0});t.side=THREE.DoubleSide;var i={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)};this.activePlane=i.XYZE,i.YZ.rotation.set(0,Math.PI/2,0),i.XZ.rotation.set(-Math.PI/2,0,0);for(var n in i)i[n].name=n,this.planes.add(i[n]),this.planes[n]=i[n],i[n].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix();var t=new THREE.Geometry;e.geometry instanceof THREE.BufferGeometry&&(e.geometry=(new THREE.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(e){e.visible=!1})},this.show=function(){this.traverse(function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))})},this.setupGizmos=function(){var e=function(e,t){for(var i in e)for(var n=e[i].length;n--;){var o=e[i][n][0],r=e[i][n][1],s=e[i][n][2],a=e[i][n][3];o.name=i,r&&o.position.set(r[0],r[1],r[2]),s&&o.rotation.set(s[0],s[1],s[2]),a&&(o.visble=a),t.add(o)}};this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(e,t){var i=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse(function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(t,i,n)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(e))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(0,.05,.2,12,1,!1),r=o("X"),s=o("Y"),a=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:15805484}))]],Y:[[new THREE.Mesh(i,new e({color:768011})),[0,.5,0]],[new THREE.Line(s,new t({color:768011}))]],Z:[[new THREE.Mesh(i,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(i(1,"x",.5),new t({color:16711680}))]],RY:[[new THREE.Line(i(1,"y",.5),new t({color:65280}))]],RZ:[[new THREE.Line(i(1,"z",.5),new t({color:255}))]],RE:[[new THREE.Line(i(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new THREE.Line(i(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,u=new THREE.Quaternion,h=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),h.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),e.quaternion.copy(o))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=n(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,u=new THREE.Quaternion,h=t.clone();n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),h.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-h.y,h.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(h.x,h.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(u.setFromAxisAngle(a,Math.atan2(h.y,h.x)),o.multiplyQuaternions(o,u),e.quaternion.copy(o))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(i){i.material&&i.material.highlight&&(i.name==e?(i.parent!=t.highlights&&i.parent!=t.handles||(i.visible=!0),i.material.highlight(!0)):(i.material.highlight(!1),i.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(.125,.125,.125),r=o("X"),s=o("Y"),a=o("Z");this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:16711680}))]],Y:[[new THREE.Mesh(i,new e({color:65280})),[0,.5,0]],[new THREE.Line(s,new t({color:65280}))]],Z:[[new THREE.Mesh(i,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4;t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,i){function n(i,n){var o=t.getBoundingClientRect(),r=(i.clientX-o.left)/o.width*2-1,s=-(i.clientY-o.top)/o.height*2+1;e.isPerspective?(f.set(r,s,.5),f.unproject(e),v.set(e.position,f.sub(e.position).normalize())):(f.set(r,s,-1),f.unproject(e),E.set(0,0,-1),v.set(f,E.transformDirection(e.matrixWorld)));var a=v.intersectObjects(n,!0);return!!a[0]&&a[0]}switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},i){case"translate":this.gizmo[i]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[i]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[i]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[i]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[i]),this.gizmo[i].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===i){(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));r=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,r);var o=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,r);var o=new THREE.Geometry,r=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,r);var s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));s.magFilter=s.minFilter=THREE.NearestFilter;var o=new THREE.CircleGeometry(.1,32),r=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:s});this.centerMark=new THREE.Mesh(o,r),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=s.minFilter=THREE.NearestFilter;var r=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:s}),a=.25;this.ticks.RX=new THREE.Object3D;var o=new THREE.PlaneBufferGeometry(.12,a),l=new THREE.Mesh(o,r);l.position.set(0,0,-1.275),l.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(l),(l=l.clone()).position.set(0,-1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),this.ticks.RY=new THREE.Object3D,(l=l.clone()).position.set(0,0,-1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(-1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l),(l=l.clone()).position.set(0,0,1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),(l=l.clone()).position.set(1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l)}var c=this,u=!1,h=i,d={type:"change"},p={type:"mouseDown"},g={type:"mouseUp",mode:h},m={type:"objectChange"},v=new THREE.Raycaster,f=new THREE.Vector3,E=new THREE.Vector3,A=new THREE.Vector3,y=new THREE.Vector3,T=new THREE.Vector3,w=new THREE.Vector3,b=1,C=new THREE.Matrix4,S=new THREE.Vector3,k=new THREE.Matrix4,M=new THREE.Vector3,x=new THREE.Quaternion,R=new THREE.Vector3,P=new THREE.Vector3,V=new THREE.Vector3,I=new THREE.Quaternion,N=new THREE.Quaternion,D=new THREE.Quaternion,L=new THREE.Quaternion,O=new THREE.Quaternion,_=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Matrix4,F=new THREE.Matrix4,z=new THREE.Vector3,U=new THREE.Vector3,G=new THREE.Euler,W=new THREE.Matrix4,j=new THREE.Vector3;new THREE.Euler;this.attach=function(e){c.object=e,this.gizmo[h].show(),c.update(),c.updateUnitVectors()},this.detach=function(e){c.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(e){"scale"==(h=e||h)&&(c.space="local"),this.gizmo[h].show(),this.update(),c.dispatchEvent(d)},this.getPicker=function(){return c.gizmo[h].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){x.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(x),this.unitY.applyQuaternion(x),this.unitZ.applyQuaternion(x),this.normal.copy(e),this.object&&this.object.quaternion.multiply(x),this.update()},this.setSnap=function(e,t){c.snap=e,c.snapDelta=t},this.setSize=function(e){c.size=e,this.update(),c.dispatchEvent(d)},this.setSpace=function(e){c.space=e,this.update(),c.dispatchEvent(d)},this.update=function(i){if(void 0!==c.object){c.object.updateMatrixWorld(),U.setFromMatrixPosition(c.object.matrixWorld),G.setFromRotationMatrix(k.extractRotation(c.object.matrixWorld)),e.updateMatrixWorld(),j.setFromMatrixPosition(e.matrixWorld),this.position.copy(U),this.quaternion.setFromEuler(G),this.normal.set(0,0,1),this.normal.applyEuler(G);var n=U.distanceTo(j),o=e.isPerspective?2*Math.tan(e.fov*Math.PI/360)*n:n,r=t.getBoundingClientRect();b=100*o/r.height,this.scale.set(b,b,b),i&&this.gizmo[h].highlight(c.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(G),this.unitY.applyEuler(G),this.unitZ.applyEuler(G)},this.showRotationGizmos=function(e){for(var t=this.gizmo[h].handles.children,i=0;i<t.length;i++){var n=t[i];n.visible=!0,-1!==n.name.search("R")&&(n.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===c.object||!0===u)return!1;var t=n(e.pointers?e.pointers[0]:e,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children),i=null,o="";return t&&(o=-1!=(i=t.object.name).search("R")?"rotate":"translate"),c.axis!==i&&(c.axis=i,c.gizmo[h].activeMode=o,c.update(!0),c.dispatchEvent(d)),null===c.axis&&c.gizmo[h].show(),!!t},this.onPointerDown=function(t){if(void 0===c.object||!0===u)return!1;var i=t.pointers?t.pointers[0]:t;if("touch"===t.pointerType){var o=null,r="";(s=n(i,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))&&(r=-1!=(o=s.object.name).search("R")?"rotate":"translate"),c.axis!==o&&(c.axis=o,c.gizmo[h].activeMode=r)}var s=null;if((0===i.button||void 0===i.button)&&(s=n(i,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))){c.dispatchEvent(p),c.axis=s.object.name,c.update(),S.copy(e.position).sub(U).normalize(),c.gizmo[h].setActivePlane(c.axis,S);var a=n(i,[c.gizmo[h].activePlane]);if(a&&y.copy(a.point),_.copy(c.object.position),H.copy(c.object.scale),B.extractRotation(c.object.matrix),W.extractRotation(c.object.matrixWorld),c.object.parent?(F.extractRotation(c.object.parent.matrixWorld),z.setFromMatrixScale(k.getInverse(c.object.parent.matrixWorld))):(F.extractRotation(c.object.matrixWorld),z.setFromMatrixScale(k.getInverse(c.object.matrixWorld))),"transrotate"===h&&"rotate"===c.gizmo[h].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine);var l=c.object.geometry.getAttribute("position"),d=(new THREE.Vector3).fromAttribute(l,0).applyMatrix4(c.object.matrixWorld),g=(new THREE.Vector3).fromAttribute(l,1).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(l,2).applyMatrix4(c.object.matrixWorld),v=(new THREE.Vector3).fromAttribute(l,3).applyMatrix4(c.object.matrixWorld);if("RX"===c.axis){d.lerp(m,.5),g.lerp(v,.5);f=d.distanceTo(g);c.centerLine.material.dashSize=f/15,c.centerLine.material.gapSize=f/30,c.centerLine.geometry.vertices[0].copy(d),c.centerLine.geometry.vertices[1].copy(g)}else{d.lerp(g,.5),m.lerp(v,.5);var f=d.distanceTo(m);c.centerLine.material.dashSize=f/15,c.centerLine.material.gapSize=f/30,c.centerLine.geometry.vertices[0].copy(d),c.centerLine.geometry.vertices[1].copy(m)}c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return u=!0,!!s},this.onPointerMove=function(e){if(void 0===c.object||null===c.axis||!1===u)return!1;var t=n(e.pointers?e.pointers[0]:e,[c.gizmo[h].activePlane]);t&&A.copy(t.point);var i=c.gizmo[h].activeMode;if("translate"==i)A.sub(y),A.multiply(z),"local"==c.space&&(A.applyMatrix4(k.getInverse(W)),R.copy(this.unitX),P.copy(this.unitY),V.copy(this.unitZ),M.set(0,0,0),-1!=c.axis.search("X")&&(R.multiplyScalar(A.dot(this.unitX)),M.add(R)),-1!=c.axis.search("Y")&&(P.multiplyScalar(A.dot(this.unitY)),M.add(P)),-1!=c.axis.search("Z")&&(V.multiplyScalar(A.dot(this.unitZ)),M.add(V)),A.copy(M),A.applyMatrix4(B),c.object.position.copy(_),c.object.position.add(A)),"world"!=c.space&&-1==c.axis.search("XYZ")||(R.copy(this.unitX),P.copy(this.unitY),V.copy(this.unitZ),M.set(0,0,0),-1!=c.axis.search("X")&&(R.multiplyScalar(A.dot(this.unitX)),M.add(R)),-1!=c.axis.search("Y")&&(P.multiplyScalar(A.dot(this.unitY)),M.add(P)),-1!=c.axis.search("Z")&&(V.multiplyScalar(A.dot(this.unitZ)),M.add(V)),A.copy(M),A.applyMatrix4(k.getInverse(F)),c.object.position.copy(_),c.object.position.add(A));else if("scale"==i)A.sub(y),A.multiply(z),"local"==c.space&&("XYZ"==c.axis?(b=1+A.y/50,c.object.scale.x=H.x*b,c.object.scale.y=H.y*b,c.object.scale.z=H.z*b):(A.applyMatrix4(k.getInverse(W)),"X"==c.axis&&(c.object.scale.x=H.x*(1+A.x/50)),"Y"==c.axis&&(c.object.scale.y=H.y*(1+A.y/50)),"Z"==c.axis&&(c.object.scale.z=H.z*(1+A.z/50))));else if("rotate"==i){if(A.sub(U),A.multiply(z),M.copy(y).sub(U),M.multiply(z),"RE"==c.axis){A.applyMatrix4(k.getInverse(C)),M.applyMatrix4(k.getInverse(C)),T.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),w.set(Math.atan2(M.z,M.y),Math.atan2(M.x,M.z),Math.atan2(M.y,M.x)),x.setFromRotationMatrix(k.getInverse(F));G=T.z-w.z;if(null!==c.snap){j=Math.round(G/c.snap)*c.snap;Math.abs(j-G)<c.snapDelta&&(G=j)}O.setFromAxisAngle(S,G),I.setFromRotationMatrix(W),x.multiplyQuaternions(x,O),x.multiplyQuaternions(x,I),c.object.quaternion.copy(x)}else if("RXYZE"==c.axis){var o=A.clone().cross(M).normalize();x.setFromRotationMatrix(k.getInverse(F));var r=-A.clone().angleTo(M);if(null!==c.snap){j=Math.round(r/c.snap)*c.snap;Math.abs(j-r)<c.snapDelta&&(r=j)}N.setFromAxisAngle(o,r),I.setFromRotationMatrix(W),x.multiplyQuaternions(x,N),x.multiplyQuaternions(x,I),c.object.quaternion.copy(x)}else if("local"==c.space){A.applyMatrix4(k.getInverse(W)),M.applyMatrix4(k.getInverse(W));var s=A.dot(this.unitX),a=A.dot(this.unitY),l=A.dot(this.unitZ),p=M.dot(this.unitX),g=M.dot(this.unitY),v=M.dot(this.unitZ);T.set(Math.atan2(l,a),Math.atan2(s,l),Math.atan2(a,s)),w.set(Math.atan2(v,g),Math.atan2(p,v),Math.atan2(g,p));var f=T.x-w.x,E=T.y-w.y,G=T.z-w.z;if(null!==c.snap){if(-1!=c.axis.search("X")){j=Math.round(f/c.snap)*c.snap;Math.abs(j-f)<c.snapDelta&&(f=j)}if(-1!=c.axis.search("Y")){j=Math.round(E/c.snap)*c.snap;Math.abs(j-E)<c.snapDelta&&(E=j)}if(-1!=c.axis.search("Z")){j=Math.round(G/c.snap)*c.snap;Math.abs(j-G)<c.snapDelta&&(G=j)}}N.setFromAxisAngle(this.unitX,f),D.setFromAxisAngle(this.unitY,E),L.setFromAxisAngle(this.unitZ,G),I.setFromRotationMatrix(B),"RX"==c.axis&&I.multiplyQuaternions(I,N),"RY"==c.axis&&I.multiplyQuaternions(I,D),"RZ"==c.axis&&I.multiplyQuaternions(I,L),c.object.quaternion.copy(I)}else if("world"==c.space){var s=A.dot(this.unitX),a=A.dot(this.unitY),l=A.dot(this.unitZ),p=M.dot(this.unitX),g=M.dot(this.unitY),v=M.dot(this.unitZ);T.set(Math.atan2(l,a),Math.atan2(s,l),Math.atan2(a,s)),w.set(Math.atan2(v,g),Math.atan2(p,v),Math.atan2(g,p)),x.setFromRotationMatrix(k.getInverse(F));var f=T.x-w.x,E=T.y-w.y,G=T.z-w.z;if(null!==c.snap){if(-1!=c.axis.search("X")){j=Math.round(f/c.snap)*c.snap;Math.abs(j-f)<c.snapDelta&&(f=j)}if(-1!=c.axis.search("Y")){j=Math.round(E/c.snap)*c.snap;Math.abs(j-E)<c.snapDelta&&(E=j)}if(-1!=c.axis.search("Z")){var j=Math.round(G/c.snap)*c.snap;Math.abs(j-G)<c.snapDelta&&(G=j)}}N.setFromAxisAngle(this.unitX,f),D.setFromAxisAngle(this.unitY,E),L.setFromAxisAngle(this.unitZ,G),I.setFromRotationMatrix(W),"RX"==c.axis&&x.multiplyQuaternions(x,N),"RY"==c.axis&&x.multiplyQuaternions(x,D),"RZ"==c.axis&&x.multiplyQuaternions(x,L),x.multiplyQuaternions(x,I),c.object.quaternion.copy(x)}"transrotate"===h&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(d),c.dispatchEvent(m),!!t},this.onPointerUp=function(e){return u&&null!==c.axis&&(g.mode=h,c.dispatchEvent(g)),u=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}(AutodeskNamespace=function(e){for(var t=getGlobal(),i=e.split("."),n=0;n<i.length;++n)t[i[n]]=t[i[n]]||{},t=t[i[n]];return t})("Autodesk.Viewing.Private"),AutodeskNamespace("Autodesk.Viewing.Extensions"),AutodeskNamespace("Autodesk.Viewing.Shaders"),AutodeskNamespace("Autodesk.Viewing.UI"),AutodeskNamespace("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=getGlobal,Autodesk.Viewing.AutodeskNamespace=AutodeskNamespace,Autodesk.Viewing.Private.initializeLegacyNamespaces=function(e){var t=Autodesk.Viewing,i=t.Shaders,n=t.Private;n.InstanceTreeStorage=WGS.InstanceTreeStorage,n.InstanceTreeAccess=WGS.InstanceTreeAccess,n.BVHBuilder=WGS.BVHBuilder,n.NodeArray=WGS.NodeArray,e||(i.PackDepthShaderChunk=WGS.PackDepthShaderChunk,i.TonemapShaderChunk=WGS.TonemapShaderChunk,i.OrderedDitheringShaderChunk=WGS.OrderedDitheringShaderChunk,i.CutPlanesUniforms=WGS.CutPlanesUniforms,i.CutPlanesShaderChunk=WGS.CutPlanesShaderChunk,i.PackNormalsShaderChunk=WGS.PackNormalsShaderChunk,i.HatchPatternShaderChunk=WGS.HatchPatternShaderChunk,i.EnvSamplingShaderChunk=WGS.EnvSamplingShaderChunk,i.IdUniforms=WGS.IdUniforms,i.IdFragmentDeclaration=WGS.IdFragmentDeclaration,i.IdOutputShaderChunk=WGS.IdOutputShaderChunk,i.FinalOutputShaderChunk=WGS.FinalOutputShaderChunk,i.ThemingUniform=WGS.ThemingUniform,i.ThemingFragmentDeclaration=WGS.ThemingFragmentDeclaration,i.ThemingFragmentShaderChunk=WGS.ThemingFragmentShaderChunk,i.BackgroundShader=WGS.BackgroundShader,i.BlendShader=WGS.BlendShader,i.CelShader=WGS.CelShader,i.CopyShader=WGS.CopyShader,i.FXAAShader=WGS.FXAAShader,i.SAOBlurShader=WGS.SAOBlurShader,i.SAOMinifyFirstShader=WGS.SAOMinifyFirstShader,i.SAOMinifyShader=WGS.SAOMinifyShader,i.SAOShader=WGS.SAOShader,i.NormalsShader=WGS.NormalsShader,i.LineShader=WGS.LineShader,n.LineStyleDefs=WGS.LineStyleDefs,n.CreateLinePatternTexture=WGS.CreateLinePatternTexture,n.FloatToHalf=WGS.FloatToHalf,n.HalfToFloat=WGS.HalfToFloat,n.IntToHalf=WGS.IntToHalf,n.HalfToInt=WGS.HalfToInt,n.HalfTest=WGS.HalfTest,i.createShaderMaterial=WGS.createShaderMaterial,i.setMacro=WGS.setMacro,i.removeMacro=WGS.removeMacro,i.LmvShaderPass=WGS.ShaderPass,i.GaussianPass=WGS.GaussianPass,i.GroundShadow=WGS.GroundShadow,i.createGroundShape=WGS.createGroundShape,i.setGroundShapeTransform=WGS.setGroundShapeTransform,i.GroundReflection=WGS.GroundReflection,n.FireflyWebGLShader=WGS.WebGLShader,n.PrismMaps=WGS.PrismMaps,n.GetPrismMapChunk=WGS.GetPrismMapChunk,n.FireflyWebGLProgram=WGS.WebGLProgram,i.ShadowMapCommonUniforms=WGS.ShadowMapCommonUniforms,i.ShadowMapUniforms=WGS.ShadowMapUniforms,i.ShadowMapDeclareCommonUniforms=WGS.ShadowMapDeclareCommonUniforms,i.ShadowMapVertexDeclaration=WGS.ShadowMapVertexDeclaration,i.ShadowMapVertexShaderChunk=WGS.ShadowMapVertexShaderChunk,i.ShadowMapFragmentDeclaration=WGS.ShadowMapFragmentDeclaration,i.FireflyPhongShader=WGS.PhongShader,i.PrismShader=WGS.PrismShader,i.GetPrismMapUniforms=WGS.GetPrismMapUniforms,i.GetPrismMapSampleChunk=WGS.GetPrismMapSampleChunk,i.GetPrismMapUniformChunk=WGS.GetPrismMapUniformChunk,i.AverageOfFloat3=WGS.AverageOfFloat3,n.createPrismMaterial=WGS.createPrismMaterial,n.clonePrismMaterial=WGS.clonePrismMaterial,n.ShadowMapShader=WGS.ShadowMapShader,n.GroundShadowShader=WGS.GroundShadowShader,n.ShadowMapOverrideMaterials=WGS.ShadowMapOverrideMaterials,n.SHADOWMAP_NEEDS_UPDATE=WGS.SHADOWMAP_NEEDS_UPDATE,n.SHADOWMAP_INCOMPLETE=WGS.SHADOWMAP_INCOMPLETE,n.SHADOWMAP_VALID=WGS.SHADOWMAP_VALID,n.ShadowConfig=WGS.ShadowConfig,n.ShadowRender=WGS.ShadowRender,n.ShadowMaps=WGS.ShadowMaps,n.FrustumIntersector=WGS.FrustumIntersector,n.OUTSIDE=WGS.OUTSIDE,n.INTERSECTS=WGS.INTERSECTS,n.CONTAINS=WGS.CONTAINS,n.VBIntersector=WGS.VBIntersector,n.memoryOptimizedLoading=WGS.memoryOptimizedLoading,n.GPU_MEMORY_LIMIT=WGS.GPU_MEMORY_LIMIT,n.GPU_OBJECT_LIMIT=WGS.GPU_OBJECT_LIMIT,n.FRAGS_PERSISTENT_COUNT=WGS.FRAGS_PERSISTENT_COUNT,n.FRAGS_PERSISTENT_MAX_COUNT=WGS.FRAGS_PERSISTENT_MAX_COUNT,n.MAX_2D_PERSISTENT_BUFFER_COUNT=WGS.MAX_2D_PERSISTENT_BUFFER_COUNT,n.PAGE_OUT_COUNT_2D=WGS.PAGE_OUT_COUNT_2D,n.PAGE_OUT_GOAL_2D=WGS.PAGE_OUT_GOAL_2D,n.GEOMS_COUNT_LIMIT=WGS.GEOMS_COUNT_LIMIT,n.onDemandLoading=WGS.onDemandLoading,n.cullGeometryOnLoading=WGS.cullGeometryOnLoading,n.pageOutGeometryEnabled=WGS.pageOutGeometryEnabled,n.PAGEOUT_SUCCESS=WGS.PAGEOUT_SUCCESS,n.PAGEOUT_FAIL=WGS.PAGEOUT_FAIL,n.PAGEOUT_NONE=WGS.PAGEOUT_NONE,n.PAGEOUT_PERCENTAGE=WGS.PAGEOUT_PERCENTAGE,n.GEOMS_PAGEOUT_COUNT=WGS.GEOMS_PAGEOUT_COUNT,n.GeometryList=WGS.GeometryList,n.MESH_VISIBLE=WGS.MESH_VISIBLE,n.MESH_HIGHLIGHTED=WGS.MESH_HIGHLIGHTED,n.MESH_HIDE=WGS.MESH_HIDE,n.MESH_ISLINE=WGS.MESH_ISLINE,n.MESH_ISWIDELINE=WGS.MESH_ISWIDELINE,n.MESH_ISPOINT=WGS.MESH_ISPOINT,n.MESH_MOVED=WGS.MESH_MOVED,n.MESH_TRAVERSED=WGS.MESH_TRAVERSED,n.MESH_DRAWN=WGS.MESH_DRAWN,n.MESH_RENDERFLAG=WGS.MESH_RENDERFLAG,n.FragmentPointer=WGS.FragmentPointer,n.FragmentList=WGS.FragmentList,n.RENDER_NORMAL=WGS.RENDER_NORMAL,n.RENDER_HIGHLIGHTED=WGS.RENDER_HIGHLIGHTED,n.RENDER_HIDDEN=WGS.RENDER_HIDDEN,n.RENDER_SHADOWMAP=WGS.RENDER_SHADOWMAP,n.RENDER_FINISHED=WGS.RENDER_FINISHED,n.RenderBatch=WGS.RenderBatch,t.rescueFromPolymer=WGS.rescueFromPolymer,n.FireflyWebGLRenderer=WGS.WebGLRenderer,n.ModelIteratorLinear=WGS.ModelIteratorLinear,n.ModelIteratorBVH=WGS.ModelIteratorBVH,n.BufferGeometryUtils=WGS.BufferGeometry,n.RenderScene=WGS.RenderScene,n.SortedList=WGS.SortedList,n.ModelIteratorTexQuad=WGS.ModelIteratorTexQuad,n.TexQuadConfig=WGS.TexQuadConfig,n.InstanceTree=WGS.InstanceTree,t.SelectionMode=WGS.SelectionMode,n.MaterialConverter=WGS.MaterialConverter)};var avp=(av=Autodesk.Viewing).Private;av.getGlobal=getGlobal;var isBrowser=av.isBrowser="undefined"!=typeof navigator,isIE11=av.isIE11=isBrowser&&!!navigator.userAgent.match(/Edge|Trident\/7\./);"undefined"!=typeof window&&isIE11&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer;for(var i=t-e,n=new Uint8Array(this,e,i),o=new Uint8Array(i),r=0;r<i;r++)o[r]=n[r];return o.buffer}),function(){Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var launchFullscreen=av.launchFullscreen=function(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)},exitFullscreen=av.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},inFullscreen=av.inFullscreen=function(){return"webkitIsFullScreen"in document?document.webkitIsFullScreen:!!(document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenElement||document.querySelector(".viewer-fill-browser"))},fullscreenElement=av.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},isFullscreenAvailable=av.isFullscreenAvailable=function(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen},getAndroidVersion=av.getAndroidVersion=function(e){var t=(e=e||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]},isTouchDevice=av.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window};av.isIOSDevice=function(){return!!isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},av.isAndroidDevice=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("android")},av.isMobileDevice=function(){return!!isBrowser&&(av.isIOSDevice()||av.isAndroidDevice())},av.isSafari=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},av.isFirefox=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")},av.isMac=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")},av.isWindows=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")};var detectWebGL=av.detectWebGL=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<4;n++)try{if(i=e.getContext(t[n]),(i=rescueFromPolymer(i))&&"function"==typeof i.getParameter)return 1}catch(e){}return 0}return-1},touchStartToClick=av.touchStartToClick=function(e){e.preventDefault(),e.stopPropagation(),e.target.click()};!function(){var e=getGlobal();e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return"";for(var t="",i=this.valueOf();e>1;)1&e&&(t+=i),e>>=1,i+=i;return t+i};var av=Autodesk.Viewing;if((avp=Autodesk.Viewing.Private).BUILD_LMV_WORKER_URL="lmvworker.js",avp.LMV_WORKER_URL=avp.BUILD_LMV_WORKER_URL,avp.ENABLE_DEBUG=avp.ENABLE_DEBUG||!1,avp.ENABLE_TRACE=avp.ENABLE_TRACE||!1,avp.ENABLE_INLINE_WORKER=!0,function(){"use strict";function e(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(n.ENABLE_TRACE?n.LogLevels.DEBUG:n.LogLevels.ERROR)}function t(){return"undefined"!=typeof window?encodeURI(window.location.href):""}var i=Autodesk.Viewing,n=Autodesk.Viewing.Private;n.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0},e.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var o=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+o.substring(4))}this.environmentInfo={touch:i.isTouchDevice(),env:n.env,referer:t(),version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE};var r={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type};this.track(r);var s=this;this.interval=setInterval(function(){s.reportRuntimeStats()},6e4)},e.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},e.prototype.track=function(e){if(this.updateRuntimeStats(e),!n.offline&&this.sessionId){e.timestamp=Date.now(),e.sessionId=this.sessionId;var t=this.logToADP(e);this.callback&&this.callback(e,{adp:t})}},e.prototype.logToADP=function(e){if(!this.adp)return!1;var i="",n="";switch(e.category){case"tool_changed":case"pref_changed":i="CLICK_OPERATION",n=e.category+"/"+e.name;break;case"screen_mode":i="CLICK_OPERATION",n="pref_changed/"+e.category;break;case"metadata_load_stats":i="DOCUMENT_START",n="stats",e.full_url=t();break;case"model_load_stats":i="DOCUMENT_FULL",n="stats";break;case"error":i="BACKGROUND_CALL",n="error"}return!!i&&(this.adp.trackEvent(i,{operation:{id:e.sessionId,type:n,stage:"",status:"C",meta:e}}),!0)},e.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},e.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},e.prototype.setLevel=function(e){if(this.level!==e){this.level=e;var t=function(){},i=n.LogLevels,o=this,r=function(){if(o.callback){var e=Array.prototype.slice.call(arguments).join(" ");o.callback({category:"error",message:e},{adp:!1})}console.error.apply(console,arguments)};this.debug=e>=i.DEBUG?console.log.bind(console):t,this.log=e>=i.LOG?console.log.bind(console):t,this.info=e>=i.INFO?console.info.bind(console):t,this.warn=e>=i.WARNING?console.warn.bind(console):t,this.error=e>=i.ERROR?r:t}},Autodesk.Viewing.Private.logger=new e}(),"undefined"!=typeof window&&function(e,t,i,n){"use strict";function o(e,t,i){return setTimeout(u(e,i),t)}function r(e,t,i){return!!Array.isArray(e)&&(s(e,i[t],i),!0)}function s(e,t,i){var o;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==n)for(o=0;o<e.length;)t.call(i,e[o],o,e),o++;else for(o in e)e.hasOwnProperty(o)&&t.call(i,e[o],o,e)}function a(e,t,i){for(var o=Object.keys(t),r=0;r<o.length;)(!i||i&&e[o[r]]===n)&&(e[o[r]]=t[o[r]]),r++;return e}function l(e,t){return a(e,t,!0)}function c(e,t,i){var n,o=t.prototype;(n=e.prototype=Object.create(o)).constructor=e,n._super=o,i&&a(n,i)}function u(e,t){return function(){return e.apply(t,arguments)}}function h(e,t){return typeof e==ue?e.apply(t?t[0]||n:n,t):e}function d(e,t){return e===n?t:e}function p(e,t,i){s(f(t),function(t){e.addEventListener(t,i,!1)})}function g(e,t,i){s(f(t),function(t){e.removeEventListener(t,i,!1)})}function m(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function v(e,t){return e.indexOf(t)>-1}function f(e){return e.trim().split(/\s+/g)}function E(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n;n++}return-1}function A(e){return Array.prototype.slice.call(e,0)}function y(e,t,i){for(var n=[],o=[],r=0;r<e.length;){var s=t?e[r][t]:e[r];E(o,s)<0&&n.push(e[r]),o[r]=s,r++}return i&&(n=t?n.sort(function(e,i){return e[t]>i[t]}):n.sort()),n}function T(e,t){for(var i,o,r=t[0].toUpperCase()+t.slice(1),s=0;s<le.length;){if(i=le[s],(o=i?i+r:t)in e)return o;s++}return n}function w(){return ge++}function b(e){var t=e.ownerDocument;return t.defaultView||t.parentWindow}function C(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){h(e.options.enable,[e])&&i.handler(t)},this.init()}function S(e){var t=e.options.inputClass;return new(t||(fe?B:Ee?U:ve?W:H))(e,k)}function k(e,t,i){var n=i.pointers.length,o=i.changedPointers.length,r=t&we&&n-o==0,s=t&(Ce|Se)&&n-o==0;i.isFirst=!!r,i.isFinal=!!s,r&&(e.session={}),i.eventType=t,M(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function M(e,t){var i=e.session,n=t.pointers,o=n.length;i.firstInput||(i.firstInput=P(t)),o>1&&!i.firstMultiple?i.firstMultiple=P(t):1===o&&(i.firstMultiple=!1);var r=i.firstInput,s=i.firstMultiple,a=s?s.center:r.center,l=t.center=V(n);t.timeStamp=pe(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=L(a,l),t.distance=D(a,l),x(i,t),t.offsetDirection=N(t.deltaX,t.deltaY),t.scale=s?_(s.pointers,n):1,t.rotation=s?O(s.pointers,n):0,R(i,t);var c=e.element;m(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function x(e,t){var i=t.center,n=e.offsetDelta||{},o=e.prevDelta||{},r=e.prevInput||{};(t.eventType===we||r.eventType===Ce)&&(o=e.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=o.x+(i.x-n.x),t.deltaY=o.y+(i.y-n.y)}function R(e,t){var i,o,r,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=Se&&(l>Te||a.velocity===n)){var c=a.deltaX-t.deltaX,u=a.deltaY-t.deltaY,h=I(l,c,u);o=h.x,r=h.y,i=de(h.x)>de(h.y)?h.x:h.y,s=N(c,u),e.lastInterval=t}else i=a.velocity,o=a.velocityX,r=a.velocityY,s=a.direction;t.velocity=i,t.velocityX=o,t.velocityY=r,t.direction=s}function P(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:he(e.pointers[i].clientX),clientY:he(e.pointers[i].clientY)},i++;return{timeStamp:pe(),pointers:t,center:V(t),deltaX:e.deltaX,deltaY:e.deltaY}}function V(e){var t=e.length;if(1===t)return{x:he(e[0].clientX),y:he(e[0].clientY)};for(var i=0,n=0,o=0;t>o;)i+=e[o].clientX,n+=e[o].clientY,o++;return{x:he(i/t),y:he(n/t)}}function I(e,t,i){return{x:t/e||0,y:i/e||0}}function N(e,t){return e===t?ke:de(e)>=de(t)?e>0?Me:xe:t>0?Re:Pe}function D(e,t,i){i||(i=De);var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]];return Math.sqrt(n*n+o*o)}function L(e,t,i){i||(i=De);var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]];return 180*Math.atan2(o,n)/Math.PI}function O(e,t){return L(t[1],t[0],Le)-L(e[1],e[0],Le)}function _(e,t){return D(t[0],t[1],Le)/D(e[0],e[1],Le)}function H(){this.evEl=_e,this.evWin=He,this.allow=!0,this.pressed=!1,C.apply(this,arguments)}function B(){this.evEl=ze,this.evWin=Ue,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function F(){this.evTarget=We,this.evWin=je,this.started=!1,C.apply(this,arguments)}function z(e,t){var i=A(e.touches),n=A(e.changedTouches);return t&(Ce|Se)&&(i=y(i.concat(n),"identifier",!0)),[i,n]}function U(){this.evTarget=qe,this.targetIds={},C.apply(this,arguments)}function G(e,t){var i=A(e.touches),n=this.targetIds;if(t&(we|be)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var o,r,s=A(e.changedTouches),a=[],l=this.target;if(r=i.filter(function(e){return m(e.target,l)}),t===we)for(o=0;o<r.length;)n[r[o].identifier]=!0,o++;for(o=0;o<s.length;)n[s[o].identifier]&&a.push(s[o]),t&(Ce|Se)&&delete n[s[o].identifier],o++;return a.length?[y(r.concat(a),"identifier",!0),a]:void 0}function W(){C.apply(this,arguments);var e=u(this.handler,this);this.touch=new U(this.manager,e),this.mouse=new H(this.manager,e)}function j(e,t){this.manager=e,this.set(t)}function Y(e){if(v(e,$e))return $e;var t=v(e,et),i=v(e,tt);return t&&i?et+" "+tt:t||i?t?et:tt:v(e,Je)?Je:Ze}function q(e){this.id=w(),this.manager=null,this.options=l(e||{},this.defaults),this.options.enable=d(this.options.enable,!0),this.state=it,this.simultaneous={},this.requireFail=[]}function X(e){return e&at?"cancel":e&rt?"end":e&ot?"move":e&nt?"start":""}function K(e){return e==Pe?"down":e==Re?"up":e==Me?"left":e==xe?"right":""}function Q(e,t){var i=t.manager;return i?i.get(e):e}function Z(){q.apply(this,arguments)}function J(){Z.apply(this,arguments),this.pX=null,this.pY=null}function $(){Z.apply(this,arguments)}function ee(){q.apply(this,arguments),this._timer=null,this._input=null}function te(){Z.apply(this,arguments)}function ie(){Z.apply(this,arguments)}function ne(){q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function oe(e,t){return t=t||{},t.recognizers=d(t.recognizers,oe.defaults.preset),new re(e,t)}function re(e,t){t=t||{},this.options=l(t,oe.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=S(this),this.touchAction=new j(this,this.options.touchAction),se(this,!0),s(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function se(e,t){var i=e.element;s(e.options.cssProps,function(e,n){i.style[T(i.style,n)]=t?e:""})}function ae(e,i){var n=t.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var le=["","webkit","moz","MS","ms","o"],ce=t.createElement("div"),ue="function",he=Math.round,de=Math.abs,pe=Date.now,ge=1,me=/mobile|tablet|ip(ad|hone|od)|android/i,ve="ontouchstart"in e,fe=T(e,"PointerEvent")!==n,Ee=ve&&me.test(navigator.userAgent),Ae="touch",ye="mouse",Te=25,we=1,be=2,Ce=4,Se=8,ke=1,Me=2,xe=4,Re=8,Pe=16,Ve=Me|xe,Ie=Re|Pe,Ne=Ve|Ie,De=["x","y"],Le=["clientX","clientY"];C.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(b(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(b(this.element),this.evWin,this.domHandler)}};var Oe={mousedown:we,mousemove:be,mouseup:Ce},_e="mousedown",He="mousemove mouseup";c(H,C,{handler:function(e){var t=Oe[e.type];t&we&&0===e.button&&(this.pressed=!0),t&be&&1!==e.which&&(t=Ce),this.pressed&&this.allow&&(t&Ce&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:ye,srcEvent:e}))}});var Be={pointerdown:we,pointermove:be,pointerup:Ce,pointercancel:Se,pointerout:Se},Fe={2:Ae,3:"pen",4:ye,5:"kinect"},ze="pointerdown",Ue="pointermove pointerup pointercancel";e.MSPointerEvent&&(ze="MSPointerDown",Ue="MSPointerMove MSPointerUp MSPointerCancel"),c(B,C,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),o=Be[n],r=Fe[e.pointerType]||e.pointerType,s=r==Ae,a=E(t,e.pointerId,"pointerId");o&we&&(0===e.button||s)?0>a&&(t.push(e),a=t.length-1):o&(Ce|Se)&&(i=!0),0>a||(t[a]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:r,srcEvent:e}),i&&t.splice(a,1))}});var Ge={touchstart:we,touchmove:be,touchend:Ce,touchcancel:Se},We="touchstart",je="touchstart touchmove touchend touchcancel";c(F,C,{handler:function(e){var t=Ge[e.type];if(t===we&&(this.started=!0),this.started){var i=z.call(this,e,t);t&(Ce|Se)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:Ae,srcEvent:e})}}});var Ye={touchstart:we,touchmove:be,touchend:Ce,touchcancel:Se},qe="touchstart touchmove touchend touchcancel";c(U,C,{handler:function(e){var t=Ye[e.type],i=G.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:Ae,srcEvent:e})}}),c(W,C,{handler:function(e,t,i){var n=i.pointerType==Ae,o=i.pointerType==ye;if(n)this.mouse.allow=!1;else if(o&&!this.mouse.allow)return;t&(Ce|Se)&&(this.mouse.allow=!0),this.callback(e,t,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Xe=T(ce.style,"touchAction"),Ke=Xe!==n,Qe="compute",Ze="auto",Je="manipulation",$e="none",et="pan-x",tt="pan-y";j.prototype={set:function(e){e==Qe&&(e=this.compute()),Ke&&(this.manager.element.style[Xe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return s(this.manager.recognizers,function(t){h(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),Y(e.join(" "))},preventDefaults:function(e){if(!Ke){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var n=this.actions,o=v(n,$e),r=v(n,tt),s=v(n,et);return o||r&&i&Ve||s&&i&Ie?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var it=1,nt=2,ot=4,rt=8,st=rt,at=16;q.prototype={defaults:{},set:function(e){return a(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(r(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=Q(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return r(e,"dropRecognizeWith",this)?this:(e=Q(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(r(e,"requireFailure",this))return this;var t=this.requireFail;return e=Q(e,this),-1===E(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(r(e,"dropRequireFailure",this))return this;e=Q(e,this);var t=E(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?X(n):""),e)}var i=this,n=this.state;rt>n&&t(!0),t(),n>=rt&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=32)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|it)))return!1;e++}return!0},recognize:function(e){var t=a({},e);return h(this.options.enable,[this,t])?(this.state&(st|at|32)&&(this.state=it),this.state=this.process(t),void(this.state&(nt|ot|rt|at)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},c(Z,q,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=t&(nt|ot),o=this.attrTest(e);return n&&(i&Se||!o)?t|at:n||o?i&Ce?t|rt:t&nt?t|ot:nt:32}}),c(J,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ne},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ve&&t.push(tt),e&Ie&&t.push(et),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,o=e.direction,r=e.deltaX,s=e.deltaY;return o&t.direction||(t.direction&Ve?(o=0===r?ke:0>r?Me:xe,i=r!=this.pX,n=Math.abs(e.deltaX)):(o=0===s?ke:0>s?Re:Pe,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=o,i&&n>t.threshold&&o&t.direction},attrTest:function(e){return Z.prototype.attrTest.call(this,e)&&(this.state&nt||!(this.state&nt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=K(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),c($,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&nt)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=e.scale<1?"in":"out";this.manager.emit(this.options.event+t,e)}}}),c(ee,q,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Ze]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!n||!i||e.eventType&(Ce|Se)&&!r)this.reset();else if(e.eventType&we)this.reset(),this._timer=o(function(){this.state=st,this.tryEmit()},t.time,this);else if(e.eventType&Ce)return st;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===st&&(e&&e.eventType&Ce?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=pe(),this.manager.emit(this.options.event,this._input)))}}),c(te,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&nt)}}),c(ie,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ve|Ie,pointers:1},getTouchAction:function(){return J.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(Ve|Ie)?t=e.velocity:i&Ve?t=e.velocityX:i&Ie&&(t=e.velocityY),this._super.attrTest.call(this,e)&&i&e.direction&&e.distance>this.options.threshold&&de(t)>this.options.velocity&&e.eventType&Ce},emit:function(e){var t=K(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),c(ne,q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Je]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&we&&0===this.count)return this.failTimeout();if(n&&r&&i){if(e.eventType!=Ce)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||D(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=o(function(){this.state=st,this.tryEmit()},t.interval,this),nt):st}return 32},failTimeout:function(){return this._timer=o(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==st&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),oe.VERSION="2.0.4",oe.defaults={domEvents:!1,touchAction:Qe,enable:!0,inputTarget:null,inputClass:null,preset:[[te,{enable:!1}],[$,{enable:!1},["rotate"]],[ie,{direction:Ve}],[J,{direction:Ve},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};re.prototype={set:function(e){return a(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,n=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&st)&&(o=t.curRecognizer=null);for(var r=0;r<n.length;)i=n[r],2===t.stopped||o&&i!=o&&!i.canRecognizeWith(o)?i.reset():i.recognize(e),!o&&i.state&(nt|ot|rt)&&(o=t.curRecognizer=i),r++}},get:function(e){if(e instanceof q)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(r(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(r(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(E(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return s(f(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return s(f(e),function(e){t?i[e].splice(E(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&ae(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&se(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(oe,{INPUT_START:we,INPUT_MOVE:be,INPUT_END:Ce,INPUT_CANCEL:Se,STATE_POSSIBLE:it,STATE_BEGAN:nt,STATE_CHANGED:ot,STATE_ENDED:rt,STATE_RECOGNIZED:st,STATE_CANCELLED:at,STATE_FAILED:32,DIRECTION_NONE:ke,DIRECTION_LEFT:Me,DIRECTION_RIGHT:xe,DIRECTION_UP:Re,DIRECTION_DOWN:Pe,DIRECTION_HORIZONTAL:Ve,DIRECTION_VERTICAL:Ie,DIRECTION_ALL:Ne,Manager:re,Input:C,TouchAction:j,TouchInput:U,MouseInput:H,PointerEventInput:B,TouchMouseInput:W,SingleTouchInput:F,Recognizer:q,AttrRecognizer:Z,Tap:ne,Pan:J,Swipe:ie,Pinch:$,Rotate:te,Press:ee,on:p,off:g,each:s,merge:l,extend:a,inherit:c,bindFn:u,prefixed:T}),"undefined"!=typeof module&&module.exports,e.Hammer=oe}(window,document),LmvMatrix4=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(e,t,i,n,o,r,s,a,l,c,u,h,d,p,g,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=o,v[5]=r,v[9]=s,v[13]=a,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=g,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,u=i*a,h=i*l,d=n*a,p=n*l,g=o*l,m=r*s,v=r*a,f=r*l;return t[0]=1-(d+g),t[4]=u-f,t[8]=h+v,t[1]=u+f,t[5]=1-(c+g),t[9]=p-m,t[2]=h-v,t[6]=p+m,t[10]=1-(c+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,o=this.elements,r=i[0],s=i[4],a=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],p=i[2],g=i[6],m=i[10],v=i[14],f=i[3],E=i[7],A=i[11],y=i[15],T=n[0],w=n[4],b=n[8],C=n[12],S=n[1],k=n[5],M=n[9],x=n[13],R=n[2],P=n[6],V=n[10],I=n[14],N=n[3],D=n[7],L=n[11],O=n[15];return o[0]=r*T+s*S+a*R+l*N,o[4]=r*w+s*k+a*P+l*D,o[8]=r*b+s*M+a*V+l*L,o[12]=r*C+s*x+a*I+l*O,o[1]=c*T+u*S+h*R+d*N,o[5]=c*w+u*k+h*P+d*D,o[9]=c*b+u*M+h*V+d*L,o[13]=c*C+u*x+h*I+d*O,o[2]=p*T+g*S+m*R+v*N,o[6]=p*w+g*k+m*P+v*D,o[10]=p*b+g*M+m*V+v*L,o[14]=p*C+g*x+m*I+v*O,o[3]=f*T+E*S+A*R+y*N,o[7]=f*w+E*k+A*P+y*D,o[11]=f*b+E*M+A*V+y*L,o[15]=f*C+E*x+A*I+y*O,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],o=e[12],r=e[1],s=e[5],a=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+o*a*u-n*l*u-o*s*h+i*l*h+n*s*d-i*a*d)+e[7]*(+t*a*d-t*l*h+o*r*h-n*r*d+n*l*c-o*a*c)+e[11]*(+t*l*u-t*s*d-o*r*u+i*r*d+o*s*c-i*l*c)+e[15]*(-n*s*c-t*a*u+t*s*h+n*r*u-i*r*h+i*a*c)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,o=n[0],r=n[4],s=n[8],a=n[12],l=n[1],c=n[5],u=n[9],h=n[13],d=n[2],p=n[6],g=n[10],m=n[14],v=n[3],f=n[7],E=n[11],A=n[15];i[0]=u*m*f-h*g*f+h*p*E-c*m*E-u*p*A+c*g*A,i[4]=a*g*f-s*m*f-a*p*E+r*m*E+s*p*A-r*g*A,i[8]=s*h*f-a*u*f+a*c*E-r*h*E-s*c*A+r*u*A,i[12]=a*u*p-s*h*p-a*c*g+r*h*g+s*c*m-r*u*m,i[1]=h*g*v-u*m*v-h*d*E+l*m*E+u*d*A-l*g*A,i[5]=s*m*v-a*g*v+a*d*E-o*m*E-s*d*A+o*g*A,i[9]=a*u*v-s*h*v-a*l*E+o*h*E+s*l*A-o*u*A,i[13]=s*h*d-a*u*d+a*l*g-o*h*g-s*l*m+o*u*m,i[2]=c*m*v-h*p*v+h*d*f-l*m*f-c*d*A+l*p*A,i[6]=a*p*v-r*m*v-a*d*f+o*m*f+r*d*A-o*p*A,i[10]=r*h*v-a*c*v+a*l*f-o*h*f-r*l*A+o*c*A,i[14]=a*c*d-r*h*d-a*l*p+o*h*p+r*l*m-o*c*m,i[3]=u*p*v-c*g*v-u*d*f+l*g*f+c*d*E-l*p*E,i[7]=r*g*v-s*p*v+s*d*f-o*g*f-r*d*E+o*p*E,i[11]=s*c*v-r*u*v-s*l*f+o*u*f+r*l*E-o*c*E,i[15]=r*u*d-s*c*d+s*l*p-o*u*p-r*l*g+o*c*g;var y=o*i[0]+l*i[4]+d*i[8]+v*i[12];if(0==y){var T="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(T);return console.warn(T),this.identity(),this}return this.multiplyScalar(1/y),this},scale:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z;return t[0]*=i,t[4]*=n,t[8]*=o,t[1]*=i,t[5]*=n,t[9]*=o,t[2]*=i,t[6]*=n,t[10]*=o,t[3]*=i,t[7]*=n,t[11]*=o,this},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),o=1-i,r=e.x,s=e.y,a=e.z,l=o*r,c=o*s;return this.set(l*r+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*r,0,l*a-n*s,c*a+n*r,o*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},transformPoint:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements;return e.x=o[0]*t+o[4]*i+o[8]*n+o[12],e.y=o[1]*t+o[5]*i+o[9]*n+o[13],e.z=o[2]*t+o[6]*i+o[10]*n+o[14],e},transformDirection:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements;e.x=o[0]*t+o[4]*i+o[8]*n,e.y=o[1]*t+o[5]*i+o[9]*n,e.z=o[2]*t+o[6]*i+o[10]*n;var r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(r>0){var s=1/r;e.x*=s,e.y*=s,e.z*=s}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new LmvMatrix4(this.elements instanceof Float64Array).fromArray(this.elements)}},function(e){var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.lmv_poly2tri=function(){return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return o(i||e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,t,i){t.exports={version:"1.3.5"}},{}],2:[function(e,t,i){"use strict";var n=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},o=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};o.prototype.head=function(){return this.head_},o.prototype.setHead=function(e){this.head_=e},o.prototype.tail=function(){return this.tail_},o.prototype.setTail=function(e){this.tail_=e},o.prototype.search=function(){return this.search_node_},o.prototype.setSearch=function(e){this.search_node_=e},o.prototype.findSearchNode=function(){return this.search_node_},o.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},o.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),n=i.point.x;if(t===n){if(e!==i.point)if(e===i.prev.point)i=i.prev;else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");i=i.next}}else if(t<n)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=o,t.exports.Node=n},{}],3:[function(e,t,i){"use strict";function n(e,t){if(!e)throw new Error(t||"Assert Failed")}t.exports=n},{}],4:[function(e,t,i){"use strict";var n=e("./xy"),o=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};o.prototype.toString=function(){return n.toStringBase(this)},o.prototype.toJSON=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set_zero=function(){return this.x=0,this.y=0,this},o.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},o.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},o.prototype.mul=function(e){return this.x*=e,this.y*=e,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},o.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},o.negate=function(e){return new o(-e.x,-e.y)},o.add=function(e,t){return new o(e.x+t.x,e.y+t.y)},o.sub=function(e,t){return new o(e.x-t.x,e.y-t.y)},o.mul=function(e,t){return new o(e*t.x,e*t.y)},o.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new o(-e*t.y,e*t.x):"number"==typeof t?new o(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},o.toString=n.toString,o.compare=n.compare,o.cmp=n.compare,o.equals=n.equals,o.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=o},{"./xy":11}],5:[function(e,t,i){"use strict";var n=e("./xy"),o=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var i=0;i<t.length;i++)this.message+=" "+n.toString(t[i])};(o.prototype=new Error).constructor=o,t.exports=o},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict";var n=t.poly2tri;i.noConflict=function(){return t.poly2tri=n,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext");var o=e("./sweep");i.triangulate=o.triangulate,i.sweep={Triangulate:o.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict";function n(e){e.initTriangulation(),e.createAdvancingFront(),o(e),r(e)}function o(e){var t,i=e.pointCount();for(t=1;t<i;++t)for(var n=e.getPoint(t),o=s(e,n),r=n._p2t_edge_list,l=0;r&&l<r.length;++l)a(e,r[l],o)}function r(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i);e.meshClean(t)}function s(e,t){var i=e.locateNode(t),n=u(e,t,i);return t.x<=i.point.x+H&&h(e,i),d(e,n),n}function a(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,c(i.triangle,t.p,t.q)||(y(e,t,i),l(e,t.p,t.q,i.triangle,t.q))}function l(e,t,i,n,o){if(!c(n,t,i)){var r=n.pointCCW(o),s=F(i,r,t);if(s===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,r,t]);var a=n.pointCW(o),u=F(i,a,t);if(u===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,a,t]);s===u?l(e,t,i,n=s===B.CW?n.neighborCCW(o):n.neighborCW(o),o):R(e,t,i,n,o)}}function c(e,t,i){var n=e.edgeIndex(t,i);if(-1!==n){e.markConstrainedEdgeByIndex(n);var o=e.getNeighbor(n);return o&&o.markConstrainedEdgeByPoints(t,i),!0}return!1}function u(e,t,i){var n=new L(t,i.point,i.next.point);n.markNeighbor(i.triangle),e.addToMap(n);var o=new O(t);return o.next=i.next,o.prev=i,i.next.prev=o,i.next=o,g(e,n)||e.mapTriangleToNodes(n),o}function h(e,t){var i=new L(t.prev.point,t.point,t.next.point);i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,g(e,i)||e.mapTriangleToNodes(i)}function d(e,t){for(var i=t.next;i.next&&!U(i.point,i.next.point,i.prev.point);)h(e,i),i=i.next;for(i=t.prev;i.prev&&!U(i.point,i.next.point,i.prev.point);)h(e,i),i=i.prev;t.next&&t.next.next&&p(t)&&f(e,t)}function p(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y;return N(i>=0,"unordered y"),t>=0||Math.abs(t)<i}function g(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var n=t.getNeighbor(i);if(n){var o=t.getPoint(i),r=n.oppositePoint(t,o),s=n.index(r);if(n.constrained_edge[s]||n.delaunay_edge[s]){t.constrained_edge[i]=n.constrained_edge[s];continue}if(m(o,t.pointCCW(o),t.pointCW(o),r)){t.delaunay_edge[i]=!0,n.delaunay_edge[s]=!0,v(t,o,n,r);var a=!g(e,t);return a&&e.mapTriangleToNodes(t),(a=!g(e,n))&&e.mapTriangleToNodes(n),t.delaunay_edge[i]=!1,n.delaunay_edge[s]=!1,!0}}}return!1}function m(e,t,i,n){var o=e.x-n.x,r=e.y-n.y,s=t.x-n.x,a=t.y-n.y,l=o*a-s*r;if(l<=0)return!1;var c=i.x-n.x,u=i.y-n.y,h=c*r-o*u;return!(h<=0)&&(o*o+r*r)*(s*u-c*a)+(s*s+a*a)*h+(c*c+u*u)*l>0}function v(e,t,i,n){var o,r,s,a;o=e.neighborCCW(t),r=e.neighborCW(t),s=i.neighborCCW(n),a=i.neighborCW(n);var l,c,u,h;l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),u=i.getConstrainedEdgeCCW(n),h=i.getConstrainedEdgeCW(n);var d,p,g,m;d=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),g=i.getDelaunayEdgeCCW(n),m=i.getDelaunayEdgeCW(n),e.legalize(t,n),i.legalize(n,t),i.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(n,g),i.setDelaunayEdgeCW(n,m),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(n,u),i.setConstrainedEdgeCW(n,h),e.clearNeighbors(),i.clearNeighbors(),o&&i.markNeighbor(o),r&&e.markNeighbor(r),s&&e.markNeighbor(s),a&&i.markNeighbor(a),e.markNeighbor(i)}function f(e,t){for(F(t.point,t.next.point,t.next.next.point)===B.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,E(e,e.basin.bottom_node))}}function E(e,t){if(!A(e,t)){h(e,t);if(t.prev!==e.basin.left_node||t.next!==e.basin.right_node){if(t.prev===e.basin.left_node){if(F(t.point,t.next.point,t.next.next.point)===B.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(F(t.point,t.prev.point,t.prev.prev.point)===B.CCW)return;t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next;E(e,t)}}}function A(e,t){var i;return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}function y(e,t,i){e.edge_event.right?T(e,t,i):S(e,t,i)}function T(e,t,i){for(;i.next.point.x<t.p.x;)F(t.q,i.next.point,t.p)===B.CCW?w(e,t,i):i=i.next}function w(e,t,i){i.point.x<t.p.x&&(F(i.point,i.next.point,i.next.next.point)===B.CCW?b(e,t,i):(C(e,t,i),w(e,t,i)))}function b(e,t,i){h(e,i.next),i.next.point!==t.p&&F(t.q,i.next.point,t.p)===B.CCW&&F(i.point,i.next.point,i.next.next.point)===B.CCW&&b(e,t,i)}function C(e,t,i){F(i.next.point,i.next.next.point,i.next.next.next.point)===B.CCW?b(e,t,i.next):F(t.q,i.next.next.point,t.p)===B.CCW&&C(e,t,i.next)}function S(e,t,i){for(;i.prev.point.x>t.p.x;)F(t.q,i.prev.point,t.p)===B.CW?k(e,t,i):i=i.prev}function k(e,t,i){i.point.x>t.p.x&&(F(i.point,i.prev.point,i.prev.prev.point)===B.CW?x(e,t,i):(M(e,t,i),k(e,t,i)))}function M(e,t,i){F(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===B.CW?x(e,t,i.prev):F(t.q,i.prev.prev.point,t.p)===B.CW&&M(e,t,i.prev)}function x(e,t,i){h(e,i.prev),i.prev.point!==t.p&&F(t.q,i.prev.point,t.p)===B.CW&&F(i.point,i.prev.point,i.prev.prev.point)===B.CW&&x(e,t,i)}function R(e,t,i,n,o){var r=n.neighborAcross(o);N(r,"FLIP failed due to missing triangle!");var s=r.oppositePoint(n,o);if(n.getConstrainedEdgeAcross(o)){var a=n.index(o);throw new D("poly2tri Intersecting Constraints",[o,s,n.getPoint((a+1)%3),n.getPoint((a+2)%3)])}z(o,n.pointCCW(o),n.pointCW(o),s)?(v(n,o,r,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(r),o===i&&s===t?i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,i),r.markConstrainedEdgeByPoints(t,i),g(e,n),g(e,r)):R(e,t,i,n=P(e,F(i,s,t),n,r,o,s),o)):(I(e,t,i,n,r,V(t,i,r,s)),l(e,t,i,n,o))}function P(e,t,i,n,o,r){var s;return t===B.CCW?(s=n.edgeIndex(o,r),n.delaunay_edge[s]=!0,g(e,n),n.clearDelaunayEdges(),i):(s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,g(e,i),i.clearDelaunayEdges(),n)}function V(e,t,i,n){var o=F(t,n,e);if(o===B.CW)return i.pointCCW(n);if(o===B.CCW)return i.pointCW(n);throw new D("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}function I(e,t,i,n,o,r){var s=o.neighborAcross(r);N(s,"FLIP failed due to missing triangle");var a=s.oppositePoint(o,r);z(i,n.pointCCW(i),n.pointCW(i),a)?R(e,i,a,s,a):I(e,t,i,n,s,V(t,i,s,a))}var N=e("./assert"),D=e("./pointerror"),L=e("./triangle"),O=e("./advancingfront").Node,_=e("./utils"),H=_.EPSILON,B=_.Orientation,F=_.orient2d,z=_.inScanArea,U=_.isAngleObtuse;i.triangulate=n},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict";var n=e("./pointerror"),o=e("./point"),r=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),l=a.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(){this.constrained_edge=null,this.right=!1},d=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new h,this.initEdges(this.points_)};d.prototype.addHole=function(e){this.initEdges(e);var t,i=e.length;for(t=0;t<i;t++)this.points_.push(e[t]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(e){var t,i=e.length;for(t=0;t<i;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},d.prototype.addPoint=function(e){return this.points_.push(e),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},d.prototype.triangulate=function(){return s.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(e){this.head_=e},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(e){this.tail_=e},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,n=this.points_[0].y,r=this.points_[0].y,s=this.points_.length;for(e=1;e<s;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<i&&(i=a.x),a.y>n&&(n=a.y),a.y<r&&(r=a.y)}this.pmin_=new o(i,r),this.pmax_=new o(t,n);var l=.3*(t-i),c=.3*(n-r);this.head_=new o(t+l,r-c),this.tail_=new o(i-l,r-c),this.points_.sort(o.compare)},d.prototype.initEdges=function(e,t){var i,n=e.length,o=t?e.length-1:e.length;for(i=0;i<o;++i)this.edge_list.push(new c(e[i],e[(i+1)%n]))},d.prototype.getPoint=function(e){return this.points_[e]},d.prototype.addToMap=function(e){this.map_.push(e)},d.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},d.prototype.createAdvancingFront=function(){var e,t,i,n=new r(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),i=new l(n.getPoint(2)),this.front_=new a(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},d.prototype.removeNode=function(e){},d.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)));i&&(i.triangle=e)}},d.prototype.removeFromMap=function(e){var t,i=this.map_,n=i.length;for(t=0;t<n;t++)if(i[t]===e){i.splice(t,1);break}},d.prototype.meshClean=function(e){for(var t,i,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||n.push(t.getNeighbor(i))},t.exports=d},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict";var n=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},o=e("./xy").toString;n.prototype.toString=function(){return"["+o(this.points_[0])+o(this.points_[1])+o(this.points_[2])+"]"},n.prototype.getPoint=function(e){return this.points_[e]},n.prototype.GetPoint=n.prototype.getPoint,n.prototype.getPoints=function(){return this.points_},n.prototype.getNeighbor=function(e){return this.neighbors_[e]},n.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},n.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},n.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},n.prototype.isInterior=function(){return this.interior_},n.prototype.setInterior=function(e){return this.interior_=e,this},n.prototype.markNeighborPointers=function(e,t,i){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=i;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=i;else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=i}},n.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},n.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},n.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},n.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},n.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},n.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},n.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},n.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},n.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},n.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},n.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},n.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},n.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},n.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},n.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},n.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},n.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},n.prototype.oppositePoint=function(e,t){var i=e.pointCW(t);return this.pointCW(i)},n.prototype.legalize=function(e,t){var i=this.points_;if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t;else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t;else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call");i[0]=i[2],i[2]=i[1],i[1]=t}},n.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},n.prototype.edgeIndex=function(e,t){var i=this.points_;if(e===i[0]){if(t===i[1])return 2;if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0;if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1;if(t===i[1])return 0}return-1},n.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},n.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},n.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_;t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=n},{"./xy":11}],10:[function(e,t,i){"use strict";function n(e,t,i){var n=(e.x-i.x)*(t.y-i.y)-(e.y-i.y)*(t.x-i.x);return n>-s&&n<s?a.COLLINEAR:n>0?a.CCW:a.CW}function o(e,t,i,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-s)&&!((e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y)<=s)}function r(e,t,i){var n=t.x-e.x,o=t.y-e.y;return n*(i.x-e.x)+o*(i.y-e.y)<0}var s=1e-12;i.EPSILON=s;var a={CW:1,CCW:-1,COLLINEAR:0};i.Orientation=a,i.orient2d=n,i.inScanArea=o,i.isAngleObtuse=r},{}],11:[function(e,t,i){"use strict";function n(e){return"("+e.x+";"+e.y+")"}function o(e){var t=e.toString();return"[object Object]"===t?n(e):t}function r(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function s(e,t){return e.x===t.x&&e.y===t.y}t.exports={toString:o,toStringBase:n,compare:r,equals:s}},{}]},{},[6])(6)}()}(),function(){"use strict";var e=Autodesk.Viewing;e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.fireEvent=e.EventDispatcher.prototype.fireEvent,t.dispatchEvent=e.EventDispatcher.prototype.fireEvent},addEventListener:function(e,t){e&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t))},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(e&&(void 0===this.listeners&&(this.listeners={}),this.listeners[e]instanceof Array))for(var i=this.listeners[e],n=0,o=i.length;n<o;n++)if(i[n]===t){i.splice(n,1);break}},fireEvent:function(e){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.");if(this.listeners[e.type]instanceof Array)for(var t=this.listeners[e.type].slice(),i=0;i<t.length;i++)t[i].call(this,e)}}}(),Autodesk.Viewing.FileLoader=function(e){this.viewer=e},Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader,Autodesk.Viewing.FileLoader.prototype.loadFile=function(e,t,i,n){return!1},function(){"use strict";var e=function(){function e(e,t,i){return!o[e]&&(o[e]={loader:i,extensions:t},!0)}function t(e){return o[e]?o[e].loader:null}function i(e){return!!o[e]&&(delete o[e],!0)}function n(e){e=e?e.toLowerCase():"";for(var t in o){var i=o[t];if(i)for(var n=0;n<i.extensions.length;n++)if(i.extensions[n].toLowerCase()===e)return i.loader}return null}var o={};return{registerFileLoader:e,getFileLoader:t,getFileLoaderForExtension:n,unregisterFileLoader:i}};Autodesk.Viewing.FileLoaderManager=new e}(),function(){"use strict";function e(e){for(var t=0;t<r.length;++t)document.addEventListener(r[t],e,!1)}function t(e){for(var t=0;t<r.length;++t)document.removeEventListener(r[t],e,!1)}function i(t){this.viewer=t,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener)}var n=Autodesk.Viewing,o=n.Private,r=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];n.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},n.ScreenModeDelegate=i,i.prototype.uninitialize=function(){t(this.bindFullscreenEventListener),this.viewer=null},i.prototype.isModeSupported=function(e){return!0},i.prototype.setMode=function(e){var t=this.getMode();return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},i.prototype.getMode=function(){throw"Implement getMode() in derived class"},i.prototype.getNextMode=function(){var e,t=this.getMode(),i=n.ScreenMode;return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},i.prototype.getEscapeMode=function(){return this.getMode()!==n.ScreenMode.kNormal?n.ScreenMode.kNormal:void 0},i.prototype.fullscreenEventListener=function(){if(n.inFullscreen())this.viewer.resize();else{var e=n.ScreenMode;this.doScreenModeChange(e.kFullScreen,e.kNormal),this.onScreenModeChanged(e.kFullScreen,e.kNormal)}},i.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},i.prototype.onScreenModeChanged=function(i,o){i===n.ScreenMode.kFullScreen?t(this.bindFullscreenEventListener):o===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:n.FULLSCREEN_MODE_EVENT,mode:o})},n.AppScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.AppScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.AppScreenModeDelegate.prototype.constructor=n.AppScreenModeDelegate,n.AppScreenModeDelegate.prototype.isModeSupported=function(e){return e!==n.ScreenMode.kFullBrowser},n.AppScreenModeDelegate.prototype.getMode=function(){return n.inFullscreen()?n.ScreenMode.kFullScreen:n.ScreenMode.kNormal},n.AppScreenModeDelegate.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container;t===n.ScreenMode.kNormal?(i.classList.remove("viewer-fill-browser"),n.exitFullscreen()):t===n.ScreenMode.kFullScreen&&(i.classList.add("viewer-fill-browser"),n.launchFullscreen(i))},n.ApplicationScreenModeDelegate=n.AppScreenModeDelegate,n.NullScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.NullScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.NullScreenModeDelegate.prototype.constructor=n.ScreenModeDelegate,n.NullScreenModeDelegate.prototype.isModeSupported=function(e){return!1},n.NullScreenModeDelegate.prototype.getMode=function(){return n.ScreenMode.kNormal},n.ScreenModeMixin=function(){},n.ScreenModeMixin.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?n.NullScreenModeDelegate:n.AppScreenModeDelegate)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=n.ScreenModeMixin.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};e.ModelUnits=i;var n=function(e){WGS.RenderModel.call(this),this.myData=e,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!(this.myData&&this.myData.is2d)}};e.EventDispatcher.prototype.apply(n.prototype),n.prototype.constructor=n,n.prototype.setData=function(e){this.myData=e},n.prototype.getData=function(){return this.myData},n.prototype.getDocumentNode=function(){return this.myData.loadOptions?this.myData.loadOptions.bubbleNode||null:null},n.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},n.prototype.getRootId=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0},n.prototype.getUnitScale=function(){var e;switch((e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null))&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}},n.prototype.getUnitString=function(){var e;switch((e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null))&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},n.prototype.getDisplayUnit=function(){var e;switch((e=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null))&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},n.prototype.getMetadata=function(e,t,i){if(this.myData){var n=this.myData.metadata;if(n){var o=n[e];if(void 0!==o){if(!t)return o;var r=o[t];if(void 0!==r)return r}}}return i},n.prototype.getDefaultCamera=function(){var e=this.myData;if(!e)return null;var t=null,i=e.cameras?e.cameras.length:0;if(0<i){var n=this.getMetadata("default camera","index",null);if(null!==n&&e.cameras[n])t=e.cameras[n];else{for(var o=0;o<i;o++){var r=e.cameras[o];if(r.isPerspective){t=r;break}}t||(t=e.cameras[0])}}return t},n.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},n.prototype.geomPolyCount=function(){var e=this.getGeometryList();return e?e.geomPolyCount:null},n.prototype.instancePolyCount=function(){var e=this.getGeometryList();return e?e.instancePolyCount:null},n.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(t.logger.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},n.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},n.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},n.prototype.getPropertyDb=function(){return this.myData&&this.myData.propDbLoader},n.prototype.getProperties=function(e,t,i){var n=this.getPropertyDb();!n||e<=0?i&&i():n.getProperties(e,t,i)},n.prototype.getBulkProperties=function(e,t,i,n){Array.isArray(t)&&(t={propFilter:t});var o=(t=t||{}).propFilter||null,r=t.ignoreHidden||!1,s=this.getPropertyDb();s?s.getBulkProperties(e,o,i,n,r):n&&n()},n.prototype.getExternalIdMapping=function(e,t){var i=this.getPropertyDb();i?i.getExternalIdMapping(e,t):t&&t()},n.prototype.getObjectTree=function(e,t){var i=this.getPropertyDb();i?i.getObjectTree(e,t):t&&t()},n.prototype.isObjectTreeLoaded=function(){var e=this.getPropertyDb();return!!e&&e.isObjectTreeLoaded()},n.prototype.search=function(e,t,i,n,o){var r=this.getPropertyDb();r?r.getObjectTree(function(){r.searchProperties(e,n,t,i,o)},i):i&&i()};var o=function(e){var t=e;if(Math.abs(t[0])<.001)if(Math.abs(t[4])>.001)for(i=0;i<4;i++){n=t[i];t[i]=t[i+4],t[i+4]=n}else for(i=0;i<4;i++){n=t[i];t[i]=t[i+8],t[i+8]=n}if(Math.abs(t[5])<.001)for(var i=4;i<8;i++){var n=t[i];t[i]=t[i+4],t[i+4]=n}},r=function(e,t,i,n){var o,r,s,a,l,c,u=!1;s=n[i[i.length-1]].x,o=(a=n[i[i.length-1]].y)>=t;for(var h=0,d=i.length;h<d;++h)l=n[i[h]].x,o!=(r=(c=n[i[h]].y)>=t)&&(c-t)*(s-l)>=(l-e)*(a-c)==r&&(u=!u),o=r,s=l,a=c;return u};n.prototype.pointInPolygon=function(e,t,i,n){for(var o=!1,s=0;s<i.length;s++)r(e,t,i[s],n)&&(o=!o);return o},n.prototype.getPageToModelTransform=function(e){if(this.myData.pageToModelTransform)return this.myData.pageToModelTransform;var t=this.myData,i=t.metadata.page_dimensions,n=t.viewports[e];if(!n)return new THREE.Matrix4;t.viewportTransforms||(t.viewportTransforms=new Array(t.viewports.length));var r=t.viewportTransforms[e];if(r)return r;var s=new LmvMatrix4(!0).set(i.logical_width/i.page_width,0,0,i.logical_offset_x,0,i.logical_height/i.page_height,0,i.logical_offset_y,0,0,1,0,0,0,0,1),a=n.transform.slice();o(a);var l=new LmvMatrix4(!0);l.elements.set(a);var c=new LmvMatrix4(!0);return c.getInverse(l),c.multiply(s),t.viewportTransforms[e]=c,c},n.prototype.pageToModel=function(e,t,i){var n=this.getPageToModelTransform(i),o=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(n),r=(new THREE.Vector3).set(t.x,t.y,0).applyMatrix4(n);e.x=o.x,e.y=o.y,t.x=r.x,t.y=r.y},n.prototype.pointInClip=function(e,t){for(var i=this.myData.clips,n=[],o=1;o<i.length;o++)if(o!==t){for(var r=[],s=[],a=i[o].contourCounts,l=i[o].points,c=0,u=[],h=0;h<a.length;h++){for(var d=0;d<a[h];d++)r.push(c),c++;s.push(r),r=[]}for(h=0;h<l.length;h+=2){var p={x:l[h],y:l[h+1]};u.push(p)}this.pointInPolygon(e.x,e.y,s,u)&&n.push(o)}return n},n.prototype.getClip=function(e){for(var t=this.myData.clips,i=[],n=[],o=t[e].contourCounts,r=t[e].points,s=0,a=[],l=0;l<o.length;l++){for(var c=0;c<o[l];c++)i.push(s),s++;n.push(i),i=[]}for(l=0;l<r.length;l+=2){var u={x:r[l],y:r[l+1]};a.push(u)}return{contours:n,points:a}},n.prototype.getTopoIndex=function(e){if(this.myData&&this.myData.fragments){var t=this.myData.fragments.topoIndexes;if(t)return t[e]}},n.prototype.getTopology=function(e){if(this.myData){var t=this.myData.topology;if(t){var i=t[e];if(i)return i}}},n.prototype.hasTopology=function(){return!(!this.myData||!this.myData.topology)},n.prototype.hasGeometry=function(){return!!this.myData&&(!!this.myData.isLeaflet||this.myData.fragments.length>0)},e.Model=n}(),function(){"use strict";function e(e){var t=e.split("/");if(0==t.length)return e;for(var i=[],n=0;n<t.length;++n){var o=t[n];"."!==o&&(".."===o&&i.length?i.pop():i.push(o))}return 0==i.length?"":i.join("/")}function t(e,t){for(var i=e.length-t,n=new ArrayBuffer(i),o=new Uint8Array(n,0),r=0,s=t;r<i;r++,s++)o[r]=255&e.charCodeAt(s);return o}function i(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}function n(e,t,i,n){function o(e){if("json"==n.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){i(e)}return e}0===e.indexOf("file://")&&(e=e.substr(7)),require("fs").readFile(e,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):31==s[0]&&139==s[1]?require("zlib").gunzip(s,null,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):(s=o(s),n.ondata&&n.ondata(s),t(s))}):(s=o(s),n.ondata&&n.ondata(s),t(s))})}function o(e,t){t.hasOwnProperty("asynchronous")?t.asynchronous||s.logger.warn("LMV: Sync XHR used. Performance warning."):t.asynchronous=!0,t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.hasOwnProperty("withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}var r=Autodesk.Viewing,s=r.Private;s.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window;var a;"undefined"!=typeof XMLHttpRequest?a=XMLHttpRequest:(a=require("xhr2")).prototype._restrictedHeaders.cookie=!1;var l={},c=!1;l.simplifyPath=e,l.OSS_PREFIX="urn:adsk.objects:os.object:",l.getDirectOSSUrl=function(t,i){var n=i.indexOf(l.OSS_PREFIX);if(-1!==n){var o=i.substr(n+l.OSS_PREFIX.length),s=o.substr(0,o.indexOf("/")),a=o.substr(o.indexOf("/")+1);return a=e(a),r.makeOssPath(t,s,a)}},l.generateUrl=function(t,n,o){if(r.isNodeJS&&!i(t,o))return o;var s=(o=e(o)).indexOf("urn:"),a=o.indexOf("?");-1!=s&&(o=-1!==a?o.slice(0,s)+encodeURIComponent(o.slice(s,a))+o.slice(a):o.slice(0,s)+encodeURIComponent(o.slice(s)));var c=l.getDirectOSSUrl(t,o);if(c)return c;if(0!==decodeURIComponent(o).indexOf("urn:"))return o;switch("items"!==n&&(o=o.substr(6)),n){case"items":return r.getItemApi(t)+o;case"bubbles":return r.getManifestApi(t)+o;case"thumbnails":return r.getThumbnailApi(t)+o}},l.rawGet=function(e,o,u,h,d,p){function g(e){d&&d(v.status,v.statusText,{url:u})}function m(e){if(200===v.status)if(v.response&&v.response instanceof ArrayBuffer){var t=new Uint8Array(v.response);if(!p.skipDecompress&&31==t[0]&&139==t[1]){c||(c=!0,s.logger.warn("An LMV resource ("+u+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=new Zlib.Gunzip(t).decompress()}catch(e){d(r.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:u,exception:e.toString(),stack:e.stack})}}h(t)}else h(v.response||v.responseText);else g(e)}var p=p||{};if(u=l.generateUrl(e,o,u),!r.isNodeJS||i(e,u)){p.queryParams&&(u=u+"?"+p.queryParams);var v=new a;try{var f=!p.hasOwnProperty("asynchronous")||p.asynchronous;if(v.open(p.noBody?"HEAD":"GET",u,f),p.hasOwnProperty("responseType")&&(v.responseType=p.responseType),v.withCredentials=!0,p.hasOwnProperty("withCredentials")&&(v.withCredentials=p.withCredentials),p.headers)for(var E in p.headers)v.setRequestHeader(E,p.headers[E]),"authorization"===E.toLocaleLowerCase()&&(v.withCredentials=!1);f&&(v.onload=m,v.onerror=g,v.ontimeout=g,p.ondata&&(v.overrideMimeType("text/plain; charset=x-user-defined"),p._dlProgress={streamOffset:0,counter:0},v.onreadystatechange=function(){if(v.readyState>2){var e=v.responseText;if(p._dlProgress.streamOffset>=e.length)return;var i=t(e,p._dlProgress.streamOffset);p._dlProgress.streamOffset=e.length,p.ondata(i)}})),v.send(),p.skipAssetCallback||(s.inWorkerThread?self.postMessage({assetRequest:[u,p.headers,null]}):s.assets.push([u,p.headers,null])),f||m()}catch(e){d(v.status,v.statusText,{url:u,exception:e})}}else n(u,h,d,p)},l.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(r.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(r.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(r.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(r.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:i.url,exception:i.exception.toString(),stack:i.exception.stack}):this.raiseError(r.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},l.getItem=function(e,t,i,n,r){o(e,r=r||{}),l.rawGet(e.endpoint,"items",t,i,n,r)},l.getManifest=function(e,t,i,n,r){(r=r||{}).hasOwnProperty("responseType")||(r.responseType="json"),o(e,r),l.rawGet(e.endpoint,"bubbles",t,i,n,r)},l.getThumbnail=function(e,t,i,n,r){if(r=r||{},o(e,r),!r.queryParams){var s=r.role||"rendered",a=r.size||400;r.queryParams="guid="+encodeURIComponent(r.guid)+"&role="+s+"&width="+a+"&height="+a}l.rawGet(e.endpoint,"thumbnails",t,i,n,r)},l.getACMSession=function(e,t,i,n){var o,s={};for(var a in t)"oauth2AccessToken"===a?o=t[a]:-1!==a.indexOf("x-ads-acm")&&(s[a]=t[a]),r.isMobileDevice()&&(r.HTTP_REQUEST_HEADERS=s);s.application="autodesk";var l=new XMLHttpRequest;l.open("POST",e+"/oss-ext/v2/acmsessions",!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization","Bearer "+o),l.responseType="json",l.onload=function(){if(200===l.status&&l.response){var e="string"==typeof l.response?JSON.parse(l.response):l.response;e&&e.acmsession?i(e.acmsession):n(l.status,"Can't get acm session from response.")}else n(l.status)},l.onerror=n,l.ontimeout=n,l.send(JSON.stringify(s)),delete s.application},s.ViewingService=l}(),"undefined"!=typeof window){var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(e,t,i){var n=null,o=e.split(":");return 0===o[0].indexOf("stun")?n={url:e}:0!==o[0].indexOf("turn")||-1===e.indexOf("transport=udp")&&-1!==e.indexOf("?transport")||(n={url:e.split("?")[0],credential:i,username:t}),n},attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t,e.play()},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject,e.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40,createIceServer=function(e,t,i){var n=null,o=e.split(":");return 0===o[0].indexOf("stun")?n={url:e}:0===o[0].indexOf("turn")&&(n=webrtcDetectedVersion<28?{url:"turn:"+t+"@"+e.split("turn:")[1],credential:i}:{url:e,credential:i,username:t}),n},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(e,t){void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}!function(){"use strict";function e(e,t){function o(){return i.config.userName&&i.config.userName.length?i.config.userName:m?m.slice(0,5):"Unknown"}function r(e){switch(e.type){case"txt":c(e);break;case"joinok":l(e);break;case"join_error":break;case"sessionId":i.logger.info("Connect successful, your id is: "+e.id),m=e.id;break;case"joined":e.userStatus="joined",s(e);break;case"left":e.userStatus="left",a(e);break;case"camera":case"pointer":break;default:i.logger.log(e)}var t=e.roomId,n={type:g[e.type],data:e,channelId:t};y.dispatchEvent(n)}function s(e){if(e.user.name&&e.user.name.length||(e.user.name=e.user.id.slice(0,5)),e.roomId){var t=A[e.roomId];t?(t.users.push(e.user),i.logger.info(e.user+" joined room "+e.roomId)):i.logger.warn("Channel "+e.roomId+" does not exist for socket "+m)}}function a(e){i.logger.info(e.user+" left room "+e.room);for(var t in A){for(var n=A[t].users,o=-1,r=0;r<n.length;r++)if(n[r].id==e.user){o=r;break}-1!=o&&n.splice(o,1),delete A[t].userSet[e.user]}}function l(e){var t=A[e.roomId];i.logger.info("joined channel "+e.roomId),e.users&&e.users.length?t.users=e.users:t.users=[];for(var n=0;n<t.users.length;n++)t.users[n].name&&t.users[n].name.length||(t.users[n].name=t.users[n].id.slice(0,5));var r=o(),s=Autodesk.Viewing.i18n.translate("you"),a={id:m,name:r+" ("+s+")",isSelf:!0,status:0};t.userSet[m]||(t.users.push(a),t.userSet[m]=a),0!=a.id.indexOf(r)&&y.sendChatMessage("/nick "+r,e.roomId)}function c(e){if(0==e.msg.indexOf("/nick ")){var t=y.getUserById(e.from,e.roomId),i=e.msg.slice(6);if(i.length&&(t.name=i,t.id==m)){var n=Autodesk.Viewing.i18n.translate("you");t.name+=" ("+n+")"}y.dispatchEvent({type:"userListChange",data:e,channelId:e.roomId})}}function u(e){f<v.length?(i.logger.info("Connect failed, trying another server..."),p.disconnect(),p=null,f++,y.connect(y.sessionID)):y.dispatchEvent({type:"socketError",data:e})}function h(e){y.dispatchEvent({type:"socketError",data:e})}function d(e){f=0;for(var t in E)y.join(t)}var p,g={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},m=null,v=Array.isArray(e)?e:[e],f=0,E={},A={},y=this;this.connect=function(e){if(!p)return void 0!==window.WebSocket&&(n||(n="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=e,(p=n.connect(v[f]+"?sessionID="+e,{path:t,forceNew:!0})).on("connect",d),p.on("message",r),p.on("connect_error",u),p.on("error",h),!0)},this.join=function(e){p&&p.connected?(delete E[e],A[e]={id:e,users:[],userSet:{}},p.emit("join",{roomId:e,name:o()})):E[e]=1},this.disconnect=function(){p&&(p.disconnect(),p=null,A={},m=null)},this.sendMessage=function(e,t,i){var n={type:e,from:m,msg:t,roomId:i};p.emit("message",n)},this.sendPrivateMessage=function(e,t){var i={type:"private",target:e,from:m,msg:t};p.emit("message",i)},this.sendChatMessage=function(e,t){var i={type:"txt",from:m,msg:e,roomId:t};p.emit("message",i),r(i)},this.getUserById=function(e,t){for(var i=A[t].users,n=0;n<i.length;n++)if(i[n].id==e)return i[n];return null},this.getLocalId=function(){return m},this.getChannelInfo=function(e){return A[e]},this.isConnected=function(){return p}}var t=Autodesk.Viewing,i=t.Private;i.config={userName:""},i.setUserName=function(e){i.config.userName=e};var n;e.prototype.constructor=e,t.EventDispatcher.prototype.apply(e.prototype);var o={};e.GetInstance=function(e,t){e||(e=i.EnvironmentConfigurations[i.env].LMV.RTC),Array.isArray(e)||(e=[e]);var n=o[e[0]];return n||(n=new i.MessageClient(e,t),o[e[0]]=n,n)},Autodesk.Viewing.Private.MessageClient=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var t=Autodesk.Viewing,i=t.Private;i.P2PClient=function(n){function o(e){try{(h=new RTCPeerConnection(y)).onicecandidate=function(e){e.candidate?f.sendPrivateMessage(d,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):i.logger.log("End of candidates.")},h.ondatachannel=function(e){i.logger.log("Data channel added."),(m=e.channel).onmessage=l,v.dispatchEvent({type:"dataChannelAdded",data:e.channel})},h.onaddstream=function(e){i.logger.log("Remote stream added."),g=e.stream,v.dispatchEvent({type:"remoteStreamAdded",data:e.stream})},h.onremovestream=function(e){i.logger.log("Remote stream removed. Event: ",e),g=null,v.dispatchEvent({type:"remoteStreamRemoved",data:e.stream})},e&&((m=h.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1})).onmessage=l)}catch(e){return i.logger.error("Failed to create PeerConnection, exception: "+e.message,t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)),void alert("Cannot create RTCPeerConnection object.")}}function r(n){i.logger.error("createOffer() error: ",e,t.errorCodeString(t.ErrorCodes.UNKNOWN_FAILURE))}function s(e){if(h.setLocalDescription(e),f.sendPrivateMessage(d,e),A.length){for(var t=0;t<A.length;t++)h.addIceCandidate(A[t]);A=[]}}function a(e){for(var t=e.split("\n"),i=!1,n=!1,o=!1,r=0;r<t.length;r++)0==t[r].indexOf("a=mid:data")&&(i=!0),0==t[r].indexOf("a=mid:video")&&(o=!0),0==t[r].indexOf("a=mid:audio")&&(n=!0);return i&&!o&&!n}function l(e){var t=JSON.parse(e.data);switch(t.type){case"camera":v.dispatchEvent({type:"cameraChange",data:t});break;case"joystick":v.dispatchEvent({type:"joystick",data:t});break;case"state":v.dispatchEvent({type:"viewerState",data:t})}}function c(e){var t=e.data.msg;if(i.logger.debug("Client received message:"+JSON.stringify(t)),"offer"!=t.type||E)if("answer"===t.type&&E)h.setRemoteDescription(new RTCSessionDescription(t));else if("candidate"===t.type){var n=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});E?h.addIceCandidate(n):A.push(n)}else"bye"===t&&E&&(v.dispatchEvent({type:"remoteHangup",data:null}),i.logger.info("Session terminated."),u());else i.logger.log("Received offer. Accepting."),v.receiveCall(e.data)}function u(){E=!1,h.close(),h=null,p=null,g=null,d=null}var h,d,p,g,m,v=this,f=n,E=!1,A=[],y={iceServers:[{url:"stun:stun.l.google.com:19302"}]},T={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},w={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};f.addEventListener("privateMessage",c),this.hangup=function(){i.logger.log("Hanging up."),E&&(f.sendPrivateMessage(d,"bye"),u())},this.initUserMedia=function(e){function n(t){i.logger.log("Adding local stream."),e&&e(t),v.dispatchEvent({type:"localStreamAdded",data:t})}function o(e){i.logger.error("getUserMedia error: ",e,t.errorCodeString(t.ErrorCodes.NETWORK_SERVER_ERROR))}var r={video:!0,audio:!0};window.getUserMedia(r,n,o),i.logger.log("Getting user media with constraints",r)},this.callUser=function(e,t){d?i.logger.warn("Already in a call. Ignoring call request."):(d=e,i.logger.info("Calling user "+d),t?(o(!0),E=!0,i.logger.log("Sending data channel offer to peer"),h.createOffer(s,r)):this.initUserMedia(function(e){p=e,E||void 0===p||(o(!1),h.addStream(p),E=!0,i.logger.log("Sending audio/video offer to peer"),h.createOffer(s,r))}))},this.receiveCall=function(e){(d=e.from)||(d=e.senderId),a(e.msg.sdp)?(o(!0),E=!0,h.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending data-only answer to peer."),h.createAnswer(s,null,w)):this.initUserMedia(function(t){p=t,E||void 0===p||(o(!1),h.addStream(p),E=!0),h.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending audio+video answer to peer."),h.createAnswer(s,null,T)})},this.getCurrentCallTarget=function(){return d},this.dataChannel=function(){return m}},i.P2PClient.prototype.constructor=i.P2PClient,Autodesk.Viewing.EventDispatcher.prototype.apply(i.P2PClient.prototype)}(),function(){var e=Autodesk.Viewing.Private;Autodesk.Viewing.Private.LiveReviewClient=function(e){this.viewer=e,this.messageClient=null,this.presenceChannelId=null,this.p2p=null,this.viewtx=null,this.interceptor=null},Autodesk.Viewing.Private.LiveReviewClient.prototype.destroy=function(){this.leaveLiveReviewSession()},Autodesk.Viewing.Private.LiveReviewClient.prototype.joinLiveReviewSession=function(t){this.messageClient||(this.messageClient=e.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(t),this.viewtx||(this.viewtx=new e.ViewTransceiver(this.messageClient)),this.viewtx.channelId=t,this.viewtx.attach(this.viewer),this.p2p||(this.p2p=new e.P2PClient(this.messageClient)),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new e.InteractionInterceptor(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},Autodesk.Viewing.Private.LiveReviewClient.prototype.leaveLiveReviewSession=function(){this.p2p&&this.p2p.hangup(),this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.p2p=null,this.viewtx=null,this.messageClient=null,this.interceptor=null};var t=Autodesk.Viewing;(e=t.Private).InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},e.ViewTransceiver=function(i){function n(e){m=!0;var t=JSON.parse(e.data.msg);w.restoreState(t),g.impl.invalidate(!0,!1,!0),m=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg;!0===t[1]||f||(t[0]!=d&&(d=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),v=!1,g.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),g.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(v||f){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z];r(n),n.unshift(f),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),d!=n[0]&&(d=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:d}}))}}function l(e,t,i){e&&!y&&(y=document.createElement("div")).classList.add("collabPointer"),e&&!T?(g.container.appendChild(y),T=!0):!e&&T&&(g.container.removeChild(y),T=!1),e&&(y.style.left=t-6+"px",y.style.top=i-6+"px")}function c(e){if(!v&&!f){var t=e.data.msg;A.origin.set(t[1],t[2],t[3]),A.direction.set(t[4],t[5],t[6]);var i=A.at(g.getCamera().near);i.project(g.getCamera()),l(!0,(i=g.impl.viewportToClient(i.x,i.y)).x,i.y)}}function u(e){if(v){var t=g.impl.clientToViewport(e.canvasX,e.canvasY);g.impl.viewportToRay(t,A);var n=[A.origin.x,A.origin.y,A.origin.z,A.direction.x,A.direction.y,A.direction.z];r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function h(e){if(!m){var t=w.getState(b);i.sendMessage("state",JSON.stringify(t),p.channelId)}}var d,p=this,g=this.viewer=null,m=!1,v=!1,f=!1,E=this.client=i,A=new THREE.Ray,y=null,T=!1;this.channelId=null;var w,b={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){v=!0,l(!1)},this.updatePointer=function(e){u(e)},this.connectCamera=function(e){f=!e},this.attach=function(i,o){g&&this.detach(),this.viewer=g=i,w=new e.ViewerState(g),E.addEventListener("cameraChange",s),E.addEventListener("pointerMove",c),g.hasEventListener(t.CAMERA_CHANGE_EVENT,a)||g.addEventListener(t.CAMERA_CHANGE_EVENT,a),o||(E.addEventListener("viewerState",n),g.hasEventListener(t.SELECTION_CHANGED_EVENT,h)||(g.addEventListener(t.SELECTION_CHANGED_EVENT,h),g.addEventListener(t.ISOLATE_EVENT,h),g.addEventListener(t.HIDE_EVENT,h),g.addEventListener(t.SHOW_EVENT,h),g.addEventListener(t.EXPLODE_CHANGE_EVENT,h),g.addEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,h),g.addEventListener(t.CUTPLANES_CHANGE_EVENT,h)))},this.detach=function(){l(!1),E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),g&&(g.removeEventListener(t.CAMERA_CHANGE_EVENT,a),g.removeEventListener(t.SELECTION_CHANGED_EVENT,h),g.removeEventListener(t.ISOLATE_EVENT,h),g.removeEventListener(t.HIDE_EVENT,h),g.removeEventListener(t.SHOW_EVENT,h),g.removeEventListener(t.EXPLODE_CHANGE_EVENT,h),g.removeEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,h),g.removeEventListener(t.CUTPLANES_CHANGE_EVENT,h),this.viewer=g=null,w=null)}},e.ViewTransceiver.prototype.constructor=e.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(e.ViewTransceiver.prototype)}(),(avp=Autodesk.Viewing.Private).Autocam=avp.Autocam||function(e,t){function i(t){E=!0,e.target.copy(v.center),e.pivot.copy(v.pivot),e.worldup?e.worldup.copy(v.sceneUpDirection):e.up.copy(v.sceneUpDirection),v.cameraChangedCallback&&v.cameraChangedCallback(t),E=!1}function n(e,t){var i=e.clone();return Math.abs(i.clone().dot(t))<Number.MIN_VALUE?(i.normalize(),i):((i=o(e,t)).length()<Number.MIN_VALUE&&(i=r(t)),i.normalize(),i)}function o(e,t){t.normalize();var i=e.clone().dot(t),n=t.clone().multiplyScalar(i);return n=e.clone().sub(n)}function r(e){for(var t=new THREE.Vector3(0,0,0),i=[new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],n=0;n<7;n++)if(Math.abs(i[n].dot(e))<Number.MIN_VALUE){t=i[n];break}return t}function s(e,t){var i=new THREE.Vector2(0,0);return i.x=e/window.innerWidth,i.y=t/window.innerHeight,i}function a(t){t.y=Math.abs(t.y-window.innerHeight);var i,n,o=e.position,r=v.center.clone().sub(o),s=e.up,a=r.clone().cross(s),l=r.clone().length(),c=l*Math.tan(THREE.Math.degToRad(e.leftFov)),u=l*Math.tan(THREE.Math.degToRad(e.rightFov)),h=l*Math.tan(THREE.Math.degToRad(e.topFov)),d=l*Math.tan(THREE.Math.degToRad(e.bottomFov)),p=c+u,g=h+d,m=t.x*p/window.innerWidth-c,f=t.y*g/window.innerHeight-d;return s=s.clone().normalize().clone().multiplyScalar(f),a=a.clone().normalize().clone().multiplyScalar(m),v.ortho?(i=o.clone().add(a).clone().add(s),n=r):(i=o,n=r.clone().add(s).clone().add(a)),{rayO:i,rayD:n}}function l(e,t,i){var n,o,r,s;n=o=r=s=0;var a=0,l=null,c=null,u=v.snapOrbitDeadZone,h=v.orbitMultiplier;return"h"==e?(n=v.snapOrbitThresholdH,o=v.snapOrbitAccelerationAX,r=v.snapOrbitAccelerationBX,s=1-v.snapOrbitAccelerationPointX,c=v.lockDeltaX,l=v.lockedX):(n=v.snapOrbitThresholdV,o=v.snapOrbitAccelerationAY,r=v.snapOrbitAccelerationBY,s=1-v.snapOrbitAccelerationPointY,c=v.lockDeltaY,l=v.lockedY),l?(c+=i)<-u?(a=(c+u)*h*1/r,l=!1):c>u&&(a=(c-u)*h*1/r,l=!1):(a=Math.abs(t)>n?i*h:Math.abs(t)>s*n?i*t>0?i*h*o:i*h*1/o:i*t>0?i*h*r:i*h*1/r)*t>0&&Math.abs(a)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,l=!0,a=t),a}function c(){return v.combined}function u(e,t){var i=!1,n=window.innerWidth,o=e.x%n,r=window.innerHeight,s=e.y%r,a=o>0?o-t.x:n+o-t.x,l=s>0?s-t.y:r+s-t.y;return Math.abs(a)<30&&Math.abs(l)<30&&(i=!0),i}function h(e,t,i){i.x=(e.x-t.x)/window.innerWidth,e.x=t.x+(e.x-t.x)%window.innerWidth,i.y=(e.y-t.y)/window.innerHeight,e.y=t.y+(e.y-t.y)%window.innerHeight}function d(e,t,i){if(!B||!e){if(e){var n=new THREE.Vector2,o=t.x,r=t.y;h(t,i,n),_=window.innerWidth*n.x,H=window.innerHeight*n.y,o<i.x?o-=60:o+=60,r<i.y?r-=60:r+=60}B=e}}function p(e,t,i){if(0===t)return 0;var n=e,o=v.saveEye.clone().sub(worldUp.clone().multiplyScalar(i+n)),r=v.saveEye.clone().sub(worldUp.clone().multiplyScalar(i)),s=0,a=(v.maxSceneBound-v.minSceneBound)/1e3;v.topLimit&&t>0?(s=v.maxSceneBound-a,v.topLimit=!1):v.bottomLimit&&t<0?(s=v.minSceneBound+a,v.bottomLimit=!1):s=o.dot(worldUp);var l=r.dot(worldUp);return s<v.minSceneBound?l<v.minSceneBound&&(v.bottomLimit=!0,n=0):s>v.maxSceneBound&&l>v.maxSceneBound&&(v.topLimit=!0,n=0),n}function g(e){var t=Math.pow(e,2);e<0&&(t=-t);var i=s(0,t),n=.01*(v.maxSceneBound-v.minSceneBound);i.y*=n;var o=v.userHeightSpeed*i.y;return o=p(o,e,v.m_amount)}function m(e){var t=v.sceneFrontDirection.clone().cross(v.sceneUpDirection),i=Math.abs(Math.abs(e.dot(v.sceneUpDirection))-1),n=Math.abs(Math.abs(e.dot(v.sceneFrontDirection))-1),o=Math.abs(Math.abs(e.dot(t))-1);return i<1e-5||n<1e-5||o<1e-5}var v=this,f=null,E=!1;this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null;var A,T=Date.now(),w=!1;this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null},this.showPivot=function(e){this.pivotDisplayCallback&&this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){E||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone();return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho};v.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),w=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,i=e.target?e.target:this.pivot,n=e.worldup?e.worldup:this.sceneUpDirection;this.homeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective}},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),i(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),i(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var i=this.dir.clone(),n=i.cross(t).normalize();0===n.lengthSq()&&(i.copy(this.dir),t.z>t.y?i.y+=1e-4:i.z+=1e-4,n=i.cross(t).normalize()),e.up.copy(n).cross(this.dir).normalize()},function e(){requestAnimationFrame(e);var t=Date.now();A=t-T,T=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new THREE.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone();var b,C,S,k;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e);var M,R,P=new THREE.Quaternion,V=new THREE.Quaternion,I=new THREE.Quaternion,N=new THREE.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=THREE.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new THREE.Vector3(-1,0,0),this.alignDirTable[1]=new THREE.Vector3(1,0,0),this.alignDirTable[2]=new THREE.Vector3(0,-1,0),this.alignDirTable[3]=new THREE.Vector3(0,1,0),this.alignDirTable[4]=new THREE.Vector3(0,0,-1),this.alignDirTable[5]=new THREE.Vector3(0,0,1),this.alignDirTable[6]=new THREE.Vector3(-1,-1,0),this.alignDirTable[7]=new THREE.Vector3(-1,1,0),this.alignDirTable[8]=new THREE.Vector3(1,-1,0),this.alignDirTable[9]=new THREE.Vector3(1,1,0),this.alignDirTable[10]=new THREE.Vector3(0,-1,-1),this.alignDirTable[11]=new THREE.Vector3(0,-1,1),this.alignDirTable[12]=new THREE.Vector3(0,1,-1),this.alignDirTable[13]=new THREE.Vector3(0,1,1),this.alignDirTable[14]=new THREE.Vector3(-1,0,-1),this.alignDirTable[15]=new THREE.Vector3(1,0,-1),this.alignDirTable[16]=new THREE.Vector3(-1,0,1),this.alignDirTable[17]=new THREE.Vector3(1,0,1),this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1),this.alignDirTable[19]=new THREE.Vector3(-1,-1,1),this.alignDirTable[20]=new THREE.Vector3(-1,1,-1),this.alignDirTable[21]=new THREE.Vector3(-1,1,1),this.alignDirTable[22]=new THREE.Vector3(1,-1,-1),this.alignDirTable[23]=new THREE.Vector3(1,-1,1),this.alignDirTable[24]=new THREE.Vector3(1,1,-1),this.alignDirTable[25]=new THREE.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var D={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=D;var L,O;this.zoomDelta=new THREE.Vector2;var _,H,B,F=0,z=new THREE.Vector3,U=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new THREE.Vector2(0,0),this.menuOrigin=new THREE.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.loadObject=function(e,t,i){loader=new THREE.JSONLoader,loader.load(e,function(e,n){var o=new THREE.MeshPhongMaterial(n);mesh=new THREE.Mesh(e,o),mesh.scale=t,mesh.position.copy(i),mesh.geometry.computeBoundingBox();var r=mesh.geometry.boundingBox.clone();U.set(r.max.x,r.max.y,r.max.z),z.set(r.min.x,r.min.y,r.min.z),U.multiply(t),z.multiply(t),scene.add(mesh),objects.push(mesh)})},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up);var i=t.worldup?t.worldup:t.up;i.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(i),w&&!this.navApi.getTransitionActive()&&(w=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},THREE.Box2.prototype.setCenter=function(e){var t=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},THREE.Box2.prototype.getIcon2DCoords=function(e,t){var i=this.center;t.set((e.x-i.x)/(this.size().x/2),(e.y-i.y)/(this.size().y/2))},THREE.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,u=i*a,h=i*l,d=n*a,p=n*l,g=o*l,m=r*s,v=r*a,f=r*l;return t[0]=1-(d+g),t[3]=u-f,t[6]=h+v,t[1]=u+f,t[4]=1-(c+g),t[7]=p-m,t[2]=h-v,t[5]=p+m,t[8]=1-(c+d),this},THREE.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,i=e.elements,n=i[0],o=i[3],r=i[6],s=i[1],a=i[4],l=i[7],c=i[2],u=i[5],h=i[8],d=n+a+h;return d>0?(t=.5/Math.sqrt(d+1),this.w=.25/t,this.x=(u-l)*t,this.y=(r-c)*t,this.z=(s-o)*t):n>a&&n>h?(t=2*Math.sqrt(1+n-a-h),this.w=(u-l)/t,this.x=.25*t,this.y=(o+s)/t,this.z=(r+c)/t):a>h?(t=2*Math.sqrt(1+a-n-h),this.w=(r-c)/t,this.x=(o+s)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+h-n-a),this.w=(s-o)/t,this.x=(r+c)/t,this.y=(l+u)/t,this.z=.25*t),this},THREE.Quaternion.prototype.rotate=function(e){var t=(new THREE.Matrix4).makeRotationFromQuaternion(this).elements,i=(new THREE.Matrix3).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]);return e.applyMatrix3(i)},THREE.Vector3.prototype.findAngleWith=function(e,t){var i=0,n=this.clone().normalize().clone().dot(e.clone().normalize()),o=this.clone().cross(e).clone().normalize();if(o.clone().length()<Number.MIN_VALUE)i=n>0?0:180;else{t=o.clone().dot(t.clone().normalize())>0?o:-o;var r=(new THREE.Quaternion).setFromAxisAngle(t,90*THREE.Math.degToRad);r=r.clone().rotate(e).clone().normalize().clone().dot(this),i=Math.acos(n)*THREE.Math.radToDeg,Math.abs(i-90)<Number.MIN_VALUE&&(i=90),(i<90&&n*r>0||i>90&&n*r<0||90==i&&r>0)&&(i*=-1)}return i=THREE.Math.degToRad(i)},"contains"in String.prototype||(String.prototype.contains=function(e,t){return-1!==String.prototype.indexOf.call(this,e,t)}),Math.linearClamp=function(e,t,i){return e<=t?0:e>=i?1:(e-t)/(i-t)},Math.easeClamp=function(e,t,i){if(e<=t)return 0;if(e>=i)return 1;var n=(e-t)/(i-t);return.5*(Math.sin((n-.5)*Math.PI)+1)},Math.linearInterp=function(e,t,i){return t*(1-e)+i*e},Math.equalityClamp=function(e,t,i){return e<=t?t:e>=i?i:e},Math.round2=function(e){return Math.round(100*e)/100},Math.round1=function(e){return Math.round(10*e)/10},this.animateTransition=function(t){if(t){var n=!1,o=0;if(this.setCameraOrtho(t.isOrtho),v.elapsedTime>=D.duration)return o=1,v.center.copy(t.center),v.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,(n=!t.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,i(n),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),void this.navApi.setTransitionActive(!1);this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var r=D.destinationPercent,s=1-(o=Math.easeClamp(v.elapsedTime/D.duration,0,r));v.elapsedTime+=A/500;var a=v.center.clone().multiplyScalar(s).add(t.center.clone().multiplyScalar(o)),l=e.position.clone().multiplyScalar(s).add(t.position.clone().multiplyScalar(o)),c=e.up.clone().multiplyScalar(s).add(t.up.clone().multiplyScalar(o)),u=e.pivot.clone().multiplyScalar(s).add(t.pivot.clone().multiplyScalar(o)),h=this.sceneUpDirection.clone().multiplyScalar(s).add(t.worldUp.clone().multiplyScalar(o)),d=e.fov*s+t.fov*o;v.center.copy(a),v.pivot.copy(u),e.position.copy(l),e.up.copy(c),e.target.copy(a),t.isOrtho||(e.fov=d),e.dirty=!0,(n=h.distanceToSquared(this.sceneUpDirection)>1e-4)&&this.setWorldUpVector(h),e.lookAt(v.center),i(n),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){v.animateTransition(t)})}},this.sphericallyInterpolateTransition=function(t){var n,o,r,s=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),v.elapsedTime>=D.duration)s=1,this.currentlyAnimating=!1;else{var a=D.destinationPercent;s=Math.easeClamp(v.elapsedTime/D.duration,0,a),v.elapsedTime+=A/500}if(1===s)o=O.position,n=O.center,r=O.up;else{var l=new THREE.Matrix3,c=P.clone();c.slerp(V,s),l.makeRotationFromQuaternion(c);var u=Math.linearInterp(s,M,R),h=l.elements;o=(n=L.center.clone().multiplyScalar(1-s).add(O.center.clone().multiplyScalar(s))).clone().sub(new THREE.Vector3(h[0],h[1],h[2]).multiplyScalar(u)),r=new THREE.Vector3(h[3],h[4],h[5])}v.center.copy(n),e.position.copy(o),e.up.copy(r),v.navApi.getUsePivotAlways()||v.pivot.copy(n),e.lookAt(v.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){v.sphericallyInterpolateTransition(t)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),i(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=Math.round1(e.up.x),i=Math.round1(e.up.y),n=Math.round1(e.up.z),o=this.sceneFrontDirection.clone(),r=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();o.x=Math.round1(o.x),o.y=Math.round1(o.y),o.z=Math.round1(o.z),r.x=Math.round1(r.x),r.y=Math.round1(r.y),r.z=Math.round1(r.z),s.x=Math.round1(s.x),s.y=Math.round1(s.y),s.z=Math.round1(s.z);var a=s.clone().multiplyScalar(-1),l=r.clone().multiplyScalar(-1),c=o.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"right":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"left";if(o.x==t&&o.y==i&&o.z==n)return"right";break;case"left":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(o.x==t&&o.y==i&&o.z==n)return"left";if(c.x==t&&c.y==i&&c.z==n)return"right";break;case"back":if(r.x==t&&r.y==i&&r.z==n)return"up";if(l.x==t&&l.y==i&&l.z==n)return"down";if(a.x==t&&a.y==i&&a.z==n)return"right";if(s.x==t&&s.y==i&&s.z==n)return"left";break;case"top":if(c.x==t&&c.y==i&&c.z==n)return"down";if(o.x==t&&o.y==i&&o.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left";break;case"bottom":if(o.x==t&&o.y==i&&o.z==n)return"down";if(c.x==t&&c.y==i&&c.z==n)return"up";if(s.x==t&&s.y==i&&s.z==n)return"right";if(a.x==t&&a.y==i&&a.z==n)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),i(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(e.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),i(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(e.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),i(!0)},this.calculateCubeTransform=function(t){var i=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();(L=e.clone()).center=v.center.clone(),L.pivot=v.pivot.clone(),(O=e.clone()).center=v.center.clone(),O.pivot=v.pivot.clone();var r=new THREE.Vector3(0,0,0);t.contains("back")&&(r=r.add(n)),t.contains("front")&&(r=r.sub(n)),t.contains("top")&&(r=r.add(i)),t.contains("bottom")&&(r=r.sub(i)),t.contains("right")&&(r=r.add(o)),t.contains("left")&&(r=r.sub(o));var s=i,a=r.clone().normalize();if(1-Math.abs(a.dot(i))<Number.MIN_VALUE)for(var l=this.getView().normalize(),c=[n.clone(),n.clone().negate(),o.clone(),o.clone().negate()],u=a.dot(i)>0?1:-1,h=l.clone().add(e.up.clone().multiplyScalar(u)).normalize(),d=-2,p=0;p<4;p++){var g=h.dot(c[p]);g>d&&(d=g,s=c[p].multiplyScalar(u))}R=M=this.getView().length(),O.position.copy(O.center.clone().add(r.multiplyScalar(R/r.length()))),O.up.copy(s);var m=L.center.clone().sub(L.position).normalize(),f=m.clone().cross(L.up).normalize(),E=f.clone().cross(m).normalize(),A=new THREE.Matrix3;A.set(m.x,E.x,f.x,m.y,E.y,f.y,m.z,E.z,f.z),P.setFromRotationMatrix3(A),E=(f=(m=O.center.clone().sub(O.position).normalize()).clone().cross(O.up).normalize()).clone().cross(m).normalize(),A.set(m.x,E.x,f.x,m.y,E.y,f.y,m.z,E.z,f.z),I.setFromAxisAngle(m,0),N.setFromAxisAngle(E,0),V.setFromRotationMatrix3(A),V.multiply(I).multiply(N).normalize()},this.centerShot=function(t){L&&!t||(v.elapsedTime=0,(L=O=e.clone()).center=v.center);var n=v.pivot.clone(),o=n.clone().sub(L.position),r=L.center.clone().sub(L.position).normalize(),s=L.up.clone(),a=r.clone().cross(s).normalize();s=a.clone().cross(r).normalize();var l=a.clone().multiplyScalar(a.dot(o)),c=s.clone().multiplyScalar(s.dot(o)),u=l.clone().add(c);O.position.copy(L.position.clone().add(u)),O.center=n,O.pivot=n;var h=0;if(v.elapsedTime>=D.duration)h=1;else{var d=D.destinationPercent;h=Math.easeClamp(v.elapsedTime/D.duration,0,d),v.elapsedTime+=A/2e3}var p=e.position.clone().multiplyScalar(1-h).add(O.position.clone().multiplyScalar(h)),g=v.center.clone().multiplyScalar(1-h).add(O.center.clone().multiplyScalar(h)),m=v.pivot.clone().multiplyScalar(1-h).add(O.pivot.clone().multiplyScalar(h));e.position.copy(p),v.center.copy(g),v.pivot.copy(m),e.lookAt(v.center),i(!1),1===h?this.addHistoryElement():requestAnimationFrame(function(){v.centerShot(!1)})},this.levelShot=function(){var t=this.getView(),i=t.length(),n=this.sceneUpDirection.clone(),o=e.up.clone().normalize(),r=t.normalize(),s=r.dot(n);if(1-Math.abs(s)>Number.MIN_VALUE){var a=r.clone().cross(n);(r=n.clone().cross(a)).normalize()}else r=o.clone();r.multiplyScalar(i);var l={center:r.add(e.position),up:n,position:e.position,pivot:v.center.clone().add(r),fov:e.fov,worldUp:n};v.elapsedTime=0,v.animateTransition(l)},this.fitToWindow=function(){var t=this.getView(),i=e.up.clone();t.normalize(),i.normalize(),(O=e.clone()).center=v.center,(i=n(i,t)).normalize(),O.up.copy(i);var o=t.clone().cross(i);o.normalize();var r=z.clone(),s=U.clone(),a=[r,s],l=new THREE.Vector3(s.x-r.x,s.y-r.y,s.z-r.z);a[2]=new THREE.Vector3(s.x,r.y,s.z),a[3]=new THREE.Vector3(s.x,r.y,r.z),a[4]=new THREE.Vector3(s.x,s.y,r.z),a[5]=new THREE.Vector3(r.x,s.y,s.z),a[6]=new THREE.Vector3(r.x,s.y,r.z),a[7]=new THREE.Vector3(r.x,r.y,s.z);for(var c=0;c<8;c++){var u=a[c].clone().sub(e.position);a[c].setX(u.clone().dot(o)),a[c].setY(u.clone().dot(i)),a[c].setZ(u.clone().dot(t))}var h,d,p,g,m=THREE.Math.degToRad(e.topFov),f=THREE.Math.degToRad(e.bottomFov),E=THREE.Math.degToRad(e.leftFov),A=THREE.Math.degToRad(e.rightFov);h=E>=0?Number.MAX_VALUE:Number.MIN_VALUE,d=A>=0?Number.MAX_VALUE:Number.MIN_VALUE,p=m>=0?Number.MAX_VALUE:Number.MIN_VALUE,g=f>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var y=1/Math.tan(A),T=-1/Math.tan(E),w=1/Math.tan(m),b=-1/Math.tan(f),C=0;C<8;C++){var S=a[C].clone(),k=S.z-T*S.x;h=E>=0?Math.min(h,k):Math.max(h,k),k=S.z-y*S.x,d=A>=0?Math.min(d,k):Math.max(d,k),k=S.z-w*S.y,p=m>=0?Math.min(p,k):Math.max(p,k),k=S.z-b*S.y,g=f>=0?Math.min(g,k):Math.max(g,k)}var M=(d-h)/(T-y),x=T*M+h,R=(g-p)/(w-b),P=w*R+p,V=0;if(x<=P){var I=(m-f)/2;if(Math.abs(I)>Number.MIN_VALUE){var N=1/Math.tan(I);R=R-P/N+x/N}V=x}else{var D=(A-E)/2;if(Math.abs(D)>Number.MIN_VALUE){var L=1/Math.tan(D);M=M-x/L+P/L}V=P}var _=new THREE.Vector3(M,R,V),H=o.clone().multiplyScalar(_.x),B=i.clone().multiplyScalar(_.y),F=t.clone().multiplyScalar(_.z);_=H.clone().add(B.clone().add(F)),O.position.add(_);var G=l.clone().sub(O.position).dot(t);O.center=O.position.clone().add(t.multiplyScalar(G)),O.pivot=l.clone();var W={center:O.center,up:O.up,position:O.position,pivot:O.pivot,fov:e.fov,worldUp:v.sceneUpDirection.clone()};v.elapsedTime=0,v.animateTransition(W)},this.updatePivotPosition=function(t){var i,n,o=new THREE.Vector3(t.x/window.innerWidth*2-1,-t.y/window.innerHeight*2+1,.5);if(o=o.unproject(e),i=new THREE.Raycaster(e.position,o.sub(e.position).normalize()),n=i.intersectObjects(objects),"zoom"==v.mode)if(void 0!==n[0]){s=n[0].point;v.pivot.copy(s)}else{var r=a(t);v.pivot.copy(r.rayO.clone().add(r.rayD))}else if(void 0!==n[0]){wheel.cursorImage("pivot");var s=n[0].point;v.isMouseDown||v.pivot.copy(s)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(t,i,n,o,r){var s=new THREE.Vector3(0,1,0),a=e.position.clone().dot(s);Math.linearClamp(a,v.minSceneBound,v.maxSceneBound)},this.drawDropdownMenu=function(e,t,i,n,o,r,s){var a=0;if(f)r.appendChild(f);else{(f=document.createElement("div")).className="dropDownMenu",f.style.top="100px",f.style.left="-400px";for(var l=0,c=0,u=0;u<e.length;u++){var h;if(null===e[u])(h=document.createElement("li")).style.height="1px",l+=1,h.style.backgroundColor="#E0E0E0";else{var d=Autodesk.Viewing.i18n.translate(e[u]);if(c=d.length>c?d.length:c,i[u]){h=document.createElement("div");var p=document.createElement("input"),g=document.createElement("label");p.type="radio",p.className="dropDownMenuCheck",g.innerHTML=d,g.className="dropDownMenuCheckText",h.appendChild(p),h.appendChild(g),h.className="dropDownMenuCheckbox"}else(h=document.createElement("li")).textContent=d,h.className=t[u]?"dropDownMenuItem":"dropDownMenuItemDisabled";h.id="menuItem"+a,a++,l+=25,h.setAttribute("data-i18n",e[u])}f.appendChild(h)}r.appendChild(f),f.style.minWidth=Math.max(256,7.4*c)+"px";var m=f.getBoundingClientRect().width;this.menuSize.x=m,this.menuSize.y=l}a=0;for(u=0;u<e.length;u++)if(null!==e[u]){if(i[u]){var v="menuItem"+a,E=document.getElementById(v);E&&(E.children[0].checked=i[u]())}a++}var A=o-15,y=n+1,T=this.canvas.getBoundingClientRect();y+this.menuSize.x>T.right&&(y=n-this.menuSize.x-1),A+this.menuSize.y>T.bottom&&(A=T.bottom-this.menuSize.y),A-=s.y,y-=s.x,f.style.top=A+"px",f.style.left=y+"px",this.menuOrigin.x=y,this.menuOrigin.y=A},this.removeDropdownMenu=function(e){e.removeChild(f)},this.isFaceView=function(){return m(this.center.clone().sub(e.position).normalize())&&m(e.up)},this.startInteraction=function(e,t){this.startCursor=new THREE.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,n,o,r){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var a="wheel";if(v.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),r&&r.saveEye.copy(this.camera.position)),r&&(a="cube"),"cube"==a?(this.saveCenter.copy(r.saveCenter),this.saveEye.copy(r.saveEye),this.savePivot.copy(r.savePivot),this.saveUp.copy(r.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),c()&&void 0==C&&(C=this.saveCenter.clone(),b=this.saveEye.clone(),k=this.savePivot.clone(),S=this.saveUp.clone()),this.preserveOrbitUpDirection){var u=s(t.x-n.x,t.y-n.y),h=s(o.x,o.y),d=this.sceneUpDirection.clone(),p=this.sceneFrontDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),m=c()?k:this.savePivot,f=c()?b:this.saveEye,E=c()?C:this.saveCenter,A=c()?S:this.saveUp,y=m.clone().sub(f).normalize(),T=E.clone().sub(f).normalize(),w=T.clone().cross(A),M=f.clone().sub(m).length(),x=f.clone().sub(E).length(),R=y.clone().multiplyScalar(-1),P=T.clone().multiplyScalar(-1),V=w,I=A.clone();if(!this.constrainOrbitHorizontal){d.dot(this.saveUp)<-.009&&(u.x=-u.x,h.x=-h.x);var N=0;N=c()?h.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+l("h",0,-h.x):u.x*this.orbitMultiplier,this.lastSnapRotateX=N;var D=(new THREE.Quaternion).setFromAxisAngle(d,-N);R.applyQuaternion(D),P.applyQuaternion(D),V.applyQuaternion(D),I.applyQuaternion(D)}if(!this.constrainOrbitVertical){var L=p.clone().multiplyScalar(p.dot(V)),O=g.clone().multiplyScalar(g.dot(V)),_=L.clone().add(O);_.clone().normalize();var H=0;if(c())H=h.y*this.orbitMultiplier;else{var B=l("v",0,h.y);H=this.useSnap?this.lastSnapRotateY+B:u.y*this.orbitMultiplier}var F=(new THREE.Quaternion).setFromAxisAngle(_,-H);if(this.navApi.getOrbitPastWorldPoles())R.applyQuaternion(F).normalize(),P.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize();else{var z=I.clone();if(z.applyQuaternion(F).normalize(),d.dot(z)<0){var U=P.clone();U.applyQuaternion(F).normalize();var G=U.angleTo(d);Math.abs(G)>.5*Math.PI&&(G-=G>0?Math.PI:-Math.PI),H-=G,F.setFromAxisAngle(_,-H),R.applyQuaternion(F).normalize(),P.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize()}else R.applyQuaternion(F).normalize(),P.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize()}this.lastSnapRotateY=H}var W=R.multiplyScalar(M).add(m);e.position.copy(W),e.up.copy(I),this.center.copy(W),this.center.sub(P.multiplyScalar(x)),c()&&(C.copy(this.center),b.copy(e.position),k.copy(this.pivot),S.copy(e.up))}e.lookAt(this.center),i(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var n=s(t.x,t.y),o=this.userLookSpeed,r=this.getView(),a=e.up,l=r.clone().cross(a).normalize(),c=this.sceneUpDirection.clone(),u=n.clone();u.x*=Math.PI,u.y*=Math.PI/e.aspect,u.multiplyScalar(o);var h=(new THREE.Quaternion).setFromAxisAngle(l,-u.y);if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var d=a.clone();if(d.applyQuaternion(h).normalize(),d.dot(c)<0){var p=r.clone();p.applyQuaternion(h);var g=p.angleTo(c);Math.abs(g)>.5*Math.PI&&(g-=g>0?Math.PI:-Math.PI),u.y-=g,h.setFromAxisAngle(l,-u.y)}}r=h.clone().rotate(r),(a=h.clone().rotate(a)).normalize();var m=e.keepSceneUpright?c:a,v=(new THREE.Quaternion).setFromAxisAngle(m,-u.x);r=v.clone().rotate(r),a=v.clone().rotate(a),this.center.copy(r.add(e.position)),e.up.copy(a),e.lookAt(this.center),i(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=s(t.x,t.y);var n=this.getView(),o=e.up.clone().cross(n),r=n.clone().cross(o);o.normalize(),r.normalize(),n.normalize();var a=this.pivot.clone().sub(e.position),l=n.clone().dot(a),c=l*(Math.tan(THREE.Math.degToRad(e.leftFov))+Math.tan(THREE.Math.degToRad(e.rightFov))),u=l*(Math.tan(THREE.Math.degToRad(e.topFov))+Math.tan(THREE.Math.degToRad(e.bottomFov))),h=t.x*Math.abs(c),d=t.y*Math.abs(u),p=new THREE.Vector3,g=o.clone().multiplyScalar(h),m=r.clone().multiplyScalar(d);p=g.clone().add(m).clone().multiplyScalar(this.userPanSpeed),e.position.add(p),this.center.add(p),e.lookAt(this.center),i(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var n=this.userZoomSpeed,o=Number.MAX_VALUE,r=t.x+t.y,s=Math.pow(n,r),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(v.D.clone().multiplyScalar(v.D.clone().dot(this.pivot.clone().sub(a).clone())));if(!(s>=o)){if(r>0){Math.pow(n,r-0);if(r<0)return void(F=0);e.position.copy(a),this.center.copy(l);var c=a.clone().sub(this.saveEye).dot(v.D);c>o?(e.position.copy(this.saveEye.sub(v.D).clone().multiplyScalar(o)),F=o>0?-1:0):F=-c/o}else e.position.copy(a),this.center.copy(l);e.lookAt(this.center),i(!1)}}},this.walk=function(t,n,o,r,a){if(this.navApi.isActionEnabled("walk")){var l=this.sceneUpDirection.clone(),c=this.sceneFrontDirection.clone(),h=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);u(t,n)?(wheel.cursorImage("SWWalk"),d(!0,t,n),x=n.x,y=n.y):d(!1,t,n),x=t.x,y=t.y;var p=s(x-n.x,y-n.y),g=-p.x,m=-p.y,v=g<0?-1:1,f=m<0?-1:1,E=Math.abs(g),A=Math.abs(m),T=new THREE.Vector2(30,30);T=s(T.x,T.y),E=u(t,n)?0:Math.abs(g)-T.x,A=u(t,n)?0:Math.abs(m)-T.y;A/=.25,E=(E/=.25)<1?Math.easeClamp(E,0,1):Math.pow(E,1),A=A<1?Math.easeClamp(A,0,1):Math.pow(A,1);var w=E>0?E*v:0,b=A>0?A*f:0,C=this.getView(),S=C.length();C.normalize(),C.clone().cross(e.up).normalize();var k=h.clone().multiplyScalar(h.clone().dot(C)),M=c.clone().multiplyScalar(c.clone().dot(C)).clone().add(k);M=M.clone().length()>Number.MIN_VALUE?M.normalize():e.up;var R=b*(1*this.walkMultiplier),P=M,V=Math.cos(.65);1!=V&&(l.clone().dot(e.up)<-Number.MIN_VALUE&&l.clone().dot(C)<-V||l.clone().dot(e.up)>Number.MIN_VALUE&&l.clone().dot(C)>V)&&(P=-P);var I=-w*this.walkMultiplier*.05,N=e.up;(l.clone().dot(e.up)<-Number.MIN_VALUE||Math.abs(l.clone().dot(e.up))<Number.MIN_VALUE&&l.clone().dot(C)>Number.MIN_VALUE)&&(I=-I),N=l;var D=(new THREE.Quaternion).setFromAxisAngle(N,I);D.normalize(),(C=D.clone().rotate(C)).normalize(),e.up.copy(D.clone().rotate(e.up)),e.up.normalize(),e.position.add(P.clone().multiplyScalar(R)),this.center.copy(e.position.clone().add(C.clone().multiplyScalar(S))),(P=l).normalize(),0===R&&(R=.01),e.lookAt(this.center),i(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var n=g(t);v.m_amount+=n;var o=new THREE.Vector3(0,1,0),r=v.saveEye.clone().sub(o.clone().multiplyScalar(v.m_amount)),s=r.clone().dot(o);e.position.copy(r),s<v.minSceneBound&&e.position.add(o.clone().multiplyScalar(v.minSceneBound-s)),s>v.maxSceneBound&&e.position.add(o.clone().multiplyScalar(v.maxSceneBound-s)),this.center.copy(e.position.clone().add(v.saveCenter.clone().sub(v.saveEye))),e.lookAt(this.center),i(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(e){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var t=0;t<this.rewindParams.history.length;t++){var i=t-this.rewindParams.timelineIndex,n=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[t].thumbnailBounds.setCenter(new THREE.Vector2(e.x+i*n,e.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[t].weight=t==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);n=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=e.clone(),this.rewindParams.openLocationOrigin=e.clone(),this.rewindParams.openBracket=e.clone(),this.rewindParams.openBracketA=new THREE.Vector2(n,e.y),this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-n,e.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var o=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=o}this.rewindParams.locationOffset=new THREE.Vector2(0,0),this.rewindParams.snapOffset=new THREE.Vector2(0,0)},this.slideTimeline=function(e){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var t=e.clone().add(this.rewindParams.locationOffset),i=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),n=i,o=window.innerWidth-i,r=this.rewindParams.history[0].thumbnailBounds.center().x,s=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,a=0;if(t.x<this.rewindParams.openBracketA.x){var l=r-(a=t.x-this.rewindParams.openBracketA.x);n<l&&(a=Math.min(a+(l-n),0))}if(t.x>this.rewindParams.openBracketB.x){var c=s-(a=t.x-this.rewindParams.openBracketB.x);o>c&&(a=Math.max(a+(c-o),0))}this.rewindParams.openLocation.x+=a,this.rewindParams.openBracketA.x+=a,this.rewindParams.openBracketB.x+=a,this.rewindParams.openBracket.x=t.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var u=new THREE.Vector2(-a,0),h=t.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));u.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var d=!1;if(this.rewindParams.snappingEnabled)for(var p=0;p<this.rewindParams.history.length;p++){var g=this.rewindParams.history[p].thumbnailBounds.center().add(u);if(Math.abs(g.x-h.x)<4||this.rewindParams.snapped&&Math.abs(g.x-h.x)<16){d=!0,0!==a?(this.rewindParams.snapOffset.x=g.x-h.x,u.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=g.x-h.x,h.x=g.x;break}}this.rewindParams.snapped=d;for(var m=-1,v=0,f=0;f<this.rewindParams.history.length;f++){var E=this.rewindParams.history[f].thumbnailBounds.clone();if(this.rewindParams.history[f].thumbnailBounds.setCenter(this.rewindParams.history[f].thumbnailBounds.center().add(u)),this.rewindParams.history[f].thumbnail){var A=this.rewindParams.history[f].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+f).css("left",A),$("#rewindBorder"+f).css("left",A-4)}var y=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));E.setFromCenterAndSize(E.center(),y);var T=new THREE.Vector2(0,0);E.getIcon2DCoords(h,T);var w=1-Math.abs(Math.equalityClamp(T.x,-1,1));this.rewindParams.history[f].weight=w,0===f&&h.x<E.center().x&&(this.rewindParams.history[f].weight=1),f===this.rewindParams.history.length-1&&h.x>E.center().x&&(this.rewindParams.history[f].weight=1),v+=this.rewindParams.history[f].weight,this.rewindParams.history[f].weight>m&&(m=this.rewindParams.history[f].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[f].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[f].thumbnailBounds.center().x-h.x,this.rewindParams.timelineIndexSlide=f)}for(var b=0;b<this.rewindParams.history.length;b++)this.rewindParams.history[b].weight=this.rewindParams.history[b].weight/v;var C=this.rewindParams.history[0].thumbnailBounds.center().x,S=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<C?(this.rewindParams.locationOffset.x+=C-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=C):this.rewindParams.openBracket.x>S&&(this.rewindParams.locationOffset.x+=S-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=S)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,v.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var t=this.rewindParams.timelineIndex,n=0;if(v.elapsedTime>=D.duration)n=1;else{var o=D.destinationPercent;n=Math.easeClamp(v.elapsedTime/D.duration,0,o),v.elapsedTime+=A/500}v.center.copy(v.center.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.center.clone().multiplyScalar(n))),e.position.copy(e.position.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.position.clone().multiplyScalar(n))),e.up.copy(this.rewindParams.history[t].camera.up),v.pivot.copy(v.center),e.lookAt(v.center),i(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==n&&requestAnimationFrame(function(){v.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);t.center=new THREE.Vector3(0,0,0),t.pivot=new THREE.Vector3(0,0,0),t.leftFov=0,t.rightFov=0,t.topFov=0,t.bottomFov=0,t.up.set(0,0,0);for(var n=0;n<this.rewindParams.history.length;n++){var o=this.rewindParams.history[n].camera,r=this.rewindParams.history[n].weight;t.center.add(o.center.clone().multiplyScalar(r)),t.position.add(o.position.clone().multiplyScalar(r)),t.up.add(o.up.clone().multiplyScalar(r)),t.rotation.add(o.rotation.clone().multiplyScalar(r)),t.pivot.add(o.pivot.clone().multiplyScalar(r)),t.leftFov+=o.leftFov*r,t.rightFov+=o.rightFov*r,t.topFov+=o.topFov*r,t.bottomFov+=o.bottomFov*r}e.position.copy(t.position),e.up.copy(t.up),e.rotation=t.rotation,e.leftFov=t.leftFov,e.rightFov=t.rightFov,e.topFov=t.topFov,e.bottomFov=t.bottomFov,v.center.copy(t.center),v.pivot.copy(t.pivot),e.lookAt(v.center),e.up.normalize(),i(!1)}};var av=Autodesk.Viewing;(avp=Autodesk.Viewing.Private).Autocam.ViewCube=function(e,t,i,n){function o(e,t){var i={};return 0===e.type.indexOf("touch")?e.touches.length>0?(i.clientX=e.touches[0].clientX,i.clientY=e.touches[0].clientY,i.pageX=e.touches[0].pageX,i.pageY=e.touches[0].pageY,i.screenX=e.touches[0].screenX,i.screenY=e.touches[0].screenY,i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY,i.which=s.navApi.getUseLeftHandedInput()?3:1):i=t.prevCoords:(i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,i.screenX=e.screenX,i.screenY=e.screenY,i.which=e.which,W?(i.movementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,i.movementY=e.movementY||e.mozMovementY||e.webkitMovementY||0):(i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY)),t.prevX=i.screenX,t.prevY=i.screenY,t.prevCoords=i,i}var r=this,s=t,a=t.camera;t.setCube(this),r.currentFace="front";var l,c,u,h,d,p,g=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],m=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],v=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],f=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],E=[null,null,function(){return!s.orthographicFaces&&!a.isPerspective},function(){return!s.orthographicFaces&&a.isPerspective},function(){return s.orthographicFaces},null,null,null,null,null,null,null,null];r.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),r.camera.position.copy(a.position),r.center=new THREE.Vector3(0,0,0),r.camera.lookAt(r.center);var A,y,T,w,b,C,S,k,M,x,R,P,V,I,N=[],D=[],L=[],O=[],_=[],H=null,B=null,F=null,z=0,U=0,G=!0,W=!1,j=!1,Y=!1,q=-1!=navigator.userAgent.search("Chrome"),X=-1!=navigator.platform.search("Win32"),K=!1,Q=!1,Z=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var J=function(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}},$=function(e){e.preventDefault(),e.stopPropagation(),j=document.pointerLockElement===i||document.mozPointerLockElement===i||document.webkitPointerLockElement===i},ee=function(){s.navApi.isActionEnabled("orbit")&&(i.style.opacity="1.0",Q=!1),requestAnimationFrame(r.render)},te=function(e){if(Q||s.viewCubeMenuOpen||!s.navApi.isActionEnabled("orbit"))s.navApi.isActionEnabled("orbit")&&(i.style.opacity=1);else{var t=Math.max(4*Math.abs((e.clientX-I.x)/I.w-.5)-1,0),n=Math.max(4*Math.abs((e.clientY-I.y)/I.h-.5)-1,0),o=Math.max(0,Math.min(Math.sqrt(t*t+n*n),1));i.style.opacity=1-o*(1-r.inactiveOpacity)}},ie=function(){s.viewCubeMenuOpen||(i.style.opacity=r.inactiveOpacity,Q=!0,requestAnimationFrame(r.render))},ne=function(e){var t=new Image,i=av.getUseCredentials()&&(-1===e.indexOf("://")||-1!==e.indexOf(window.location.host));t.crossOrigin=i?"use-credentials":"anonymous";var n=new THREE.Texture(t);return t.onload=function(){n.needsUpdate=!0,++U>=11&&requestAnimationFrame(r.render)},t.src=e,n},oe=function(){var e,t=[],i=[];t[0]=me(0,0),t[1]=me(0,Math.PI/2),t[2]=me(0,-Math.PI/2),t[3]=me(0,Math.PI),t[4]=me(Math.PI/2,0),t[5]=me(Math.PI/2,Math.PI/2),t[6]=me(Math.PI/2,-Math.PI/2),t[7]=me(Math.PI/2,Math.PI),i[0]=ge(0,0,0),i[1]=ge(0,Math.PI/2,0),i[2]=ge(0,-Math.PI/2,0),i[3]=ge(0,Math.PI,0),i[4]=ge(Math.PI/2,0,0),i[5]=ge(Math.PI/2,Math.PI/2,0),i[6]=ge(Math.PI/2,-Math.PI/2,0),i[7]=ge(Math.PI/2,Math.PI,0),i[8]=ge(0,0,Math.PI/2),i[9]=ge(0,0,-Math.PI/2),i[10]=ge(-Math.PI/2,0,-Math.PI/2),i[11]=ge(-Math.PI,0,-Math.PI/2),N.push(pe(0,0)),N[0].name="front",L.push(N[0]),_.push(N[0]),u.add(N[0]),N.push(pe(0,Math.PI/2)),N[1].name="right",L.push(N[1]),_.push(N[1]),u.add(N[1]),N.push(pe(0,Math.PI)),N[2].name="back",L.push(N[2]),_.push(N[2]),u.add(N[2]),N.push(pe(0,-Math.PI/2)),N[3].name="left",L.push(N[3]),_.push(N[3]),u.add(N[3]),N.push(pe(Math.PI/2,0)),N[4].name="bottom",L.push(N[4]),_.push(N[4]),u.add(N[4]),N.push(pe(-Math.PI/2,0)),N[5].name="top",L.push(N[5]),_.push(N[5]),u.add(N[5]),e=N.length;var n;for(n=0;n<t.length;n++)N.push(t[n]),N[e+n].name=m[n],u.add(N[e+n]),L.push(N[e+n]),_.push(N[e+n]);for(e=N.length,n=0;n<i.length;n++)N.push(i[n]),N[e+n].name=g[n],u.add(N[e+n]),L.push(N[e+n]),_.push(N[e+n])},re=function(e,t,i){var n,o=new THREE.Vector3;return o.copy(e),o=o.unproject(t),n=new THREE.Raycaster(t.position,o.sub(t.position).normalize()),n.intersectObjects(i)},se=function(e,t){var i=e.clientX-t.x,n=e.clientY-t.y;return i=i/t.w*2-1,n=(t.h-n)/t.h*2-1,new THREE.Vector3(i,n,.5)},ae=function(e){if(e.preventDefault(),e.stopPropagation(),s.navApi.isActionEnabled("orbit")&&!s.currentlyAnimating){var t=o(e,r);I=J(i),i.removeEventListener("mousemove",he,!1),document.addEventListener("mouseup",ue,!1),document.addEventListener("touchend",ue,!1),s.navApi.getUsePivotAlways()||(s.pivot.copy(s.center),s.navApi.setPivotPoint(s.center),s.navApi.setPivotSetFlag(!1)),s.startInteraction(t.pageX,t.pageY);var n;0==s.rewindParams.history.length&&s.addHistoryElement(),s.rewindParams.snapped&&s.rewindParams.timelineIndex+1==s.rewindParams.history.length||s.addIntermediateHistoryElement();var a=s.navApi.getUseLeftHandedInput()?1:3;t.which!==a&&(r.animSpeed<=0?avp.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR)):(n=se(t,I),re(n,r.camera,_).length>0&&(Ee(),r.draggable&&(document.addEventListener("mousemove",le,!1),document.addEventListener("touchmove",le,!1),W&&(i.requestPointerLock(),Y=q&&X)))))}},le=function(e){if(e.preventDefault(),e.stopPropagation(),r.animSpeed<=0)return document.removeEventListener("mousemove",le,!1),document.removeEventListener("touchmove",le,!1),void avp.logger.error("animSpeed cannot be 0 or less",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR));if(!s.currentlyAnimating){var t=o(e,r);W&&Y&&(Y=!1,t.movementX=t.movementY=0),j&&(t.movementX>300||t.movementY>300)&&(t.movementX=0,t.movementY=0),t.movementX!==t.movementY||0!==t.movementX?(G=!1,K=!0,s.showPivot(!0),s.currentCursor=new THREE.Vector2(t.pageX,t.pageY),s.orbit(s.currentCursor,s.startCursor,new THREE.Vector3(-t.movementX,t.movementY,0),s.startState),r.camera.lookAt(r.center),requestAnimationFrame(r.render)):s.currentlyAnimating=!1}},ce=function(e){e||(document.removeEventListener("mouseup",ue,!1),document.removeEventListener("touchend",ue,!1)),document.removeEventListener("mousemove",le,!1),document.removeEventListener("touchmove",le,!1),i.addEventListener("mousemove",he,!1),j&&document.exitPointerLock()},ue=function(e){e.preventDefault(),e.stopPropagation();var t,n,l;if(s.currentlyAnimating||K)return s.endInteraction(),s.showPivot(!1),K=!1,void ce(!1);var c=o(e,r);if(s.viewCubeMenuOpen){var u=c.clientX-I.x,h=c.clientY-I.y;if(s.menuOrigin.x<=u&&u<=s.menuOrigin.x+s.menuSize.x&&s.menuOrigin.y<=h&&h<=s.menuOrigin.y+s.menuSize.y){var d=function(e){avp.logger.track({name:"navigation/"+e,aggregate:"count"})};switch(Math.floor((h-5-s.menuOrigin.y)/25)){case 0:d("home"),s.goHome();break;case 1:d("setortho"),s.setOrthographicFaces(!1),s.toOrthographic();break;case 2:d("setpersp"),s.setOrthographicFaces(!1),s.toPerspective();break;case 3:s.setOrthographicFaces(!0),G?s.toOrthographic():s.toPerspective();break;case 4:d("sethome"),s.setCurrentViewAsHome(!1);break;case 5:d("focushome"),s.setCurrentViewAsHome(!0);break;case 6:d("resethome"),s.resetHome();break;case 7:d("setfront"),s.setCurrentViewAsFront();break;case 8:d("settop"),s.setCurrentViewAsTop();break;case 9:s.resetOrientation()}}return s.viewCubeMenuOpen=!1,s.removeDropdownMenu(i),(c.clientX<I.x||c.clientX>I.w+I.x||c.clientY<I.y||c.clientY>I.h+I.y)&&ie(),r.mouseMoveSave&&r.processMouseMove(r.mouseMoveSave),s.endInteraction(),void ce(!1)}var g=s.navApi.getUseLeftHandedInput()?1:3;if(c.which===g)return s.viewCubeMenuOpen=!0,s.drawDropdownMenu(v,f,E,c.clientX,c.clientY,i,I),void ce(!0);var m=se(c,I);if(t=re(m,r.camera,_),n=re(m,p,D),l=re(m,p,O),n.length>0&&G){var A=s.getOrientation();switch(r.currentFace){case"front":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"right":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"left":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"back":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[1]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[3]&&(s.calculateCubeTransform("top"),r.currentFace="top");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("bottom"),r.currentFace="bottom"):n[0].object===D[1]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("top"),r.currentFace="top"):n[0].object===D[3]&&(s.calculateCubeTransform("bottom"),r.currentFace="bottom")}break;case"top":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front")}break;case"bottom":switch(A){case"up":n[0].object===D[0]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[1]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[2]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[3]&&(s.calculateCubeTransform("left"),r.currentFace="left");break;case"right":n[0].object===D[0]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[1]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[2]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[3]&&(s.calculateCubeTransform("front"),r.currentFace="front");break;case"down":n[0].object===D[0]?(s.calculateCubeTransform("back"),r.currentFace="back"):n[0].object===D[1]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[2]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[3]&&(s.calculateCubeTransform("right"),r.currentFace="right");break;case"left":n[0].object===D[0]?(s.calculateCubeTransform("left"),r.currentFace="left"):n[0].object===D[1]?(s.calculateCubeTransform("right"),r.currentFace="right"):n[0].object===D[2]?(s.calculateCubeTransform("front"),r.currentFace="front"):n[0].object===D[3]&&(s.calculateCubeTransform("back"),r.currentFace="back")}}s.elapsedTime=0,s.sphericallyInterpolateTransition()}if(l.length>0){if(s.elapsedTime=0,r.wantHomeButton&&l[0].object===O[P])return s.goHome(),void ce(!1);if(r.wantContextMenu&&l[0].object===O[V])return s.viewCubeMenuOpen=!0,s.drawDropdownMenu(v,f,E,c.clientX,c.clientY,i,I),void ce(!0);if(r.wantRollArrows&&G&&(l[0].object===O[M]||l[0].object===O[x])){var y=l[0].object===O[x],T={center:s.center.clone(),position:a.position.clone(),pivot:a.pivot.clone(),fov:a.fov,worldUp:s.sceneUpDirection.clone(),isOrtho:!1===a.isPerspective},w=s.center.clone().sub(a.position).normalize();y?T.up=a.up.clone().cross(w):(T.up=a.up.clone().multiplyScalar(-1),T.up.cross(w)),T.up.normalize(),s.elapsedTime=0,s.animateTransition(T)}}if(t.length>0){var b=t[0].object.name;r.mouseMoveSave=e,r.cubeRotateTo(b)}ce(!1)};this.cubeRotateTo=function(e){r.currentFace=e,s.orthographicFaces&&-1!==r.currentFace.indexOf(",")&&s.setCameraOrtho(!1),s.calculateCubeTransform(r.currentFace),s.elapsedTime=0,s.sphericallyInterpolateTransition(function(){r.mouseMoveSave&&r.processMouseMove(r.mouseMoveSave)})},this.processMouseMove=function(e){var t,i,n;if(s.viewCubeMenuOpen||s.currentlyAnimating)r.mouseMoveSave=e;else{r.mouseMoveSave=null;var a=o(e,r),l=se(a,I);if(t=re(l,r.camera,L),i=re(l,p,D),n=re(l,p,O),H&&!K&&(H.material.color.setHex(14540253),H=null,requestAnimationFrame(r.render)),i.length>0&&!K){H=i[0].object;for(var c=C.children.length;--c>=0;)if(H===D[c]){(H=C.children[c]).material.color.setHex(45055);break}requestAnimationFrame(r.render)}B&&!K&&(B.material.opacity=0,B=null,requestAnimationFrame(r.render)),t.length>0&&!K&&((B=t[0].object).material.opacity=.3,requestAnimationFrame(r.render)),n.length>0&&!K?F!==n[0].object&&(r.wantHomeButton&&n[0].object===O[P]?(F=n[0].object,O[P].material.map=Z[0]):r.wantRollArrows&&n[0].object===O[M]?(F=n[0].object,O[R].material.map=Z[1]):r.wantRollArrows&&n[0].object===O[x]?(F=n[0].object,O[R].material.map=Z[2]):r.wantContextMenu&&n[0].object===O[V]?(F=n[0].object,O[V].material.map=Z[6]):r.wantHomeButton&&F===O[P]?(F=null,O[P].material.map=Z[3]):!r.wantRollArrows||F!==O[M]&&F!==O[x]&&F!==O[R]?r.wantContextMenu&&F===O[V]&&(F=null,O[V].material.map=Z[5]):(F=null,O[R].material.map=Z[4]),requestAnimationFrame(r.render)):null===F||K||(r.wantHomeButton&&F===O[P]?(F=null,O[P].material.map=Z[3]):!r.wantRollArrows||F!==O[M]&&F!==O[x]&&F!==O[R]?r.wantContextMenu&&F===O[V]&&(F=null,O[V].material.map=Z[5]):(F=null,O[R].material.map=Z[4]),requestAnimationFrame(r.render))}};var he=function(e){s.navApi.isActionEnabled("orbit")&&r.processMouseMove(e)},de=function(){I=J(i),r.width=i.offsetWidth,r.height=i.offsetHeight,S=r.width/2,k=r.height/2,r.camera.aspect=r.width/r.height,r.camera.updateProjectionMatrix(),r.camera.topFov=r.camera.bottomFov=r.camera.fov/2,r.camera.leftFov=r.camera.rightFov=r.camera.aspect*r.camera.fov/2,r.renderer.setSize(r.width,r.height),requestAnimationFrame(r.render)},pe=function(e,t){var i,n=new THREE.Geometry,o=new THREE.Vector3(0,0,0),r=new THREE.Vector3(60,-60,105),s=new THREE.Vector3(60,60,105),a=new THREE.Vector3(-60,60,105),l=new THREE.Vector3(-60,-60,105);return n.vertices.push(o),n.vertices.push(r),n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.faces.push(new THREE.Face3(1,2,3)),n.faces.push(new THREE.Face3(1,3,4)),n.applyMatrix((new THREE.Matrix4).makeRotationX(e)),n.applyMatrix((new THREE.Matrix4).makeRotationY(t)),n.computeFaceNormals(),n.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(n,i)},ge=function(e,t,i){var n,o=new THREE.Geometry,r=new THREE.Vector3(60,105,105),s=new THREE.Vector3(-60,105,105),a=new THREE.Vector3(-60,60,105),l=new THREE.Vector3(60,60,105),c=new THREE.Vector3(60,105,60),u=new THREE.Vector3(-60,105,60),h=new THREE.Vector3(-60,105,105),d=new THREE.Vector3(60,105,105);return o.vertices.push(r),o.vertices.push(s),o.vertices.push(a),o.vertices.push(l),o.vertices.push(c),o.vertices.push(u),o.vertices.push(h),o.vertices.push(d),o.faces.push(new THREE.Face3(0,1,2)),o.faces.push(new THREE.Face3(0,2,3)),o.faces.push(new THREE.Face3(4,5,6)),o.faces.push(new THREE.Face3(4,6,7)),o.applyMatrix((new THREE.Matrix4).makeRotationX(e)),o.applyMatrix((new THREE.Matrix4).makeRotationY(t)),o.applyMatrix((new THREE.Matrix4).makeRotationZ(i)),o.computeFaceNormals(),o.computeVertexNormals(),n=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(o,n)},me=function(e,t){var i,n=new THREE.Geometry,o=new THREE.Vector3(105,105,105),r=new THREE.Vector3(60,105,105),s=new THREE.Vector3(60,60,105),a=new THREE.Vector3(105,60,105),l=new THREE.Vector3(105,105,60),c=new THREE.Vector3(105,105,105),u=new THREE.Vector3(105,60,105),h=new THREE.Vector3(105,60,60),d=new THREE.Vector3(105,105,105),p=new THREE.Vector3(105,105,60),g=new THREE.Vector3(60,105,60),m=new THREE.Vector3(60,105,105);return n.vertices.push(o),n.vertices.push(r),n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.vertices.push(c),n.vertices.push(u),n.vertices.push(h),n.vertices.push(d),n.vertices.push(p),n.vertices.push(g),n.vertices.push(m),n.faces.push(new THREE.Face3(0,1,2)),n.faces.push(new THREE.Face3(0,2,3)),n.faces.push(new THREE.Face3(4,5,6)),n.faces.push(new THREE.Face3(4,6,7)),n.faces.push(new THREE.Face3(8,9,10)),n.faces.push(new THREE.Face3(8,10,11)),n.applyMatrix((new THREE.Matrix4).makeRotationX(e)),n.applyMatrix((new THREE.Matrix4).makeRotationY(t)),n.computeFaceNormals(),n.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(n,i)},ve=function(e){var t=s.cubeFront.clone(),i=s.sceneUpDirection.clone(),n=t.clone().cross(i);i.copy(n).cross(t),t.normalize(),i.normalize(),n.normalize();var o=new THREE.Vector3(t.x,i.x,n.x).multiplyScalar(e.x);return o.add(new THREE.Vector3(t.y,i.y,n.y).multiplyScalar(e.y)),o.add(new THREE.Vector3(t.z,i.z,n.z).multiplyScalar(e.z)),o};this.render=function(){var e=r.compass?r.viewScaleFactorCompass*r.viewScale:r.viewScale,t=s.center.clone().sub(a.position).normalize(),i=a.up.normalize();t=ve(t),i=ve(i),r.camera.position.copy(t),r.camera.position.multiplyScalar(-e/r.camera.position.length()),r.camera.up=i.normalize(),r.camera.lookAt(r.center),fe();var n=r.renderer;n&&(n.clear(),n.render(l,r.camera),n.render(c,r.camera),n.render(h,r.camera),n.render(u,r.camera),n.render(d,p))};var fe=function(){!(G=s.isFaceView())||Q||s.currentlyAnimating?Ee():Ae(),Q?ye():Te(),Q?we():be()},Ee=function(){d.remove(C),O[R].material.opacity=0,O[V].material.opacity=0},Ae=function(){d.add(C);var e=r.wantRollArrows?1:0;O[R].material.opacity=e,O[V].material.opacity=e},ye=function(){b.material.opacity=av.isMobileDevice()?1:0},Te=function(){b.material.opacity=r.wantContextMenu?1:0},we=function(){T.material.opacity=0},be=function(){T.material.opacity=r.wantHomeButton?1:0};this.refreshCube=function(){de()},this.setSize=function(e,t){if(r.width=e,r.height=t,i.children.length>1)for(var n=1;n<i.children.length;n++)i.children[n].style.bottom=(r.height/5).toString()+"px";de()},this.useTransparency=function(e){Q=e,e?(i.onmouseover=ee,i.onmousemove=te,i.onmouseout=ie,ie()):(i.onmouseover=null,i.onmouseout=null,i.onmousemove=null,i.style.opacity="1.0")},this.dtor=function(){this.renderer=null},function(){var e=i.getBoundingClientRect();r.width=e.width,r.height=e.height,I=J(i),S=r.width/2,k=r.height/2,(p=new THREE.PerspectiveCamera(70,r.height/r.width,1,1e4)).position.set(0,0,500),l=new THREE.Scene,c=new THREE.Scene,u=new THREE.Scene,h=new THREE.Scene,d=new THREE.Scene,G=!0,z=200,r.viewScale=3.5*z;var t=THREE.LinearFilter,o=Autodesk.Viewing.Private.getResourceUrl,a="res/textures/",g=n||a,m=(new THREE.DDSLoader).load(o(g+"VCcrossRGBA8small.dds"));m.minFilter=m.maxFilter=t;var v=THREE.ShaderLib.cube,f=Autodesk.Viewing.Shaders.createShaderMaterial(v);f.depthWrite=!1,f.uniforms.tCube.value=m;var E=new THREE.BoxGeometry(z,z,z,4,4,4),N=new THREE.BoxGeometry(z+1,z+1,z+1,4,4,4);(A=new THREE.Mesh(E,f)).position.set(0,0,0),c.add(A);var L=ne(o(a+"VCedge1.png"));L.minFilter=L.maxFilter=t,(y=new THREE.Mesh(N,new THREE.MeshBasicMaterial({map:L,overdraw:!1,transparent:!0,shading:THREE.SmoothShading}))).position.set(0,0,0),h.add(y);var _=z,H=new THREE.Geometry,B=new THREE.Vector3(-30,0,0),F=new THREE.Vector3(30,0,0),U=new THREE.Vector3(0,-30,0);H.vertices.push(B),H.vertices.push(F),H.vertices.push(U),H.faces.push(new THREE.Face3(1,0,2)),H.computeFaceNormals();var j=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),Y=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),q=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),X=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),K=new THREE.PlaneBufferGeometry(.5*z,.3*z,2,2),Q=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),ee=new THREE.Mesh(H,j),te=new THREE.Mesh(K,Q);ee.position.set(0,_,0),te.position.set(0,.9*_,.1);var ie=new THREE.Mesh(H,Y),re=new THREE.Mesh(K,Q);ie.position.set(0,-_,0),re.position.set(0,.9*-_,.1),ie.rotation.z+=Math.PI,re.rotation.z+=Math.PI;var se=new THREE.Mesh(H,q),le=new THREE.Mesh(K,Q);se.position.set(_,0,0),le.position.set(.9*_,0,.1),se.rotation.z-=Math.PI/2,le.rotation.z-=Math.PI/2;var ce=new THREE.Mesh(H,X),ue=new THREE.Mesh(K,Q);ce.position.set(-_,0,0),ue.position.set(.9*-_,0,.1),ce.rotation.z+=Math.PI/2,ue.rotation.z+=Math.PI/2,(C=new THREE.Object3D).position.set(0,0,0),C.add(ee),C.add(ie),C.add(se),C.add(ce),d.add(te),d.add(re),d.add(le),d.add(ue),d.add(C),D.push(te),D.push(re),D.push(le),D.push(ue);var de=new THREE.PlaneBufferGeometry(z/3,z/3,2,2),pe=new THREE.MeshBasicMaterial({map:ne(o(a+"VChome.png")),transparent:!0,shading:THREE.FlatShading});(T=new THREE.Mesh(de,pe)).position.set(-z,z,0),P=O.length,d.add(T),O.push(T);var ge=new THREE.PlaneBufferGeometry(1.5*z,1.5*z,2,2),me=new THREE.MeshBasicMaterial({map:ne(o(a+"VCarrows.png")),shading:THREE.FlatShading,transparent:!0}),ve=new THREE.Mesh(ge,me);ve.position.set(.5*z+20,.5*z+20,0);var fe=new THREE.PlaneBufferGeometry(.6*z,.45*z,2,2),Ee=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),Ae=new THREE.Mesh(fe,Ee);Ae.position.set(.5*z+20,z+20,.1);var ye=new THREE.PlaneBufferGeometry(.45*z,.6*z,2,2),Te=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),we=new THREE.Mesh(ye,Te);we.position.set(z+20,.5*z+20,.1),d.add(ve),d.add(Ae),d.add(we),M=O.length,O.push(Ae),x=O.length,O.push(we),R=O.length,O.push(ve);var be=new THREE.PlaneBufferGeometry(z/2.3,z/2.3,2,2),Ce=new THREE.MeshBasicMaterial({map:ne(o(a+"VCcontext.png")),transparent:!0,shading:THREE.FlatShading});(b=new THREE.Mesh(be,Ce)).position.set(z,-z,0),V=O.length,d.add(b),O.push(b);var Se=new THREE.Geometry;Se.vertices.push(new THREE.Vector3(0,0,0)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,z/2)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,z/2)),Se.faces.push(new THREE.Face3(4,3,2)),Se.faces.push(new THREE.Face3(4,2,1));var ke;ke=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),w=new THREE.Mesh(Se,ke),l.add(w),oe(),"CANVAS"===s.renderer.toUpperCase()?r.renderer=new THREE.CanvasRenderer:"WEBGL"===s.renderer.toUpperCase()?r.renderer=new avp.FireflyWebGLRenderer({alpha:!0,antialias:!1}):(avp.logger.warn("Incorrect use of Autocam.renderer property"),r.renderer=new THREE.CanvasRenderer),r.useTransparency(!0),r.setSize(r.width,r.height),r.camera.topFov=r.camera.bottomFov=r.camera.fov/2,r.camera.leftFov=r.camera.rightFov=r.camera.aspect*r.camera.fov/2,r.renderer.autoClear=!1,r.renderer.setSize(r.width,r.height),r.renderer.sortObjects=!1,i.appendChild(r.renderer.domElement),i.addEventListener("touchstart",ae,!1),i.addEventListener("mousedown",ae,!1),i.addEventListener("mousemove",he,!1),(W=!1)&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,document.addEventListener("pointerlockchange",$,!1),document.addEventListener("mozpointerlockchange",$,!1),document.addEventListener("webkitpointerlockchange",$,!1)),Z.push(ne(o(a+"VChomeS.png"))),Z.push(ne(o(a+"VCarrowsS0.png"))),Z.push(ne(o(a+"VCarrowsS1.png"))),Z.push(ne(o(a+"VChome.png"))),Z.push(ne(o(a+"VCarrows.png"))),Z.push(ne(o(a+"VCcontext.png"))),Z.push(ne(o(a+"VCcontextS.png")))}()},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224},Autodesk.Viewing.ToolController=function(e,t,i,n,o){function r(e,i){return t.navigation.getUseLeftHandedInput()&&0===e||c&&1===e||l&&!h&&0===e&&i.ctrlKey}var s=Autodesk.Viewing,a=Autodesk.Viewing.Private;this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=i,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var l=-1!=navigator.userAgent.search("Mac OS"),c=-1!=navigator.userAgent.search("Firefox"),u=-1!==navigator.userAgent.search("Chrome"),h=-1!==navigator.userAgent.search("Safari")&&!u,d={},p=[],g=!1,m=-1,v=-1,f=!1,E=null,A=void 0,y=!1,T={},w=this,b=Autodesk.Viewing.KeyCode;this.__registerToolByName=function(e,t){d[t]=e},this.registerTool=function(e){var t=e.getNames();if(!t||0==t.length)return a.logger.warn("Cannot register tool with no name."),!1;for(var i=!1,o=0;o<t.length;++o)"default"!==t[o]&&(this.__registerToolByName(e,t[o]),i=!0);return e.utilities=n,e.controller=this,e.register&&e.register(),i},this.deregisterTool=function(e){this.deactivateTool(e.getName());var t=e.getNames();if(!t||0==t.length)return!1;for(var i=t.length;--i>=0;)this.__deregisterToolName(t[i]);return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in d&&(!function(e){for(var t=p.length;--t>=0;)p[t].activeName===e&&(d[e].deactivate(e),p.splice(t,1))}(e),delete d[e])},this.getTool=function(e){return d[e]},this.getActiveToolName=function(){var e=p.length;return e>0?p[e-1].activeName:"default"},this.getActiveTool=function(){var e=p.length;return e>0?p[e-1]:d.default},this.isToolActivated=function(e){for(var t=0;t<p.length;t++)if(p[t].activeName===e)return!0;return!1},this.setToolActiveName=function(e){var t=d[e];t&&(t.activeName=e)},this.activateTool=function(i){if(g)return!1;var n=d[i];if(n){void 0===n.count&&(n.count=0);var o=null;p.length&&"intercept"===p[p.length-1].activeName&&(o=p.pop());for(var r=0;r<p.length;r++)p[r]===n&&n.count++;return n.activeName=i,0===n.count&&(n.count++,p.push(n)),n.activate(i,t),o&&p.push(o),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:i,tool:n,active:!0}),e.track({category:"tool_changed",name:i}),!0}return a.logger.warn("activateTool not found: "+i),!1},this.deactivateTool=function(e){if(g)return!1;for(var i=p.length;--i>=0;)if(p[i].activeName===e)return 1===d[e].count&&p.splice(i,1),d[e].count--,d[e].deactivate(e),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:e,tool:p[i],active:!1}),!0;return a.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(d)},this.setDefaultTool=function(e){var t=this.getDefaultTool();return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return d.default},this.setDefaultTool(o),this.setIsLocked=function(e){var t=g;return g=!!e,t},this.getIsLocked=function(){return g},this.__checkCursor=function(){for(var e=null,i=p.length;--i>=0;){var n=p[i];if(n.getCursor&&(e=n.getCursor()))break}e||(e="auto"),E!=e&&(t.canvas.style.cursor=e,E=e)},this.update=function(e){this.__checkCursor();var i=!1;n&&n.update()&&(i=!0);for(var o=p.length;--o>=0;){var r=p[o];r.update&&r.update(e)&&(i=!0)}return t.navigation.getCamera().dirty?(t.navigation.updateCamera(),i=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,i?(t.navigation.updateCamera(),this.moveDelay=Date.now()+150):0!==this.moveDelay&&(this.moveDelay-Date.now()>0?i=!0:this.moveDelay=0),i},this.__clientToCanvasCoords=function(t,i,n){var o=e.canvas.getBoundingClientRect(),r=o.width,s=o.height,a=t.clientX-o.left,l=t.clientY-o.top;t.canvasX=a,t.canvasY=l,t.normalizedX=a/r*2-1,t.normalizedY=(s-l)/s*2-1,i&&i.set(a/r,l/s,0),n&&n.set(a,l)},this.__invokeStack=function(e,t,i){for(var n=p.length;--n>=0;){var o=p[n];if(o[e]&&o[e](t,i))return!0}var r=this.getDefaultTool();return!(!r[e]||!r[e](t,i))},this.distributeEvent=function(e,t,i){return this.__invokeStack(e,t,i)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect());for(var e=p.length;--e>=0;){var i=p[e];i.handleResize&&i.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e);this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e);this.__invokeStack("handleDoubleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e)&&(t.preventDefault(),t.stopPropagation())},this.applyButtonMappings=function(e){var i=e.button;return"buttons"in e&&(e.firefoxSpoof?i=0:!f||1&e.buttons?2===i&&1&e.buttons&&(i=0,e.firefoxSpoof=f=!0):(e.firefoxSpoof=!0,f=!1,i=0)),t.navigation.getUseLeftHandedInput()&&(i=0===i?2:2===i?0:i),i},this.applyKeyMappings=function(e,t){switch(e.keyCode){case b.LCOMMAND:case b.RCOMMAND:case b.COMMANDMOZ:return l&&e.metaKey&&e.shiftKey?null:b.CONTROL;case b.SHIFT:return t&&l&&e.metaKey?null:b.SHIFT;case b.EQUALSMOZ:return b.EQUALS;case b.DASHMOZNEW:case b.DASHMOZ:return b.DASH}return e.keyCode},this.handleKeyDown=function(e){var t=this.applyKeyMappings(e,!0);t&&this.__invokeStack("handleKeyDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleKeyUp=function(e){var t=this.applyKeyMappings(e,!0);t&&this.__invokeStack("handleKeyUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&(e.preventDefault(),e.stopPropagation())},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&(e.preventDefault(),e.stopPropagation())},this.keydown=function(e){if(!(!w.domElement.contains(A)||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var t=document.activeElement.getAttribute("contenteditable");if("true"===t||""===t)return}l&&e.metaKey&&e.keyCode!=b.LCOMMAND&&e.keyCode!=b.RCOMMAND||w.handleKeyDown(e)}},this.keyup=function(e){l&&e.metaKey&&e.keyCode!=b.LCOMMAND&&e.keyCode!=b.RCOMMAND||w.handleKeyUp(e)},this.mousedown=function(e){function t(e){w.applyButtonMappings(e)===i&&(document.removeEventListener("mouseup",t),w.mouseup(e))}s.isIE11&&s.inFullscreen()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),w.__clientToCanvasCoords(e);var i=w.applyButtonMappings(e);if(w.handleButtonDown(e,i),m=e.canvasX,v=e.canvasY,r(i,e)){var n=T,o=void 0!==n.time&&e.timeStamp-n.time<500,a=void 0!==n.x&&void 0!==n.y&&Math.abs(n.x-e.canvasX)<=2&&Math.abs(n.y-e.canvasY)<=2;(!o||!a||n.clickCount&&2<=n.clickCount)&&(n.clickCount=0),n.clickCount?1===n.clickCount&&(n.clickCount=2):(n.clickCount=1,n.x=e.canvasX,n.y=e.canvasY,n.time=e.timeStamp)}document.addEventListener("mouseup",t,!1),w.registerWindowMouseMove()},this.mousemove=function(e){w.__clientToCanvasCoords(e);var t=m-e.canvasX,i=v-e.canvasY;(Math.abs(t)>2||Math.abs(i)>2)&&(m=-1,v=-1),w.handleMouseMove(e)},this.mouseup=function(e){w.__clientToCanvasCoords(e);var t=w.applyButtonMappings(e);w.handleButtonUp(e,t);var i=m-e.canvasX,n=v-e.canvasY;if(m=-1,v=-1,Math.abs(i)<=2&&Math.abs(n)<=2&&w.handleSingleClick(e),r(t,e)){var o=T;2===o.clickCount&&(w.handleDoubleClick(e),o.clickCount=0,o.x=void 0,o.y=void 0,o.time=void 0)}w.unregisterWindowMouseMove()},this.doubleclick=function(e){w.__clientToCanvasCoords(e),m=e.canvasX,v=e.canvasY,w.handleDoubleClick(e)},this.mousewheel=function(e){if(w.scrollInputEnabled){var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail),w.handleWheelInput(t,e)}},this.blur=function(e){w.handleBlur(e)},this.mouseover=function(e){A=e.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",w.mousemove),window.addEventListener("mouseover",w.mouseover),w.domElement.removeEventListener("mousemove",w.mousemove),w.domElement.removeEventListener("mouseover",w.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",w.mousemove),window.removeEventListener("mouseover",w.mouseover),w.domElement.addEventListener("mousemove",w.mousemove),w.domElement.addEventListener("mouseover",w.mouseover)},this.enableMouseButtons=function(e){e&&!y?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&y&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var t=y;return y=e,t},this.enableMouseButtons(!0),this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(y&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",w.mousemove),window.removeEventListener("mouseover",w.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;p.length>0;)this.deactivateTool(p[p.length-1].activeName);d=null,p=null,w=null,n=null,t=null,e=null,A=null},this.set2DMode=function(e){},this.setAutocam=function(e){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera();i.sync(e),i.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ViewingUtilities=function(e,t,i){function n(e){var t=0,i=new THREE.SphereGeometry(1),n=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),o=new THREE.Mesh(i,n),r=e;r.createOverlayScene("pivot"),o.visible=!1,this.shown=function(){return o.visible},this.show=function(e,i,s){o.scale.x=i,o.scale.y=i,o.scale.z=i,o.position.set(e.x,e.y,e.z),n.opacity=.6,o.visible=!0,r.addOverlay("pivot",o),r.invalidate(!1,!1,!0),t=s?Date.now()+500:0},this.hide=function(){o.visible&&(o.visible=!1,r.removeOverlay("pivot",o),r.invalidate(!1,!1,!0),t=0)},this.fade=function(){if(t>0){var e=t-Date.now();if(e<=0)return this.hide(),!0;var i=e/500*.6;return n.opacity=i,!0}return!1},this.fading=function(){return t>0}}function o(e,t,i){var n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var o=n.clone().cross(i);return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()}this.autocam=t,this.viewerImpl=e;var r=i.getCamera(),s={},a={},l=new n(this.viewerImpl);this.transitionView=function(e,n,s,a,l,c,u){l=l||i.getWorldUpVector();var h=c?o(e,n,l):a;h||(h=r.up);var d={position:e,center:n,pivot:u=u||n,fov:s,up:h,worldUp:l,isOrtho:!1===r.isPerspective};t.goToView(d)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){e=2*e-1,t=2*(t=1-t)-1;var i=new THREE.Vector3(e,t,1),n=this.viewerImpl.hitTestViewport(i,!1);return n?n.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=r.isPerspective?i.getPivotPlaneDistance():i.getEyeVector().length(),n=i.getVerticalFov(),o=2*t*Math.tan(THREE.Math.degToRad(.5*n)),s=i.getScreenViewport(),a=window.devicePixelRatio||1,c=5*o/(s.height*a);l.show(i.getPivotPoint(),c,e)}},this.pivotActive=function(e,t){e=e&&!i.getIs2D(),t=t||!1,e||!l.shown()?e&&this.activatePivot(t):l.hide()},this.pivotUpdate=function(){l.shown()&&l.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,n){i.setPivotPoint(e),t||i.setTarget(e),n&&i.setPivotSetFlag(!0),this.setTemporaryPivot(null),i.getIs2D()||l.shown()&&this.activatePivot(l.fading())},this.savePivot=function(e){e||(e="default"),s[e]=i.getPivotPoint(),a[e]=i.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),s[e]){var t=a[e];this.setPivotPoint(s[e],!0,t),t||i.setPivotSetFlag(!1),delete s[e],delete a[e]}},this.setTemporaryPivot=function(e){if(e){var t=i.getPivotPoint(),n=i.getPivotSetFlag();this.setPivotPoint(e,!0,n),s.TEMP=t,a.TEMP=n}else delete s.TEMP,delete a.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.api.getSelection()),this.activatePivot(!0)},this.update=function(){i.getRequestFitToView()&&!i.getTransitionActive()&&(i.setRequestFitToView(!1),this.fitToView()),i.getRequestHomeView()&&!i.getTransitionActive()&&(i.setRequestHomeView(!1),this.goHome());var e=i.getRequestTransition();return e&&!i.getTransitionActive()&&(i.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.DefaultHandler=function(e,t,i){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,n){for(var o=0;o<t.length;++o)switch(t[o]){case"selectOnly":e.selector&&n&&e.selector.setSelection([n.dbId],n.model);break;case"deselectAll":e.selector&&e.selector.setSelection([]);break;case"selectToggle":e.selector&&n&&e.selector.toggleSelection(n.dbId,n.model);break;case"isolate":n&&e.isolate(n.dbId);break;case"showAll":e.showAll();break;case"setCOI":n&&n.intersectPoint&&(i.setPivotPoint(n.intersectPoint,!0,!0),i.pivotActive(!0,!0));break;case"hide":n&&e.hide(n.dbId);break;case"show":n&&e.show(n.dbId);break;case"toggleVisibility":n&&e.toggleVisibility(n.dbId);break;case"focus":e.selector&&(n?e.selector.setSelection([n.dbId],n.model):e.selector.setSelection([]),i.fitToView())}},this.handleSingleClick=function(t,n){var o=t.ctrlKey||t.metaKey,r=t.shiftKey,s=t.altKey;if(0===n){var a=new THREE.Vector3(t.normalizedX,t.normalizedY,1),l=e.hitTestViewport(a,!1),c="click";o&&(c+="Ctrl"),r&&(c+="Shift"),s&&(c+="Alt");var u=l?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[c]&&this.clickConfig[c][u])return this.handleAction(this.clickConfig[c][u],l),!0}else if(1===n&&r&&!s&&!o){a=new THREE.Vector3(t.normalizedX,t.normalizedY,1);if((l=e.hitTestViewport(a,!1))&&l.intersectPoint)return i.setPivotPoint(l.intersectPoint,!0,!0),i.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(n,o){if(e.selector&&0===o){var r=new THREE.Vector3(n.normalizedX,n.normalizedY,1),s=e.hitTestViewport(r,!1);return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),i.fitToView(),!0}return 1===o&&(t.fitBounds(!1,i.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(i){if(i.clientX=i.pointers[0].clientX,i.clientY=i.pointers[0].clientY,e.api.triggerSingleTapCallback(i),i.hasOwnProperty("pointers")&&2===i.pointers.length)return t.setRequestHomeView(!0),!0;if(e.selector){var n=new THREE.Vector3(i.normalizedX,i.normalizedY,1),o=e.hitTestViewport(n,!1);return o?(e.selector.setSelection([o.dbId],o.model),e.api.triggerSelectionChanged([o.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t);var n=this.handleSingleTap(t,0);return i.fitToView(),n},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.GestureHandler=function(e){var t=Autodesk.Viewing,i=e.navigation,n=["gestures"],o=this,r=!0,s=!0,a=null,l=t.isTouchDevice();i.setIsTouchDevice(l),l&&(a=new Hammer.Manager(e.canvasWrap,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}],[Hammer.Pan,{event:"drag3",pointers:3,threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Rotate,{enable:!0,threshold:7}]],inputClass:Hammer.TouchInput}),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return n},this.getName=function(){return n[0]},this.__clientToCanvasCoords=function(t){var i,n,o=e.impl.canvas.getBoundingClientRect(),r=o.width,s=o.height;t.hasOwnProperty("center")?(i=t.center.x-o.left,n=t.center.y-o.top):(i=t.pointers[0].clientX-o.left,n=t.pointers[0].clientY-o.top),t.canvasX=i,t.canvasY=n,t.normalizedX=i/r*2-1,t.normalizedY=(s-n)/s*2-1},this.distributeGesture=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleGesture",e)&&e.preventDefault(),function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(e.type,"end")&&a.stop()},this.onSingleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){o.__clientToCanvasCoords(e),"press"===e.type?r=o.controller.enableMouseButtons(!1):o.controller.enableMouseButtons(r),o.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.activate=function(e){a&&(a.on("dragstart dragmove dragend",this.distributeGesture),a.on("singletap",this.onSingleTap),a.on("singletap2",this.onSingleTap),a.on("doubletap",this.onDoubleTap),a.on("doubletap2",this.onDoubleTap),a.on("press pressup",this.onPressHold),a.on("drag3start drag3move drag3end",this.distributeGesture),s&&(a.on("panstart panmove panend",this.distributeGesture),a.on("pinchstart pinchmove pinchend",this.distributeGesture),a.on("rotatestart rotatemove rotateend",this.distributeGesture)),a.get("doubletap2").recognizeWith("doubletap"),a.get("singletap2").recognizeWith("singletap"),a.get("singletap").requireFailure("doubletap"))},this.deactivate=function(e){a&&(a.off("dragstart dragmove dragend",this.distributeGesture),a.off("singletap",this.onSingleTap),a.off("singletap2",this.onSingleTap),a.off("doubletap",this.onDoubleTap),a.off("doubletap2",this.onDoubleTap),a.off("press pressup",this.onPressHold),a.off("drag3start drag3move drag3end",this.distributeGesture),s&&(a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture)))},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){s=!1,a&&(a.remove(Hammer.Pan),a.remove(Hammer.Pinch),a.remove(Hammer.Rotate),a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.OrbitDollyPanTool=function(e,t){function i(){var e=ne;return O===L&&!e.SHIFT&&!(e.ALT^e.CONTROL)||O===L&&e.SHIFT&&e.CONTROL||O===D&&!e.SHIFT&&!e.CONTROL||O===D&&e.ALT||O===D&&e.CONTROL&&!e.ALT||O===N&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===T&&O!==D&&!e.ALT&&!("pinch"===w)||e.SPACE}function n(){var e=ne;return O===L&&e.SHIFT&&!e.ALT&&!e.CONTROL||O===L&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===T&&!e.ALT&&!("pinch"===w)}function o(){var e=ne;return!(e.CONTROL||e.ALT||e.SHIFT||O!==L&&O!==D)}function r(){return v.getPivotPoint().sub(v.getPosition()).dot(v.getEyeVector())<=0}function s(e,t){var i={left:0,top:0,width:window.innerWidth,height:window.innerHeight};Q.set((e-.5*i.width-i.left)/(.5*i.width),(.5*i.height+i.top-t)/(.5*i.height),0);var n=Q.length();return $?n<Math.SQRT1_2?Q.z=Math.sqrt(1-n*n):Q.z=.5/n:n>1?Q.normalize():Q.z=Math.sqrt(1-n*n),Y.copy(f.position).sub(f.pivot),X.copy(f.up).setLength(Q.y),X.add(K.copy(f.up).cross(Y).setLength(Q.x)),X.add(Y.setLength(Q.z)),X}function a(){if(v.isActionEnabled("orbit")){Y.subVectors(f.position,f.pivot),q.subVectors(f.position,f.target);var e=q.length();q.normalize();var t=Math.acos(W.dot(j)/W.length()/j.length());t&&(t*=g,Z.crossVectors(W,j).normalize(),J.setFromAxisAngle(Z,-t),Y.applyQuaternion(J),f.up.applyQuaternion(J),j.applyQuaternion(J),q.applyQuaternion(J),ee?W.copy(j):(J.setFromAxisAngle(Z,t*(te-1)),W.applyQuaternion(J))),f.position.addVectors(f.pivot,Y),f.target.subVectors(f.position,q.multiplyScalar(e)),f.dirty=!0}}function l(e,t){return-1!==e.indexOf(t,e.length-t.length)}function c(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY;return Math.sqrt(t*t+i*i)}Autodesk.Viewing.Private;var u,h,d,p=this,g=2,m=-1!=navigator.userAgent.search("Mac OS"),v=t.navigation,f=v.getCamera(),E=["orbit","freeorbit","dolly","pan"],A=E[0],y=[A],T=A,w=null,b=1,C=1,S=0,k=0,M=0,x=0,R=!1,P=null,V=!1,I={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},N=0,D=1,L=2,O=-5,_=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector2,F=new THREE.Vector2,z=new THREE.Vector2,U=new THREE.Vector2,G=new THREE.Vector3,W=new THREE.Vector3,j=new THREE.Vector3,Y=new THREE.Vector3,q=new THREE.Vector3,X=new THREE.Vector3,K=new THREE.Vector3,Q=new THREE.Vector3,Z=new THREE.Vector3,J=new THREE.Quaternion,$=!1,ee=!0,te=.2,ie=[!1,!1,!1,!1,!1,!1],ne={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},oe=1,re=5,se=.025;this.getNames=function(){return E},this.getName=function(){return E[0]},this.activate=function(e){y.push(e),T=e},this.deactivate=function(e){var t=y.length-1;t>0&&y[t]===e&&(y.pop(),T=y[t-1])},this.adjustDollyLookSpeed=function(e){0===e?(se=.025,re=5):(se*=e>0?1.1:.9,re*=e>0?1.1:.9,se<1e-6&&(se=1e-6),re<1e-6&&(re=1e-6))},this.getDollySpeed=function(e){var t=v.getEyeVector(),i=v.getPosition(),n=e.clone().sub(i).dot(t.normalize())*se;return Math.abs(n)<.01?n<0?-.01:.01:n},this.getLookSpeed=function(){return re},this.coiIsActive=function(){return v.getPivotSetFlag()&&v.isPointVisible(v.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return O===D&&ne.SHIFT?y[1]:n()||0!==G.z?o()?"pan":"dolly":i()?"pan":"pan"===w||"pinch"===w?"dollypan":T},this.initTracking=function(e,t){var i;if(f.isPerspective){i=.5*(f.near+f.far);var n=this.utilities.getHitPoint(e,t),o=v.getPosition();if(n&&n.sub){var r=n.sub(o),s=v.getEyeVector().normalize();i=Math.abs(s.dot(r))}else if(v.getPivotSetFlag()&&v.isPointVisible(v.getPivotPoint())){var a=v.getPivotPlaneDistance();a>1e-5&&(i=a)}}else i=v.getEyeVector().length();oe=i},this.initOrbit=function(){this.utilities.setTemporaryPivot(r()?v.getTarget():null)},this.getActiveMode=function(){return A},this.getCursor=function(){switch(A){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var i=v&&v.getReverseZoomDirection()?-1.5:1.5;m&&(i*=-1),ie[0]&&(H.x+=.01,z.x+=20),ie[1]&&(H.x-=.01,z.x-=20),ie[2]&&(H.y+=.01,z.y+=20),ie[3]&&(H.y-=.01,z.y-=20),ie[4]&&(H.z+=i),ie[5]&&(H.z-=i);var n=H.x-_.x,o=H.y-_.y,r=H.z-_.z;Math.abs(n)<.001&&(n=0),Math.abs(o)<.001&&(o=0),Math.abs(r)<.001&&(r=0),e.set(n,o,r),t&&t.set(z.x-F.x,z.y-F.y)},this.stepMotionDelta=function(e,t){t?(_.x+=.6*e.x,_.y+=.6*e.y,_.z+=.6*e.z):_.copy(H),F.copy(z)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(d=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),d},this.update=function(){var e,i=!1,n=!1;this.getMotionDelta(G,U);var o=G.x,r=G.y,s=G.z;if(R||this.checkInteractionMode(),(R=O>-1)&&this.controller.setIsLocked(!0),0!==o||0!==r||0!==s){switch(A){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(U.x=-U.x,P&&this.utilities.autocam.orbit(z,P,U.multiplyScalar(g),this.utilities.autocam.startState));break;case"freeorbit":a();break;case"dolly":var l,c,d;s*=.6,O>=N?(r=-r,s=Math.abs(o)>Math.abs(r)?o:r,s*=100,o=0,r=0,c=d=.5):(e=v.getScreenViewport(),u&&h?(c=u/e.width,d=h/e.height):c=d=.5),l=!v.getIs2D()&&v.getZoomTowardsPivot()?this.coiIsActive()?v.getPivotPoint():v.getWorldPoint(.5,.5):v.getWorldPoint(c,d),v.dollyFromPoint(s*this.getDollySpeed(l),l,this.getFitBounds());break;case"pan":v.panRelative(-o,r,oe);break;case"dollypan":0===o&&0===r||v.panRelative(-o,r,oe),e=v.getScreenViewport(),c=u/e.width,d=h/e.height,l=v.getWorldPoint(c,d);var p=v.getPosition(),m=v.getIs2D()?p.sub(l).length():oe,y=(S/k-1)*m;v.dollyFromPoint(y,l,this.getFitBounds());var T=new THREE.Vector3,x=new THREE.Quaternion,I=v.getCameraUpVector(),D=T.copy(f.position).sub(f.target).normalize();x.setFromAxisAngle(D,1.2*M),I.applyQuaternion(x),v.getIs2D()||v.setCameraUpVector(I),S=k,C=b,oe=m+y}n=!0}return this.stepMotionDelta(G,"pan"!==A&&"dollypan"!==A),-1===O&&Math.abs(s)<1e-5&&(this.interactionEnd(-1),i=!0,n=!0),(ne.SHIFT||ne.ALT)&&-1!==E.indexOf(t.getActiveNavigationTool())&&(n=!0),!V&&(i||O>-5)&&(O>-1&&(_.copy(H),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),O=-5,R&&this.controller.setIsLocked(!1),R=!1,P=null,w=null),n?this.utilities.pivotActive(v.getPivotSetFlag(),O<=-1):this.utilities.pivotUpdate(),f.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode();e!==A&&("pan"===(A=e)&&O>-1||"dollypan"===A)&&this.initTracking(_.x,_.y)},this.interactionStart=function(e,t){(t||e>O)&&(O=e,V=!0,e>-1&&("pan"===A&&this.initTracking(_.x,_.y),"orbit"===A&&this.initOrbit()),this.utilities.pivotActive(v.getPivotSetFlag(),-1===e),this.utilities.autocam&&(this.utilities.autocam.sync(f),this.utilities.autocam.startInteraction(F.x,F.y),P=F.clone()))},this.interactionCheck=function(){(ie[0]||ie[1]||ie[2]||ie[3]||ie[4]||ie[5]||ne.SHIFT||ne.CONTROL||ne.ALT||ne.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(e){e===O&&(-1!==e&&this.utilities.pivotActive(!1),V=!1)},this.handleWheelInput=function(t){if(this.isDragging)return!1;if(v.getIs2D()){var i=v.getScreenViewport(),n=e.intersectGround(u+i.width,h+i.height);this.utilities.setPivotPoint(n,!0,!0)}return v.getReverseZoomDirection()&&(t*=-1),H.z+=t,0!=t&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),ne.SHIFT=0,ne.CONTROL=0,ne.ALT=0,ne.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?ie[0]=ie[1]=ie[2]=ie[3]=ie[4]=ie[5]=t:ie[e]=t,t||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(e){ne.CONTROL=m&&e.metaKey||e.ctrlKey?1:0,ne.SHIFT=e.shiftKey?1:0,ne.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e);var i=!1;switch(t){case I.EQUALS:this.adjustSpeed(1),i=!0;break;case I.DASH:this.adjustSpeed(-1),i=!0;break;case I.ZERO:this.adjustSpeed(0),i=!0;break;case I.LEFT:this.autoMove(0,!0),i=!0;break;case I.RIGHT:this.autoMove(1,!0),i=!0;break;case I.PAGEUP:this.autoMove(2,!0),i=!0;break;case I.PAGEDOWN:this.autoMove(3,!0),i=!0;break;case I.UP:this.autoMove(4,!0),i=!0;break;case I.DOWN:this.autoMove(5,!0),i=!0;break;default:return!1}return this.isDragging||this.interactionStart(-4),i},this.handleKeyUp=function(e,t){this.updateModifierState(e);var i=!1;switch(t){case I.LEFT:this.autoMove(0,!1),i=!0;break;case I.RIGHT:this.autoMove(1,!1),i=!0;break;case I.PAGEUP:this.autoMove(2,!1),i=!0;break;case I.PAGEDOWN:this.autoMove(3,!1),i=!0;break;case I.UP:this.autoMove(4,!1),i=!0;break;case I.DOWN:this.autoMove(5,!1),i=!0;break;default:return!1}return i&&(this.interactionEnd(-4),V||this.interactionCheck()),i},this.handleDollyPan=function(e){u=e.canvasX,h=e.canvasY;var t=v.getScreenViewport();z.x=B.x+e.deltaX,z.y=B.y+e.deltaY,H.x=z.x/t.width,H.y=z.y/t.height,k=c(e);var i=THREE.Math.degToRad(e.rotation);M=i-x,Math.abs(M)>1&&(M=0),x=i,l(e.type,"start")&&(S=k,C=1,M=0,x=i),b=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return w="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===w&&this.handleMouseMove(e);case"dragend":return"drag"===w&&(this.handleButtonUp(e,0),w=null,!0);case"panstart":return w="pan",this.isDragging=!0,_.x=.5*(e.normalizedX+1),_.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),F.set(e.canvasX,e.canvasY),this.interactionStart(3),this.handleDollyPan(e),!0;case"panmove":return"pan"===w&&this.handleDollyPan(e);case"panend":return"pan"===w&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0);case"pinchstart":return this.isDragging=!0,w="pinch",_.x=.5*(e.normalizedX+1),_.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),F.set(e.canvasX,e.canvasY),this.interactionStart(3),this.handleDollyPan(e),!0;case"pinchmove":return"pinch"===w&&this.handleDollyPan(e);case"pinchend":return"pinch"===w&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),_.x=.5*(e.normalizedX+1),_.y=1-.5*(e.normalizedY+1),F.set(e.canvasX,e.canvasY),H.copy(_),z.copy(F),W.copy(s(e.canvasX,e.canvasY)),j.copy(W),u=e.canvasX,h=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),H.x=.5*(e.normalizedX+1),H.y=1-.5*(e.normalizedY+1),z.set(e.canvasX,e.canvasY),j.copy(s(e.canvasX,e.canvasY)),W.copy(j),u=e.canvasX,h=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(H.x=.5*(t.normalizedX+1),H.y=1-.5*(t.normalizedY+1),z.set(t.canvasX,t.canvasY),j.copy(s(t.canvasX,t.canvasY)),u=t.canvasX,h=t.canvasY,!0):(_.x=.5*(t.normalizedX+1),_.y=1-.5*(t.normalizedY+1),F.set(t.canvasX,t.canvasY),H.x=_.x,H.y=_.y,z.copy(F),u=t.canvasX,h=t.canvasY,e.rolloverObject(u,h),!1)},this.handleBlur=function(e){this.resetKeys(),this.interactionEnd(O)},t.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(e){p.handleBlur(e)})},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.HotGestureTool=function(e){navigator.userAgent.search("Mac OS"),e.navigation.getCamera();var t=["hottouch"],i={SHIFT:0,ALT:0,CONTROL:0},n=null,o=null,r=!1,s=!1,a=null,l={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224};this.getNames=function(){return t},this.getName=function(){return t[0]},this.activate=function(e){},this.deactivate=function(e){},this.__checkStart=function(){a&&(this.controller.distributeEvent("handleGesture",a),a=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var t=e.getActiveNavigationTool(),i=!1===r&&!0===s,a=!0===r&&!1===s;if(i||a){var l=i?"worldup":"fov";if(t===l)return!1;if(t===n)return e.setActiveNavigationTool(l),n=l,this.__checkStart(),!1;o=t,e.setActiveNavigationTool(l),n=l,this.__checkStart()}else n&&(e.setActiveNavigationTool(o),n=null,o=null);return!1},this.resetKeys=function(){i.SHIFT=0,i.CONTROL=0,i.ALT=0},this.updateModifierState=function(e){i.CONTROL=e.ctrlKey?1:0,i.SHIFT=e.shiftKey?1:0,i.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===a)return!1;switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(a=t,r=!0);break;case"drag3move":break;case"drag3end":r=!1;break;case"rotatestart":e.navigation.isActionEnabled("roll")&&(a=t,s=!0);break;case"rotatemove":break;case"rotateend":s=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case l.SHIFT:i.SHIFT=1;break;case l.CONTROL:i.CONTROL=1;break;case l.ALT:i.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case l.SHIFT:i.SHIFT=0;break;case l.CONTROL:i.CONTROL=0;break;case l.ALT:i.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.HotkeyManager=function(){function e(){return g}function t(){return g[0]}function i(e,t){return e-t}function n(e,t,n){if(u.some(function(t){return t.id===e}))return!1;for(var o=0;o<t.length;o++)u.push({id:e,keys:t[o].keycodes.sort(i).join(),onPress:t[o].onPress,onRelease:t[o].onRelease,options:n||{}});return!0}function o(e){for(var t=!1,i=u.length-1;i>=0;i--)u[i].id===e&&(u.splice(i,1),t=!0);return t}function r(){var e,t=h.join();for(e=0;e<p.length;)p[e].keys===t?p.splice(e,1):e++;for(e=0;e<d.length;)d[e].keys!==t?d.splice(e,1):e++}function s(e,t){if(-1===h.indexOf(t)){for(var i=h.join(),n=h.slice(0),o=0;o<h.length&&h[o]<t;)o++;h.splice(o,0,t);var s=h.join(),a=h.slice(0);r();var l,c=[],g=[];for(o=u.length-1;o>=0;o--)(l=u[o]).keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&g.unshift(l);for(o=c.length-1;o>=0&&!(l=c[o]).onRelease(n);o--)l.options.tryUntilSuccess&&p.unshift(l);for(o=g.length-1;o>=0&&!(l=g[o]).onPress(a);o--)l.options.tryUntilSuccess&&d.unshift(l)}}function a(e,t){var i=h.join(),n=h.slice(0),o=h.indexOf(t);o>-1&&h.splice(o,1);var s=h.join(),a=h.slice(0);r();var l,c=[],g=[];for(o=u.length-1;o>=0;o--)(l=u[o]).keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&g.unshift(l);for(o=c.length-1;o>=0&&!(l=c[o]).onRelease(n);o--)l.options.tryUntilSuccess&&p.unshift(l);for(o=g.length-1;o>=0&&!(l=g[o]).onPress(a);o--)l.options.tryUntilSuccess&&d.unshift(l)}function l(){var e,t;for(t=0;t<p.length;)!0===(e=p[t]).onRelease(e.keys.split())?p.splice(t,1):t++;for(t=0;t<d.length;)!0===(e=d[t]).onPress(e.keys.split())?d.splice(t,1):t++;return!1}function c(){for(var e=h.length-1;e>=0;e--)a(null,h[e])}var u=[],h=[],d=[],p=[],g=["hotkeys"];return{pushHotkeys:n,popHotkeys:o,handleKeyDown:s,handleKeyUp:a,handleBlur:c,getName:t,getNames:e,activate:function(){},deactivate:function(){},update:l,KEYCODES:Autodesk.Viewing.KeyCode}},Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager,AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.FovTool=function(e){function t(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}var i=e.navigation,n=i.getCamera(),o=["fov"],r=!1,s=0,a=null,l=null,c=!1,u=0,h=-5,d=new THREE.Vector3,p=new THREE.Vector3,g=new THREE.Vector3,m=null;this.getNames=function(){return o},this.getName=function(){return o[0]},this.activate=function(e){u=0},this.deactivate=function(e){h=-5},this.getCursor=function(){return 0!==u&&-5===h?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var t=p.x-d.x,i=p.y-d.y,n=p.z-d.z;Math.abs(t)<.001&&(t=0),Math.abs(i)<.001&&(i=0),Math.abs(n)<.001&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(e,t){t?(d.x+=.6*e.x,d.y+=.6*e.y,d.z+=.6*e.z):d.copy(p)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),i=0;return l&&e-l>100?(i=t(s),s=0,a=null,l=null,c=!1):a&&e-a>100&&(c?Math.abs(s)>=3&&(i=s,s=0):(i=t(s),c=!0,s=0)),i},this.update=function(){var e=!1,t=h>-5;if(h>-5){this.controller.setIsLocked(!0),this.getMotionDelta(g);var o=g.x,s=g.y,a=g.z;if(0!==o||0!==s||0!==a)if(t=!0,h>=0)s=-s,0!==(a=Math.abs(o)>Math.abs(s)?o:s)&&(a*=-1,i.setVerticalFov(i.getVerticalFov()*(1+a),!0));else{var l=this.getAccumulatedWheelDelta()/3;0!==l&&i.setFocalLength(i.getFocalLength()+l,!0)}this.stepMotionDelta(g,!0),-1===h&&Math.abs(a)<1e-5&&(this.interactionEnd(-1),e=!0)}return t?this.utilities.pivotActive(i.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!r&&(e||h>-5)&&(h>-1&&d.copy(p),h=-5,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,t){(t||e>h)&&(h=e,r=!0),i.toPerspective()},this.interactionEnd=function(e){e===h&&(-1!==e&&this.utilities.pivotActive(!1),r=!1)},this.handleWheelInput=function(e){if(h>-1)return!1;i.getReverseZoomDirection()&&(e*=-1),p.z+=e,s+=e;var t=Date.now();return a||(a=t),l=t,0!=e&&this.interactionStart(-1),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return this.handleButtonUp(e,0);case"drag3start":return m="drag",this.handleButtonDown(e,0);case"drag3move":return"drag"===m&&this.handleMouseMove(e);case"drag3end":return"drag"===m&&this.handleButtonUp(e,0),m=null,!1}return!1},this.handleButtonDown=function(e,t){return u+=1<<t,2!==t&&(d.x=.5*(e.normalizedX+1),d.y=1-.5*(e.normalizedY+1),p.copy(d),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return u-=1<<t,2!==t&&(p.x=.5*(e.normalizedX+1),p.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return p.x=.5*(e.normalizedX+1),p.y=1-.5*(e.normalizedY+1),h>-1},this.handleBlur=function(e){return this.interactionEnd(h),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.WorldUpTool=function(e,t){function i(e,t){function i(e,t){var i=Math.abs(e-t);return i>h?i:Math.min(h-i,i)}function n(e,t){var i=m(e);return i.distanceToSquared(t)<d||(M.set(-t.x,-t.y,-t.z),i.distanceToSquared(M)<d)}function a(e,t){for(var o=X+K+2*Math.PI/180,r=0;r<6;++r)if(U[r]!==Z)for(var s=r+1;s<6;++s)if(U[s]!==Z&&i(U[r],U[s])<o){if(e[r]<e[s]&&!n(r,t)||n(s,t)){U[r]=Z;break}U[s]=Z}}function l(e){return e>h?e:e<=0?e+Math.PI:e-Math.PI}function c(e,t,i){var n=e.clone().normalize(),o=new Array(3),r=new Array(6);o[0]=u(1,0,0,n),o[1]=u(0,1,0,n),o[2]=u(0,0,1,n);var s,c=t.clone().cross(n).normalize();for(s=0;s<3;++s){var h=o[s];r[s]=h.length(),r[s]<J?U[s]=Z:(h.multiplyScalar(1/r[s]),U[s]=Math.atan2(c.dot(h),t.dot(h)))}for(U[3]=l(U[0]),U[4]=l(U[1]),U[5]=l(U[2]),r[3]=r[0],r[4]=r[1],r[5]=r[2],a(r,i),s=0;s<6;++s)if(U[s]!==Z){var d=M.set(0,0,1);x.setFromAxisAngle(d,U[s]);var p=M.set(0,.54,0);p.applyQuaternion(x),F[s].position.copy(p),F[s].visible=!0}else F[s].visible=!1}function p(){H=new THREE.Object3D;var e=new THREE.RingGeometry(.5-.01*V,.5,60),t=new THREE.Mesh(e,S);D=t;var i=.007*V,n=new THREE.BoxGeometry(.93,i,i),o=new THREE.BoxGeometry(i,.93,i),r=new THREE.BoxGeometry(i,i,.93);L=new THREE.Mesh(n,S),O=new THREE.Mesh(o,S),_=new THREE.Mesh(r,S),H.add(L),H.add(O),H.add(_),B=new THREE.Mesh(new THREE.CircleGeometry(.005),S),H.add(B),F=new Array(6),z=new Array(6);for(var s=0;s<6;++s){var a=.005*V,l=.0025*V;F[s]=new THREE.Mesh(new THREE.CircleGeometry(a,16),S),z[s]=new THREE.Mesh(new THREE.CircleGeometry(l,16),S),z[s].visible=!1,F[s].add(z[s]),t.add(F[s])}return H.add(t),H}function g(e,t,i,n,o){return H||(H=p()),s.orient(D,t,R.position,n),c(i,o,n),H.scale.x=e,H.scale.y=e,H.scale.z=e,H.position.copy(t),H}function m(e){if(k.set(0,0,0),e>=0){var t=e>=3?-1:1;0===(e%=3)&&(k.x=t),1===e&&(k.y=t),2===e&&(k.z=t)}return j&&k.multiplyScalar(-1),k}function v(e,t){for(var n=i(U[0],e),o=0,r=1;r<6;++r){var s=i(U[r],e);s<n&&(n=s,o=r)}return G=n,n<t?o:-1}function f(e){s.setWorldUpVector(e,!0)}function E(e){if(0!==e){var t=30*Math.PI/180,i=M.copy(R.position).sub(N).normalize();x.setFromAxisAngle(i,e);var n=s.getWorldUpVector(),o=Math.abs(i.angleTo(n));(o<t||Math.PI-o<t)&&n.copy(s.getCameraUpVector()),n.applyQuaternion(x),f(n)}}function A(){if(!Y){var e=v(W,X);if(e>=0)return G=0,Y=!0,W=U[e],m(e)}return!1}function y(){if(Y){if(v(W,K)<0)return Y=!1,!0;G=0}return!1}function T(e,t,i,n){return!!(e<t)&&m(i).distanceToSquared(n)<d}function w(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),s.orient(B,N,R.position,t),B.position.copy(t.multiplyScalar(.495));for(var n=!1,o=Y?K:X,r=0;r<6;++r){var a=i(U[r],W),l=T(a,o,r,e);l&&(n=!0);var c=l?4:3*(1-3*a/Math.PI);c<1&&(c=1),c*=V,z[r].visible=l;var u=F[r];u.scale.x=c,u.scale.y=c,u.scale.z=c}return L.visible=n,O.visible=n,_.visible=n,n}function b(e){(W+=e)>Math.PI?W-=h:W<=-Math.PI&&(W=h+W);var t=A();if(t)q=W,f(t);else if(y())E(W-q),q=0;else{if(Y)return!1;E(e)}return!0}var C=2*Math.tan(THREE.Math.degToRad(15)),S=new THREE.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),k=new THREE.Vector3,M=new THREE.Vector3,x=new THREE.Quaternion,R=new THREE.PerspectiveCamera(30,t.aspect,t.near,t.far),P=t,V=1,I=1,N=null,D=null,L=null,O=null,_=null,H=null,B=null,F=null,z=null,U=new Array(6),G=0,W=0,j=!1,Y=!0,q=0,X=5*Math.PI/180,K=7*Math.PI/180,Q=1,Z=1e3,J=.1;e.createOverlayScene("roll",null,null,R),this.updateRollCamera=function(e,t){R.position.copy(P.position),R.quaternion.copy(P.quaternion),R.up.copy(P.up),R.aspect=P.aspect,e&&t&&(R.near=t-e,R.far=t+e),R.updateProjectionMatrix()},this.isSnapped=function(){return Y},this.resize=function(){var e=Q*C,t=e*P.aspect,i=(P.aspect<1?t:e)*I;H.scale.x=i,H.scale.y=i,H.scale.z=i},this.start=function(t,i){this.updateHUD(t,i),e.addOverlay("roll",H)},this.updateHUD=function(e,t){N=e,t<o?t=o:t>r&&(t=r),I=t,V=r/t;var i=k.copy(e).sub(P.position),n=(Q=i.length())*C,a=n*P.aspect,l=(P.aspect<1?a:n)*t;this.updateRollCamera(l,Q);var c=s.getWorldUpVector(),u=s.getCameraUpVector();g(l,e,i,c,u),W=0,q=0;var h=c.dot(u);j=h<0,Y=w(c,u)},this.handleRoll=function(e,t,i){if(this.updateRollCamera(),w(s.getWorldUpVector(),s.getCameraUpVector()),0!==e||0!==t){var n=i.x-e-.5,o=i.y-t-.5,r=i.x-.5,a=i.y-.5;return b(Math.atan2(a,r)-Math.atan2(o,n))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),w(s.getWorldUpVector(),s.getCameraUpVector());var t=e-W;return Math.abs(t)>.001&&b(t)},this.end=function(){e.removeOverlay("roll",H)}}function n(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY,n=Math.sqrt(t*t+i*i),o=s.getScreenViewport();return n/Math.min(o.width,o.height)}var o=.35,r=.8,s=t.navigation,a=s.getCamera(),l=["worldup"],c=this,u=function(){var e=new THREE.Vector3;return function(t,i,n,o){var r=new THREE.Vector3(t,i,n),s=o.dot(r);return e.copy(o),e.multiplyScalar(s),r.sub(e)}}(),h=2*Math.PI,d=1e-5,p=!1,g=!1,m=!1,v=new i(e,a),f=new THREE.Vector3,E=new THREE.Vector3,A=new THREE.Vector3,y=null,T=0,w={x:.5,y:.5},b=1;this.getNames=function(){return l},this.getName=function(){return l[0]},this.activate=function(e){t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),m=!1},this.deactivate=function(e){v.end(),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),y=null,p=!1,m=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=E.x-f.x,i=E.y-f.y,n=E.z-f.z;Math.abs(t)<.001&&(t=0),Math.abs(i)<.001&&(i=0),Math.abs(n)<.001&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(){f.copy(E)},this.update=function(){if(!m){var e=s.getEyeVector(),t=.5*(a.near+a.far);e.normalize().multiplyScalar(t);var i=e.add(a.position);this.utilities.savePivot(),this.utilities.setPivotPoint(i,!0,!0),this.utilities.pivotActive(!0);v.start(i,.65),m=!0}var n=g;this.getMotionDelta(A);var o=A.x,r=A.y,l=A.z;return(g||"roll"===y||p&&(0!==o||0!==r||0!==l))&&(g="roll"===y?v.handleRollTouch(T):v.handleRoll(o,r,E)),this.stepMotionDelta(),a.dirty&&(n=!0),n},this.handleResize=function(){v.resize(),g=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return y="drag",this.handleButtonDown(e,0);case"dragmove":return this.handleMouseMove(e);case"dragend":return y=null,this.handleButtonUp(e,0);case"rotatestart":return t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),y="roll",T=THREE.Math.degToRad(e.rotation),w={x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},b=n(e),!0;case"rotatemove":return T=THREE.Math.degToRad(e.rotation),"roll"===y;case"rotateend":return t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),T=THREE.Math.degToRad(e.rotation),y=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=s.getEyeVector(),t=.5*(a.near+a.far);e.normalize().multiplyScalar(t);var i=e.add(a.position);v.updateHUD(i,.65)},this.handleButtonDown=function(e,i){return f.x=.5*(e.normalizedX+1),f.y=1-.5*(e.normalizedY+1),E.copy(f),p=!0,y=null,this.controller.setIsLocked(!0),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.handleCameraChange),!0},this.handleButtonUp=function(e,i){return E.x=.5*(e.normalizedX+1),E.y=1-.5*(e.normalizedY+1),p=!1,g=!0,this.controller.setIsLocked(!1),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.handleCameraChange),!0},this.handleMouseMove=function(e){return E.x=.5*(e.normalizedX+1),E.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return p=!1,y=null,!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ToolInterface=function(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},function(){"use strict";function e(e,t){function o(){return t.getData().instanceTree}function r(i){var n=o();if(d[i]>0)0==--d[i]&&e.highlightObjectNode(t,i,!1);else if(d[i]<0)throw"Selection State machine broken. Negatively selected object!";n&&n.enumNodeChildren(i,function(e){r(e)},!1)}function s(i,n){var r=o();d[i]?d[i]++:(e.highlightObjectNode(t,i,!0,n),d[i]=1),r&&r.enumNodeChildren(i,function(e){s(e,!0)},!1)}function a(e){if(void 0!==e&&h.selectedObjectIds[e])return!0}function l(e){var t=o();t&&(e=t.findNodeForSelection(e,h.selectionMode),!t.isNodeSelectable(e))||a(e)||(h.selectedObjectIds[e]=e,h.selectionCount++,s(e))}function c(e){a(e)&&(r(e),h.selectedObjectIds[e]=0,h.selectionCount--)}function u(e){if(h.selectionCount!==e.length)return!1;for(var t=0;t<e.length;t++)if(!a(e[t]))return!1;return!0}var h=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=i.SelectionMode.LEAF_OBJECT;var d={};this.getInstanceTree=o,this.getSelectionLength=function(){return h.selectionCount},this.getSelection=function(){var e=[],t=h.selectedObjectIds;for(var i in t)if(t[i]){var n=parseInt(i);e.push(n)}return e},this.clearSelection=function(e){if(this.selectionCount>0){var t=h.selectedObjectIds;for(var i in t){var n=parseInt(i);void 0!==n&&r(n)}h.selectedObjectIds={},h.selectionCount=0}},this.deselectInvisible=function(){var i=!1,n=h.selectedObjectIds,r=(o(),e.visibilityManager);for(var s in n){var a=parseInt(s);a&&!r.isNodeVisible(t,a)&&(c(a),i=!0)}return i},this.toggleSelection=function(e){e?a(e)?c(e):l(e):n.logger.error("Attempting to select node 0.",i.errorCodeString(i.ErrorCodes.VIEWER_INTERNAL_ERROR))},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.setSelection=function(e){if(!u(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var t=0;t<e.length;t++)l(e[t])},this.getSelectionBounds=function(){var e=new THREE.Box3,i=new THREE.Box3,n=o(),r=t.getFragmentList(),s=h.selectedObjectIds;for(var a in s){var l=parseInt(a);n.enumNodeFragments(l,function(t){r.getWorldBounds(t,i),e.union(i)},!0)}return e},this.getSelectionVisibility=function(){var e=!1,i=!1,n=h.selectedObjectIds;for(var r in n){var s=parseInt(r);if(s){var a=o();if(a&&a.isNodeHidden(s)?i=!0:e=!0,e&&i)break}}return{hasVisible:e,hasHidden:i,model:t}},this.dtor=function(){this.selectedObjectIds=null}}function t(t){function o(){a.length>1&&n.logger.warn("This selection call does not yet support multiple models.")}function r(){for(var e=[],n=0;n<a.length;n++){var o=[],r=[],s=a[n].selector.selectedObjectIds,l=a[n].selector.getInstanceTree();for(var c in s)if(s[c]){var u=parseInt(c);u&&(o.push(u),l&&l.enumNodeFragments(u,function(e){r.push(e)},!1))}o.length&&e.push({fragIdsArray:r,dbIdArray:o,nodeArray:o,model:a[n]})}var h;1===a.length&&(h={type:i.SELECTION_CHANGED_EVENT,fragIdsArray:e[0]?e[0].fragIdsArray:[],dbIdArray:e[0]?e[0].dbIdArray:[],nodeArray:e[0]?e[0].dbIdArray:[],model:a[0]},t.api.fireEvent(h)),h={type:i.AGGREGATE_SELECTION_CHANGED_EVENT,selections:e},t.api.fireEvent(h)}function s(){for(var e=!1,t=0;t<a.length;t++)e=a[t].selector.deselectInvisible()||e;e&&r()}var a=[];this.addModel=function(i){-1==a.indexOf(i)&&(i.selector=new e(t,i),a.push(i))},this.removeModel=function(e){var t=a.indexOf(e);e.selector.getSelection();e.selector.clearSelection(),e.selector=null,a.splice(t,1)},this.getSelectionLength=function(){for(var e=0,t=0;t<a.length;t++)e+=a[t].selector.getSelectionLength();return e},this.getSelection=function(){return o(),a.length>1&&n.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),a[0].selector.getSelection()},this.getAggregateSelection=function(){for(var e=[],t=0;t<a.length;t++){var i=a[t].selector.getSelection();i&&i.length&&e.push({model:a[t],selection:i})}return e},this.clearSelection=function(e){for(var t=0;t<a.length;t++)a[t].selector.clearSelection(e);e||r()},this.toggleSelection=function(e,t){t||(o(),t=a[0]),t.selector.toggleSelection(e),r()},this.setSelectionMode=function(e){for(var t=0;t<a.length;t++)a[t].selector.setSelectionMode(e)},this.setSelection=function(e,t){if(e&&0!==e.length){if(t)for(var i=0;i<a.length;i++)a[i]!==t&&a[i].selector.clearSelection();else o(),t=a[0];t.selector.setSelection(e)}else this.clearSelection();r()},this.getSelectionBounds=function(){if(1==a.length)return a[0].selector.getSelectionBounds();for(var e=new THREE.Box3,t=0;t<a.length;t++){var i=a[t].selector.getSelectionBounds();e.union(i)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},t=0;t<a.length;t++){var i=a[t].selector.getSelectionVisibility();e.hasVisible=e.hasVisible||i.hasVisible,e.hasHidden=e.hasHidden||i.hasHidden,e.details.push(i)}return e},this.dtor=function(){for(var e=0;e<a.length;e++)a[e].selector.dtor()},t.api.addEventListener(i.ISOLATE_EVENT,function(e){s()}),t.api.addEventListener(i.HIDE_EVENT,function(e){s()})}var i=Autodesk.Viewing,n=i.Private;n.Selector=e,n.MultiModelSelector=t}(),function(){"use strict";function e(e){this.viewer=e,this.models=[]}var t=Autodesk.Viewing,i=t.Private,n=function(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]};n.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},n.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},n.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},n.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e),this.model.getData().is2d&&this.model.setAllVisibility(e)},n.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},n.prototype.isolate=function(e){var t=this.getInstanceTree(),i=t?t.getRootId():null,n="number"==typeof e&&e===i||"object"==typeof e&&e.dbId===i;e&&!n?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},n.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0);var e={type:t.ISOLATE_EVENT,nodeIdArray:[],model:this.model};this.viewerImpl.api.fireEvent(e)},n.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];for(var i=0;i<e.length;i++)this.setVisibilityOnNode(e[i],!0);var n={type:t.ISOLATE_EVENT,nodeIdArray:e,model:this.model};this.viewerImpl.api.fireEvent(n)}else this.isolateNone();this.viewerImpl.invalidate(!0)},n.prototype.hide=function(e){var i;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!1);e.length>0&&(i={type:t.HIDE_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!1),i={type:t.HIDE_EVENT,nodeIdArray:[e],model:this.model};i&&this.viewerImpl.api.fireEvent(i)},n.prototype.show=function(e){var i;if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!0);e.length>0&&(i={type:t.SHOW_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!0),i={type:t.SHOW_EVENT,nodeIdArray:[e],model:this.model};i&&this.viewerImpl.api.fireEvent(i)},n.prototype.toggleVisibility=function(e){var i=this.getInstanceTree().isNodeHidden(e);this.setVisibilityOnNode(e,i);var n={type:i?t.SHOW_EVENT:t.HIDE_EVENT,nodeIdArray:[e],model:this.model};this.viewerImpl.api.fireEvent(n)},n.prototype.setVisibilityOnNode=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getInstanceTree(),r=!t,s=n.getData().is2d;this.viewerImpl.matman();o?o.enumNodeChildren(e,function(e){o.setNodeHidden(e,r),s?n.getFragmentList().setObject2DGhosted(e,!t):o.enumNodeFragments(e,function(e){n.setVisibility(e,t)},!1)},!0):s?n.getFragmentList().setObject2DGhosted(e,!t):n.setVisibility(e,t),i.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t)},n.prototype.updateNodeVisibilityTracking=function(e,t){var i=t;if(this.isolatedNodes.length>0){var n=this.isolatedNodes.indexOf(e);i&&-1===n?this.isolatedNodes.push(e):i||-1===n||this.isolatedNodes.splice(n,1)}else{var o=this.hiddenNodes.indexOf(e);i||-1!==o?i&&-1!==o&&this.hiddenNodes.splice(o,1):this.hiddenNodes.push(e)}var r=this.getInstanceTree();r&&r.root&&r.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},n.prototype.setNodeOff=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getInstanceTree(),r=n.getData().is2d;o?o.enumNodeChildren(e,function(e){o.setNodeOff(e,t),r?n.getFragmentList().setObject2DVisible(e,!t):o.enumNodeFragments(e,function(e){n.getFragmentList().setFragOff(e,t)},!1)},!0):r?n.getFragmentList().setObject2DVisible(e,!t):n.getFragmentList().setFragOff(e,t),i.sceneUpdated(!0)},t.Private.VisibilityManager=n,e.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new n(this.viewer,e),this.models.push(e))},e.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},e.prototype.warn=function(){this.models.length>1&&i.logger.warn("This selection call does not yet support multiple models.")},e.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},e.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},e.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},e.prototype.isolate=function(e,t){(t?[t]:this.models).forEach(function(t){t.visibilityManager.isolate(e)})},e.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},e.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},e.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},e.prototype.setVisibilityOnNode=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t)},e.prototype.setNodeOff=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t)},t.Private.MultiModelVisibilityManager=e}();var av=Autodesk.Viewing,LMV_WORKER_URL=(avp=Autodesk.Viewing.Private).LMV_WORKER_URL||"src/workers/MainWorker-web.js",ENABLE_INLINE_WORKER=avp.ENABLE_INLINE_WORKER||!1;!function(){"use strict";var e=null,t=!1,i=[];avp.clearWorkerDataURL=function(){e=null},avp.initWorkerScript=function(n,o){if(ENABLE_INLINE_WORKER&&!e){if(i.push({successCB:n}),t)return;var r=new XMLHttpRequest,s=LMV_WORKER_URL,a=avp.getResourceUrl(LMV_WORKER_URL);a&&(s=a),r.open("GET",s,!0),r.withCredentials=!1,r.onload=function(){t=!1;var n;window.URL=window.URL||window.webkitURL;try{n=new Blob([r.responseText],{type:"application/javascript"})}catch(e){(n=new BlobBuilder).append(r.responseText),n=n.getBlob()}e=URL.createObjectURL(n);var o=i.concat();i=[];for(var s=0;s<o.length;++s)o[s].successCB&&o[s].successCB()},t=!0,r.send();var l={};return l.cancel=function(){var e=-1;return!!i.some(function(t,i){return t.successCB==n&&(e=i,!0)})&&(i.splice(e,1),!0)},l}return n&&n(),null},avp.createWorker=function(){var t;return t=ENABLE_INLINE_WORKER?new Worker(e):new Worker(avp.getResourceUrl(LMV_WORKER_URL)),t.doOperation=t.postMessage,t},avp.createWorkerWithIntercept=function(){function e(e){if(!i)return null;for(var t=0;t<i.length;++t)if(i[t].arg===e){var n=i[t].callback;return i.splice(t,1),0===i.length&&(i=null),n}return null}var t=avp.createWorker();t.checkEvent=function(e){return!(!e.data||!e.data.assetRequest)&&(avp.assets&&avp.assets.push(e.data.assetRequest),!0)};var i=[];return t.addEventListenerWithIntercept=function(e){var n=function(i){t.checkEvent(i)||e(i)};return i||(i=[]),i.push({arg:e,callback:n}),t.addEventListener("message",n,!1),n},t.removeEventListenerWithIntercept=function(i){var n=e(i);n&&t.removeEventListener("message",n,!1)},t.clearAllEventListenerWithIntercept=function(){if(i)for(var e=i.concat(),n=0;n<e.length;++n)t.removeEventListenerWithIntercept(e[n].arg)},t}}(),function(){"use strict";function e(e){var t=e.data;if(t&&t.debug)r.logger.debug(t.message);else if(t.cbId){var i=l[t.cbId];t&&t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete l[t.cbId]}}function t(e,t){var i=a++;return l[i]=[e,t],i}function i(){n&&n.doOperation({operation:s,clearCaches:!0})}var n,o=Autodesk.Viewing,r=o.Private,s="UNLOAD_PROPERTYDB",a=1,l={},c=function(e,t,i){if(this.eventTarget=i||new o.EventDispatcher,this.model=t,this.svf=t&&t.getData(),this.svf&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbPath=r.pathToURL(this.svf.basePath),this.dbFiles=this.svf.propertydb,this.sharedDbPath=!1;for(var n in this.dbFiles)this.dbFiles[n][0]=this.dbFiles[n][0]&&this.dbFiles[n][0].replace(/\\/g,"/");if(e){var s=this.dbPath+this.svf.propertydb.avs[0];if(s=r.ViewingService.simplifyPath(s),(s=s.slice(0,s.lastIndexOf("/")+1))===e){var a={},l=this.dbPath.split("/");for(var n in this.dbFiles){h=this.dbFiles[n][0];h=r.ViewingService.simplifyPath(this.dbPath+h),a[n]=[h];for(var c=h.split("/"),u=0;c[u]===l[u];)u++;l.length=u}this.sharedDbPath=!0,this.dbFiles=a,this.dbPath=l.join("/")+"/",this.dbPath.length>e.length&&(this.dbPath=e);for(var n in this.dbFiles){var h=this.dbFiles[n][0];this.dbFiles[n][0]=h.slice(this.dbPath.length)}}}}else this.sharedDbPath=!0,this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]},r.logger.log("Using shared db path "+e);var d=o.getUseCredentials()&&!o.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"";this.queryParam=d,this.svf&&this.svf.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.svf.acmSessionId)};c.prototype.dtor=function(){this.asyncPropertyOperation({operation:s},function(){},function(){})},c.prototype.processLoadResult=function(e){var t=this;if(e.instanceTreeStorage){var i=new r.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);t.instanceTree=new r.InstanceTree(i,e.objectCount,e.maxTreeDepth),t.svf&&(t.svf.instanceTree=t.instanceTree)}else e.instanceTree?(r.logger.warn("glTF instance tree not supported"),t.hasObjectProperties=e.objectCount):e.objectCount&&(t.hasObjectProperties=e.objectCount,t.svf&&(t.svf.hasObjectProperties=e.objectCount));t.eventTarget.fireEvent({type:o.OBJECT_TREE_CREATED_EVENT,svf:t.svf,model:t.model,target:t})},c.prototype.processLoadError=function(e){var t=this;t.propertyDbError=e,t.eventTarget.fireEvent({type:o.OBJECT_TREE_UNAVAILABLE_EVENT,svf:t.svf,model:t.model,target:t})},c.prototype.load=function(){var i=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)setTimeout(function(){i.processLoadResult(i.svf)},0);else{n||(n=r.createWorkerWithIntercept()).addEventListenerWithIntercept(e),this.propWorker=n;var o=t(function(e){i.processLoadResult(e)},function(e){i.processLoadError(e)}),s=this.model.loader.options,a={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:this.svf&&this.svf.fragments.boxes,headers:s.svfHeaders,cbId:o,queryParams:this.queryParam};n.doOperation(r.initLoadContext(a))}},c.prototype.asyncPropertyOperation=function(e,i,r){var s=this;if(e.dbPath=this.dbPath,s.instanceTree||s.hasObjectProperties)e.cbId=t(i,r),n.doOperation(e);else if(s.propertyDbError)r&&r(s.propertyDbError);else{var a=function(t){s.eventTarget.removeEventListener(o.OBJECT_TREE_CREATED_EVENT,a),s.eventTarget.removeEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,a),s.instanceTree||s.hasObjectProperties||s.propertyDbError?s.asyncPropertyOperation(e,i,r):r&&r({code:o.UNKNOWN_FAILURE,msg:"Failed to load properties"})};s.eventTarget.addEventListener(o.OBJECT_TREE_CREATED_EVENT,a),s.eventTarget.addEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,a)}},c.prototype.getProperties=function(e,t,i){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:e},t,i)},c.prototype.getBulkProperties=function(e,t,i,n,o){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:e,propFilter:t,ignoreHidden:o},i,n)},c.prototype.searchProperties=function(e,t,i,n,o){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t,completeInfo:o},i,n)},c.prototype.getExternalIdMapping=function(e,t){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING"},e,t)},c.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},c.prototype.getObjectTree=function(e,t){var i=this;if(i.instanceTree)e(i.instanceTree);else if(i.propertyDbError||"hasObjectProperties"in i)t&&t(i.propertyDbError);else{var n=function(){i.eventTarget.removeEventListener(o.OBJECT_TREE_CREATED_EVENT,n),i.eventTarget.removeEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,n),i.getObjectTree(e,t)};i.eventTarget.addEventListener(o.OBJECT_TREE_CREATED_EVENT,n),i.eventTarget.addEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,n)}},r.PropDbLoader=c,r.clearPropertyWorkerCache=i}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=e.isNodeJS?10:e.isMobileDevice()?2:6,n=function(e){this.options={pageOutPercentage:t.PAGEOUT_PERCENTAGE,maxQueuedGeomPFForLoading:WGS.MAX_QUEUED_GEOM_PF_FOR_LOADING,pixelCullingEnable:WGS.pixelCullingEnable,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,onDemandLoading:t.onDemandLoading,pageOutGeometryEnabled:t.pageOutGeometryEnabled,minPackFiles:WGS.MIN_PACK_FILES,maxPackFiles:WGS.MAX_PACK_FILES,forceOnDemandLoading:WGS.forceOnDemandLoading},function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}(this.options,e),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackslength=0,this.loadingPacks=[],this.queuedPacks=[],this.totalPackFiles=this.options.totalPackFiles,this.loadPackFileImpl=this.options.loadPackFileImpl,this.cancelLoadPackImpl=this.options.cancelLoadPackImpl;var i=!1;this.onDemandLoadingEnabled=function(){return!(!this.options.onDemandLoading||!this.loadPackFileImpl)&&(!!this.options.forceOnDemandLoading||this.totalPackFiles>this.options.maxPackFiles)},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.pixelCullingThreshold},this.loadPackFile=function(e){return!(!this.onDemandLoadingEnabled()||this.reachLimit)&&(this.loadPackFileImpl(e),!0)},this.unloadPackFile=function(e,t){if(!this.onDemandLoadingEnabled())return!1;if(!this.loadedPacks[e]||!t)return!1;return t.geoms.forEach(function(i){i&&i.packId==e&&t.removeGeometry(i.svfid)}),delete this.loadedPacks[e],this.loadedPackslength--,!0},this.onPackFileLoaded=function(e){if(e){var i=e.packId;if(!this.loadedPacks[i]){var n=e.meshes.length;this.loadedPacks[i]={count:n,travsed:0,culled:0},this.loadedPackslength++}var o=this.loadingPacks.indexOf(i);-1!=o&&this.loadingPacks.splice(o,1),this.loadedPackslength>this.options.maxPackFiles&&t.logger.warn("More pack files being loaded than the max count: "+this.loadedPackslength)}},this.onPackFileLoading=function(e){this.loadingPacks.push(e)},this.onProcessReceivedMesh=function(e,t){var i=e.svfid;this.onDemandLoadingEnabled()&&t>1&&null==this.geomidsmap[i]&&(this.geomidsmap[i]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedPackFileCount=function(){return this.loadedPackslength},this.preparedPackFilesCount=function(){return this.queuedPacks.length+this.loadingPacks.length+this.loadedPackFileCount()},this.reset=function(){var e=this.loadedPacks;for(var t in e)e[t].travsed=0,e[t].culled=0;this.cancelLoadPackImpl&&this.loadingPacks.length>0&&this.loadedPackslength>=this.options.maxPackFiles&&this.cancelLoadPackImpl(),this.loadingPacks.length=0,this.queuedPacks.length=0},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(e){if(this.pageOutGeometryEnabled()){if(this.preparedPackFilesCount()>=this.options.maxPackFiles)return this.reachLimit=!0,!1;if(this.queuedPacks.length>=this.options.maxQueuedGeomPFForLoading)return!1}return-1==this.queuedPacks.indexOf(e)&&this.queuedPacks.push(e),!0},this.needResumeNextFrame=function(){return i},this.pageOut=function(e,n,o){i=!1;var r=WGS.PAGEOUT_SUCCESS;if(!e)return r;if((c=this.loadedPackFileCount())&&(this.reachLimit||c>this.options.maxPackFiles)){var s=this.loadedPacks,a=Object.keys(s);a.sort(function(e,t){var i=.7*s[e].culled+.3*s[e].travsed;return.7*s[t].culled+.3*s[t].travsed-i});var l=this.options.maxPackFiles,c=Math.ceil(this.options.pageOutPercentage*l),u=0;return a.every(function(e){return s[e].culled+s[e].travsed>0&&(this.unloadPackFile(e,o),u++),u<c}.bind(this)),n&&0==u&&(this.unloadPackFile(a[0],o),u++,t.logger.log("A force page out occur.")),0==u?(r=WGS.PAGEOUT_FAIL,this.reachLimit=!0):(this.reachLimit=!1,i=!0),t.logger.log("[On Demand Loading] Unload pack files count: "+u),window&&window.gc&&window.gc(),r}return i=i||this.queuedPacks.length>0,r},this.onGeomTraversed=function(e){var t=e.packId,i=e.svfid;if(t>=this.options.minPackFiles){var n=!0,o=this.geomidsmap[i];null!=o&&(this.geomTravCount[o]++,n=e.instanceCount==this.geomTravCount[o]),n&&this.loadedPacks[t].travsed++}},this.onGeomCulled=function(e){if(e){var t=e.packId,i=e.svfid;if(t>=this.options.minPackFiles){var n=this.geomidsmap[i];null!=n?(this.geomTravCount[n]++,e.instanceCount==this.geomTravCount[n]&&this.loadedPacks[t].culled++):this.loadedPacks[t].culled++}}}},o=function(i){this.viewer3DImpl=i,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.tmpMatrix=new THREE.Matrix4,this.tmpBox=new THREE.Box3,this.logger=t.logger,this.loadTime=0,this.domainParam=e.getUseCredentials()&&!e.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""};o.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,t.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,t.logger.debug("SVF loader dtor: on svf worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null,t.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.logger=null,this.domainParam=null,this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.loadTime=0,this.pagingProxy=null},o.prototype.isValid=function(){return null!=this.viewer3DImpl},t.pathToURL=function(e){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if("undefined"==typeof window)return e;var t=window.location.pathname,i=t.lastIndexOf("/");return t=t.substr(0,i+1),window.location.protocol+"//"+window.location.host+t+e},o.prototype.loadFile=function(e,i,n,o,r){if(!this.viewer3DImpl)return t.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return t.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var s=e.indexOf("urn:");if(-1!=s){var a=(e=decodeURIComponent(e)).substr(s,e.substr(s).indexOf("/"));t.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=i.sharedPropertyDbPath,this.currentLoadPath=e;var c=this.currentLoadPath.lastIndexOf("/");-1!=c&&(this.basePath=this.currentLoadPath.substr(0,c+1)),this.acmSessionId=i.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=i;var u=this;return this.initWorkerScriptToken=t.initWorkerScript(function(){u.loadSvfCB(e,i,n,o,r)}),!0},o.prototype.interceptManifest=void 0,o.prototype.loadSvfCB=function(n,o,r,s,a){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var l=!0,c=this,u={url:t.pathToURL(n),basePath:this.currentLoadPath,objectIds:o.ids,globalOffset:o.globalOffset,placementTransform:o.placementTransform,applyRefPoint:o.applyRefPoint,queryParams:this.queryParam,bvhOptions:o.bvhOptions||{isWeakDevice:e.isMobileDevice()},applyScaling:o.applyScaling,loadInstanceTree:o.loadInstanceTree,headers:o.svfHeaders};t.memoryOptimizedSvfLoading&&(u.perfOpt={memoryOptimizedSvfLoading:t.memoryOptimizedSvfLoading,forceMemoryOptimizedMode:t.forceMemoryOptimizedModeOnSvfLoading}),o.useConsolidation&&!o.bvhOptions&&(u.bvhOptions.frags_per_leaf_node=256,u.bvhOptions.max_polys_per_node=5e4);var h=this.svfWorker=t.createWorkerWithIntercept(),d=function(n){var o=function(){h.clearAllEventListenerWithIntercept(),h.terminate(),c.svfWorker=null,h=null};if(l&&a&&(l=!1,a()),n.data&&n.data.manifest)c.interceptManifest(n.data.manifest),u.operation="LOAD_SVF_CONTD",u.manifest=n.data.manifest,h.doOperation(u);else if(n.data&&n.data.svf){var d=c.svf=n.data.svf;c.failedToLoadSomeGeometryPacks&&(s&&s(c.failedToLoadSomeGeometryPacks.code,c.failedToLoadSomeGeometryPacks.msg),c.failedToLoadSomeGeometryPacks=null),c.onModelRootLoadDone(d),r&&r(c.model),c.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:d,model:c.model}),c.svf.loadDone=!1;var p=!1;if(c.svf.metadata&&c.svf.metadata.gltf&&(p=!0),!p){var g=d.geompacks.length;if(0==g)c.onGeomLoadDone();else if(c.model.getFragmentList().onDemandLoadingEnabled())t.logger.debug("[On Demand Loading]: Enabled."),c.loadedPacksCount=0;else if(g)for(var m=Math.min(g,i),v=0;v<m;v++){var f=d.geompacks[c.next_pack++];f.loading=!0,e.isNodeJS?c.loadGeometryPack(f.id,f.uri):function(e){setTimeout(function(){c.loadGeometryPack(e.id,e.uri)},200*v)}(f)}}1==n.data.progress&&(c.loading=!1,o()),d.fragments.polygonCounts||(d.fragments.polygonCounts=new Int32Array(d.fragments.length)),n.data.bvh&&(c.svf.bvh=n.data.bvh,c.model.setBVH(new t.NodeArray(c.svf.bvh.nodes,c.svf.bvh.useLeanNodes),c.svf.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0))}else n.data&&n.data.bvh?(c.svf.bvh||(c.svf.bvh=n.data.bvh,c.model.setBVH(new t.NodeArray(c.svf.bvh.nodes,c.svf.bvh.useLeanNodes),c.svf.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0)),c.loading=!1,o()):n.data&&n.data.mesh?(c.processReceivedMesh(n.data),1===n.data.progress&&(c.onGeomLoadDone(),c.loading=!1,o())):n.data&&n.data.progress?1==n.data.progress&&(c.loading=!1,o()):n.data&&n.data.error?(c.loading=!1,o(),s&&s(n.data.error.code,n.data.error.msg,n.data.error.args.httpStatus,n.data.error.args.httpStatusText)):n.data&&n.data.debug?t.logger.debug(n.data.message):(t.logger.error("SVF download failed.",e.errorCodeString(e.ErrorCodes.NETWORK_FAILURE)),c.loading=!1,o())};return h.addEventListenerWithIntercept(d),u.operation="LOAD_SVF",u.interceptManifest=!!this.interceptManifest,h.doOperation(t.initLoadContext(u)),!0},o.prototype.cancelGeometryPackLoading=function(){if(this.pack_workers&&this.isValid()){for(var e=0;e<this.pack_workers.length;e++)this.svf&&(this.svf.geompacks[this.pack_workers[e].packId].loading=!1),this.pack_workers[e].queued=0,this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null}},o.prototype.loadGeometryPackOnDemand=function(n){if(this.svf&&this.isValid()){var o=this.svf.geompacks[n];if(!o.loading){this.t0||(this.t0=(new Date).getTime());var r,s=this.pagingProxy,a=this,l=function(i){if(i.data&&i.data.meshes){s.onPackFileLoaded(i.data);for(var n=i.data.meshes,o={packId:i.data.packId,meshIndex:0,mesh:null},r=0;r<n.length;r++){var l=n[r];l&&(o.meshIndex=r,o.mesh=l,a.processReceivedMesh(o))}if(i.data.progress>=1){a.pack_workers[i.data.workerId].queued-=1,a.svf.geompacks[i.data.packId].loading=!1;for(var c=!0,u=0;u<a.pack_workers.length;u++)if(0!=a.pack_workers[u].queued){c=!1;break}-1==a.loadedPacks.indexOf(i.data.packId)&&a.loadedPacks.push(i.data.packId),c&&0==a.model.geomPacksMissingLastFrame().length?a.onDemandGeomLoadDone():a.viewer3DImpl.invalidate(!1,!0)}}else if(i.data&&i.data.progress){a.pack_workers[i.data.workerId].queued-=1,a.loadedPacksCount++;var h,d=null,p=a.model.geomPacksMissingLastFrame();for(r=0;r<p.length&&(h=p[r],(d=a.svf.geompacks[h]).loading);++r);d&&!d.loading&&(p.splice(r,1),a.loadGeometryPackOnDemand(h)),a.viewer3DImpl.signalProgress(100*a.loadedPacks.length/a.svf.geompacks.length,e.ProgressState.LOADING)}else i.data&&i.data.debug?t.logger.debug(i.data.message):i.data&&i.data.error?a.failedToLoadSomeGeometryPacks={code:i.data.error.code,msg:i.data.error.msg}:(a.pack_workers[i.data.workerId].queued-=2,a.svf.geompacks[i.data.packId].loading=!1)};if(!this.pack_workers){this.pack_workers=[];var c=s.options.maxPackFiles<i?s.options.maxPackFiles:i;for(r=0;r<c;r++){var u=t.createWorkerWithIntercept();u.addEventListenerWithIntercept(l),u.queued=0,this.pack_workers.push(u)}}var h=0,d=this.pack_workers[0].queued;for(r=1;r<this.pack_workers.length;r++)this.pack_workers[r].queued<d&&(h=r,d=this.pack_workers[r].queued);if(d>1||s.preparedPackFilesCount()>=s.options.maxPackFiles)this.model.addGeomPackMissingLastFrame(n)||this.viewer3DImpl.invalidate(!1,!0);else{var p,g,m=o.uri;(p=this.pack_workers[h]).queued+=2,p.packId=n,g=h,s.onPackFileLoading(n),o.loading=!0,a.svf.partPacksLoadDone=!1,t.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+n);var v={operation:"LOAD_GEOMETRY",url:t.pathToURL(this.svf.basePath+m),packId:parseInt(n),workerId:g,packNormals:this.options.packNormals,skipAssetCallback:!0,queryParams:this.queryParam};p.doOperation(t.initLoadContext(v))}}}},o.prototype.loadGeometryPack=function(n,o){var r,s,a,l=this;if(this.svf&&this.isValid()){var c=function(i){if(i.data&&i.data.meshes){for(var n=i.data.meshes,o={packId:i.data.packId,meshIndex:0,mesh:null},r=0;r<n.length;r++){var s=n[r];s&&(o.meshIndex=r,o.mesh=s,l.processReceivedMesh(o))}if(i.data.progress>=1){l.pack_workers[i.data.workerId].queued-=1,l.loadedPacksCount++,l.viewer3DImpl.signalProgress(100*l.loadedPacksCount/l.svf.geompacks.length,e.ProgressState.LOADING);var c=!0;for(a=0;a<l.pack_workers.length;a++)if(0!=l.pack_workers[a].queued){c=!1;break}if(c){for(a=0;a<l.pack_workers.length;a++)l.pack_workers[a].clearAllEventListenerWithIntercept(),l.pack_workers[a].terminate();l.pack_workers=null}l.loadedPacksCount+l.failedToLoadPacksCount==l.svf.geompacks.length&&l.onGeomLoadDone()}}else if(i.data&&i.data.progress){if(l.pack_workers[i.data.workerId].queued-=1,l.next_pack<l.svf.geompacks.length){var u=null,h=l.model.geomPacksMissingLastFrame();for(r=0;r<h.length&&(!(u=l.svf.geompacks[h[r]])||u.loading);++r);if(!u||u.loading)for(;l.next_pack<l.svf.geompacks.length&&(u=l.svf.geompacks[l.next_pack++]).loading;);u&&!u.loading?(u.loading=!0,l.loadGeometryPack(u.id,u.uri)):(l.viewer3DImpl.modelQueue().enforceBvh=!1,l.svf.fragments.packIds=null)}}else i.data&&i.data.debug?t.logger.debug(i.data.message):i.data&&i.data.error?(++l.failedToLoadPacksCount,l.failedToLoadSomeGeometryPacks={code:i.data.error.code,msg:i.data.error.msg}):l.pack_workers[i.data.workerId].queued-=2},u=this.pack_workers;if(u||(u=this.pack_workers=[]),u.length<i){for(var h=!0,d=0;d<u.length;d++)if(0===u.queued){h=!1;break}if(h){var p=t.createWorkerWithIntercept();p.addEventListenerWithIntercept(c),p.queued=0,u.push(p)}}var g=0,m=u[0].queued;for(d=1;d<u.length;d++)u[d].queued<m&&(g=d,m=u[d].queued);(r=u[g]).queued+=2,s=g;var v={operation:"LOAD_GEOMETRY",url:t.pathToURL(this.svf.basePath+o),packId:parseInt(n),workerId:s,headers:this.options.svfHeaders,packNormals:this.options.packNormals,queryParams:this.queryParam};r.doOperation(t.initLoadContext(v))}},o.prototype.checkCull=function(e,t,i){var n=this.tmpBox;if(e.getWorldBounds(t,n),!i.intersectsBox(n))return!0;var o=i.projectedArea(n);return(o*=i.areaConv)<i.areaCullThreshold},o.prototype.processReceivedMesh=function(e){var i=e.packId+":"+e.meshIndex,n=this.svf,o=n.fragments,r=this.model,s=o.mesh2frag[i];if(void 0!==s){Array.isArray(s)||(s=[s]),t.BufferGeometryUtils.meshToGeometry(e),e.geometry.packId=e.packId;var a=s.length,l=r.getFragmentList().getGeometryId(s[0]);r.getGeometryList().addGeometry(e.geometry,a,l);this.pagingProxy.onProcessReceivedMesh(e.geometry,a);for(var c=(e.geometry.attributes.index.array||e.geometry.ib).length/3,u=0;u<s.length;u++){var h=0|s[u];r.getFragmentList().getOriginalWorldMatrix(h,this.tmpMatrix);var d=o.materials[h].toString();o.polygonCounts&&(o.polygonCounts[h]=c);var p=this.viewer3DImpl.setupMesh(this.model,e.geometry,d,this.tmpMatrix);r.activateFragment(h,p,!!n.placementTransform)}this.model.getFragmentList().onDemandLoadingEnabled()||(o.mesh2frag[i]=null),o.numLoaded+=s.length,r.getGeometryList().geomPolyCount>n.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0))}else t.logger.warn("Mesh "+i+" was not referenced by any fragments.")},o.prototype.onModelRootLoadDone=function(i){this.viewer3DImpl._removeLoadingFile(this),i.geomMemory=0,i.fragments.numLoaded=0,i.gpuNumMeshes=0,i.gpuMeshMemory=0,i.nextRepaintPolys=0,i.numRepaints=0,i.urn=this.svfUrn,i.acmSessionId=this.acmSessionId,i.basePath=this.basePath,i.loadOptions=this.options;var o=Date.now();this.loadTime+=o-this.t0,t.logger.log("SVF load: "+(o-this.t0));var r=this.model=new e.Model(i);r.loader=this;var s=this.viewer3DImpl.api.config?this.viewer3DImpl.api.config.memPerfOpts||{}:{};this.viewer3DImpl.modelQueue().getModels().length>0&&(s.pageOutGeometryEnabled=!1),s.totalPackFiles=i.geompacks.length,s.loadPackFileImpl=this.loadGeometryPackOnDemand.bind(this),s.cancelLoadPackImpl=this.cancelGeometryPackLoading.bind(this),this.pagingProxy=new n(s),r.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&e.isMobileDevice())&&!this.options.skipPropertyDb&&this.loadPropertyDb();var a=this.convertMaterials(r);if(this.t0=o,i.bbox=(new THREE.Box3).copy(i.bbox),i.modelBox&&(i.modelBox=(new THREE.Box3).copy(i.modelBox)),i.refPointTransform&&(i.refPointTransform=new LmvMatrix4(!0).copy(i.refPointTransform)),i.placementTransform&&(i.placementTransform=new LmvMatrix4(!0).copy(i.placementTransform)),i.cameras)for(var l=0;l<i.cameras.length;l++){var c=i.cameras[l];c.position=(new THREE.Vector3).copy(c.position),c.target=(new THREE.Vector3).copy(c.target),c.up=(new THREE.Vector3).copy(c.up)}i.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(this.model),t.logger.log("scene bounds: "+JSON.stringify(i.bbox));var u={category:"metadata_load_stats",urn:i.urn,has_topology:!!i.topology,has_animations:!!i.animations,cameras:i.cameras?i.cameras.length:0,lights:i.lights?i.lights.length:0,materials:a,is_mobile:e.isMobileDevice()};i.topologyTooBig&&(u.has_topology=!0,u.topologyTooBig=!0),t.logger.track(u),this.viewer3DImpl.signalProgress(5,e.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},o.prototype.convertMaterials=function(e){var i=this.viewer3DImpl.matman(),n=e.getData(),o=0;if(!n.materials)return o;if(n.gltfMaterials){var r=n.materials.materials;for(var s in r){var a=r[s],l=t.MaterialConverter.convertMaterialGltf(a,n),c=i._getMaterialHash(e,s);i.addMaterial(c,l,!1),o++}return o}var u=n.materials.materials,h=n.proteinMaterials?n.proteinMaterials.materials:null;for(var s in u){var d=!1;h&&(d=t.MaterialConverter.isPrismMaterial(h[s]));var p=d?h[s]:u[s],g=p.userassets,m=p.materials[g[0]];p.transparent=m.transparent,i.convertOneMaterial(e,p,s,d),o++}return i.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),o},o.prototype.makeBVH=function(i){var n=performance.now(),o=i.materials?i.materials.materials:null;i.bvh=new t.BVHBuilder(i.fragments,o),i.bvh.build(this.options.bvhOptions||{isWeakDevice:e.isMobileDevice()});var r=performance.now();t.logger.log("BVH build time: "+(r-n))},o.prototype.onDemandGeomLoadDone=function(){!this.svf.proteinMaterials||!PROTEIN_ROOT||PRISM_ROOT;var e=Date.now(),i="[On Demand Loading] On demand requested geometries load time: "+(e-this.t0);t.logger.log(i);var n={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:e-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};t.logger.track(n,!0),this.t0=null,this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.onDemandLoadComplete(this.model)},o.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||this.viewer3DImpl.matman().loadTextures(this.model),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var i=Date.now(),n="Fragments load time: "+(i-this.t0);this.loadTime+=i-this.t0;var o=this.firstPixelTimestamp-this.t0;if(n+=" (first pixel time: "+o+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),t.logger.log(n),this.options.useConsolidation){var r=this.viewer3DImpl.glrenderer();this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,r)}var s={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};o>0&&(s.first_pixel_time=o),t.logger.track(s,!0),t.assets&&e.isBrowser&&window.webkit&&(!function(t){var i={command:"assets",data:t};e.isBrowser&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage(i)}(t.assets),t.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},o.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new t.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},t.SvfLoader=o,t.SvfPagingProxy=n,e.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],t.SvfLoader)}(),function(){"use strict";function e(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=i.logger,this.loadTime=0,this.domainParam=t.getUseCredentials()&&!t.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",this.useInstancing=this.viewer3DImpl.use2dInstancing}var t=Autodesk.Viewing,i=t.Private,n="PARSE_F2D_FRAME",o=1,r=2,s=4,a=8,l=function(e,t){function l(e){for(;++e<h.length&&(h[e]&(s|a))!=s;);return e}function c(e){var t=0;if(u.model){var i=u.model.getGeometryList();i&&(t=i.numGeomsInMemory)}for(var s=l(m);t+g<e.max2DPersistentBufferCount;){var c=-1;if(p.length>0&&(A||s>h.length))c=p.shift().lmv_buffer_id;else{if(!(s<h.length))break;c=s,m=s,s=l(s),A=!0}u.parsingWorker.doOperation({operation:n,bufferId:c,rendered:!!(h[c]&o),promised:!!(h[c]&r),conditional:!!(h[c]&a)}),h[c]&a||(g+=1,h[c]|=a)}}var u=e;this.options={max2DPersistentBufferCount:i.MAX_2D_PERSISTENT_BUFFER_COUNT,pageOutCount2D:i.PAGE_OUT_COUNT_2D,pageOutGoal2D:i.PAGE_OUT_GOAL_2D,instancingFactor:1,pixelCullingEnable:WGS.pixelCullingEnable,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,onDemandLoading:i.onDemandLoading,pageOutGeometryEnabled:i.pageOutGeometryEnabled,forceOnDemandLoading:WGS.forceOnDemandLoading},function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}(this.options,t),this.options.max2DPersistentBufferCount*=this.options.instancingFactor,this.options.pageOutCount2D*=this.options.instancingFactor,this.options.pageOutGoal2D*=this.options.instancingFactor,this.options.pageOutGeometryEnabled=this.options.onDemandLoading,this.options.fragsPersistentCount=0,this.options.fragsPersistentMaxCount=this.options.max2DPersistentBufferCount,this.options.geomCountLimit=0|this.options.pageOutCount2D;var h=[],d={},p=[],g=0,m=-1,v=-1,f=-1,E=0,A=!0,y=0,T=!1,w=[];this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.onDemandLoading},this.pixelCullingEnable=function(){return this.options.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.pixelCullingThreshold},this.loadPackFile=function(e){return!!this.onDemandLoadingEnabled()&&(!(e<0||T&&e>=y)&&(e>f&&(f=e),h[e]&o||(e<=m&&this.reset(),h[e]|=s|o),c(this.options),!0))},this.promisePackFile=function(e){if(!this.onDemandLoadingEnabled())return Promise.reject({reason:"Not supported"});if(e<0||e>=y)return Promise.reject({reason:"Buffer id out of bounds"});var t=d[e];if(t)return c(this.options),t;var i,n;return t=new Promise(function(e,t){i=e,n=t}),t.lmv_resolve=i,t.lmv_reject=n,t.lmv_buffer_id=e,p.push(t),d[e]=t,h[e]|=s|r,c(this.options),t},this.cancelPromisedPackFile=function(e){if(!e||!e.hasOwnProperty("lmv_buffer_id")||d[e.lmv_buffer_id]!=e)return!1;var t=p.indexOf(e);t>=0&&p.splice(t,1);var i=h[e.lmv_buffer_id];return i&a&&(u.parsingWorker.doOperation({operation:n,cancelPromise:e.lmv_buffer_id}),i&o||(g-=1)),i&o?i&=~r:i=0,h[e.lmv_buffer_id]=i,delete d[e.lmv_buffer_id],e.lmv_reject&&e.lmv_reject({canceled:!0}),c(this.options),!0},this.reset=function(){u.parsingWorker.doOperation({operation:n,cancel:!0}),g=0;for(var e=0;e<h.length;++e)h[e]&r?(h[e]&=~o,h[e]&a&&++g):h[e]=0;m=-1,v=-1,w.length=0,f=y-1,++E},this.addGeomPackMissingLastFrame=function(e){return!0},this.needResumeNextFrame=function(){return!1},this.pageOut=function(e,t,i){var n=i.numGeomsInMemory;if(n>this.options.geomCountLimit){var o=0,r=0|n-this.options.pageOutGoal2D;if(w.splice(0,r).forEach(function(e){i.removeGeometry(e)>0&&--r}),r>0)for(o=i.geoms.length;--o>=0&&!(o<=this.options.fragsPersistentCount)&&!((o<=v||o>m)&&i.removeGeometry(o)>0&&--r<=0););if(n=i.numGeomsInMemory-this.options.geomCountLimit,t&&n>0)for(o=m;o>=0&&!(o<=this.options.fragsPersistentCount)&&!(i.removeGeometry(o)>0&&--n<=0);--o);window&&window.gc&&window.gc()}if(e&&!T){var s=this.options.fragsPersistentMaxCount-i.numGeomsInMemory;if(s>0)for(var a=m;--s>=0;)this.loadPackFile(++a)}return WGS.PAGEOUT_SUCCESS},this.onGeomTraversed=function(e){v=e.svfid-1},this.onGeomCulled=function(e){this.onDemandLoadingEnabled()&&e&&w.push(e.svfid-1)},this.onMeshReceived=function(e,t){if(!this.onDemandLoadingEnabled())return!0;var i=d[t];if(i){i.lmv_resolve&&i.lmv_resolve(),delete d[t];var n=p.indexOf(i);n>=0&&p.splice(n,1)}return!!(h[t]&a&&(0==E||h[t]&r))&&(t>=y&&(y=t+1),h[t]&o&&u.viewer3DImpl.invalidate(!1,!0),h[t]=0,--g,!0)},this.onFinalFrame=function(){this.onDemandLoadingEnabled()&&(T=!0,h.splice(y,h.length).forEach(function(e){e&a&&--g}))},this.cancelAcknowledged=function(){--E}};e.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,i.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,i.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,i.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.domainParam=null,this.loadTime=0,this.svf=null,this.options=null,this.pagingProxy=null},e.prototype.isValid=function(){return null!=this.viewer3DImpl},e.prototype.loadFile=function(e,t,n,o,r){if(!this.viewer3DImpl)return i.logger.log("F2D loader was already destructed. So no longer usable."),!1;if(this.loading)return i.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.loading=!0,this.viewer3DImpl._addLoadingFile(this);var s=e.indexOf("urn:");if(-1!=s){var a=(e=decodeURIComponent(e)).substr(s,e.substr(s).indexOf("/"));i.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0;var c=this,u=this.memPerfOpts=this.viewer3DImpl.api.config?this.viewer3DImpl.api.config.memPerfOpts||{}:{};return(!u.hasOwnProperty("max2DPersistentBufferCount")||u.max2DPersistentBufferCount<=0)&&(u.max2DPersistentBufferCount=i.MAX_2D_PERSISTENT_BUFFER_COUNT),u.instancingFactor=this.useInstancing?4:1,u.hasOwnProperty("forceOnDemandLoading")||(u.forceOnDemandLoading=WGS.forceOnDemandLoading),u.hasOwnProperty("onDemandLoading")||(u.onDemandLoading=i.onDemandLoading),u.hasOwnProperty("pageOutGeometryEnabled")||(u.pageOutGeometryEnabled=i.pageOutGeometryEnabled),u.hasOwnProperty("pixelCullingEnable")||(u.pixelCullingEnable=WGS.pixelCullingEnable),this.initWorkerScriptToken=i.initWorkerScript(function(){c.loadFydoCB(e,t,n,o,r)}),!0},e.prototype.loadFydoCB=function(e,o,r,s,a){this.t0=Date.now();var l=i.pathToURL(e);this.streamingWorker=i.createWorker(),this.parsingWorker=i.createWorker();var c=this,u=!0,h=function(){c.memPerfOpts.onDemandLoading||(c.parsingWorker.terminate(),c.parsingWorker=null)},d=function(e){if(c.isValid()){var r=function(e,t){if(e){var i=e.geom_metrics,n=3*(i.arcs+i.circ_arcs);n+=i.circles,n+=i.pline_points-(i.plines||0),n+=i.rasters,n+=i.ptri_indices/3*3,n*=4,n+=i.ptri_points,n/=t?16383:32767;var o=c.memPerfOpts;o.onDemandLoading&&!o.forceOnDemandLoading&&n<o.max2DPersistentBufferCount*o.instancingFactor&&(o.onDemandLoading=!1,o.pageOutGeometryEnabled=!1)}return c.memPerfOpts.onDemandLoading};if(u&&a&&(u=!1,a()),e.data&&"F2DBLOB"==e.data.type){r(e.data.metadata,t.isMobileDevice());h={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:o.modelSpace,bgColor:o.bgColor,isMobile:t.isMobileDevice(),useInstancing:c.useInstancing,onDemandLoading:c.memPerfOpts.onDemandLoading},url:l};c.parsingWorker.doOperation(h,[h.data]),c.streamingWorker.terminate(),c.streamingWorker=null}else if(e.data&&"F2DSTREAM"==e.data.type){r(e.data.metadata,t.isMobileDevice());var h={operation:n,data:e.data.frames,url:l,f2dLoadOptions:{modelSpace:o.modelSpace,bgColor:o.bgColor,isMobile:t.isMobileDevice(),useInstancing:c.useInstancing,onDemandLoading:c.memPerfOpts.onDemandLoading}};e.data.metadata&&(h.metadata=e.data.metadata,h.manifest=e.data.manifest),e.data.finalFrame&&(h.finalFrame=!0),e.data.finalFrame&&(c.streamingWorker.terminate(),c.streamingWorker=null),e.data.progress&&c.viewer3DImpl.signalProgress(100*e.data.progress,t.ProgressState.LOADING),c.parsingWorker.doOperation(h,h.data?[h.data]:void 0)}else e.data&&"F2DAssetURL"==e.data.type?i.assets=i.assets.concat(e.data.urls):e.data&&e.data.assetRequest?i.assets.push(e.data.assetRequest):e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(c.loading=!1,c.streamingWorker.terminate(),c.streamingWorker=null,s&&s.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed.",t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)),c.loading=!1,c.streamingWorker.terminate(),c.streamingWorker=null))}},p=function(e){if(c.isValid())if(u&&a&&(u=!1,a()),e.data&&e.data.f2d){var n=c.svf=e.data.f2d;h(),i.logger.info("Num polylines: "+n.numPolylines),i.logger.info("Line segments: "+n.numLineSegs),i.logger.info("Circular arcs: "+n.numCircles),i.logger.info("Ellipitcal arcs:"+n.numEllipses),i.logger.info("Plain triangles:"+n.numTriangles),i.logger.info("Total # of op codes generated by fydo.parse: "+n.opCount),c.onModelRootLoadDone(c.svf),r&&r(c.model),c.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:c.svf,model:c.model});for(d=0;d<n.meshes.length;d++)c.processReceivedMesh2D(n.meshes[d],d);n.meshes=null,c.onGeomLoadDone(),c.loading=!1}else if(e.data&&e.data.f2dframe){var o=0;if(e.data.meshes){var l=e.data.bbox;c.svf.bbox=new THREE.Box3(l.min,l.max),o=e.data.baseIndex}else c.svf=e.data.f2dframe,o=e.data.baseIndex;if((n=c.svf).fragments&&n.fragments.initialized||(c.onModelRootLoadDone(n),r&&r(c.model),c.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:n,model:c.model})),e.data.meshes&&e.data.meshes.length)for(var d=0;d<e.data.meshes.length;d++)c.processReceivedMesh2D(e.data.meshes[d],o+d);if(e.data.finalFrame){var p=e.data.cumulativeProps;for(var g in p)n[g]=p[g];h(),c.onGeomLoadDone(),c.loading=!1,c.pagingProxy&&c.pagingProxy.onFinalFrame()}}else e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.canceled&&c.pagingProxy?c.pagingProxy.cancelAcknowledged():e.data&&e.data.error?(c.loading=!1,h(),i.logger.error("Error while parsing F2d: "+JSON.stringify(e.data.error.args),t.errorCodeString(t.ErrorCodes.BAD_DATA)),s&&s.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed.",t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)),c.loading=!1,h()))};this.streamingWorker.addEventListener("message",d,!1),this.parsingWorker.addEventListener("message",p,!1);var g={operation:"STREAM_F2D",url:l,objectIds:o.ids,queryParams:this.queryParam};return this.streamingWorker.doOperation(i.initLoadContext(g)),!0},e.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf.fragments,o=n.mesh2frag[t];if(void 0!==o){Array.isArray(o)||(o=[o]),i.BufferGeometryUtils.meshToGeometry(e);for(var r=o.length,s=this.model,a=(s.getGeometryList().addGeometry(e.geometry,r,e.meshIndex+1),(e.geometry.attributes.index.array||e.geometry.ib).length/3),l=0;l<o.length;l++){var c=0|o[l];s.getFragmentList().getOriginalWorldMatrix(c,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var u=n.materials[c].toString();n.polygonCounts&&(n.polygonCounts[c]=a);var h=this.viewer3DImpl.setupMesh(this.model,e.geometry,u,this.tmpMatrix);s.activateFragment(c,h)}n.mesh2frag[t]=null,n.numLoaded+=o.length;n.numLoaded}else i.logger.warn("Mesh "+t+" was not referenced by any fragments.")},e.prototype.processReceivedMesh2D=function(e,t){if(!this.pagingProxy||this.pagingProxy.onMeshReceived(e,t)){var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},n="0:"+t,o=this.svf.fragments;if(!o.fragId2dbId[t]){var r=Object.keys(i.mesh.dbIds).map(function(e){return parseInt(e)});o.fragId2dbId[t]=r;for(var s=0;s<r.length;s++){var a=r[s],l=o.dbId2fragId[a];Array.isArray(l)?l.push(t):o.dbId2fragId[a]=void 0!==l?[l,t]:t}e.material.modelScale=this.modelScale;var c=this.viewer3DImpl;o.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,function(){c.invalidate(!1,!0,!1)}),o.length++}o.mesh2frag[n]=t,this.processReceivedMesh(i)}},e.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId=[],e.fragments.length=0,e.fragments.initialized=!0,e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var n=this.currentLoadPath.lastIndexOf("/");-1!=n&&(e.basePath=this.currentLoadPath.substr(0,n+1)),e.loadOptions=this.options;var o=Date.now();this.loadTime+=o-this.t0,i.logger.log("SVF load: "+(o-this.t0)),this.t0=o,e.bbox=(new THREE.Box3).copy(e.bbox);var r=this.model=new t.Model(e);r.loader=this;var s=this.memPerfOpts;this.viewer3DImpl.modelQueue().getModels().length>0&&(s.pageOutGeometryEnabled=!1),s.pageOutPercentage=s.pageOutPercentage>0&&s.pageOutPercentage<1?s.pageOutPercentage:i.PAGEOUT_PERCENTAGE,(s.onDemandLoading||s.pixelCullingEnable)&&(this.pagingProxy=new l(this,s)),r.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&t.isMobileDevice())&&!this.options.skipPropertyDb&&(this.svf.propDbLoader=new i.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),i.logger.log("scene bounds: "+JSON.stringify(e.bbox));var a={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};i.logger.track(a),this.viewer3DImpl.signalProgress(5,t.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},e.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.memPerfOpts.onDemandLoading||(this.svf.fragments.mesh2frag=null);var e=Date.now(),n="Fragments load time: "+(e-this.t0);this.loadTime+=e-this.t0,this.options.skipPropertyDb||this.loadPropertyDb(),i.logger.log(n);var o={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};i.logger.track(o,!0),i.assets&&t.isBrowser&&window.webkit&&(!function(e){if(t.isBrowser){var i=window.webkit.messageHandlers.callbackHandler;i.doOperation?i.doOperation({command:"assets",data:e}):i.postMessage&&i.postMessage({command:"assets",data:e})}}(i.assets),i.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.memPerfOpts.onDemandLoading?this.viewer3DImpl.onDemandLoadComplete(this.model):this.viewer3DImpl.onLoadComplete(this.model)},e.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},i.F2DLoader=e,i.F2DPagingProxy=l,t.FileLoaderManager.registerFileLoader("f2d",["f2d"],i.F2DLoader)}(),function(){"use strict";function e(e){var n=e;this.loadFile=function(e,o,r,s,a){function l(){function s(i){this.bbox=new THREE.Box3,this.basePath=e,this.is2d=!0;var o=i&&i.paperWidth>=0?i.paperWidth:u.texWidth,r=i&&i.paperHeight>=0?i.paperHeight:u.texHeight;this.pageToModelTransform=u.getPageToModelTransform(o,r),this.metadata=new Object,this.metadata.page_dimensions=new Object;var s=this.metadata.page_dimensions;s.page_width=o,s.page_height=r,s.page_units=i.paperUnits,this.loadDone=!0,this.isLeaflet=!0,n.signalProgress(100,t.ProgressState.LOADING),u.texWidth>0&&(this.maxPixelPerUnit=u.texWidth/u.getQuadWidth())}var a=new s(o.loadOptions);a.loadOptions=o,h.getVisibleBounds(a.bbox);var l=new t.Model(a);l.initFromCustomIterator(h),h.callWhenRefined(function(){var e=Date.now();a.loadTime=e-c,i.logger.log("SVF load: "+a.loadTime)}.bind(this)),r(l)}var c=Date.now(),u=new i.TexQuadConfig;u.initFromLoadOptions(e,o.loadOptions,function(e,t,n){i.loadTextureWithSecurity(e,THREE.UVMapping,t,o.acmSessionId)});var h=null;a&&a();var d=!u.valid();d&&u.initForSimpleImage(e,l),u.pixelRatio=n.glrenderer().getPixelRatio(),h=new i.ModelIteratorTexQuad(u,n.getMaterials()),d||l()}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private;e.computeLevelOffset=function(e){for(var t=1,n=0,o=0;o<20;o++){if((t*=2)>e)return n;n++}return i.logger.log("unexpected leaflet tileSize"),0},Autodesk.Viewing.Private.LeafletLoader=e,Autodesk.Viewing.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],i.LeafletLoader)}(),function(){"use strict";function e(e,t,i){var n=t||65536;this.FULL_COUNT=0|(i||32767),this.useInstancing=e,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?n/4:n)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(n),this.reset(0)}var t=Autodesk.Viewing.Private,i=2*Math.PI,n=[0,1,3,0,3,2];e.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0},e.prototype.expandStride=function(){},e.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},e.prototype.setCommonVertexAttribs=function(e,t,i,n,o,r,s,a){t&=255,i&=255,a&=255,r&=65535,s&=65535,this.vbi[e+8]=t|i<<8|a<<16,this.vbi[e+6]=n,this.vbi[e+7]=o,this.vbi[e+9]=r|s<<16,this.dbIds[o]=1},e.prototype.addVertexTriangleGeom=function(e,t,i,n,o,r,s,a,l,c){for(var u=this.vcount,h=this.vbf,d=this.useInstancing?1:4,p=0;p<d;p++){var g=(u+p)*this.stride;h[g]=e,h[g+1]=t,h[g+2]=i,h[g+3]=n,h[g+4]=o,h[g+5]=r,this.setCommonVertexAttribs(g,0+p,5,s,a,l,c,0),this.vcount++}return u},e.prototype.addVertexLine=function(e,t,i,n,o,r,s,a,l,c,u){for(var h=this.vcount,d=this.vbf,p=this.useInstancing?1:4,g=0;g<p;g++){var m=(h+g)*this.stride;d[m]=e,d[m+1]=t,d[m+2]=i,d[m+3]=n,d[m+4]=.5*r,d[m+5]=o,this.setCommonVertexAttribs(m,0+g,1,s,a,l,c,u),this.vcount++}return h},e.prototype.addVertexTexQuad=function(e,t,i,n,o,r,s,a,l){for(var c=this.vcount,u=this.vbf,h=this.useInstancing?1:4,d=0;d<h;d++){var p=(c+d)*this.stride;u[p]=e,u[p+1]=t,u[p+2]=o,u[p+3]=i,u[p+4]=n,this.setCommonVertexAttribs(p,0+d,4,r,s,a,l,0),this.vcount++}return c},e.prototype.addVertexArc=function(e,t,i,n,o,r,s,a,l,c,u,h){for(var d=this.vcount,p=this.vbf,g=o==r?2:3,m=this.useInstancing?1:4,v=0;v<m;v++){var f=(d+v)*this.stride;p[f]=e,p[f+1]=t,p[f+2]=i,p[f+3]=n,p[f+4]=.5*a,p[f+5]=o,3===g&&(p[f+10]=r,p[f+11]=s),this.setCommonVertexAttribs(f,0+v,g,l,c,u,h,0),this.vcount++}return d},e.prototype.addVertex=function(e,t,i,n,o,r){if(!this.useInstancing){var s=this.vcount,a=this.stride*s,l=this.vbf;return l[a]=e,l[a+1]=t,this.setCommonVertexAttribs(a,0,0,i,n,o,r,0),this.vcount++,s}},e.prototype.addVertexPolytriangle=function(e,t,i,n,o,r){this.useInstancing||(this.addVertex(e,t,i,n,o,r),this.addToBounds(e,t))},e.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,n=this.icount;if(n+e.length>=i.length){for(var o=new Uint16Array(2*Math.max(e.length,i.length)),r=0;r<n;++r)o[r]=i[r];this.ib=i=o}for(r=0;r<e.length;++r)i[n+r]=t+e[r];this.icount+=e.length}},e.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(n,e)},e.prototype.addSegment=function(e,t,i,n,o,r,s,a,l,c,u){var h=i-e,d=n-t,p=h||d?Math.atan2(d,h):0,g=h||d?Math.sqrt(h*h+d*d):0,m=this.addVertexLine(e,t,p,g,o,r,s,a,l,c,u);this.finalizeQuad(m),this.addToBounds(e,t),this.addToBounds(i,n)},e.prototype.addTriangleGeom=function(e,t,i,n,o,r,s,a,l,c){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,i,n,o,r,s,a,l,c);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(i,n),this.addToBounds(o,r)},e.prototype.addArc=function(e,t,n,r,s,a,l,c,u,h,d,p){s==a?this.numCirculars++:this.numEllipticals++;var g=o(n,r);if(n=g.start,r=g.end,0==n&&0==r&&(r=i),(y=Math.abs(n-r))>1e-4&&Math.abs(y-i)>1e-4){var m=e+s*Math.cos(n),v=t+a*Math.sin(n);this.addSegment(m,v,m,v,0,c,u,h,d,p);var f=e+s*Math.cos(r),E=t+a*Math.sin(r);this.addSegment(f,E,f,E,0,c,u,h,d,p)}else this.addToBounds(e-s,t-a),this.addToBounds(e+s,t+a);var A=this.addVertexArc(e,t,n,r,s,a,l,c,u,h,d,p);this.finalizeQuad(A);var y},e.prototype.addTexturedQuad=function(e,t,i,n,o,r,s,a,l){var c=this.addVertexTexQuad(e,t,i,n,o,r,s,a,l);this.finalizeQuad(c);var u=.5*Math.cos(o),h=.5*Math.sin(o),d=Math.abs(i*u)+Math.abs(n*h),p=Math.abs(i*h)+Math.abs(n*u);this.addToBounds(e-d,t-p),this.addToBounds(e+d,t+p)},e.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>this.FULL_COUNT},e.prototype.toMesh=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride;var t=this.useInstancing?1:0;if(e.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},this.stride>10&&(e.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1}),this.useInstancing){e.numInstances=this.vcount;var i=new Int32Array([0,1,2,3]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=i.buffer;e.indices=new Uint16Array(n)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var o=this.maxx-this.minx,r=this.maxy-this.miny,s=Math.max(o,r);e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-s},max:{x:this.maxx,y:this.maxy,z:.001*s}};e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(o*o+r*r)};return e};var o=function(e,t){function n(){function n(e,t){return Math.abs(e-t)<.001}n(e,0)&&(e=0),n(t,0)&&(t=0),n(e,i)&&(e=i),n(t,i)&&(t=i)}if(n(),e>t)for(;e>i;)e-=i,t-=i;else for(;t>i;)e-=i,t-=i;return n(),e<0&&t>0&&(e+=i),{start:e,end:t}};t.VertexBufferBuilder=e}(),function(){"use strict";Autodesk.Viewing;var e=Autodesk.Viewing.Private;Math.PI;e.VertexBufferReader=function(e,t){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!t},e.VertexBufferReader.prototype.getDbIdAt=function(e){return this.vbi[e*this.stride+7]},e.VertexBufferReader.prototype.getVertexFlagsAt=function(e){return this.vbi[e*this.stride+8]},e.VertexBufferReader.prototype.getLayerIndexAt=function(e){return 65535&this.vbi[e*this.stride+9]},e.VertexBufferReader.prototype.getViewportIndexAt=function(e){return this.vbi[e*this.stride+9]>>16&65535},e.VertexBufferReader.prototype.decodeLineAt=function(e,t,i,n){if(n.onLineSegment){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=r+l*Math.cos(a),u=s+l*Math.sin(a);n.onLineSegment(r,s,c,u,i)}},e.VertexBufferReader.prototype.decodeCircularArcAt=function(e,t,i,n){if(n.onCircularArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5];n.onCircularArc(r,s,a,l,c,i)}},e.VertexBufferReader.prototype.decodeEllipticalArcAt=function(e,t,i,n){if(n.onEllipticalArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5],u=this.vbf[o+10],h=this.vbf[o+11];n.onEllipticalArc(r,s,a,l,c,u,h,i)}},e.VertexBufferReader.prototype.decodeTexQuadAt=function(e,t,i,n){if(n.onTexQuad){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+4];n.onTexQuad(r,s,l,c,a,i)}},e.VertexBufferReader.prototype.decodeOneTriangleAt=function(e,t,i,n){if(n.onOneTriangle){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+4],u=this.vbf[o+5];n.onOneTriangle(r,s,a,l,c,u,i)}},e.VertexBufferReader.prototype.decodeTriangleVertex=function(e,t,i,n){if(n.onTriangleVertex){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1];n.onTriangleVertex(r,s,i)}},e.VertexBufferReader.prototype.enumGeomsForObject=function(e,t){for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i)>>8&255,o=this.getLayerIndexAt(i),r=this.getViewportIndexAt(i);if(this.getDbIdAt(i)===e)switch(n){case 0:this.decodeTriangleVertex(i,o,r,t);break;case 1:this.decodeLineAt(i,o,r,t);break;case 2:this.decodeCircularArcAt(i,o,r,t);break;case 3:this.decodeEllipticalArcAt(i,o,r,t);break;case 4:this.decodeTexQuadAt(i,o,r,t);break;case 5:this.decodeOneTriangleAt(i,o,r,t)}i+=this.useInstancing||0==n?1:4}},e.VertexBufferReader.prototype.enumGeomsForVisibleLayer=function(e,t){for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i)>>8&255,o=this.getLayerIndexAt(i),r=this.getViewportIndexAt(i),s=-1!==e.indexOf(o);if(0!==o&&s)switch(n){case 0:this.decodeTriangleVertex(i,o,r,t);break;case 1:this.decodeLineAt(i,o,r,t);break;case 2:this.decodeCircularArcAt(i,o,r,t);break;case 3:this.decodeEllipticalArcAt(i,o,r,t);break;case 4:this.decodeTexQuadAt(i,o,r,t);break;case 5:this.decodeOneTriangleAt(i,o,r,t)}i+=this.useInstancing||0==n?1:4}}}(),function(){"use strict";function e(){function e(){var e=te.NormalsShader;(a=te.createShaderMaterial(e)).blending=THREE.NoBlending,a.packedNormals=!0;var t={NoCutPlanes:1,Instancing:2,Count:4},i=[];i[0]=null;for(var n=1;n<t.Count;n++){var o=a.clone();n&t.NoCutPlanes&&(o.cutPlanes=null,o.blending=THREE.NoBlending,o.packedNormals=!0,o.doNotCut=!0),n&t.Instancing&&(o.useInstancing=!0),i[n]=o}a.variants=i,a.getCustomOverrideMaterial=function(e){var i=!e.cutplanes||0==e.cutplanes.length,n=e.useInstancing,o=(i?t.NoCutPlanes:0)|(n?t.Instancing:0);return this.variants[o]}}function n(e){e(a);for(var t=1;t<a.variants.length;t++)e(a.variants[t])}function o(){function t(e){e.material.blending=THREE.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}e(),t(g=new te.LmvShaderPass(te.SAOShader)),t(p=new te.LmvShaderPass(te.SAOBlurShader)),t(v=new te.LmvShaderPass(te.SAOMinifyFirstShader)),t(m=new te.LmvShaderPass(te.SAOMinifyShader)),t(f=new te.LmvShaderPass(te.FXAAShader)),t(E=new te.LmvShaderPass(te.CelShader)),t(A=new te.LmvShaderPass(te.BlendShader)),t(d=new te.LmvShaderPass(te.BackgroundShader)),t(y=new te.LmvShaderPass(te.CopyShader))}function r(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i;return(((1-i-n)*t+n)*t+i)*t}var s,a,l,c,u,h,d,p,g,m,v,f,E,A,y,T,w,b,C,S,k,M,x,R=!1,P=!1,V=null,I=null,N=null,D=null,L=null,O=[],_=0,H=0,B=0,F=1,z=!1,U=new Uint8Array(4),G=(new THREE.Color).setRGB(1,1,1),W=(new THREE.Color).setRGB(0,0,0),j=null,Y=!1,q=!1,X=!1,K=0,Q=0,Z=0,J=[.42,0,1,1],$={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1},ee={},te=Autodesk.Viewing.Shaders;this.settings=$,this.init=function(e,n,r){if(o(),e){var a=-1!=window.navigator.userAgent.indexOf("Firefox");x=a?THREE.RGBAFormat:THREE.RGBFormat,Y=t.isMobileDevice(),$.idbuffer=!Y,k=n,M=r,s=e}else i.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",t.errorCodeString(t.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED))},this.overlayUpdate=function(e){if(0===Q||-1===Q)return!1;var t=A.uniforms.highlightIntensity.value,i=.004*(performance.now()-K);i=Math.min(i,1);var n=r(J,i);return t!=n&&(A.uniforms.highlightIntensity.value=n,!0)},this.beginScene=function(e,n,o,r){if(c=n,h=e.fog,u=o,R=!1,P=!1,!I&&k)this.initPostPipeline($.sao,$.antialias);else if(!I&&!k)return void(z||(i.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",t.errorCodeString(t.ErrorCodes.VIEWER_INTERNAL_ERROR)),z=!0));if(r){if(j&&!$.envMapBg){if($.swapBlackAndWhite){var a=new THREE.Color(1,1,1),l=new THREE.Color(0,0,0);j.equals(a)?s.setClearColor(l,1):j.equals(l)?s.setClearColor(a,1):s.setClearColor(j,1)}else s.setClearColor(j,1);s.clearTarget(I,!0,!0,!1)}else d.uniforms.uCamDir.value=c.worldUpTransform?c.getWorldDirection().clone().applyMatrix4(c.worldUpTransform):c.getWorldDirection(),d.uniforms.uCamUp.value=c.worldUpTransform?c.up.clone().applyMatrix4(c.worldUpTransform):c.up,d.uniforms.uResolution.value.set(k,M),d.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*c.fov)),s.clearTarget(I,!1,!0,!1),d.render(s,I,null);for(var p=0;p<O.length;p++)s.setClearColor(G,1),s.clearTarget(O[p],!0,!1,!1)}if($.sao||$.toonShaded){r&&(s.setClearColor(W,0),s.clearTarget(S,!0,!1,!1));var m=n.near,f=n.far;g.uniforms.cameraNear.value=m,g.uniforms.cameraFar.value=f,E.uniforms.cameraNear.value=m,E.uniforms.cameraFar.value=f,v.uniforms.cameraNear.value=m,v.uniforms.cameraInvNearFar.value=1/(m-f);var y=n.projectionMatrix.elements;n.isPerspective?(g.uniforms.projInfo.value.set(-2/(I.width*y[0]),-2/(I.height*y[5]),(1-y[8])/y[0],(1+y[9])/y[5]),E.uniforms.projInfo.value.copy(g.uniforms.projInfo.value),g.uniforms.isOrtho.value=0,E.uniforms.isOrtho.value=0):(g.uniforms.projInfo.value.set(-2/(I.width*y[0]),-2/(I.height*y[5]),(1-y[12])/y[0],(1-y[13])/y[5]),E.uniforms.projInfo.value.copy(g.uniforms.projInfo.value),g.uniforms.isOrtho.value=1,E.uniforms.isOrtho.value=1);g.uniforms.projScale.value=I.height*y[5]*.125}$.sao||(A.uniforms.useAO.value=0),this.renderScenePart(e,!0,!0,!1,!0)},this.renderScenePart=function(e,t,i,n,o){R=!1,P=!1;var r=o?u:void 0;e.fog=h;var d;q&&X?$.idbuffer&&n&&($.sao||$.toonShaded)?s.render(e,c,[I,S].concat(O),!1,r):$.sao||$.toonShaded?s.render(e,c,[I,S],!1,r):$.idbuffer&&n?s.render(e,c,[I].concat(O)):s.render(e,c,I,!1,r):X?($.idbuffer&&n?s.render(e,c,[I].concat(O),!1,r):s.render(e,c,I,!1,r),($.sao||$.toonShaded)&&i&&(d=e.overrideMaterial,e.overrideMaterial=a,s.render(e,c,S,!1,void 0),e.overrideMaterial=d)):(t&&s.render(e,c,I,!1,r),$.idbuffer&&n&&l&&(d=e.overrideMaterial,e.overrideMaterial=l,s.render(e,c,O[0],!1,void 0),e.overrideMaterial=d),($.sao||$.toonShaded)&&i&&(d=e.overrideMaterial,e.overrideMaterial=a,s.render(e,c,S,!1,void 0),e.overrideMaterial=d))},this.clearAllOverlays=function(){s.clearTarget(N,!0,!1,!1)},this.renderOverlays=function(e,t){var i=0;for(var n in e){var o=e[n],r=o.scene,a=o.camera?o.camera:c;r.children.length&&(i||(i=1,s.setClearColor(W,0),s.clearTarget(N,!0,!1,!1)),o.materialPre&&(r.overrideMaterial=o.materialPre),s.render(r,a,N,!1,t),o.materialPost&&(r.overrideMaterial=o.materialPost,s.context.depthFunc(s.context.GREATER),s.render(r,a,N,!1,t),s.context.depthFunc(s.context.LEQUAL)),r.overrideMaterial=null)}A.uniforms.useOverlay.value=i},this.computeSSAO=function(e){if(e||!$.sao||$.toonShaded)A.uniforms.useAO.value=0;else{if(!R){if(V&&V.length){var t=V[0];v.uniforms.resolution.value.set(1/t.width,1/t.height),v.render(s,t,S);for(var i=1;i<V.length;i++){var n=V[i];m.uniforms.resolution.value.set(1/n.width,1/n.height),m.render(s,n,t),t=n}}g.render(s,L,I),p.uniforms.axis.value.set(1,0),p.render(s,D,L),p.uniforms.axis.value.set(0,1),p.render(s,L,D),R=!0}A.uniforms.useAO.value=1}},this.presentBuffer=function(e){s&&(!($.sao||A.uniforms.useOverlay.value||0!==Q&&-1!==Q||0!==Z&&-1!==Z)?$.antialias?e?(f.render(s,D,I),e.render(s,null,D)):$.toonShaded?(E.render(s,D,I),f.render(s,null,D)):f.render(s,null,I):e?e.render(s,null,I):$.toonShaded?(E.render(s,D,I),y.render(s,null,D)):y.render(s,null,I):$.antialias?(A.render(s,D,I),e?(f.render(s,L,D),e.render(s,null,L)):$.toonShaded?(E.render(s,L,D),f.render(s,null,L)):f.render(s,null,D)):e?(A.render(s,D,I),e.render(s,null,D)):$.toonShaded?(A.render(s,D,I),E.render(s,L,D),y.render(s,null,L)):A.render(s,null,I))},this.composeFinalFrame=function(e,t){$.sao&&!$.toonShaded&&this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(I&&(I.dispose(),I=null),S&&(S.dispose(),S=null),N&&(N.dispose(),N=null),D&&(D.dispose(),D=null),L&&(L.dispose(),L=null),V){for(var e=0;e<V.length;e++)V[e].dispose();V=[]}},this.setSize=function(e,n,o){if(k=e,M=n,$.logicalWidth=e,$.logicalHeight=n,0===e&&0===n||!s)this.cleanup();else{var r=0|e*s.getPixelRatio(),a=0|n*s.getPixelRatio();$.deviceWidth=r,$.deviceHeight=a,s.setSize(e,n),i.logger.log("width: "+r+" height: "+a);var l=1/r,c=1/a;if(($.useSSAA||$.toonShaded&&s.getPixelRatio()<=1)&&(r*=2,a*=2,o=!0),!o&&I&&I.width==r&&I.height==a||(i.logger.log("Reallocating render targets."),this.cleanup(),(I=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:$.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1})).generateMipmaps=!1,(N=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1})).generateMipmaps=!1,N.shareDepthFrom=I,S=null,D=null,L=null,V=[]),($.antialias||$.sao||$.customPresentPass||$.toonShaded)&&(!o&&D&&D.width==r&&D.height==a||((D=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1})).generateMipmaps=!1)),$.sao||$.toonShaded){if(o||!S||S.width!=r||S.height!=a){var u=THREE.FloatType;t.isMobileDevice()&&(u=THREE.HalfFloatType),(S=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:x,type:u,stencilBuffer:!1})).shareDepthFrom=I,V=[];for(var h=0;h<5;h++){var d=new THREE.WebGLRenderTarget(0|r/(2<<h),0|a/(2<<h),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});d.generateMipmaps=!1,V.push(d),g.uniforms["tDepth_mip"+(h+1)].value=d}q=s.verifyMRTWorks([I,S]),L=D.clone()}!L&&$.antialias&&$.customPresentPass&&(L=D.clone()),g.uniforms.size.value.set(r,a),g.uniforms.resolution.value.set(l,c),g.uniforms.tDepth.value=S,p.uniforms.size.value.set(r,a),p.uniforms.resolution.value.set(l,c),E.uniforms.tDepth.value=S}if($.idbuffer){if(o||!O[0]||O[0].width!=r||O[0].height!=a){O=[];for(m=0;m<$.numIdTargets;m++)O[m]=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1}),O[m].generateMipmaps=!1,O[m].shareDepthFrom=I,O[m].canReadPixels=!0;(X=s.verifyMRTWorks([I].concat(O)))||i.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work.")}E.uniforms.tID.value=O[0]}else if(O[0])for(var m=0;m<O.length;m++)O[m].dispose(),O[m]=null;f.uniforms.uResolution.value.set(l,c),E.uniforms.resolution.value.set(l,c),A.uniforms.tOverlay.value=N,A.uniforms.tAO.value=L,A.uniforms.useAO.value=$.sao?1:0,A.uniforms.resolution.value.set(l,c),A.uniforms.tID.value=O[0]}},this.getMaxAnisotropy=function(){return s.getMaxAnisotropy()},this.mrtFlags=function(){return{mrtNormals:q&&($.sao||$.toonShaded),mrtIdBuffer:X&&$.idbuffer?$.numIdTargets:void 0}},this.getAntialiasing=function(){return $.antialias},this.initPostPipeline=function(e,i){$.sao=e&&!t.isIE11,$.antialias=i&&!t.isIE11,$.sao&&($.toonShaded=!1),$.haveTwoSided&&n(function(e){e.side=THREE.DoubleSide}),n(function(e){e.needsUpdate=!0}),g.material.needsUpdate=!0,p.material.needsUpdate=!0,v.material.needsUpdate=!0,m.material.needsUpdate=!0,f.material.needsUpdate=!0,E.material.needsUpdate=!0,A.material.needsUpdate=!0,d.material.needsUpdate=!0,y.material.needsUpdate=!0,this.setSize(k,M)},this.setClearColors=function(e,t){(j=t?e.equals(t)||Y?new THREE.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone())||(d.uniforms.color1.value.copy(e),d.uniforms.color2.value.copy(t))},this.setAOEnabled=function(e){$.sao=e,this.setSize(k,M)},this.setAOOptions=function(e,i){void 0!==e&&(g.uniforms.radius.value=e,g.uniforms.bias.value=e*t.isMobileDevice()?.1:.01,p.uniforms.radius.value=e),void 0!==i&&(g.uniforms.intensity.value=i),R=!1},this.getAOEnabled=function(){return $.sao},this.getAORadius=function(){return g.uniforms.radius.value},this.getAOIntensity=function(){return g.uniforms.intensity.value},this.setCubeMap=function(e){d.material.envMap=e},this.setEnvRotation=function(e){H=e,d.material.envRotationSin=Math.sin(e),d.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return H},this.setEnvExposure=function(e){d.uniforms.envMapExposure.value=Math.pow(2,e),d.material.envMapExposure=Math.pow(2,e),d.material.needsUpdate=!0},this.setTonemapExposureBias=function(e){_=e,d.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return _},this.setCamera=function(e){c=e},this.setTonemapMethod=function(e){B=e,s.gammaInput=0!==e,d.material.tonemapOutput=B,d.material.needsUpdate=!0},this.getToneMapMethod=function(){return B},this.toggleTwoSided=function(e){$.haveTwoSided!=e&&a&&n(function(t){t.side=e?THREE.DoubleSide:THREE.FrontSide,t.needsUpdate=!0}),$.haveTwoSided=e},this.toggleCelShading=function(e){$.sao=!e,$.toonShaded=e,$.idbuffer=e,this.initPostPipeline($.sao,$.antialias)},this.toggleEnvMapBackground=function(e){$.envMapBg=e,d.uniforms.envMapBackground.value=e},this.toggleSwapBlackAndWhite=function(e){$.swapBlackAndWhite=e},this.enter2DMode=function(e){l=e,ee.sao=$.sao,ee.toonShaded=$.toonShaded,ee.antialias=$.antialias,ee.idbuffer=$.idbuffer,$.idbuffer=!0,$.toonShaded=!1,A.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){l=null,$.idbuffer=ee.idbuffer,$.toonShaded=ee.toonShaded,delete A.material.defines.IS_2D,this.initPostPipeline(ee.sao,ee.antialias)},this.idAtPixel=function(e,t,i){if(!O[0])return 0;var n=0|.5*(e+1)*O[0].width,o=0|.5*(t+1)*O[0].height;if(P&&n===T&&o===w)return i&&(i[0]=b,i[1]=C),b;s.readRenderTargetPixels(O[0],n,o,1,1,U);var r=U[2]<<16|U[1]<<8|U[0],a=0;return O[1]?(s.readRenderTargetPixels(O[1],n,o,1,1,U),a=(a=U[1]<<8|U[0])<<16>>16,r=r<<8>>8):r=r<<8>>8,T=n,w=o,b=r,C=a,P=!0,i&&(i[0]=r,i[1]=a),r},this.idAtPixels=function(e,t,i,n){if(!O[0])return 0;var o=.5*(e+1)*O[0].width-.5*(i-1),r=.5*(t+1)*O[0].height-.5*(i-1),a=new Uint8Array(4*i*i);s.readRenderTargetPixels(O[0],o,r,i,i,a);var l=void 0;return n&&O[1]&&(l=new Uint8Array(4*i*i),s.readRenderTargetPixels(O[1],o,r,i,i,l)),function(){for(var e,t=0,o=0,r=0,s=-1,c=0;c<i*i;c++){var u=t+(i-1)/2,h=o+(i-1)/2;if(u>=0&&u<=i&&h>=0&&h<=i){var d=u+h*i;if(e=a[4*d+2]<<16|a[4*d+1]<<8|a[4*d],(e=e<<8>>8)>=0){if(l){var p=l[4*d+1]<<8|l[4*d];p=p<<16>>16,n[0]=e,n[1]=p}break}}if(t==o||t<0&&t==-o||t>0&&t==1-o){var g=r;r=-s,s=g}t+=r,o+=s}return e}()},this.readbackTargetId=function(){if(!O[0])return null;var e=new Uint8Array(4*O[0].width*O[0].height);return s.readRenderTargetPixels(O[0],0,0,O[0].width,O[0].height,e),{buffer:e,width:O[0].width,height:O[0].height}},this.rolloverObjectViewport=function(e,t,i){var n=i?i[0]:this.idAtPixel(e,t);return this.rolloverObjectId(n,i)},this.rolloverObjectId=function(e,t,i){return i=i||0,(e!==Q||i!==Z)&&(A.uniforms.highlightIntensity.value=0,A.uniforms.objID.value=e,K=performance.now(),Q=e,Z=i,t?(t.length>1&&t.shift(),A.uniforms.highlightRange.value=1,A.uniforms.objIDStart.value=t[0],A.uniforms.objIDEnd.value=t[t.length-1]):(A.uniforms.highlightRange.value=0,e<=0&&(e=0),A.uniforms.objIDv3.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255)),!0)},this.setUnitScale=function(e){F=e},this.getUnitScale=function(){return F},this.getBlendPass=function(){return A},this.getClearPass=function(){return d},this.getColorTarget=function(){return I},this.getDepthMaterial=function(){return a}}var t=Autodesk.Viewing,i=t.Private;i.RenderContext=e}(),function(){"use strict";function e(e,t){var i=255*t[2]+t[3],n=Math.pow(2,(i-127)/2),o=n/t[1],r=t[0]*o,s=a[0]*r+a[3]*n+a[6]*o,l=a[1]*r+a[4]*n+a[7]*o,c=a[2]*r+a[5]*n+a[8]*o;s<0&&(s=0),l<0&&(l=0),c<0&&(c=0),e[0]=s,e[1]=l,e[2]=c}function t(e,t,i){var n=.0625*Math.sqrt(t[0]*i),o=.0625*Math.sqrt(t[1]*i),r=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(n,o),Math.max(r,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;n>1&&(n=1),o>1&&(o=1),r>1&&(r=1),e[3]=a;var l=1/a;e[0]=n*l,e[1]=o*l,e[2]=r*l}function i(e,t,i){var n=Math.sqrt(t[0]*i),o=Math.sqrt(t[1]*i),r=Math.sqrt(t[2]*i);n>65504&&(n=65504),o>65504&&(o=65504),r>65504&&(r=65504),e[0]=n,e[1]=o,e[2]=r}function n(e){for(var t=[],i=Array.isArray(e.image)?e.image:[e.image],n=0;n<i.length;n++)for(var o=i[n],r=0;r<o.mipmaps.length;r++){var s=o.mipmaps[r];t.push(s.data.buffer)}return t}Autodesk.Viewing;var o=Autodesk.Viewing.Private,r=Autodesk.LMVTK;o.DefaultLightPreset=1,o.DefaultLightPreset2d=0,o.ModelSettingsEnvironment=null,o.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var s=o.BackgroundPresets;o.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:s["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:s["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:s.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:s.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:s.Snow,darkerFade:!1,rotation:0}],o.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["RaaS SBS"],darkerFade:!1,rotation:0}],o.ENABLE_DEBUG&&(o.LightPresets=o.LightPresets.concat(o.DebugEnvironments)),o.copyLightPreset=function(e,t){t.name=e.name+" (copy)",t.path=e.path,t.type=e.type,t.tonemap=e.tonemap,t.E_bias=e.E_bias,t.directLightColor=e.directLightColor,t.ambientColor=e.ambientColor,t.lightMultiplier=e.lightMultiplier,t.bgColorGradient=e.bgColorGradient,t.darkerFade=e.darkerFade,t.rotation=e.rotation},o.CreateCubeMapFromColors=function(e,t){for(var i=255*e.x,n=255*e.y,o=255*e.z,r=255*t.x,s=255*t.y,a=255*t.z,l=new Uint8Array(16),c=new Uint8Array(16),u=new Uint8Array(16),h=0;h<4;h++)l[4*h]=i,l[4*h+1]=n,l[4*h+2]=o,l[4*h+3]=255,c[4*h]=r,c[4*h+1]=s,c[4*h+2]=a,c[4*h+3]=255,h>1?(u[4*h]=i,u[4*h+1]=n,u[4*h+2]=o,u[4*h+3]=255):(u[4*h]=r,u[4*h+1]=s,u[4*h+2]=a,u[4*h+3]=255);var d=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),g=new THREE.DataTexture(c,2,2,THREE.RGBAFormat),m=new THREE.DataTexture(l,2,2,THREE.RGBAFormat),v=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),f=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),E=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);return E.image=[p,d,m,g,f,v],E.needsUpdate=!0,E};var a=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],l=new Float32Array(4),c=new Float32Array(4);o.DecodeEnvMap=function(n,r,s,a){if(n.LogLuv){for(var u=Math.pow(2,r),h=Array.isArray(n.image)?n.image:[n.image],d=0;d<h.length;d++)for(var p=h[d],g=0;g<p.mipmaps.length;g++){var m,v=p.mipmaps[g],f=v.data;s?(m=new Uint16Array(f.length/4*3),v.data=m):m=f.buffer;for(var E=0,A=0;A<f.length;A+=4)l[0]=f[A]/255,l[1]=f[A+1]/255,l[2]=f[A+2]/255,l[3]=f[A+3]/255,e(c,l),s?(i(l,c,u),m[E++]=o.FloatToHalf(l[0]),m[E++]=o.FloatToHalf(l[1]),m[E++]=o.FloatToHalf(l[2])):(t(l,c,u),f[A]=Math.round(255*l[0]),f[A+1]=Math.round(255*l[1]),f[A+2]=Math.round(255*l[2]),f[A+3]=Math.round(255*l[3]))}n.LogLuv=!1,s?(n.type=THREE.HalfFloatType,n.format=THREE.RGBFormat,n.RGBM=!1,n.GammaEncoded=!0):n.RGBM=!0,a&&a(n)}else o.logger.warn("Environment map expected to be in LogLuv format.")},o.imageWorker=null;var u=1;o.DecodeEnvMapAsync=function(e,t,i,r){if(e.LogLuv){o.imageWorker||(o.imageWorker=o.createWorker());var s=u++,a=function(t){if(t.data.id===s){o.imageWorker.removeEventListener("message",a);var n=t.data.map;e.image=n.image,e.LogLuv=!1,i?(e.type=THREE.HalfFloatType,e.format=THREE.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,r(e)}};o.imageWorker.addEventListener("message",a),o.imageWorker.postMessage({operation:"DECODE_ENVMAP",map:e,exposure:t,useHalfFloat:i,id:s},n(e))}else o.logger.warn("Environment map expected to be in LogLuv format.")},r.doDecodeEnvmap=function(e){o.DecodeEnvMap(e.map,e.exposure,e.useHalfFloat),self.postMessage({map:e.map,id:e.id},n(e.map))}}(),function(){"use strict";function e(e,i,n,o){if(a.getUseCredentials()){var r=-1===e.indexOf("://")||-1!==e.indexOf(window.location.host)||l.urlIsApiViewingOrDev(e);THREE.ImageUtils.crossOrigin=r?"use-credentials":"anonymous"}if(-1!==e.indexOf("urn:")){var s=a.getUseCredentials()&&!a.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"";o&&(s&&(s+="&"),s+="acmsession="+o),s&&(e+="?"+s)}if(".dds"===e.slice(e.length-4).toLocaleLowerCase()){if(a.isIOSDevice()){var c=e.slice(0,e.length-4)+".pvr";return(new THREE.PVRLoader).load(c,n)}return(new THREE.DDSLoader).load(e,n)}return!LMV_THIRD_PARTY_COOKIE&&r?t(e,i,n):THREE.ImageUtils.loadTexture(e,i,n)}function t(e,t,n){function o(e){return i(e,s,n)}function r(e,t,i){var n="Error: "+e+" ("+t+")";l.logger.error(n,a.errorCodeString(a.ErrorCodes.NETWORK_SERVER_ERROR))}var s=new THREE.Texture(void 0,t);return l.ViewingService.getItem(l.initLoadContext(),e,o,r),s}function i(e,t,i){var n=new Image;t.image=n,n.onload=function(){t.needsUpdate=!0,i&&i(t)},n.onerror=function(e){l.logger.error(e,a.errorCodeString(a.ErrorCodes.UNKNOWN_FAILURE))},n.src=function(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,o=0;o<n;o++)t+=String.fromCharCode(i[o]);return"data:image/jpeg;base64,"+window.btoa(t)}(e)}function n(e){var t=e.width,i=e.height;if(0==(t&t-1)&&0==(i&i-1))return e;for(var n=1;2*n<t;)n*=2;for(var o=1;2*o<i;)o*=2;var r=document.createElement("canvas"),s=r.getContext("2d");return r.width=n,r.height=o,s.drawImage(e,0,0,n,o),r}function o(t){function i(e){return.299*e.r+.587*e.g+.114*e.b}WGS.MaterialManager.call(this,t);var o=this,r=WGS.MaterialManager.prototype;this.hasPrism=!1;var s=!1;this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0}),this.dtor=function(){this.cleanup(),THREE.Cache.clear(),o=null},this.hasTwoSidedMaterials=function(){return s},this.findMaterial=function(e,t){var i=r.findMaterial.call(this,this._getMaterialHash(e,t));return i||(l.logger.warn("Unknown material "+t+". Using default."),i=this.defaultMaterial),i},this.convertOneMaterial=function(e,t,i,n){var o=e.getData(),r=l.MaterialConverter.convertMaterial(t,n);o.doubleSided&&(r.side=THREE.DoubleSide);var s=this._getMaterialHash(e,i);if(this.addMaterial(s,r,n),t.decals){r.decals=[];for(var a=0,c=t.decals.length;a<c;a++){var u=t.decals[a];n=l.MaterialConverter.isPrismMaterial(u.material);var h=l.MaterialConverter.convertMaterial(u.material,n);r.decals.push({uv:u.uv||0,material:h}),this.addMaterial(s+"|decal|"+a,h,n)}}},this.loadTexture=function(t,i){var s=i.getData(),a=function(t,r,a){o._getTextureHash(i,r.uri,r.mapName);var c=null,u=t.proteinType&&t.proteinType.length,h=u&&0===t.proteinType.indexOf("Prism");if((h&&PRISM_ROOT||u&&PROTEIN_ROOT)&&(0===r.uri.indexOf("1/Mats")||0===r.uri.indexOf("2/Mats")||0===r.uri.indexOf("3/Mats")))c=h?PRISM_ROOT+r.uri:PROTEIN_ROOT+r.uri;else{for(var d=0;d<s.manifest.assets.length;++d){var p=s.manifest.assets[d];if(p.id.toLowerCase()==r.uri.toLowerCase()){c=l.pathToURL(s.basePath+p.URI);break}}c||(c=l.pathToURL(s.basePath+r.uri))}return e(c,THREE.UVMapping,function(e){o&&(e.image=n(e.image),a(r,e))},s.acmSessionId)};r.loadMaterialTextures.call(this,i,t,s.materials.scene.SceneUnit,a)},this.loadTextures=function(e){var t=this._getModelHash(e);for(var i in this._materials)if(-1!=i.indexOf(t)){var n=this._materials[i];this.loadTexture(n,e)}},this.texturesLoaded=function(){return 0===this._texturesToUpdate.length},this.create2DMaterial=function(i,o,s,l,c){var u=i?i.getData():null,h="__lineMaterial__";o.image&&(h+="|image:"+o.image.name),o.clip&&(h+="|clip:"+JSON.stringify(o.clip)),s&&(h+="|id"),l&&(h+="|selection"),o.skipEllipticals&&(h+="|skipEllipticals"),o.skipCircles&&(h+="|skipCircles"),o.skipTriangleGeoms&&(h+="|skipTriangleGeoms"),o.useInstancing&&(h+="|useInstancing");var d=this._getMaterialHash(i,h);if(!this._materials.hasOwnProperty(d)){var p=a.Shaders,g=p.createShaderMaterial(p.LineShader);if(g.is2d=!0,g.transparent=!0,g.depthWrite=!1,g.depthTest=!1,g.side=THREE.DoubleSide,g.blending=THREE.NormalBlending,s?(g.defines.ID_COLOR=1,g.blending=THREE.NoBlending):l?(this.setSelectionTexture(g),g.defines.SELECTION_RENDERER=1,g.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):t&&t.supportsMRT()&&(g.mrtIdBuffer=this._mrtIdBuffer),o.skipEllipticals||(g.defines.HAS_ELLIPTICALS=1),o.skipCircles||(g.defines.HAS_CIRCLES=1),o.skipTriangleGeoms||(g.defines.HAS_TRIANGLE_GEOMS=1),o.useInstancing&&(g.defines.USE_INSTANCING=1),o.image&&!a.isNodeJS){var m=function(e){e.image=n(e.image),e.wrapS=THREE.ClampToEdgeWrapping,e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.LinearMipMapLinearFilter,e.magFilter=THREE.LinearFilter,e.anisotropy=1,e.flipY=!0,e.generateMipmaps=!0,e.needsUpdate=!0,g.defines.HAS_RASTER_QUADS=1,g.uniforms.tRaster.value=e,-1!=o.image.dataURI.indexOf("png")&&(g.transparent=!0),g.needsUpdate=!0,c&&c(e)};e(o.image.dataURI,THREE.UVMapping,m,u.acmSessionId)}g.modelScale=o.modelScale||1,r.addLineMaterial.call(this,d,g)}return h},this.addMaterial=function(e,t,n){var o=t.proteinMat?t.proteinMat:null,a=t.prismType&&-1!=t.prismType.indexOf("Prism");if(a&&t.transparent&&(t.side===THREE.FrontSide&&(t.side=THREE.DoubleSide),t.side===THREE.DoubleSide&&t.depthTest&&(t.twoPassTransparency=!0)),this.hasPrism=a||this.hasPrism,!n){var l=t.proteinType&&-1!=t.proteinType.indexOf("Prism");if(t.metal)t.reflectivity||(t.reflectivity=i(t.specular)),o&&(1===t.reflectivity&&(t.reflectivity=i(t.specular)),0===t.color.r&&0===t.color.g&&0===t.color.b||(t.color.r*=.1,t.color.g*=.1,t.color.b*=.1));else if(l){var c=!1;if("PrismLayered"==t.proteinType&&(t.clearcoat=!0,t.reflectivity=.06,o)){var u=o.materials[o.userassets[0]].categories;u&&u.length&&-1!=u[0].indexOf("Metal")&&(c=!0)}t.reflectivity=Math.sqrt(t.reflectivity),c?t.specular.copy(t.color):(t.specular.r=t.reflectivity,t.specular.g=t.reflectivity,t.specular.b=t.reflectivity)}else t.reflectivity?t.reflectivity>.3?(t.metal=!0,t.specular.r=t.color.r,t.specular.g=t.color.g,t.specular.b=t.color.b,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1):(t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):1!==t.color.r||1!==t.color.g||1!==t.color.b||1!==t.specular.r||1!==t.specular.g||1!==t.specular.b||t.textureMaps&&(t.textureMaps.map||t.textureMaps.specularMap)?(t.reflectivity=.01+.06*i(t.specular),t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):(t.metal=!0,t.reflectivity=.7,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1),t.opacity<1&&(t.reflectivity=1);(t.transparent||t.textureMaps&&(t.textureMaps.map&&-1!=t.textureMaps.map.uri.toLowerCase().indexOf(".png")||t.textureMaps.opacityMap))&&(t.alphaTest=.01)}if(t.textureMaps&&t.textureMaps.normalMap){var h=t.bumpScale;(void 0===h||h>=1)&&(h=1),t.normalScale=new THREE.Vector2(h,h)}else void 0===t.bumpScale&&t.textureMaps&&(t.textureMaps.map||t.textureMaps.bumpMap)?t.bumpScale=.03:t.bumpScale>=1&&(t.bumpScale=.03);void 0!==t.shininess&&(t.shininess*=.25),t.side==THREE.DoubleSide&&(s=!0),r.addHDRMaterial.call(this,e,t)},this.addMaterialNonHDR=function(e,t){r.addNonHDRMaterial.call(this,e,t)},this.togglePolygonOffset=function(e){this.forEach(function(t){t instanceof THREE.MeshPhongMaterial&&(t.polygonOffset=!0,t.polygonOffsetFactor=e?1:0,t.polygonOffsetUnits=e?.1:0,t.extraDepthOffset&&(t.polygonOffsetFactor+=t.extraDepthOffset),t.needsUpdate=!0)})},this.applyGeometryFlagsToMaterial=function(e,t){t.attributes.color&&(e.vertexColors=THREE.VertexColors,e.needsUpdate=!0),!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern&&(e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0))},this.setCubeMapFromColors=function(e,t){var i=l.CreateCubeMapFromColors(e,t);return i.isBgColor=!0,r.setReflectionMap.call(o,i),o._reflectionMap},this.setCubeMap=function(e,t,i){var n=this,o=function(e){r.setReflectionMap.call(n,e),i&&i(e)},s=function(i){i?(i.mapping=THREE.CubeReflectionMapping,i.LogLuv=-1!=e.indexOf("logluv"),i.RGBM=-1!=e.indexOf("rgbm"),l.DecodeEnvMap(i,t,!1,o)):o(i)};return Array.isArray(e)?(this._reflectionMap=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,s),this._reflectionMap.format=THREE.RGBFormat):"string"==typeof e?-1!=e.toLowerCase().indexOf(".dds")?this._reflectionMap=(new THREE.DDSLoader).load(e,s):(this._reflectionMap=THREE.ImageUtils.loadTexture(e,THREE.SphericalReflectionMapping,o),this._reflectionMap.format=THREE.RGBFormat):o(e?e:null),n._reflectionMap},this.setIrradianceMap=function(e,t,i){var n=this,s=function(e){r.setIrradianceMap.call(n,e),i&&i(e)},a=function(i){i?(i.mapping=THREE.CubeReflectionMapping,i.LogLuv=-1!=e.indexOf("logluv"),i.RGBM=-1!=e.indexOf("rgbm"),l.DecodeEnvMap(i,t,!1,s)):n._irradianceMap&&s(null)};return THREE.ImageUtils.crossOrigin="",Array.isArray(e)?(o._irradianceMap=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,s),o._irradianceMap.format=THREE.RGBFormat):"string"==typeof e?-1!=e.toLowerCase().indexOf(".dds")&&(this._irradianceMap=(new THREE.DDSLoader).load(e,a)):s(e?e:null),n._irradianceMap},this.init2DSelectionMaterial=function(e,t,i){this._selectionTex||this.initSelectionTexture(e.myData.maxObjectNumber);var n=this.create2DMaterial(e,{useInstancing:t},!1,!0,i);return this._materials[this._getMaterialHash(e,n)]},this.highlightObject2D=function(e,t){this._selectionTex.image.data[e]=t?255:0,this._selectionTex.needsUpdate=!0},this.getCutPlanes=function(){return this._cutplanes.slice()},this.getCutPlanesRaw=function(){return this._cutplanes},this.addSimpleMaterial=function(e,t,i){var n=l.MaterialConverter.convertMaterial(t),o=this._getMaterialHash(i,e);this.addMaterial(o,n),this.loadTexture(n,i)},this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.setShadowParams=function(e){this.forEach(function(t){e.apply(t)})}}function r(e){return l.hasOwnProperty("MaterialManager")||(o.prototype=new WGS.MaterialManager(e),o.prototype.constructor=o,l.MaterialManager=o),new l.MaterialManager(e)}function s(e){var t=e.clone();t.useInstancing=!0;var i=e.clone();i.wideLines=!0,e.variants=[t,i],e.getCustomOverrideMaterial=function(e){return e.useInstancing?this.variants[0]:e.wideLines?this.variants[1]:null}}var a=Autodesk.Viewing,l=a.Private;Autodesk.Viewing.Private.createMaterialManager=r,Autodesk.Viewing.Private.loadTextureWithSecurity=e,Autodesk.Viewing.Private.addInstancingSupport=s}(),function(){"use strict";function e(e,t){function i(e,t,i,n,o,r,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*r+a*o+t}var n,o,r,s,a,l,c,u,h,d=[],p=[];return n=(e.length-1)*t,o=Math.floor(n),r=n-o,d[0]=0===o?o:o-1,d[1]=o,d[2]=o>e.length-2?o:o+1,d[3]=o>e.length-3?o:o+2,l=e[d[0]],c=e[d[1]],u=e[d[2]],h=e[d[3]],s=r*r,a=r*s,p[0]=i(l[0],c[0],u[0],h[0],r,s,a),p[1]=i(l[1],c[1],u[1],h[1],r,s,a),p[2]=i(l[2],c[2],u[2],h[2],r,s,a),p}var t=Autodesk.Viewing.Private,i={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2},n=function(){this.animations=[]};n.prototype.init=function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(n=0;n<e.hierarchy[t].keys.length;n++)if(e.hierarchy[t].keys[n].time<0&&(e.hierarchy[t].keys[n].time=0),void 0!==e.hierarchy[t].keys[n].rot&&!(e.hierarchy[t].keys[n].rot instanceof THREE.Quaternion)){var i=e.hierarchy[t].keys[n].rot;Array.isArray(i)||(i=[i._x,i._y,i._z,i._w]),e.hierarchy[t].keys[n].rot=(new THREE.Quaternion).fromArray(i)}for(n=1;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time&&(e.hierarchy[t].keys.splice(n,1),n--);for(var n=0;n<e.hierarchy[t].keys.length;n++)e.hierarchy[t].keys[n].index=n}return e.initialized=!0,e},n.prototype.parse=function(e){function t(e,i){if(i.push(e),e.children&&!(e instanceof THREE.Camera))for(var n=0;n<e.children.length;n++)t(e.children[n],i)}var i=[];return t(e,i),i},n.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},n.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},n.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)};var o=function(e,t,n){this.root=e,this.handler=n.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=n.viewer,this.animator=n,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=i.LINEAR,this.setStartAndEndKeyTime()};o.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys;this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},o.prototype.keyTypes=[],o.prototype.defaultKey={},o.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},o.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},o.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},o.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause();var t=e-this.currentTime;this.update(t)},o.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={}),void 0===i.animationCache[this.data.name]&&(i.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:i.matrix});for(var n=i.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){for(var r=this.keyTypes[o],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(r,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(r,e,a.index+1);n.prevKey[r]=s,n.nextKey[r]=a}}this.setStartAndEndKeyTime()},o.prototype.getNextKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys;for(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n=n<o.length-1?n:o.length-1:n%=o.length;n<o.length;n++)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[0]},o.prototype.getPrevKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys;for(n=this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+o.length;n>=0;n--)if(void 0!==o[n][e])return o[n];return this.data.hierarchy[t].keys[o.length-1]},o.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},o.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};var r=function(e,t,i){o.call(this,e,t,i),this.localMatrix=new THREE.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform};(r.prototype=Object.create(o.prototype)).constructor=r,r.prototype.keyTypes=["pos","rot","scl"],r.prototype.defaultKey={pos:0,rot:0,scl:0},r.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Quaternion,s=new THREE.Matrix4,a=new THREE.Matrix4)}var n,o,r,s,a,l=[];return function(c){if(!1!==this.isPlaying&&(this.currentTime+=c*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var u=0,h=this.hierarchy.length;u<h;u++){for(var d=this.hierarchy[u],p=d.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var m=this.keyTypes[g],v=p.prevKey[m],f=p.nextKey[m];if(f.time<=this.currentTime||v.time>=this.currentTime){for(v=this.data.hierarchy[u].keys[0],f=this.getNextKeyWith(m,u,1);f.time<this.currentTime&&f.index>v.index;)v=f,f=this.getNextKeyWith(m,u,f.index+1);p.prevKey[m]=v,p.nextKey[m]=f}var E=v[m],A=f[m];if(f.time!==v.time&&void 0!==E&&void 0!==A){var y=(this.currentTime-v.time)/(f.time-v.time);if(y<0&&(y=0),y>1&&(y=1),"pos"===m)if(this.interpolationType===i.LINEAR)o.x=E[0]+(A[0]-E[0])*y,o.y=E[1]+(A[1]-E[1])*y,o.z=E[2]+(A[2]-E[2])*y,d.position.copy(o);else{l[0]=this.getPrevKeyWith("pos",u,v.index-1).pos,l[1]=E,l[2]=A,l[3]=this.getNextKeyWith("pos",u,f.index+1).pos;var T=e(l,y=.33*y+.33);if(o.x=T[0],o.y=T[1],o.z=T[2],d.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var w=e(l,1.01*y);n.set(w[0],w[1],w[2]),n.sub(vector),n.y=0,n.normalize();var b=Math.atan2(n.x,n.z);d.rotation.set(0,b,0)}}else"rot"===m?(THREE.Quaternion.slerp(E,A,r,y),d.quaternion.copy(r)):"scl"===m&&(o.x=E[0]+(A[0]-E[0])*y,o.y=E[1]+(A[1]-E[1])*y,o.z=E[2]+(A[2]-E[2])*y,d.scale.copy(o))}}if(!this.relativeTransform){var C=s.compose(d.position,d.quaternion,d.scale),S=a;d.getOriginalWorldMatrix(S),S.getInverse(S),s.multiplyMatrices(C,S).decompose(d.position,d.quaternion,d.scale)}d.updateAnimTransform()}}}();var s=function(e,t,i){o.call(this,e,t,i)};(s.prototype=Object.create(o.prototype)).constructor=s,s.prototype.keyTypes=["pos","up","target","fov","perspective"],s.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},s.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[];return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var a=0,l=this.hierarchy.length;a<l;a++){for(var c=this.hierarchy[a],u=c.animationCache[this.data.name],h=0;h<this.keyTypes.length;h++){var d=this.keyTypes[h],p=u.prevKey[d],g=u.nextKey[d];if(g.time<=this.currentTime||p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(d,a,1);g.time<this.currentTime&&g.index>p.index;)p=g,g=this.getNextKeyWith(d,a,g.index+1);u.prevKey[d]=p,u.nextKey[d]=g}var m=p[d],v=g[d];if(g.time!==p.time&&void 0!==m&&void 0!==v){var f=(this.currentTime-p.time)/(g.time-p.time);f<0&&(f=0),f>1&&(f=1);var E;if("pos"===d)E=c.position;else if("up"===d)E=c.up;else if("target"===d)E=c.target;else{if("fov"===d){c.setFov(m+(v-m)*f);continue}if("perspective"===d){(f>.5?v:m)?c.toPerspective():c.toOrthographic();continue}}if(this.interpolationType===i.LINEAR)o.x=m[0]+(v[0]-m[0])*f,o.y=m[1]+(v[1]-m[1])*f,o.z=m[2]+(v[2]-m[2])*f,E.copy(o);else{r[0]=this.getPrevKeyWith(d,a,p.index-1)[d],r[1]=m,r[2]=v,r[3]=this.getNextKeyWith(d,a,g.index+1)[d];var A=e(r,f=.33*f+.33);if(o.x=A[0],o.y=A[1],o.z=A[2],E.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var y=e(r,1.01*f);n.set(y[0],y[1],y[2]),n.sub(E),n.y=0,n.normalize();var T=Math.atan2(n.x,n.z);c.rotation.set(0,T,0)}}}}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0}c.lookAt(c.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();var a=function(e,t,i,n){o.call(this,e,t,n),this.nodeId=i,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(e.getMaterial()))};(a.prototype=Object.create(o.prototype)).constructor=a,a.prototype.keyTypes=["vis","opa"],a.prototype.defaultKey={viz:1,opa:1},a.prototype.update=function(){return function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++)for(var n=this.hierarchy[t],o=n.animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){var s=this.keyTypes[r],a=o.prevKey[s],l=o.nextKey[s];if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[t].keys[0],l=this.getNextKeyWith(s,t,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,t,l.index+1);o.prevKey[s]=a,o.nextKey[s]=l}var c=a[s],u=l[s];if(l.time!==a.time&&void 0!==c&&void 0!==u){var h=n.getMaterial();if("vis"===s){var d=Math.abs(this.currentTime-l.time)<this.epsilon,p=d?u:c;this.viewer.visibilityManager.setNodeOff(this.nodeId,!p)}else if("opa"===s){var g=(this.currentTime-a.time)/(l.time-a.time);g<0&&(g=0),g>1&&(g=1);var m=c+(u-c)*g;h.transparent=1!==m,h.opacity=m,m>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}();var l=function(e,t,i){var n=this;null===e&&(e=function(e,t,i){var o=n.container=document.createElement("div"),r=e.name;o.id=r,o.style.cursor="pointer",o.style.visibility=i;var s=document.createElement("div");s.id=r+"-txt",s.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(s);var a=document.createElement("img"),l=e.custom&&e.custom.att&&1===e.custom.att;a.src=l?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",a.id=r+"-img",a.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(a),t.api.container.appendChild(o),o.addEventListener("click",function(){s.style.display="none"===s.style.display?"block":"none"});var c=new THREE.SphereGeometry(.01),u=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),h=new THREE.Mesh(c,u);return h.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",h),h}(t,i.viewer,"hidden")),o.call(this,e,t,i),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(t){n.updateText(e.position,n.text)})};(l.prototype=Object.create(o.prototype)).constructor=l,l.prototype.keyTypes=["pos","text","vis"],l.prototype.defaultKey={pos:0,text:"",vis:1},l.prototype.stop=function(){o.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},l.prototype.updateText=function(e,t){var i=function(e,t,i){var n=e.clone(),o=new THREE.Matrix4;return t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),n.applyProjection(o),{x:(n.x+1)*i.width/2+i.offsetLeft,y:(1-n.y)*i.height/2+i.offsetTop}}(e,this.viewer.camera,this.viewer.canvas),n=document.getElementById(this.id+"-txt");n&&(n.innerHTML=t,n.style.left=i.x+"px",n.style.top=i.y+"px",this.text=t),(n=document.getElementById(this.id+"-img"))&&(n.style.left=i.x+"px",n.style.top=i.y-24+"px")},l.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[];return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)(w=document.getElementById(this.id))&&(w.style.visibility=this.state);else for(var a=0,l=this.hierarchy.length;a<l;a++){for(var c=this.hierarchy[a],u=c.animationCache[this.data.name],h=0;h<this.keyTypes.length;h++){var d=this.keyTypes[h],p=u.prevKey[d],g=u.nextKey[d];if(g.time<=this.currentTime||p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],g=this.getNextKeyWith(d,a,1);g.time<this.currentTime&&g.index>p.index;)p=g,g=this.getNextKeyWith(d,a,g.index+1);u.prevKey[d]=p,u.nextKey[d]=g}var m=p[d],v=g[d];if(g.time!==p.time&&void 0!==m&&void 0!==v){var f=(this.currentTime-p.time)/(g.time-p.time);if(f<0&&(f=0),f>1&&(f=1),"pos"===d){if(this.interpolationType===i.LINEAR)o.x=m[0]+(v[0]-m[0])*f,o.y=m[1]+(v[1]-m[1])*f,o.z=m[2]+(v[2]-m[2])*f,c.position.copy(o);else if(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD){r[0]=this.getPrevKeyWith("pos",a,p.index-1).pos,r[1]=m,r[2]=v,r[3]=this.getNextKeyWith("pos",a,g.index+1).pos;var E=e(r,f=.33*f+.33);if(o.x=E[0],o.y=E[1],o.z=E[2],c.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var A=e(r,1.01*f);n.set(A[0],A[1],A[2]),n.sub(vector),n.y=0,n.normalize();var y=Math.atan2(n.x,n.z);c.rotation.set(0,y,0)}}}else if("text"===d){var T=Math.abs(this.currentTime-g.time)<this.epsilon?v:m;this.updateText(c.position,T)}else if("vis"===d){var w=document.getElementById(this.id);if(w){var b=Math.abs(this.currentTime-g.time)<this.epsilon?v:m;w.style.visibility=b?"visible":"hidden"}}}}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0}}}();var c=function(e,t,i){this.viewer=i.viewer,null===e&&(e=this.createPolyline([])),o.call(this,e,t,i),this.epsilon=.1};(c.prototype=Object.create(o.prototype)).constructor=c,c.prototype.keyTypes=["points","vis"],c.prototype.defaultKey={points:[],vis:1},c.prototype.stop=function(){o.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},c.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)e(this);else for(var i=0,n=this.hierarchy.length;i<n;i++)for(var o=this.hierarchy[i].animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){var s=this.keyTypes[r],a=o.prevKey[s],l=o.nextKey[s];if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[i].keys[0],l=this.getNextKeyWith(s,i,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,i,l.index+1);o.prevKey[s]=a,o.nextKey[s]=l}var c=a[s],u=l[s];if(l.time!==a.time&&void 0!==c&&void 0!==u){var h=(this.currentTime-a.time)/(l.time-a.time);if(h<0&&(h=0),h>1&&(h=1),"points"===s){var d=h<.5?c:u;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var p=[],g=0;g<d.length;g++){var m=d[g].slice();if(0===g)m[0]=c[g][0]+(u[g][0]-c[g][0])*h,m[1]=c[g][1]+(u[g][1]-c[g][1])*h,m[2]=c[g][2]+(u[g][2]-c[g][2])*h;else if(g===d.length-1){var v=c.length-1,f=u.length-1;m[0]=c[v][0]+(u[f][0]-c[v][0])*h,m[1]=c[v][1]+(u[f][1]-c[v][1])*h,m[2]=c[v][2]+(u[f][2]-c[v][2])*h}var E=new THREE.Vector3(m[0],m[1],m[2]);p.push(E)}this.root=this.createPolyline(p)}else if("vis"===s){var A=Math.abs(this.currentTime-l.time)<this.epsilon?u:c;this.root.visible=A,A||e(this)}}}}}(),c.prototype.createPolyline=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(e[i]);t.computeLineDistances();var n=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),o=new THREE.Line(t,n,THREE.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",o),o},t.Animation=o,t.AnimationHandler=n,t.MeshAnimation=r,t.CameraAnimation=s,t.PolylineAnimation=c,t.VisibilityAnimation=a,t.AnnotationAnimation=l}(),function(){"use strict";var e=Autodesk.Viewing.Private,t=function(e,t){this.animations=[],this.viewer=e,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2};t.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},t.prototype.add=function(t){if(!(!t.hierarchy||t.hierarchy.length<1||!t.hierarchy[0].keys||t.hierarchy[0].keys.length<2)){var i=null,n=this;if("camera"===t.type?(i=new e.CameraAnimation(n.viewer.camera,t,n),n.animations.push(i)):"annotation"===t.type?(i=new e.AnnotationAnimation(null,t,n),n.animations.push(i)):"polyline"===t.type?(i=new e.PolylineAnimation(null,t,n),n.animations.push(i)):"mesh"!==t.type&&"visibility"!==t.type||n.viewer.model.getData().instanceTree.enumNodeFragments(t.id,function(o){var r=n.viewer.getFragmentProxy(n.viewer.model,o);r&&(i="mesh"===t.type?new e.MeshAnimation(r,t,n):new e.VisibilityAnimation(r,t,t.id,n),n.animations.push(i))},!0),i){for(var o=0,r=t.hierarchy.length;o<r;o++)for(var s=t.hierarchy[o].keys,a=0;a<s.length;a++)void 0===s[a].xk&&n.keys.push(s[a].time);!function(e){e.sort(function(e,t){return e-t}),function(e,t,i){for(t=e.length;i=--t;)for(;i--;)e[t]!==e[i]||e.splice(i,1)}(e)}(n.keys)}this.updateFlag|=this.UPDATE_SCENE}},t.prototype.update=function(e){this.animationHandler.update(e);var t=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),t|=this.UPDATE_SCENE),this.updateFlag=0,t},t.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)this.pause();else{for(var i=0;i<this.animations.length;i++)this.animations[i].play(e);this.isPlaying=!0,this.isPaused=!1}},t.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},t.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e];t instanceof Autodesk.Viewing.Private.CameraAnimation&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},t.prototype.stop=function(){for(var e=0;e<this.animations.length;e++)this.animations[e].stop();this.isPlaying=!1,this.isPaused=!1},t.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++)this.animations[t].goto(e);this.isPlaying=!0,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},t.prototype.next=function(){var e=function(e,t){for(var i=-1,n=0;n<t.length;n++)if(t[n]>e){i=t[n];break}return i<0?t[t.length-1]:i}(this.currentTime,this.keys);this.goto(e)},t.prototype.prev=function(){var e=function(e,t){for(var i=-1,n=t.length-1;n>-1;n--)if(t[n]<e){i=t[n];break}return i<0?t[0]:i}(this.currentTime,this.keys);this.goto(e)},e.KeyFrameAnimator=t}();var av=Autodesk.Viewing,ENABLE_DEBUG=(avp=Autodesk.Viewing.Private).ENABLE_DEBUG||!0,ENABLE_TRACE=avp.ENABLE_TRACE||!0;!function(){"use strict";function e(e,t){function i(e){if(!e)return null;var t=window.devicePixelRatio;t||(t=1);var i=av.InitParametersSetting;i.canvas=e,i.devicePixelRatio=t;var n=new avp.FireflyWebGLRenderer(i);return n.context?(n.autoClear=!1,n.sortObjects=!1,n):null}function n(e){var t=O,i=t==avp.RENDER_NORMAL,n=k.settings.idbuffer&&t!=avp.RENDER_HIDDEN;t==avp.RENDER_HIDDEN?e.overrideMaterial=I.fadeMaterial:t==avp.RENDER_HIGHLIGHTED&&(e.overrideMaterial=I.highlightMaterial),k.renderScenePart(e,!0,i,n),e.overrideMaterial=null}function o(e){ee++,J>0&&($=.8*$+.2*(e-J)),I.fpsCallback&&I.fpsCallback(I.fps())}function r(e){if(I.keyFrameAnimator){var t=J>0?(e-J)/1e3:0,i=I.keyFrameAnimator.update(t);if(i&&(I.sceneUpdated(!0),i&I.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function s(){T&&(I.camera.aspect=w/b,I.camera.clientWidth=w,I.camera.clientHeight=b,k.setSize(w,b),I.controls.handleResize(),P&&P.setSize(w,b),I.invalidate(!0,!0,!0),T=!1,I.api.fireEvent({type:av.VIEWER_RESIZE_EVENT,width:w,height:b}))}function a(){if((R.enabled||P)&&!I.is2d){var e;if(e=I.model&&!I.model.isLoadDone()?I.model.getData().bbox:I.getVisibleBounds(!0,!1)){R.needClear=!0;var t=I.camera,i=e.clone(),n=new THREE.Vector3(1,0,0),o=U.clone();t.worldUpTransform&&(i.applyMatrix4(t.worldUpTransform),n.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),i.min.y-=.005*(i.max.y-i.min.y),M&&M.expandByGroundShadow(i,o);var r=i.size(),s=i.center();if(M||(r.x*=1.25,r.z*=1.25,r.x=r.z=Math.max(r.x,r.z)),t.worldUpTransform){var a=(new THREE.Matrix4).getInverse(t.worldUpTransform);s.applyMatrix4(a)}if(R.setTransform(s,r,t.worldup,n),P){var l=(new THREE.Vector3).subVectors(s,t.worldup.clone().multiplyScalar(r.y/2));P.setTransform(l,t.worldup,r)}M&&M.setGroundShadowTransform(s,r,t.worldup,n)}}}function l(e){q&&(a(),q=!1)}function c(e){for(var t in I.selectionMeshes){var i=I.selectionMeshes[t];if(i.model){var n=i.model.getFragmentList();i.geometry===n.getGeometry(i.fragId)&&n.getWorldMatrix(i.fragId,i.matrix)}}}function u(){M&&(M.state=avp.SHADOWMAP_NEEDS_UPDATE)}function h(e){if(!M||!I)return e;var t=W||G;if(O==avp.RENDER_SHADOWMAP){if(t)return O=avp.RENDER_FINISHED,e;e=M.continueUpdate(V,e,C),M.state==avp.SHADOWMAP_VALID&&(O=avp.RENDER_FINISHED,G=!0,W=!0)}return M.state==avp.SHADOWMAP_NEEDS_UPDATE?e=M.startUpdate(V,e,I.camera,U,C):t||O==avp.RENDER_FINISHED&&M.state==avp.SHADOWMAP_INCOMPLETE&&(e=M.startUpdate(V,e,I.camera,U,C),O=avp.RENDER_SHADOWMAP),e}function d(e){var t=C.updateMaterials();I.invalidate(t.needsClear,t.needsRender,t.overlayDirty);var i=r(e),a=I.controls.update(e),u=V&&V.update(e),d=a||i||x||u,p=T;T&&s(),G=G||d,(j=j||d)&&c(e),j=j||k.overlayUpdate(e);var g=I.model&&(I.model.isLoadDone()||!0===I.model.myData.partPacksLoadDone),m=I.progressiveRender?I.targetFrameBudget:1e10,v=m,f=V;if(q&&l(e),v=h(v),!M||O!=avp.RENDER_SHADOWMAP){var E=!1;!R||I.is2d||te||(E=R.prepareGroundShadow(I));var A=G,y=V.frameResumePossible();(G=G||!y)||W?(d&&I.skipAOWhenMoving&&k.settings.sao&&!ne&&(k.setAOEnabled(!1),ne=!0),g&&I.signalProgress(0,av.ProgressState.RENDERING),Q>0&&(Z=.75*Z+.25*(e-Q)),Q=e,Z<D&&m<N?I.targetFrameBudget+=1:Z>D&&m>L&&(I.targetFrameBudget-=1),I.updateCameraMatrices(),k.beginScene(I.scene,I.camera,I.lightsOn?I.lights:I.no_lights,G),(d||p)&&I.api.fireEvent(I.cameraChangedEvent),E&&!P&&I.renderGroundShadow(),f&&(O=f.hasHighlighted()?avp.RENDER_HIGHLIGHTED:avp.RENDER_NORMAL,f.reset(I.camera,O,A))):Q=-1,!P||I.is2d||te||P.prepareGroundReflection(I,R,G)&&V.isDone()&&I.showGhosting&&!V.areAllVisible()&&(O=avp.RENDER_HIDDEN,V.reset(I.camera,O));var w=!1;f.isEmpty()||f.isDone()||(w=!0,v=f.renderSome(n,v),f.isDone()&&O===avp.RENDER_HIGHLIGHTED&&(O=avp.RENDER_NORMAL,f.reset(I.camera,O),v=f.renderSome(n,v)),f.isDone()?(O===avp.RENDER_NORMAL&&!f.areAllVisible()&&I.showGhosting?P&&!P.finished||(O=avp.RENDER_HIDDEN,f.reset(I.camera,O),v=f.renderSome(n,v)):(O=avp.RENDER_FINISHED,k.renderScenePart(I.sceneAfter,!0,!0,!0)),g&&I.signalProgress(100,av.ProgressState.RENDERING)):g&&I.signalProgress(100*f.getRenderProgress(),av.ProgressState.RENDERING),o(e)),j&&(w=!0,k.renderScenePart(I.sceneAfter,!0,!0,!0),!f.isEmpty()&&f.isDone()||I.showOverlaysWhileMoving?(I.renderOverlays(),f.isEmpty()||f.isDone()||(j=!0)):k.clearAllOverlays());var b=!0;I.skipAOWhenMoving&&(d||!f.isDone()?b=!1:B&&(w=!0,ne&&(oe=!0))),f.enableNonResumableFrames&&O!==avp.RENDER_FINISHED&&!d&&(w=!1),w&&k.composeFinalFrame(!b),X!==w&&(X=w,I.api.fireEvent({type:av.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!w}})),B=d,J=e,f&&f.needsRender()?(W=!0,f.resetNeedsRender()):W=!1,G=!1,x=!1,oe&&(oe=!1,k.setAOEnabled(!0),ne=!1,I.invalidate(!0,!0))}}function p(){for(var e in I.selectionMeshes){var t=I.selectionMeshes[e];t.model&&t.model.isConsolidated()&&t.model.updateRenderProxy(t,t.fragId)}}function g(e){function t(){if(i.animations){I.keyFrameAnimator=new avp.KeyFrameAnimator(I,i.animations.duration);for(var e in i.animations.animations)I.keyFrameAnimator.add(i.animations.animations[e]);I.keyFrameAnimator.goto(0),I.api.fireEvent({type:av.ANIMATION_READY_EVENT})}I.api.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}var i=e.getData();e.isObjectTreeCreated()?t():I.api.addEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}function m(e,t){ue=ue||new THREE.Box3,t.updateMatrixWorld(!0),t.traverse(function(t){var i=t.geometry;void 0!==i&&i.visible&&(i.boundingBox||i.computeBoundingBox(),ue.copy(i.boundingBox),ue.applyMatrix4(t.matrixWorld),e.union(ue))})}function v(){var e=new THREE.Box3,t=I.overlayScenes;for(var i in t)t.hasOwnProperty(i)&&m(e,t[i].scene);return m(e,I.scene),e}function f(e){var t,i,n;if(-1==e.indexOf(";base64,"))return t=e.split(","),i=t[0].split(":")[1],n=decodeURIComponent(t[1]),new Blob([n],{type:i});i=(t=e.split(";base64,"))[0].split(":")[1];for(var o=(n=window.atob(t[1])).length,r=new Uint8Array(o),s=0;s<o;++s)r[s]=n.charCodeAt(s);return new Blob([r],{type:i})}function E(e){this.bounds=e,this.point=new THREE.Vector4,this.point.z=0,this.point.w=1}var A,y,T,w,b,C,S,k,M,x,R,P,V,I=this,N=1e3/15,D=1e3/30,L=1e3/120,O=avp.RENDER_NORMAL,_=-1,H=-1,B=!1,F="y",z=null,U=null,G=!1,W=!1,j=!1,Y={type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,state:Autodesk.Viewing.ProgressState.LOADING,percent:0},q=!1,X=!1,K=0,Q=0,Z=0,J=0,$=1e3/60,ee=0,te=!0,ie=!1,ne=!1,oe=!1,re=!1,se=null,ae=null,le=av.getGlobal();e&&setInterval(function(){te||ee<60||I.track({name:"fps",value:Number(I.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=t,this.canvas=e,this.loader=null,this.initialize=function(){if(A=new THREE.Vector3(0,1,0),V=new avp.RenderScene,(S=i(e))||av.isNodeJS){(k=new avp.RenderContext).init(S,e?e.clientWidth:0,e?e.clientHeight:0),this.use2dInstancing=av.isMobileDevice()&&this.glrenderer().supportsInstancedArrays(),C=new avp.createMaterialManager(S),avp.init_UnifiedCamera(THREE),this.camera=new av.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],se=(new THREE.Color).setRGB(1,1,1),ae=(new THREE.Color).setRGB(1,1,1),this.cameraChangedEvent=this.camera.getCameraChangedEvent(),z=new THREE.Vector3(1,1,1),U=(new THREE.Vector3).copy(z),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,ce("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,avp.addInstancingSupport(this.fadeMaterial),C.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,avp.addInstancingSupport(this.highlightMaterial),C.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=D,av.isMobileDevice()&&(N*=2,L/=2,D*=2,this.targetFrameBudget/=2),this.controls={update:function(e){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new avp.MultiModelSelector(this),this.visibilityManager=new avp.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0;var t=avp.LightPresets[avp.DefaultLightPreset].bgColorGradient;this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),(R=new av.Shaders.GroundShadow(S)).enabled=!0,C.addMaterialNonHDR("groundShadowDepthMaterial",R.getDepthMaterial()),C.addOverrideMaterial("normalsMaterial",k.getDepthMaterial()),k.beginScene(this.scene,this.camera,this.noLights,!0),k.composeFinalFrame(!0,av.isIE11)}},this.renderGroundShadow=function(e){M?M.state==avp.SHADOWMAP_VALID&&M.renderGroundShadow(I.camera,e||k.getColorTarget()):(R.renderShadow(I.camera,e||k.getColorTarget()),R.rendered=!0)},this.setLmvDisplay=function(e){le=e},this.run=function(){y=0,setTimeout(function(){!function e(t){y=le.requestAnimationFrame(e),d(t)}()},1)},this.toggleProgressive=function(e){this.progressiveRender=e,G=!0},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,k.toggleSwapBlackAndWhite(e),G=!0},this.toggleGhosting=function(e){this.showGhosting=e,G=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){k.initPostPipeline(e,t),this.fireRenderOptionChanged(),G=!0},this.toggleCelShading=function(e){k.toggleCelShading(e),this.fireRenderOptionChanged(),G=!0},this.toggleGroundShadow=function(e){R.enabled!==e&&(R.enabled=e,R.clear(),a(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(e){R.enabled&&(R.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){R.enabled&&(R.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&P||!e&&!P||(e?((P=new av.Shaders.GroundReflection(S,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:k.getClearPass()})).setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),P.toggleEnvMapBackground(ie),P.setEnvRotation(k.getEnvRotation()),a()):(P.cleanup(),P=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){P&&(P.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){P&&(P.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){ie=e,k.toggleEnvMapBackground(e),P&&P.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return ie},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){p();var e=this.lightsOn;e||this.toggleLights(!0,!0);var t;this.dir_light1&&(t=this.dir_light1.intensity,this.dir_light1.intensity=1),k.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),e||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=t),j=!1},this.setLayerVisible=function(e,t){this.matman().setLayerVisible(e,t),this.invalidate(!0)},this.isLayerVisible=function(e){return this.matman().isLayerVisible(e)},this.getVisibleLayerIds=function(){var e=this.model.getData().layersMap,t=[];for(var i in e)this.isLayerVisible(i)&&t.push(e[i]);return t},this.updateCameraMatrices=function(){function e(){t=new THREE.Matrix4,i=new THREE.Matrix4,n=new THREE.Box3}var t,i,n;return function(){n||e();var o=this.camera;if(t.compose(o.position,o.quaternion,o.scale),i.getInverse(t),o.worldup&&this.setWorldUp(o.worldup),this.model){var r=this.getVisibleBounds(!0,j);if(n.copy(r),P){var s=new THREE.Vector3;s.multiplyVectors(n.max,o.worldup);var a=new THREE.Vector3;a.multiplyVectors(n.min,o.worldup),s.sub(a),s.x>=0?n.min.x-=s.x:n.max.x-=s.x,s.y>=0?n.min.y-=s.y:n.max.y-=s.y,s.z>=0?n.min.z-=s.z:n.max.z-=s.z}M&&M.groundShapeBox&&n.union(M.groundShapeBox),n.applyMatrix4(i);var l=1e-5*(n.max.z-n.min.z),c=.5*(n.max.y-n.min.y),u=-(n.max.z+l)-c,h=-(n.min.z-l)+c;o.isPerspective&&(u=Math.max(u,Math.min(1,1e-4*Math.abs(h-u)))),h=Math.max(h,u),o.near=u,o.far=h,o.updateProjectionMatrix();var d;if(this.model.is2d()){var p=this.intersectGroundViewport(new THREE.Vector3(0,0,1));d=p?o.position.distanceTo(p):o.position.distanceTo(r.center());y=k.settings.deviceHeight/(2*d*Math.tan(THREE.Math.degToRad(.5*o.fov)));C.updatePixelScale(y),C.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var g,m=C.getCutPlanesRaw();if(m&&m.length){var v=m[0],f=o.target.clone().sub(o.position).normalize(),E=f.dot(v);if(0===E)g=r.center();else{var A=-(o.position.clone().dot(v)+v.w)/E;g=r.clampPoint(f.multiplyScalar(A).add(o.position))}}else g=r.center();d=o.position.distanceTo(g);var y=k.settings.deviceHeight/(2*d*Math.tan(THREE.Math.degToRad(.5*o.fov)));C.updatePixelScale(y)}}}}(),this.initLights=function(){this.dir_light1=new THREE.DirectionalLight(se,1),this.dir_light1.position.set(-1,0,1),this.amb_light=new THREE.AmbientLight(ae),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),re=!0},this.toggleLights=function(e,t){if(this.amb_light){this.lightsOn=e;var i=avp.LightPresets[_],n=i.ambientColor,o=i.directLightColor;n=n||ae.toArray(),o=o||se.toArray(),this.lightsOn?(t&&this.amb_light?this.amb_light.color.setRGB(.5*o[0],.5*o[1],.5*o[2]):this.amb_light&&this.amb_light.color.setRGB(n[0],n[1],n[2]),this.dir_light1&&this.dir_light1.color.setRGB(o[0],o[1],o[2])):this.amb_light&&t&&this.amb_light.color.setRGB(n[0],n[1],n[2])}},this.syncCamera=function(e){this.camera.updateProjectionMatrix(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),x=!0},this.setViewFromFile=function(e,t){var i,n=e.getDefaultCamera();if(n)i=n;else{i={};var o=e.getBoundingBox(),r=o.size();if(i.target=o.center(),e.is2d()){i.isPerspective=!1;var s=r.x/r.y,a=this.camera.aspect;i.orthoScale=a>s?r.y:r.x/a,i.up=new THREE.Vector3(0,0,1),i.position=i.target.clone(),i.position.z+=i.orthoScale,i.target.y+=1e-6*r.y}else i.isPerspective=!0,i.fov=this.camera.fov,i.up=this.camera.up.clone(),i.position=i.target.clone(),i.position.z+=1.5*Math.max(r.x,r.y,r.z)}this.setViewFromCamera(i,t)},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),i=t.size(),n=e.target.clone().sub(e.position),o=n.length();if(o>1e3*i.length()){var r=e.position.distanceTo(t.center());e.target.copy(e.position).add(n.normalize().multiplyScalar(r))}else Math.abs(o-e.orthoScale)/o>1e-5&&(avp.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?"),!(0===e.fov&&1===e.orthoScale)&&e.position.copy(e.target).add(n.normalize().multiplyScalar(-e.orthoScale)))}},this.setViewFromCamera=function(e,t){this.adjustOrthoCamera(e);var i=this.controls.isToolActivated("freeorbit"),n=this.model?this.model.getUpVector():null;this.model&&-1!=this.model.getData().basePath.indexOf("SaRang")&&(n=[0,0,1]);var o;o=n?(new THREE.Vector3).fromArray(n):i?e.up.clone():av.Navigation.snapToAxis(e.up.clone()),i?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",o.equals(e.up)):e.up=o;var r=this.api.navigation;if(r){var s=this.camera;if(t)s.up.copy(e.up),s.position.copy(e.position),s.target.copy(e.target),e.isPerspective?s.fov=e.fov:(s.saveFov=e.fov,s.fov=av.UnifiedCamera.ORTHO_FOV),s.isPerspective=e.isPerspective,s.orthoScale=e.orthoScale,s.dirty=!0,r.setWorldUpVector(i?o:s.up),r.setView(s.position,s.target),r.setPivotPoint(s.target),this.syncCamera(!0);else if(s.isPerspective=e.isPerspective,e.isPerspective||(s.saveFov=e.fov,e.fov=av.UnifiedCamera.ORTHO_FOV),i)r.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,o);else{var a=r.computeOrthogonalUp(e.position,e.target);r.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,a,o)}}x=!0},this.setViewFromViewBox=function(e,t,i,n){if(e.is2d()){var o={},r=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;a>s.aspect?o.orthoScale=s.height:o.orthoScale=s.width/a,o.isPerspective=!1,o.position=new THREE.Vector3(s.centerX,s.centerY,r.center().z+o.orthoScale),o.target=new THREE.Vector3(s.centerX,s.centerY,r.center().z),o.target.y+=1e-6*s.height,o.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(o,n)}},this.setWorldUp=function(e){if(!A.equals(e)){A.copy(e);var t=Math.abs(e.x);F="x",Math.abs(e.y)>t&&(F="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(F="z");var i=new THREE.Vector3(0,1,0);I.camera.worldUpTransform=function(e,t){var i=(new THREE.Vector3).crossVectors(t,e).normalize(),n=Math.acos(e.dot(t));return(new THREE.Matrix4).makeRotationAxis(i,n)}(i,e),this.sceneUpdated(!1)}},this.addModel=function(e){if(e){var t=!!this.model,i=e.is2d(),n=0;if(this.model||(this.model=e,k.setUnitScale(e.getUnitScale()),n=e.getData().bbox.size().length()),V.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),i){var o=e.getData();C.initLayersTexture(o.layerCount,o.layersMap);var r=C.create2DMaterial(e,{useInstancing:this.use2dInstancing},!0,!1,function(){I.invalidate(!1,!0,!1)}),s=C.findMaterial(e,r);if(k.enter2DMode(s),!t){this.is2d=!0,H=_,this.setLightPreset(avp.DefaultLightPreset2d);var a=e.getData();if(a.hidePaper){var l=a.bgColor,c=l>>16&255,u=l>>8&255,h=255&l;this.setClearColors(c,u,h,c,u,h)}}}if(this.api.navigation){this.api.navigation.setIs2D(i&&!t),this.api.setActiveNavigationTool();var d=e.getData();d.isLeaflet?this.api.navigation.setConstraints2D(d.bbox,d.maxPixelPerUnit):this.api.navigation.setConstraints2D()}t||e.getData().loadOptions.preserveView||(this.setViewFromFile(e,!0),this.controls.recordHomeView()),i||this.setLightPresetFromFile(e)||(H>=0?(this.setLightPreset(H,!0),H=-1):this.setLightPreset(_,!1)),n>0&&k.setAOOptions(Math.min(10,.05*n)),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return C},this.setupMesh=function(e,t,i,n){var o=e.getData(),r={geometry:t,matrix:n,isLine:t.isLines,isWideLine:t.isWideLines,isPoint:t.isPoints,is2d:t.is2d};if(t.isLines||t.isPoints){var s,a=!!t.attributes.color,l=C.findMaterial(e,i);t.isPoints?s=new THREE.PointCloudMaterial({vertexColors:a,size:t.pointSize}):t.isWideLines?((s=new THREE.MeshBasicMaterial({vertexColors:a})).wideLines=!0,t.isLines=!1,r.isLine=!1,s.polygonOffset=l.polygonOffset,s.polygonOffsetFactor=l.polygonOffsetFactor,s.polygonOffsetUnits=l.polygonOffsetUnits):s=new THREE.LineBasicMaterial({vertexColors:a}),a||(s.color=l.color),s.svfMatId=i,C.addMaterialNonHDR(o.basePath+i+"_line_"+s.id,s),r.material=s,o.hasLines=!0}else(s=C.findMaterial(e,i))&&(s.svfMatId=i),C.applyGeometryFlagsToMaterial(s,t),r.material=s;return r},this.onDemandLoadComplete=function(e){te=!1,this.signalProgress(100,av.ProgressState.LOADING),this.invalidate(!1,!0),this.is2d&&(this.selectionMaterial2d=C.init2DSelectionMaterial(e,this.use2dInstancing,function(){I.invalidate(!1,!0,!1)}),this.createOverlayScene("selection2d",this.selectionMaterial2d)),e.getData().hasLines&&C.togglePolygonOffset(!0),g(e),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e,onDemandLoad:!0})},this.onLoadComplete=function(e){te=!1,this.signalProgress(100,av.ProgressState.LOADING),this.sceneUpdated(!1),this.is2d&&(this.selectionMaterial2d=C.init2DSelectionMaterial(e,this.use2dInstancing,function(){I.invalidate(!1,!0,!1)}),this.createOverlayScene("selection2d",this.selectionMaterial2d));var t=e.getData();V.getGeometryList()&&V.getGeometryList().printStats(),t.hasLines&&C.togglePolygonOffset(!0),g(e),e.hasGeometry()||avp.logger.warn("Loaded model has not geometry."),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e})},this.signalProgress=function(e,t){Y.percent===e&&Y.state===t||(Y.percent=e,Y.state=t,this.api.fireEvent(Y))},this.resize=function(e,t){T=!0,w=e,b=t},this.unloadModel=function(e){this.removeModel(e)&&e.loader&&e.loader.dtor()},this._addLoadingFile=function(e){this.loaders||(this.loaders=[]),this.loaders.push(e)},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e);t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!V.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),e.dtor(this.glrenderer()),C.cleanup(e),this.selector.removeModel(e),this.visibilityManager.removeModel(e),e===this.model&&(this.model=null,V.isEmpty()||(this.model=V.getModels()[0])),this.api.fireEvent({type:av.MODEL_UNLOADED_EVENT,model:e}),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),k.exit2DMode(),_=H),k.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),k.composeFinalFrame(!0),this.loaders&&(this.loaders.forEach(function(e){e.dtor()}),this.loaders=[]);for(var e=V.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t])};var ce=function(e,t,i){t.depthWrite=!1,t.depthTest=!0,t.side=THREE.DoubleSide,i.depthWrite=!1,i.depthTest=!0,i.side=THREE.DoubleSide,avp.addInstancingSupport(t),avp.addInstancingSupport(i),I.createOverlayScene(e,t,i)};this.createOverlayScene=function(e,t,i,n){t&&C.addOverrideMaterial(e+"_pre",t),i&&C.addOverrideMaterial(e+"_post",i);var o=new THREE.Scene;o.__lights=this.scene.__lights,this.overlayScenes[e]={scene:o,camera:n,materialPre:t,materialPost:i}},this.removeOverlayScene=function(e){this.overlayScenes[e]&&(delete this.overlayScenes[e],this.invalidate(!1,!1,!0))},this.addOverlay=function(e,t){this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.removeOverlay(e,t[i])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,i,n=this.overlayScenes[e].scene;for(i=n.children.length-1;i>=0;--i)(t=n.children[i])&&n.remove(t);this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,n,o,r){if(this.clearColorTop=new THREE.Vector3(e/255,t/255,i/255),this.clearColorBottom=new THREE.Vector3(n/255,o/255,r/255),!C._reflectionMap||C._reflectionMap.isBgColor){var s=C.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);k.setCubeMap(s),this.invalidate(!0)}k.setClearColors(this.clearColorTop,this.clearColorBottom),P&&P.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),G=!0,this.fireRenderOptionChanged()};var ue;this.getVisibleBounds=function(e,t){var i=new THREE.Box3;return V.isEmpty()||(m(i,this.scene),i=V.getVisibleBounds(e).union(i),t&&(i=v().union(i))),i},this.getFitBounds=function(e){var t;return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.empty()||(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.promiseRenderProxy=function(e,t){var i=e.getFragmentList().promiseVizmesh(t);return i.lmv_model=e,i},this.cancelPromisedRenderProxy=function(e){return!!e.lmv_model&&e.lmv_model.getFragmentList().cancelPromisedVizmesh(e)},this.getFragmentProxy=function(e,t){return new avp.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(e){return!V||V.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,i,n){e.is2d()&&(C.highlightObject2D(t,i),this.invalidate(!1,!1,!0));var o=this,r=e.getData().instanceTree;if(r&&!e.is2d())r.enumNodeFragments(t,function(t){o.highlightFragment(e,t,i,n)},!1);else{var s=t;if(e.is2d()&&(s=e.getData().fragments.dbId2fragId[t]),Array.isArray(s))for(var a=0;a<s.length;a++)o.highlightFragment(e,s[a],i,n);else o.highlightFragment(e,s,i,n)}},this.highlightFragment=function(e,t,i,n){var o=this.getRenderProxy(e,t);if(o){var r=!n||o.is2d||o.isPoint,s=e.id+":"+t;if(r){var a="selection";if(e.is2d()&&(a+="2d"),o.isPoint&&(a+="_points"),i){var l=this.promiseRenderProxy(e,t),c=this;this.selectionMeshes[s]=l,l.then(function(i){var n,o=c.getRenderProxy(i.model,i.fragId);if(o&&o.geometry){if(o.isPoint){var r=o.material.clone();r.color=c.selectionMaterialBase.color,r.needsUpdate=!0,n=new THREE.Mesh(o.geometry,r)}else n=new THREE.Mesh(o.geometry,o.material);n.matrix.copy(o.matrixWorld),n.matrixAutoUpdate=!1,n.matrixWorldNeedsUpdate=!0,n.frustumCulled=!1,n.model=e,n.fragId=t,i.model.getFragmentList().lockGeometry(t),c.addOverlay(a,n),c.selectionMeshes[s]=n}}).catch(function(e){e.canceled||delete c.selectionMeshes[s]})}else if(this.selectionMeshes.hasOwnProperty(s)){var u=this.selectionMeshes[s];u instanceof Promise?this.cancelPromisedRenderProxy(u):(e.getFragmentList().unlockGeometry(t),this.removeOverlay(a,u)),delete this.selectionMeshes[s]}}r&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){e!=K&&(K=e,V.explode(e),this.sceneUpdated(!0),this.api.fireEvent({type:av.EXPLODE_CHANGE_EVENT,scale:e}))},this.getExplodeScale=function(){return K},this.setGhostingBrightness=function(e){this.fadeMaterial.color=e?new THREE.Color(1052688):new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.setLightPreset=function(e,t){if(re||this.initLights(),_!=e||t){(e<0||avp.LightPresets.length<=e)&&(e=avp.DefaultLightPreset),_=e;var i=avp.LightPresets[e];if(i&&i.path){var n="res/environments/"+i.path,o=avp.getResourceUrl(n+"_mipdrop."+(i.type||"")+".dds"),r=avp.getResourceUrl(n+"_irr."+(i.type||"")+".dds"),s=(C.setIrradianceMap(r,i.E_bias,function(){I.invalidate(!0)}),C.setCubeMap(o,i.E_bias,function(e){I.invalidate(!0),e||C.setCubeMapFromColors(I.clearColorTop,I.clearColorBottom)}));k.setCubeMap(s),C.setEnvExposure(-i.E_bias),k.setEnvExposure(-i.E_bias),this.setTonemapExposureBias(i.E_bias),this.setTonemapMethod(i.tonemap),this.setGhostingBrightness(i.darkerFade)}else{C.setIrradianceMap(null);s=C.setCubeMap(null);k.setCubeMap(s),C.setEnvExposure(0),k.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1),this.invalidate(!0)}var a=av.Shaders.SAOShader.uniforms.radius.value,l=av.Shaders.SAOShader.uniforms.intensity.value;i.hasOwnProperty("saoRadius")&&(a=i.saoRadius),i.hasOwnProperty("saoIntensity")&&(l=i.saoIntensity),k.setAOOptions(a,l);var c=i.bgColorGradient;c||(c=avp.BackgroundPresets.Custom),this.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5]);var h=1;null!==i.lightMultiplier&&void 0!==i.lightMultiplier&&(h=i.lightMultiplier),U.copy(z),i.lightDirection&&U.fromArray(i.lightDirection).negate(),M&&u(),this.dir_light1&&(this.dir_light1.intensity=h,i.lightDirection&&this.dir_light1.position.set(-i.lightDirection[0],-i.lightDirection[1],-i.lightDirection[2])),C.setEnvRotation(i.rotation||0),k.setEnvRotation(i.rotation||0),P&&P.setEnvRotation(i.rotation||0),this.toggleLights(0!==h),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;var t=e.getMetadata("renderEnvironmentStyle","value",null);if(null===t||""===t)return!1;var i=e.getMetadata("renderEnvironmentGroundReflection","value",null);null!==i&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(i)));var n=e.getMetadata("renderEnvironmentGroundShadow","value",null);null!==n&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(n)));var o=e.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==o&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(o,k.getAntialiasing())));var r=e.getMetadata("renderEnvironmentDisplayLines","value",null);null!==r&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!r)));var s=e.getMetadata("renderEnvironmentDisplayPoints","value",null);null!==s&&(this.api.prefs.hasTag("pointRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): pointRendering is locked. No changes."):(this.api.prefs.tag("no-storage","pointRendering"),this.api.hidePoints(!s)));var a=avp.LightPresets.filter(function(e){return e.name===t});if(a=a[0]||null)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))avp.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var l=avp.ModelSettingsEnvironment;l||(l=avp.ModelSettingsEnvironment={},avp.LightPresets.push(l)),avp.copyLightPreset(a,l),l.name="(Custom: Model defined)";var c=e.getMetadata("renderEnvironmentExposureBias","value",null),u=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==c&&null!==u&&(l.E_bias=c+u);var h=e.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):h&&(l.bgColorGradient=[255*h[0],255*h[1],255*h[2],255*h[0],255*h[1],255*h[2]]);var d=e.getMetadata("renderEnvironmentRotation","value",null);null!==d&&(l.rotation=d);var p=avp.LightPresets.indexOf(l);this.api.setLightPreset(p)}var g=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==g&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(g))),a},this.setTonemapMethod=function(e){e!=k.getToneMapMethod()&&(k.setTonemapMethod(e),C.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=k.getExposureBias()&&(k.setTonemapExposureBias(e),C.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(y),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,V=null,k=null,C.dtor(),C=null},this.hideLines=function(e){return!(!V||V.isEmpty())&&(V.hideLines(e),this.sceneUpdated(!0),!0)},this.hidePoints=function(e){return!(!V||V.isEmpty())&&(V.hidePoints(e),this.sceneUpdated(!0),!0)},this.getCutPlanes=function(){return C.getCutPlanes()},this.setCutPlanes=function(e){C.setCutPlanes(e),this.sceneUpdated(),this.api.fireEvent({type:av.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){C.toggleMRTSetting(k.mrtFlags()),this.api.fireEvent({type:av.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){var i=this.camera;e.z=-1;var n=new THREE.Vector3(e.x,e.y,1);return e=e.unproject(i),(n=n.unproject(i)).sub(e).normalize(),t||(t=new THREE.Ray),t.set(i.isPerspective?i.position:e,n),t},this.rayIntersect=function(e,t,i,n){var o=V.rayIntersect(e.origin,e.direction,t,i,n);if(this.sceneAfter.children.length){var r=new THREE.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far),s=[];avp.VBIntersector.intersectObject(this.sceneAfter,r,s,!0),s.length&&(!o||s[0].distance<o.distance)&&(o=s[0])}if(!o)return null;var a=o.fragId,l=o.point,c=o.face,u=o.model,h=o.dbId;return void 0===h&&void 0!==a&&(h=u.getFragmentList().getDbIds(a),u.getData().instanceTree||(h=a)),{dbId:h,fragId:a,intersectPoint:l,face:c,model:u}},this.castRayViewport=function(){var e;return function(t,i,n,o){return e=e||new THREE.Ray,V?(this.viewportToRay(t,e),this.rayIntersect(e,i,n,o)):{}}}(),this.clientToViewport=function(e,t){var i=I.canvas.getBoundingClientRect();return new THREE.Vector3((e+.5)/i.width*2-1,-(t+.5)/i.height*2+1,1)},this.viewportToClient=function(e,t){var i=I.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(e+1)*i.width-.5,-.5*(t-1)*i.height-.5,0)},this.castRay=function(e,t,i){return this.castRayViewport(this.clientToViewport(e,t),i)},this.intersectGroundViewport=function(e){var t=this.camera,i="z";this.is2d||(i=F);var n=e;n.z=-1;var o=new THREE.Vector3(n.x,n.y,1);n=n.unproject(t),(o=o.unproject(t)).sub(n).normalize();var r=o;if(Math.abs(r[i])<1e-6)return null;var s;s=t.isPerspective?t.position:n;var a=((this.model?this.model.getBoundingBox().min[i]:0)-s[i])/r[i];return r.multiplyScalar(a),r.add(s),r},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this.hitTestViewport=function(e,t){var i;if(I.is2d){var n,o=[];if((n=av.isMobileDevice()?k.idAtPixels(e.x,e.y,45,o):k.idAtPixels(e.x,e.y,5,o))<=0)return null;var r=this.intersectGroundViewport(e),s=V.findModel(o[1])||I.model;i={intersectPoint:r,dbId:n,fragId:s.getData().fragments.dbId2fragId[n],model:s}}else i=this.castRayViewport(e,t);return i},this.hitTest=function(e,t,i){return I.hitTestViewport(this.clientToViewport(e,t),i)},this.snappingHitTestViewport=function(e,t){var i;if(this.model.getData().isLeaflet)i={intersectPoint:n=this.intersectGroundViewport(e)};else if(I.is2d){if((r=av.isMobileDevice()?k.idAtPixels(e.x,e.y,45):k.idAtPixels(e.x,e.y,17))<0)return null;var n=this.intersectGroundViewport(e),o=I.model.getData().fragments;i={intersectPoint:n,dbId:r,fragId:o?o.dbId2fragId[r]:-1}}else{var r=k.idAtPixel(e.x,e.y);i=this.castRayViewport(e,t,r>0?[r]:null)}return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.rolloverObjectViewport=function(e){k.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(e,t){this.rolloverDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.disableRollover=function(e){this.rolloverDisabled=e},this.rolloverObjectNode=function(e){var t=[],i=I.model.getData().instanceTree;if(i){if(i.enumNodeChildren(e,function(e){t.push(e)},!0),t.length>1){var n=t.shift();t.sort(function(e,t){return e-t}),t.unshift(n)}}else t.push(e);k.rolloverObjectViewport(null,null,t)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(e,t,i){k.presentBuffer();var n=I.canvas.toDataURL("image/png"),o=av.isSafari();if((o|=av.isIOSDevice())&&(e=e||w,t=t||b),!e||!t)return n;var r,s,a=0,l=0;e>t||w/b<e/t?(r=e,l=t/2-(s=b/w*e)/2):(s=t,a=e/2-(r=w/b*t)/2);var c=window.URL.createObjectURL(f(I.canvas.toDataURL("image/png"))),u=new Image;u.src=c;var h=document.createElement("canvas"),d=h.getContext("2d");h.width=e,h.height=t,u.onload=function(){o&&(d.translate(0,s),d.scale(1,-1)),d.drawImage(u,a,l,r,s);var e=h.toDataURL("image/png"),t=window.URL.createObjectURL(f(h.toDataURL("image/png")));i?i(e):window.open(t)}},this.getScreenShot=function(e,t,i){k.presentBuffer();var n=window.URL.createObjectURL(f(I.canvas.toDataURL("image/png"))),o=av.isSafari();(o|=av.isIOSDevice())&&(e=e||w,t=t||b),function(e,t,i,n,o){if(n||t&&i){var r,s,a=0,l=0;t>i||w/b<t/i?(r=t,l=i/2-(s=b/w*t)/2):(s=i,a=t/2-(r=w/b*i)/2);var c=new Image;c.src=e;var u=document.createElement("canvas"),h=u.getContext("2d");u.width=t,u.height=i,c.onload=function(){n&&(h.translate(0,s),h.scale(1,-1)),h.drawImage(c,a,l,r,s);var e=window.URL.createObjectURL(f(u.toDataURL("image/png")));o?o(e):window.open(e)}}else o&&o(e)}(n,e,t,o,i)},this.modelQueue=function(){return V},this.glrenderer=function(){return S},this.renderer=function(){return k},this.shadowMaps=function(){return M},this.worldUp=function(){return A},this.worldUpName=function(){return F},this.setUserRenderContext=function(e){(k=e||new avp.RenderContext).init(S,this.canvas.clientWidth,this.canvas.clientHeight),k.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(e,t,i){G=G||e,W=W||t,j=j||i},this.sceneUpdated=function(e){this.invalidate(!0,!1,!0),V&&e&&(V.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),q=!0,u()},this.currentLightPreset=function(){return _},this.matman=function(){return C},this.fps=function(){return 1e3/$},this.setFPSTargets=function(e,t,i){N=1e3/i,L=1e3/e,D=1e3/t,this.targetFrameBudget=av.isMobileDevice()?D/4:D},this.track=function(e){avp.logger.track(e)},this.worldToClient=function(e){var t=new THREE.Vector4(e.x,e.y,e.z,1);return t.applyMatrix4(this.camera.matrixWorldInverse),t.applyMatrix4(this.camera.projectionMatrix),t.w>0&&(t.x/=t.w,t.y/=t.w,t.z/=t.w),this.viewportToClient(t.x,t.y)},this.clientToWorld=function(e,t,i){var n=null,o=this.model,r=o.getData();if(o.is2d()){var s=this.intersectGround(e,t);if(s){s.z=0;var a=r.bbox;(r.hidePaper||a.containsPoint(s))&&(n={point:s,model:o})}}else(n=this.hitTest(e,t,i))&&(n.point=n.intersectPoint);return n},this.setSelectionColor=function(e){this.selectionMaterialBase.color.set(e),this.selectionMaterialTop.color.set(e),this.invalidate(!1,!1,!0)},this.updateViewportId=function(e){C.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e){return V.findModel(e)},this.setShadowLightDirection=function(e){U.copy(e),u(),this.invalidate(!0,!1,!1),a()},this.getShadowLightDirection=function(e){var t=e||new THREE.Vector3;return t.copy(U),t},this.toggleShadows=function(e){!!M!=!!e&&(e?M=new avp.ShadowMaps(S):(M.cleanup(C),M=null),a(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){V.enableNonResumableFrames=e},this.fitToView=function(e,t,i){if(t=t||this.model,i=i||!1,!t)return!1;var n={type:av.FIT_TO_VIEW_EVENT,nodeIdArray:e,immediate:i,model:t},o=this,r=function(){var r=null;if(Array.isArray(e)&&e.length>0){for(var s=new THREE.Box3,a=new THREE.Box3,l=t.getInstanceTree(),c=t.getFragmentList(),u=0;u<e.length;u++)l.enumNodeFragments(e[u],function(e){c.getWorldBounds(e,a),s.union(a)},!0);s.empty()||(r=s)}r&&!r.empty()||(r=o.getFitBounds()),o.api.navigation.fitBounds(i,r),o.api.fireEvent(n)};if(e&&e.length>0)if(t.is2d()){for(var s=new E(p=new THREE.Box3),a=t.getData().fragments.dbId2fragId,l=0;l<e.length;l++){var c=a[e[l]];if(Array.isArray(c))for(var u=0;u<c.length;u++)this.find2DBounds(c[u],e[l],s);else"number"==typeof c&&this.find2DBounds(c,e[l],s)}if(!p.empty())return this.api.navigation.fitBounds(i,p),void this.api.fireEvent(n)}else{var h=t.getData().propertydb;if(h&&h.attrs.length>0)return void t.getObjectTree(function(){r()})}var d=this.api.viewerState.getState().objectSet[0];if(t.is2d()&&!d.allLayers){for(var p=new THREE.Box3,s=new E(p),g=t.getData().fragments,l=0;l<g.length;l++)this.find2DLayerBounds(l,s);if(!p.empty())return this.api.navigation.fitBounds(i,p),void this.api.fireEvent(n)}this.api.navigation.fitBounds(i,this.getFitBounds(!0)),this.api.fireEvent(n)},this.find2DBounds=function(e,t,i){var n=this.getRenderProxy(this.model,e);new avp.VertexBufferReader(n.geometry).enumGeomsForObject(t,i)},this.find2DLayerBounds=function(e,t){var i=this.getRenderProxy(this.model,e),n=new avp.VertexBufferReader(i.geometry),o=this.getVisibleLayerIds();n.enumGeomsForVisibleLayer(o,t)},E.prototype.onTriangleVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},E.prototype.onLineSegment=function(e,t,i,n,o){this.onTriangleVertex(e,t),this.onTriangleVertex(i,n)},E.prototype.onCircularArc=function(e,t,i,n,o,r){this.onEllipticalArc(e,t,i,n,o,o,0,r)},E.prototype.onEllipticalArc=function(e,t,i,n,o,r,s,a){0==s?i<=0&&n>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*o,2*r,s,a):(this.point.x=e+Math.cos(i)*o,this.point.y=t+Math.sin(i)*r,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(n)*o,this.point.y=t+Math.sin(n)*r,this.bounds.expandByPoint(this.point),i>n&&(this.point.x=e+o,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&n>.5*Math.PI&&(this.point.x=e,this.point.y=t+r,this.bounds.expandByPoint(this.point)),i<Math.PI&&n>Math.PI&&(this.point.x=e-o,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&n>1.5*Math.PI&&(this.point.x=e,this.point.y=t-r,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*o,2*r,s,a)},E.prototype.onTexQuad=function(e,t,i,n,o,r){var s=.5*i,a=.5*i;if(0==o)this.onTriangleVertex(e-s,t-a),this.onTriangleVertex(e+s,t+a);else{var l=new THREE.Matrix4,c=new THREE.Matrix4;l.makeRotationZ(o),c.makeTranslation(e,t,0),c.multiply(l);for(var u=0;u<4;u++)this.point.x=u%2==1?s:-s,this.point.y=u>=2?a:-a,this.point.applyMatrix4(c),this.bounds.expandByPoint(this.point)}},E.prototype.onOneTriangle=function(e,t,i,n,o,r,s){this.onTriangleVertex(e,t),this.onTriangleVertex(i,n),this.onTriangleVertex(o,r)}}av.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null},av.ProgressState={ROOT_LOADED:0,LOADING:1,RENDERING:2},e.prototype.constructor=e,avp.Viewer3DImpl=e}(),Autodesk.Viewing.Private.ViewerState=function(e){var t=Autodesk.Viewing.Private;this.getState=function(i){var n=e.navigation,o={};o.seedURN=this.getSeedUrn();var r=o.objectSet;Array.isArray(r)||(o.objectSet=r=[]),e.model&&!e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:e.getIsolatedNodes(),hidden:e.getHiddenNodes(),explodeScale:e.getExplodeScale(),idType:"lmv"}),e.model&&e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),allLayers:this.areAllLayersVisible(),hidden:[],idType:"lmv"});var s=o.viewport;s||(s=o.viewport={});var a=n.getCamera().isPerspective;s.name="",s.eye=n.getPosition().toArray(),s.target=n.getTarget().toArray(),s.up=n.getCamera().up.toArray(),s.worldUpVector=n.getWorldUpVector().toArray(),s.pivotPoint=n.getPivotPoint().toArray(),s.distanceToOrbit=n.getPivotPlaneDistance(),s.aspectRatio=this.getAspectRatio(),s.projection=a?"perspective":"orthographic",s.isOrthographic=!a,a?s.fieldOfView=n.getVerticalFov():s.orthographicHeight=this.getOrthographicHeight();var l=o.renderOptions;if(l||(l=o.renderOptions={}),l.environment=t.LightPresets[e.impl.currentLightPreset()].name,l.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},l.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},l.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.ambientShadows,antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.progressiveRendering,swapBlackAndWhite:e.prefs.swapBlackAndWhite,displayLines:e.prefs.lineRendering,displayPoints:e.prefs.pointRendering},e.model&&!e.model.is2d())for(var c=o.cutplanes=[],u=e.getCutPlanes(),h=0;h<u.length;h++)c.push(u[h].toArray());for(var d in e.loadedExtensions){var p=e.loadedExtensions[d];p.getState&&p.getState(o)}return i&&!0!==i&&this.applyFilter(o,i),o},this.restoreState=function(i,n,o){if(!i)return t.logger.warn("restoreState has no viewer state to restore from."),!1;if(!e||!e.model)return t.logger.warn("restoreState has no viewer or model to restore."),!1;n&&!0!==n&&(i=JSON.parse(JSON.stringify(i)),this.applyFilter(i,n));var r=e.navigation,s=e.model.is2d(),a=!s;if(Array.isArray(i.objectSet)&&i.objectSet.length>0){var l=i.objectSet[0],c=l.id;if(c&&(c=this.toIntArray(c),e.select(c)),s){var u=l.isolated;Array.isArray(u)&&u.length>0?(e.setLayerVisible(null,!1),e.impl.setLayerVisible(u,!0)):e.setLayerVisible(null,!0)}else{var h=l.isolated||[];if(h=this.toIntArray(h),e.isolate(h),0===h.length){var d=l.hidden||null;d&&d.length>0&&(d=this.toIntArray(d),e.hide(d))}}if("explodeScale"in l){var p=parseFloat(l.explodeScale);e.explode&&e.explode(p)}}var g=i.viewport;if(g){var m=this.getVector3FromArray(g.eye,r.getPosition()),v=this.getVector3FromArray(g.up,r.getCamera().up),f=this.getVector3FromArray(g.target,r.getTarget()),E="fieldOfView"in g?parseFloat(g.fieldOfView):r.getVerticalFov(),A=this.getVector3FromArray(g.worldUpVector,null);if(!A){var y=e.model?e.model.getUpVector():null;A=y?(new THREE.Vector3).fromArray(y):new THREE.Vector3(0,1,0)}var T=this.getVector3FromArray(g.pivotPoint,r.getPivotPoint()),w=r.getCamera().isPerspective;"isOrthographic"in g&&(w=!g.isOrthographic);var b=this.getOrthographicHeight();"orthographicHeight"in g&&(b=Number(g.orthographicHeight));var C={position:m,target:f,up:v,worldup:A,aspect:e.impl.camera.aspect,fov:E,orthoScale:b,isPerspective:w,pivot:T};this.restoreCameraState(C,o)}var S=i.renderOptions;if(S){var k=e.impl.renderer(),M=e.prefs,x=M.ambientShadows,R=M.antialiasing,P=S.ambientOcclusion;if(P){"enabled"in P&&(x=P.enabled);var V="radius"in P?P.radius:null,I="intensity"in P?P.intensity:null;null!==V&&null!==I&&(V===k.getAORadius()&&I===k.getAOIntensity()||(k.setAOOptions(V,I),k.composeFinalFrame()))}if("environment"in S){var N=this.getLightPresetIndex(S.environment);-1!==N&&N!==M.get("lightPreset")&&a&&e.setLightPreset(N)}var D=S.toneMap;if(D){var L=!1,O="exposure"in D?D.exposure:null,_="lightMultiplier"in D?D.lightMultiplier:null;null!==O&&O!==k.getExposureBias()&&(k.setTonemapExposureBias(O),L=!0),null!==_&&e.impl.dir_light1&&_!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,_),L=!0),L&&e.impl.invalidate(!0)}var H=S.appearance;H&&("antiAliasing"in H&&(R=H.antiAliasing),"progressiveDisplay"in H&&H.progressiveDisplay!==M.get("progressiveRendering")&&e.setProgressiveRendering(H.progressiveDisplay),"swapBlackAndWhite"in H&&H.swapBlackAndWhite!==M.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(H.swapBlackAndWhite),"ghostHidden"in H&&H.ghostHidden!==M.get("ghosting")&&a&&e.setGhosting(H.ghostHidden),"displayLines"in H&&H.displayLines!==M.get("lineRendering")&&e.hideLines(!H.displayLines),"displayPoints"in H&&H.displayPoints!==M.get("pointRendering")&&e.hidePoints(!H.displayPoints)),a&&x!==M.ambientShadows&&R!==M.antialiasing&&e.setQualityLevel(x,R)}if(Array.isArray(i.cutplanes)&&e.model&&a){for(var B=[],F=0;F<i.cutplanes.length;F++){var z=i.cutplanes[F];Array.isArray(z)&&z.length>=4&&B.push(new THREE.Vector4(z[0],z[1],z[2],z[3]))}e.setCutPlanes(B)}for(var U in e.loadedExtensions){var G=e.loadedExtensions[U];G.restoreState&&G.restoreState(i,o)}return!0},this.restoreCameraState=function(t,i){e.impl.adjustOrthoCamera(t);var n=e.navigation;i?(t.isPerspective?n.toPerspective():n.toOrthographic(),n.setCameraUpVector(t.up),n.setWorldUpVector(t.worldup),n.setView(t.position,t.target),n.setPivotPoint(t.pivot),n.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,n.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,i){function n(e,t){if(e=e||[],t=t||[],e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function o(e,t,i){return e=e||[],t=t||[],e.length===t.length&&(0!==e.length&&(r(e[0],t[0],i)||r(e[1],t[1],i)||r(e[2],t[2],i)))}function r(e,t,i){var n=e?parseFloat(e):null,o=typeof(e?parseFloat(t):null);return"number"===typeof n&&"number"===o?Math.abs(e-t)<i:(e=e||null,t=t||null,e===t)}var s=e,a=t;if(i&&!0!==i&&(s=this.applyFilter(s,i),a=this.applyFilter(a,i)),s.seedURN!==a.seedURN)return!1;var l=s.objectSet||[],c=a.objectSet||[];if(l.length!==c.length)return!1;var u=l[0]||{},h=c[0]||{};if(!(u.idType===h.idType&&r(u.explodeScale,h.explodeScale,1e-9)&&n(u.id,h.id)&&n(u.isolated,h.isolated)&&n(u.hidden,h.hidden)))return!1;var d=s.viewport||{},p=a.viewport||{};return!!(d.name===p.name&&d.projection===p.projection&&d.isOrthographic===p.isOrthographic&&r(d.distanceToOrbit,p.distanceToOrbit,1e-9)&&r(d.fieldOfView,p.fieldOfView,1e-9)&&r(d.orthographicHeight,p.orthographicHeight,1e-9)&&o(d.eye,p.eye,1e-9)&&o(d.target,p.target,1e-9)&&o(d.up,p.up,1e-9)&&o(d.worldUpVector,p.worldUpVector,1e-9)&&o(d.pivotPoint,p.pivotPoint,1e-9))},this.toIntArray=function(e){var t=[];if(Array.isArray(e))for(var i=0,n=e.length;i<n;++i)t.push(parseInt(e[i]));return t},this.extractSelectedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.id)}return[]},this.extractIsolatedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0];return this.toIntArray(t.isolated)}return[]},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(){return e.impl&&e.impl.selector?e.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var t=[],i=e.impl.matman(),n=i._layersMap;for(var o in n)n.hasOwnProperty(o)&&i.isLayerVisible(o)&&t.push(o);return t},this.areAllLayersVisible=function(){var t=e.impl.matman(),i=t._layersMap;for(var n in i)if(i.hasOwnProperty(n)&&!t.isLayerVisible(n))return!1;return!0},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport();return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera();return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(){return e.model&&e.model.loader?e.model.loader.svfUrn||"":""},this.getToneMapIntensity=function(){var t=0;return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var i=0;i<t.LightPresets.length;i++)if(t.LightPresets[i].name===e)return i;return-1},this.applyFilter=function(e,i){if(!0!==i)for(var n in e)if(e.hasOwnProperty(n)){var o=i[n];void 0===o?(delete e[n],t.logger.log("[applyFilter] C - skipping key ["+n+"] from viewerState; unspecified in filter.")):"boolean"==typeof o?!1===o&&(delete e[n],t.logger.log("[applyFilter] D - skipping key ["+n+"] from viewerState; explicit filtering.")):o instanceof Object?e[n]instanceof Object?this.applyFilter(e[n],i[n]):t.logger.warn("[applyFilter] A - Invalid filter Object for key ["+n+"]"):t.logger.warn("[applyFilter] B - Invalid filter value for key ["+n+"]")}}},Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState,AutodeskNamespace("Autodesk.Viewing.i18n"),function(){function e(){k="aaaa",q()}function t(){k=null,q()}function i(e,t){if(!t||"function"==typeof t)return e;for(var i in t)e[i]=t[i];return e}function n(e,t,i){var n,o=0,r=e.length,s=void 0===r||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e;if(i)if(s){for(n in e)if(!1===t.apply(e[n],i))break}else for(;o<r&&!1!==t.apply(e[o++],i););else if(s){for(n in e)if(!1===t.call(e[n],n,e[n]))break}else for(;o<r&&!1!==t.call(e[o],o,e[o++]););return e}function o(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return O[e]}):e}function r(e){var t=function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest);if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}return e(new Error)},i=function(e){if("string"==typeof e)return e;var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=n(e);var i,o,r,s,a,l,c,u="",h=0;do{s=(i=e.charCodeAt(h++))>>2,a=(3&i)<<4|(o=e.charCodeAt(h++))>>4,l=(15&o)<<2|(r=e.charCodeAt(h++))>>6,c=63&r,isNaN(o)?l=c=64:isNaN(r)&&(c=64),u+=t.charAt(s)+t.charAt(a)+t.charAt(l)+t.charAt(c),i=o=r="",s=a=l=c=""}while(h<e.length);return u},r=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}return e},s=function(e,n,o,a){"function"==typeof o&&(a=o,o={}),o.doNotCache=o.doNotCache||!1,o.data=o.data||{},o.headers=o.headers||{},o.jsonp=o.jsonp||!1,o.async=void 0===o.async||o.async;var l,c=r({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},s.headers,o.headers);if(l="application/json"===c["content-type"]?JSON.stringify(o.data):i(o.data),"GET"===e){var u=[];if(l&&(u.push(l),l=null),o.doNotCache&&u.push("_="+(new Date).getTime()),o.jsonp&&(u.push("callback="+o.jsonp),u.push("jsonp="+o.jsonp)),(u=u.join("&")).length>1&&(n.indexOf("?")>-1?n+="&"+u:n+="?"+u),o.jsonp){var h=document.getElementsByTagName("head")[0],d=document.createElement("script");return d.type="text/javascript",d.src=n,void h.appendChild(d)}}t(function(t,i){if(t)return a(t);i.open(e,n,o.async);for(var r in c)c.hasOwnProperty(r)&&i.setRequestHeader(r,c[r]);i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText||"";if(!a)return;a(i.status,e)}},i.send(l)})};({authBasic:function(e,t){s.headers.Authorization="Basic "+o(e+":"+t)},connect:function(e,t,i){return s("CONNECT",e,t,i)},del:function(e,t,i){return s("DELETE",e,t,i)},get:function(e,t,i){return s("GET",e,t,i)},head:function(e,t,i){return s("HEAD",e,t,i)},headers:function(e){s.headers=e||{}},isAllowed:function(e,t,i){this.options(e,function(e,n){i(-1!==n.text().indexOf(t))})},options:function(e,t,i){return s("OPTIONS",e,t,i)},patch:function(e,t,i){return s("PATCH",e,t,i)},post:function(e,t,i){return s("POST",e,t,i)},put:function(e,t,i){return s("PUT",e,t,i)},trace:function(e,t,i){return s("TRACE",e,t,i)}})[e.type?e.type.toLowerCase():"get"](e.url,e,function(t,i){200===t?e.success(i,t,null):e.error(i,t,null)})}function s(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},F.extend(L,e),delete L.fixLng,"string"==typeof L.ns&&(L.ns={namespaces:[L.ns],defaultNs:L.ns}),"string"==typeof L.fallbackNS&&(L.fallbackNS=[L.fallbackNS]),"string"!=typeof L.fallbackLng&&"boolean"!=typeof L.fallbackLng||(L.fallbackLng=[L.fallbackLng]),L.interpolationPrefixEscaped=F.regexEscape(L.interpolationPrefix),L.interpolationSuffixEscaped=F.regexEscape(L.interpolationSuffix),L.lng||(L.lng=F.detectLanguage()),L.lng?L.useCookie&&F.cookie.create(L.cookieName,L.lng,L.cookieExpirationTime,L.cookieDomain):(L.lng=L.fallbackLng[0],L.useCookie&&F.cookie.remove(L.cookieName)),N=F.toLanguages(L.lng),M=N[0],F.log("currentLng set to: "+M);var i=y;if(e.fixLng&&((i=function(e,t){return t=t||{},t.lng=t.lng||i.lng,y(e,t)}).lng=M),U.setCurrentLng(M),L.resStore)return V=L.resStore,D=!0,void(t&&t(i));var n=F.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var o=0,r=L.preload.length;o<r;o++)for(var s=F.toLanguages(L.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a]);Autodesk.Viewing.i18n.sync.load(n,L,function(e,n){V=n,D=!0,t&&t(i)})}function a(e,t){"string"==typeof e&&(e=[e]);for(var i=0,n=e.length;i<n;i++)L.preload.indexOf(e[i])<0&&L.preload.push(e[i]);return s(t)}function l(e,t,i){"string"!=typeof t?(i=t,t=L.ns.defaultNs):L.ns.namespaces.indexOf(t)<0&&L.ns.namespaces.push(t),V[e]=V[e]||{},V[e][t]=V[e][t]||{},F.extend(V[e][t],i)}function c(e,t){"string"!=typeof t&&(t=L.ns.defaultNs),V[e]=V[e]||{},V[e][t]={}}function u(e){L.ns.defaultNs=e}function h(e,t){d([e],t)}function d(e,t){var i={dynamicLoad:L.dynamicLoad,resGetPath:L.resGetPath,getAsync:L.getAsync,customLoad:L.customLoad,ns:{namespaces:e,defaultNs:""}},n=F.toLanguages(L.lng);"string"==typeof L.preload&&(L.preload=[L.preload]);for(var o=0,r=L.preload.length;o<r;o++)for(var s=F.toLanguages(L.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a]);for(var c=[],u=0,h=n.length;u<h;u++){var d=!1,p=V[n[u]];if(p)for(var g=0,m=e.length;g<m;g++)p[e[g]]||(d=!0);else d=!0;d&&c.push(n[u])}c.length?Autodesk.Viewing.i18n.sync._fetch(c,i,function(i,n){var o=e.length*c.length;F.each(e,function(e,i){L.ns.namespaces.indexOf(i)<0&&L.ns.namespaces.push(i),F.each(c,function(e,r){V[r]=V[r]||{},V[r][i]=n[r][i],0===--o&&t&&(L.useLocalStorage&&Autodesk.Viewing.i18n.sync._storeLocal(V),t())})})}):t&&t()}function p(e,t,i){return"function"==typeof t?(i=t,t={}):t||(t={}),t.lng=e,s(t,i)}function g(){return M}function m(e,t,i,n){if(!e)return e;if(n=n||t,e.indexOf(n.interpolationPrefix||L.interpolationPrefix)<0)return e;var o=n.interpolationPrefix?F.regexEscape(n.interpolationPrefix):L.interpolationPrefixEscaped,r=n.interpolationSuffix?F.regexEscape(n.interpolationSuffix):L.interpolationSuffixEscaped,s="HTML"+r;return F.each(t,function(t,a){var l=i?i+L.keyseparator+t:t;"object"==typeof a&&null!==a?e=m(e,a,l,n):n.escapeInterpolation||L.escapeInterpolation?(e=e.replace(new RegExp([o,l,s].join(""),"g"),a),e=e.replace(new RegExp([o,l,r].join(""),"g"),F.escape(a))):e=e.replace(new RegExp([o,l,r].join(""),"g"),a)}),e}function v(e,t){var i=F.extend({},t);for(delete i.postProcess;-1!=e.indexOf(L.reusePrefix)&&!(++I>L.maxRecursion);){var n=e.lastIndexOf(L.reusePrefix),o=e.indexOf(L.reuseSuffix,n)+L.reuseSuffix.length,r=e.substring(n,o),s=r.replace(L.reusePrefix,"").replace(L.reuseSuffix,"");if(-1!=s.indexOf(",")){var a=s.indexOf(",");if(-1!=s.indexOf("{",a)&&-1!=s.indexOf("}",a)){var l=s.indexOf("{",a),c=s.indexOf("}",l)+"}".length;try{i=F.extend(i,JSON.parse(s.substring(l,c))),s=s.substring(0,a)}catch(e){}}}var u=b(s,i);e=e.replace(r,u)}return e}function f(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}function E(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}function A(e,t){var i=T(e,t=t||{}),n=C(e,t);return void 0!==n||n===i}function y(e,t){if(t=t||{},!D){F.log("i18next not finished initialization. you might have called t function before loading resources finished.");var i=e.indexOf(":");i<0?i=0:i++;var n=t.defaultValue||e.substr(i);return n&&(n=m(n,t)),n}return I=0,b.apply(null,arguments)}function T(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function w(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);return{postProcess:"sprintf",sprintf:e}}function b(e,t){if(t&&"object"!=typeof t?"sprintf"===L.shortcutFunction?t=w.apply(null,arguments):"defaultValue"===L.shortcutFunction&&(t={defaultValue:t}):t=t||{},void 0===e||null===e)return"";"string"==typeof e&&(e=[e]);var i=e[0];if(e.length>1)for(var n=0;n<e.length&&(i=e[n],!A(i,t));n++);var o,r=T(i,t),s=C(i,t),a=t.lng?F.toLanguages(t.lng):N,l=t.ns||L.ns.defaultNs;i.indexOf(L.nsseparator)>-1&&(l=(o=i.split(L.nsseparator))[0],i=o[1]),void 0===s&&L.sendMissing&&(t.lng?z.postMissing(a[0],l,i,r,a):z.postMissing(L.lng,l,i,r,a));var c=t.postProcess||L.postProcess;if(void 0!==s&&c&&G[c]&&(s=G[c](s,i,t)),k&&void 0!==s)return k;var u=r;if(r.indexOf(L.nsseparator)>-1&&(u=(o=r.split(L.nsseparator))[1]),u===i&&L.parseMissingKey&&(r=L.parseMissingKey(r)),void 0===s&&(r=m(r,t),r=v(r,t),c&&G[c])){var h=T(i,t);s=G[c](h,i,t)}return void 0!==s?s:r}function C(e,t){var i,n,o=T(e,t=t||{}),r=N;if(!V)return o;if("cimode"===r[0].toLowerCase())return o;if(t.lng&&(r=F.toLanguages(t.lng),!V[r[0]])){var s=L.getAsync;L.getAsync=!1,Autodesk.Viewing.i18n.sync.load(r,L,function(e,t){F.extend(V,t),L.getAsync=s})}var a=t.ns||L.ns.defaultNs;if(e.indexOf(L.nsseparator)>-1){var l=e.split(L.nsseparator);a=l[0],e=l[1]}if(f(t)&&(delete(i=F.extend({},t)).context,i.defaultValue=L.contextNotFound,(n=y(a+L.nsseparator+e+"_"+t.context,i))!=L.contextNotFound))return m(n,{context:t.context});if(E(t)){delete(i=F.extend({},t)).count,i.defaultValue=L.pluralNotFound;var c=a+L.nsseparator+e+L.pluralSuffix,u=U.get(r[0],t.count);if(u>=0?c=c+"_"+u:1===u&&(c=a+L.nsseparator+e),(n=y(c,i))!=L.pluralNotFound)return m(n,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var h,d=e.split(L.keyseparator),p=0,g=r.length;p<g&&void 0===h;p++){for(var A=r[p],w=0,S=V[A]&&V[A][a];d[w];)S=S&&S[d[w]],w++;if(void 0!==S){var k=Object.prototype.toString.apply(S);if("string"==typeof S)S=v(S=m(S,t),t);else if("[object Array]"!==k||L.returnObjectTrees||t.returnObjectTrees){if(null===S&&!0===L.fallbackOnNull)S=void 0;else if(null!==S)if(L.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==k&&"[object Function]"!==k&&"[object RegExp]"!==k){var M="[object Array]"===k?[]:{};F.each(S,function(i){M[i]=b(a+L.nsseparator+e+L.keyseparator+i,t)}),S=M}}else L.objectTreeKeyHandler&&"function"==typeof L.objectTreeKeyHandler?S=L.objectTreeKeyHandler(e,S,A,a,t):(S="key '"+a+":"+e+" ("+A+")' returned an object instead of string.",F.log(S))}else S=v(S=m(S=S.join("\n"),t),t);"string"==typeof S&&""===S.trim()&&!0===L.fallbackOnEmpty&&(S=void 0),h=S}}if(void 0===h&&!t.isFallbackLookup&&(!0===L.fallbackToDefaultNS||L.fallbackNS&&L.fallbackNS.length>0))if(t.isFallbackLookup=!0,L.fallbackNS.length)for(var x=0,R=L.fallbackNS.length;x<R&&(!(h=C(L.fallbackNS[x]+L.nsseparator+e,t))||(h.indexOf(L.nsseparator)>-1?h.split(L.nsseparator)[1]:h)===(o.indexOf(L.nsseparator)>-1?o.split(L.nsseparator)[1]:o));x++);else h=C(e,t);return h}function S(){var e,t=[];if("undefined"!=typeof window&&(!function(){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var n=e[i].indexOf("=");if(n>0){var o=e[i].substring(0,n),r=e[i].substring(n+1);t[o]=r}}}(),t[L.detectLngQS]&&(e=t[L.detectLngQS])),!e&&"undefined"!=typeof document&&L.useCookie){var i=F.cookie.read(L.cookieName);i&&(e=i)}return e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage),e}var k=null;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>0&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var o=n>=0?n:Math.max(i-Math.abs(n),0);o<i;o++)if(o in t&&t[o]===e)return o;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var n=i;arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n))));for(var o=n>=0?Math.min(n,i-1):i-Math.abs(n);o>=0;o--)if(o in t&&t[o]===e)return o;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var M,x=this,R=x.jQuery||x.Zepto,P={},V={},I=0,N=[],D=!1;"undefined"!=typeof module&&module.exports?module.exports=P:(R&&(R.i18n=R.i18n||P),x.i18n=x.i18n||P);var L={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},_=function(e){for(var t,i,n=!1,o=!1,r="",s=0;s<e.length;s++)if(t=e[s],i=e[s+1],o||"\\"===e[s-1]||'"'!==t||(n=!n),n)r+=t;else{if(o||t+i!=="//")if("single"===o&&t+i==="\r\n")o=!1,s++;else if("single"===o&&"\n"===t)o=!1;else{if(!o&&t+i==="/*"){o="multi",s++;continue}if("multi"===o&&t+i==="*/"){o=!1,s++;continue}}else o="single",s++;o||(r+=t)}return r},H={create:function(e,t,i,n){var o;if(i){var r=new Date;r.setTime(r.getTime()+60*i*1e3),o="; expires="+r.toGMTString()}else o="";n=n?"domain="+n+";":"",document.cookie=e+"="+t+o+";"+n+"path=/"},read:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},remove:function(e){this.create(e,"",-1)}},B={create:function(e,t,i,n){},read:function(e){return null},remove:function(e){}},F={extend:R?R.extend:i,each:R?R.each:n,ajax:R?R.ajax:"undefined"!=typeof document?r:function(){},cookie:"undefined"!=typeof document?H:B,detectLanguage:S,escape:o,log:function(e){L.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[];if("string"==typeof e&&e.indexOf("-")>-1){var i=e.split("-");e=L.lowerCaseLng?i[0].toLowerCase()+"-"+i[1].toLowerCase():i[0].toLowerCase()+"-"+i[1].toUpperCase(),"unspecific"!==L.load&&t.push(e),"current"!==L.load&&t.push(i[0])}else t.push(e);for(var n=0;n<L.fallbackLng.length;n++)-1===t.indexOf(L.fallbackLng[n])&&L.fallbackLng[n]&&t.push(L.fallbackLng[n]);return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};F.applyReplacement=m;var z={load:function(e,t,i){t.useLocalStorage?z._loadLocal(e,t,function(n,o){for(var r=[],s=0,a=e.length;s<a;s++)o[e[s]]||r.push(e[s]);r.length>0?z._fetch(r,t,function(e,t){F.extend(o,t),z._storeLocal(t),i(null,o)}):i(null,o)}):z._fetch(e,t,function(e,t){i(null,t)})},_loadLocal:function(e,t,i){var n={},o=(new Date).getTime();if(window.localStorage){var r=e.length;F.each(e,function(e,s){var a=window.localStorage.getItem("res_"+s);a&&(a=JSON.parse(a)).i18nStamp&&a.i18nStamp+t.localStorageExpirationTime>o&&(n[s]=a),0===--r&&i(null,n)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,i){var n=t.ns,o={};if(t.dynamicLoad){var r=function(e,t){i(null,t)};if("function"==typeof t.customLoad)t.customLoad(e,n.namespaces,t,r);else{var s=m(t.resGetPath,{lng:e.join("+"),ns:n.namespaces.join("+")});s=Autodesk.Viewing.Private.getResourceUrl(s),F.ajax({url:s,success:function(e,t,i){F.log("loaded: "+s),r(0,e.json())},error:function(e,t,i){F.log("failed loading: "+s),r()},dataType:"text",async:t.getAsync})}}else{var a,l=n.namespaces.length*e.length;F.each(n.namespaces,function(n,r){F.each(e,function(e,n){var s=function(e,t){e&&(a=a||[]).push(e),o[n]=o[n]||{},o[n][r]=t,0===--l&&i(a,o)};"function"==typeof t.customLoad?t.customLoad(n,r,t,s):z._fetchOne(n,r,t,s)})})}},_fetchOne:function(e,t,i,n){var o=m(i.resGetPath,{lng:e,ns:t});o=Autodesk.Viewing.Private.getResourceUrl(o),F.ajax({url:o,success:function(e,t,i){F.log("loaded: "+o);var r=_(e);n(null,JSON.parse(r))},error:function(e,t,i){if(t&&200==t||e&&e.status&&200==e.status)F.log("There is a typo in: "+o);else if(t&&404==t||e&&e.status&&404==e.status)F.log("Does not exist: "+o);else{var r=t||(e&&e.status?e.status:null);F.log(r+" when loading "+o)}n(i,{})},dataType:"text",async:i.getAsync})},postMissing:function(e,t,i,n,o){var r={};r[i]=n;var s=[];if("fallback"===L.sendMissingTo&&!1!==L.fallbackLng[0])for(a=0;a<L.fallbackLng.length;a++)s.push({lng:L.fallbackLng[a],url:m(L.resPostPath,{lng:L.fallbackLng[a],ns:t})});else if("current"===L.sendMissingTo||"fallback"===L.sendMissingTo&&!1===L.fallbackLng[0])s.push({lng:e,url:m(L.resPostPath,{lng:e,ns:t})});else if("all"===L.sendMissingTo)for(var a=0,l=o.length;a<l;a++)s.push({lng:o[a],url:m(L.resPostPath,{lng:o[a],ns:t})});for(var c=0,u=s.length;c<u;c++){var h=s[c];F.ajax({url:h.url,type:L.sendType,data:r,success:function(e,o,r){F.log("posted missing key '"+i+"' to: "+h.url);for(var s=i.split("."),a=0,l=V[h.lng][t];s[a];)l=a===s.length-1?l[s[a]]=n:l[s[a]]=l[s[a]]||{},a++},error:function(e,t,n){F.log("failed posting missing key '"+i+"' to: "+h.url)},dataType:"json",async:L.postAsync})}}},U={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymar",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){U.rules[e]=t},setCurrentLng:function(e){if(!U.currentRule||U.currentRule.lng!==e){var t=e.split("-");U.currentRule={lng:e,rule:U.rules[t[0]]}}},get:function(e,t){return function(t,i){var n;if(n=U.currentRule&&U.currentRule.lng===e?U.currentRule.rule:U.rules[t]){var o=n.plurals(i),r=n.numbers[o];return 2===n.numbers.length&&1===n.numbers[0]&&(2===r?r=-1:1===r&&(r=1)),r}return 1===i?"1":"-1"}(e.split("-")[0],t)}},G={},W=function(e,t){G[e]=t},j=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var i=[];t>0;i[--t]=e);return i.join("")}var i=function(){return i.cache.hasOwnProperty(arguments[0])||(i.cache[arguments[0]]=i.parse(arguments[0])),i.format.call(null,i.cache[arguments[0]],arguments)};return i.format=function(i,n){var o,r,s,a,l,c,u,h=1,d=i.length,p="",g=[];for(r=0;r<d;r++)if("string"===(p=e(i[r])))g.push(i[r]);else if("array"===p){if((a=i[r])[2])for(o=n[h],s=0;s<a[2].length;s++){if(!o.hasOwnProperty(a[2][s]))throw j('[sprintf] property "%s" does not exist',a[2][s]);o=o[a[2][s]]}else o=a[1]?n[a[1]]:n[h++];if(/[^s]/.test(a[8])&&"number"!=e(o))throw j("[sprintf] expecting number but found %s",e(o));switch(a[8]){case"b":o=o.toString(2);break;case"c":o=String.fromCharCode(o);break;case"d":o=parseInt(o,10);break;case"e":o=a[7]?o.toExponential(a[7]):o.toExponential();break;case"f":o=a[7]?parseFloat(o).toFixed(a[7]):parseFloat(o);break;case"o":o=o.toString(8);break;case"s":o=(o=String(o))&&a[7]?o.substring(0,a[7]):o;break;case"u":o=Math.abs(o);break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(a[8])&&a[3]&&o>=0?"+"+o:o,c=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(o).length,l=a[6]?t(c,u):"",g.push(a[5]?o+l:l+o)}return g.join("")},i.cache={},i.parse=function(e){for(var t=e,i=[],n=[],o=0;t;){if(null!==(i=/^[^\x25]+/.exec(t)))n.push(i[0]);else if(null!==(i=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(i[2]){o|=1;var r=[],s=i[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw"[sprintf] huh?";r.push(a[1])}i[2]=r}else o|=2;if(3===o)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(i)}t=t.substring(i[0].length)}return n},i}(),Y=function(e,t){return t.unshift(e),j.apply(null,t)};W("sprintf",function(e,t,i){return i.sprintf?"[object Array]"===Object.prototype.toString.apply(i.sprintf)?Y(e,i.sprintf):"object"==typeof i.sprintf?j(e,i.sprintf):e:e});var q=function(){function e(e){return[null,e]}Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),function(t){var i=e(t.getAttribute("data-i18n")),n=i[0],o=i[1],r=Autodesk.Viewing.i18n.translate(o);r?n?t.setAttribute(n,r):t.textContent=r:n?t.setAttribute(n,o):t.textContent=o})};Autodesk.Viewing.i18n.init=s,Autodesk.Viewing.i18n.setLng=p,Autodesk.Viewing.i18n.preload=a,Autodesk.Viewing.i18n.addResourceBundle=l,Autodesk.Viewing.i18n.removeResourceBundle=c,Autodesk.Viewing.i18n.loadNamespace=h,Autodesk.Viewing.i18n.loadNamespaces=d,Autodesk.Viewing.i18n.localize=q,Autodesk.Viewing.i18n.setDefaultNamespace=u,Autodesk.Viewing.i18n.t=y,Autodesk.Viewing.i18n.translate=y,Autodesk.Viewing.i18n.exists=A,Autodesk.Viewing.i18n.detectLanguage=F.detectLanguage,Autodesk.Viewing.i18n.pluralExtensions=U,Autodesk.Viewing.i18n.sync=z,Autodesk.Viewing.i18n.functions=F,Autodesk.Viewing.i18n.lng=g,Autodesk.Viewing.i18n.addPostProcessor=W,Autodesk.Viewing.i18n.options=L,Autodesk.Viewing.i18n.setDebugLocString=e,Autodesk.Viewing.i18n.clearDebugLocString=t}(),function(){"use strict";Autodesk.Viewing.UI;var e=function(e,t,i,n){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.parentContainer=e,this.container=document.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=i,(n=n||{}).hasOwnProperty("localizeTitle")||(n.localizeTitle=!0),this.options=n,this.container.classList.add("dockingPanel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)};e.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer)},e.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},e.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},e.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect();if(this.container.dockRight){var i=t.width,n=300,o=this.container.lastWidth||this.container.style.width;o||(o=this.container.getBoundingClientRect().width),o&&(n=parseInt(o)),this.container.style.left=i-n+"px"}if(this.container.dockBottom){var r=t.height,s=300,a=this.container.lastHeight||this.container.style.height;a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a));var l=r-s;this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},e.prototype.isVisible=function(){return"block"===this.container.style.display},e.prototype.visibilityChanged=function(){},e.prototype.initializeMoveHandlers=function(e){function t(e){var t=d.style.minWidth?parseInt(d.style.minWidth):p.kMinWdth,i=d.style.minHeight?parseInt(d.style.minHeight):p.kMinHeight,n=p.getContainerBoundingRect();d.style.maxWidth&&parseInt(d.style.width)>parseInt(d.style.maxWidth)&&(d.style.width=d.style.maxWidth),d.style.maxHeight&&parseInt(d.style.height)>parseInt(d.style.maxHeight)&&(d.style.height=d.style.maxHeight),parseInt(d.style.width)<t&&(d.style.width=t+"px"),parseInt(d.style.height)<i&&(d.style.height=i+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),u+=e.screenX-s,h+=e.screenY-a,o=l+u,r=c+h;var g=parseInt(d.style.width),m=parseInt(d.style.height);isNaN(g)&&(g=p.container.getBoundingClientRect().width),isNaN(m)&&(m=p.container.getBoundingClientRect().height),o<5&&(o=0),r<5&&(r=0),d.dockRight=!1,d.dockBottom=!1,n.width-5<o+g&&(o=n.width-g,d.dockRight=!0),n.height-5<r+m&&(r=n.height-m,d.dockBottom=!0),d.style.left=o+"px",d.style.top=r+"px",d.style.maxWidth=n.width-o+"px",d.style.maxHeight=n.height-r+"px",s=e.screenX,a=e.screenY,p.onMove(e,o,r)}function i(e){window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",i),p.onEndMove(e,o,r)}function n(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),s=e.screenX,a=e.screenY,u=0,h=0,l=p.container.offsetLeft,c=p.container.offsetTop,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",i,!1),window.addEventListener("touchmove",t,!1),window.addEventListener("touchend",i,!1),e.preventDefault(),p.onStartMove(e,l,c)}var o,r,s,a,l,c,u,h,d=this.container,p=this;p.addEventListener(e,"mousedown",n),p.addEventListener(e,"touchstart",n)},e.prototype.initializeCloseHandler=function(e){var t=this;t.addEventListener(e,"click",function(e){t.setVisible(!1)},!1)},e.prototype.createScrollContainer=function(e){var t=document.createElement("div"),i=t.classList;return i.add("dockingPanelScroll"),i.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,t},e.prototype.createTitleBar=function(e){var t=document.createElement("div");t.className="dockingPanelTitle",t.textContent=e;var i=this;return i.addEventListener(t,"click",function(e){i.movedSinceLastClick||i.onTitleClick(e),i.movedSinceLastClick=!1}),i.addEventListener(t,"dblclick",function(e){i.onTitleDoubleClick(e)}),t},e.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},e.prototype.createCloseButton=function(){var e=document.createElement("div");return e.className="dockingPanelClose",e.innerHTML="&times;",this.initializeCloseHandler(e),e},e.prototype.onStartMove=function(e,t,i){},e.prototype.onEndMove=function(e,t,i){},e.prototype.onMove=function(e,t,i){this.movedSinceLastClick=!0},e.prototype.onTitleClick=function(e){},e.prototype.onTitleDoubleClick=function(e){},e.prototype.addEventListener=function(e,t,i){e.addEventListener(t,i),this.listeners.push({target:e,eventId:t,callback:i})},e.prototype.removeEventListener=function(e,t,i){for(var n=0;n<this.listeners.length;++n){var o=this.listeners[n];if(o.target===e&&o.eventId===t&&o.callback===i)return e.removeEventListener(t,i),this.listeners.splice(n,1),!0}return!1},e.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},e.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize().height,i=this.container.getBoundingClientRect(),n=this.getContainerBoundingRect(),o=e&&e.maxHeight?e.maxHeight:n.height;t>(o-=75)&&(t=o);var r=i.top;r>0&&r+t+75>n.height&&(r=Math.max(0,n.height-(t+75))),this.container.style.height=t.toString()+"px",this.container.style.top=r+"px"}},e.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},Autodesk.Viewing.UI.DockingPanel=e}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=Autodesk.Viewing.Private,i=function(t,i,n,o){e.DockingPanel.call(this,t,i,n,o),this.container.classList.add("modelStructurePanel"),(o=o||{}).heightAdjustment||(o.heightAdjustment=40),o.marginTop||(o.marginTop=0),o.left=!0,this.createScrollContainer(o),this.options=o,this.instanceTree=null,this.tree=null,this.selectedNodes=[],this.uiCreated=!1;var r=this;this.addVisibilityListener(function(e){e&&(r.uiCreated||r.createUI(),r.resizeToContent())})};(i.prototype=Object.create(e.DockingPanel.prototype)).constructor=i,i.prototype.setModel=function(e,t){this.instanceTree=e,this.modelTitle=t,this.isVisible()?this.createUI():this.uiCreated=!1},i.prototype.createUI=function(){var i=this,n=i.instanceTree;if(n){i.selectedNodes=[];var o=i.modelTitle;o||i.options&&i.options.defaultTitle&&(o=i.options.defaultTitle);var r={};if(o||(o="Browser",r.localizeTitle=!0),i.setTitle(o,r),i.tree){for(;i.scrollContainer.hasChildNodes();)i.scrollContainer.removeChild(i.scrollContainer.lastChild);i.title.removeEventListener("click",i.onTitleClick),i.title.removeEventListener("dblclick",i.onTitleDoubleClick)}var s,a=this.rootId=n.getRootId(),l=n.getNodeName(a),c=0,u=0;n.enumNodeChildren(a,function(e){u||(s=n.getNodeName(e),c=e),u++});var h=function(){var n=new e.TreeDelegate;return n.getTreeNodeId=function(e){return"object"==typeof e?(t.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},n.getTreeNodeLabel=function(e){var t=this.getTreeNodeId(e);return i.instanceTree.getNodeName(t)||"Object "+t},n.getTreeNodeClass=function(e){return i.getNodeClass(e)},n.isTreeNodeGroup=function(e){return i.isGroupNode(e)},n.shouldCreateTreeNode=function(e){return i.shouldInclude(e)},n.onTreeNodeClick=function(e,t,n){i.onClick(t,n)},n.onTreeNodeRightClick=function(e,t,n){i.onRightClick(t,n)},n.onTreeNodeDoubleClick=function(e,t,n){i.onDoubleClick(t,n)},n.onTreeNodeIconClick=function(e,t,n){i.onIconClick(t,n)},n.forEachChild=function(e,t){var n=this.getTreeNodeId(e);i.instanceTree.enumNodeChildren(n,t)},n.onTreeNodeHover=function(e,t,n){i.onHover(t,n)},n}();this.myDelegate=h;var d=1===u&&l===s,p={excludeRoot:d,localize:!0};i.tree=new e.Tree(h,a,i.scrollContainer,p),i.options&&i.options.hasOwnProperty("startCollapsed")&&!i.options.startCollapsed||(i.tree.setAllCollapsed(!0),i.tree.setCollapsed(a,!1),d&&i.tree.setCollapsed(c,!1)),this.uiCreated=!0}},i.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){var t=this.myDelegate.getTreeNodeId(e);return this.instanceTree.getChildCount(t)},i.prototype.shouldInclude=function(e){return!0},i.prototype.onClick=function(e,t){this.setSelection([e])},i.prototype.onDoubleClick=function(e,t){},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){this.tree.delegate().isTreeNodeGroup(e)&&(this.tree.setCollapsed(e,t),this.resizeToContent())},i.prototype.isGroupCollapsed=function(e){return!!this.tree.delegate().isTreeNodeGroup(e)&&this.tree.isCollapsed(e)},i.prototype.onRightClick=function(e,t){},i.prototype.onTitleClick=function(e){},i.prototype.onTitleDoubleClick=function(e){},i.prototype.onHover=function(e,t){},i.prototype.setSelection=function(e){if(this.tree){var t,i;for(t=0;t<this.selectedNodes.length;++t)for(i=this.instanceTree.getNodeParentId(this.selectedNodes[t]);i;)this.tree.removeClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i);var n=[];for(t=0;t<e.length;++t)for(n.push(e[t]),i=this.instanceTree.getNodeParentId(e[t]);i;)this.tree.addClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i);this.selectedNodes=e,this.tree.setSelection(n)}},i.prototype.getContentSize=function(){var e=this.tree;if(e){var t=e.getRootContainer();if(t)return{height:t.clientHeight+this.options.heightAdjustment+35,width:t.clientWidth}}return{height:0,width:0}},i.prototype.addClass=function(e,t){return null!==this.tree&&this.tree.addClass(e,t)},i.prototype.removeClass=function(e,t){return null!==this.tree&&this.tree.removeClass(e,t)},Autodesk.Viewing.UI.ModelStructurePanel=i}(),function(){"use strict";function e(e){e=String(e);var t=' target="blank" class="propertyLink" ';return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce(function(e,t){return e.replace(t.pattern,t.value)},e)}var t=Autodesk.Viewing.UI,i=function(e,i,n,o){t.DockingPanel.call(this,e,i,n,o),this.container.classList.add("propertyPanel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0}),this.highlightableElements={};var r=this,s=function(){function e(e){return"category"===e.type}var i=new t.TreeDelegate;return i.getTreeNodeId=function(e){return e.name+(e.hasOwnProperty("value")?e.value:"")+(e.hasOwnProperty("category")?e.category:"")},i.getTreeNodeClass=function(t){return e(t)?r.getCategoryClass(t):r.getPropertyClass(t)},i.isTreeNodeGroup=function(t){return e(t)},i.onTreeNodeClick=function(t,i,n){e(i)?r.onCategoryClick(i,n):r.onPropertyClick(i,n)},i.onTreeNodeRightClick=function(t,i,n){e(i)?r.onCategoryRightClick(i,n):r.onPropertyRightClick(i,n)},i.onTreeNodeDoubleClick=function(t,i,n){e(i)?r.onCategoryDoubleClick(i,n):r.onPropertyDoubleClick(i,n)},i.onTreeNodeIconClick=function(t,i,n){e(i)?r.onCategoryIconClick(i,n):r.onPropertyIconClick(i,n)},i.createTreeNode=function(t,i,n){var o=null;(o=e(t)?r.displayCategory(t,i,n):r.displayProperty(t,i,n))&&(r.highlightableElements[this.getTreeNodeId(t)]=o)},i}();this.tree=new t.Tree(s,null,this.scrollContainer,{})};(i.prototype=Object.create(t.DockingPanel.prototype)).constructor=i,i.prototype.setProperties=function(e,t){this.removeAllProperties();for(var i=[],n=[],o=0;o<e.length;o++)if(!(s=e[o]).hidden){var r=e[o].displayCategory;r&&"string"==typeof r&&""!==r?i.push(s):n.push(s)}if(i.length+n.length!==0){for(o=0;o<i.length;o++){var s=i[o],a=Autodesk.Viewing.Private.formatValueWithUnits(s.displayValue,s.units,s.type,s.precision);this.addProperty(s.displayName,a,s.displayCategory)}for(var l=i.length>0,o=0;o<n.length;o++){var s=n[o],a=Autodesk.Viewing.Private.formatValueWithUnits(s.displayValue,s.units,s.type,s.precision);this.addProperty(s.displayName,a,l?"Other":"",l?{localizeCategory:!0}:{})}}else this.showNoProperties()},i.prototype.showNoProperties=function(){this.removeAllProperties();var e=this.tree.myRootContainer,t=document.createElement("div");t.className="noProperties";var i="No properties to display";t.setAttribute("data-i18n",i),t.textContent=Autodesk.Viewing.i18n.translate(i),e.appendChild(t)},i.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},i.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},i.prototype.addProperty=function(e,t,i,n){if(this.tree.getElementForNode({name:e,value:t,category:i}))return!1;var o=null,r={name:e,value:t,type:"property"};return i?((o=this.tree.getElementForNode({name:i}))||(o=this.tree.createElement_({name:i,type:"category"},this.tree.myRootContainer,n&&n.localizeCategory?{localize:!0}:null)),r.category=i):o=this.tree.myRootContainer,this.tree.createElement_(r,o,n&&n.localizeProperty?{localize:!0}:null),!0},i.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0;return!1},i.prototype.removeProperty=function(e,t,i,n){var o={name:e,value:t,category:i},r=this.tree.getElementForNode(o);return!!r&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(o)],r.parentNode.removeChild(r),!0)},i.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},i.prototype.setCategoryCollapsed=function(e,t){var i=this.tree.delegate().getTreeNodeId(e);this.tree.setCollapsed(i,t)},i.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e);return this.tree.isCollapsed(t)},i.prototype.getContentSize=function(){var e=this.tree.myRootContainer;return{height:e.clientHeight+55,width:e.clientWidth}},i.prototype.highlight=function(e,t){for(var i in this.highlightableElements)for(var n=this.highlightableElements[i],o=0;o<n.length;++o)!function(t){var i=t.innerHTML,n=i.replace(/(<highlight>|<\/highlight>)/gim,"");if(i!==n&&(t.innerHTML=n),e&&""!==e){var o=new RegExp("(\\b"+e+"\\b)","gim"),r=n.replace(o,"<highlight>$1</highlight>");t.innerHTML=r}}(n[o])},i.prototype.displayCategory=function(e,t,i){var n=document.createElement("div"),o=e.name;return i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o,n.title=o,n.className="categoryName",t.appendChild(n),[n]},i.prototype.displayProperty=function(t,i,n){var o=document.createElement("div"),r=t.name;n&&n.localize&&(o.setAttribute("data-i18n",r),r=Autodesk.Viewing.i18n.translate(r)),o.textContent=r,o.title=r,o.className="propertyName";var s=document.createElement("div");s.className="separator";var a=document.createElement("div");a.textContent=t.value;var l=t.value;return a.title=l,l=e(l),a.innerHTML=l,a.className="propertyValue",i.appendChild(o),i.appendChild(s),i.appendChild(a),[o,a]},i.prototype.getCategoryClass=function(e){return"category"},i.prototype.getPropertyClass=function(e){return"property"},i.prototype.onCategoryClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyClick=function(e,t){},i.prototype.onCategoryIconClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyIconClick=function(e,t){},i.prototype.onCategoryDoubleClick=function(e,t){},i.prototype.onPropertyDoubleClick=function(e,t){},i.prototype.onCategoryRightClick=function(e,t){},i.prototype.onPropertyRightClick=function(e,t){},Autodesk.Viewing.UI.PropertyPanel=i}(),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private,i=function(e){this.viewer=e,this.menus=[],this.open=!1};i.prototype.constructor=i,i.prototype.show=function(e,t){var i=this.viewer.container.getBoundingClientRect();Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY);var n=e.clientX-i.left,o=e.clientY-i.top;if(!this.open){var r=this;this.showMenu(t,n,o),this.open=!0,this.hideEventListener=function(e){"menuItem"!==e.target.className&&r.hide(e)},this.isTouch="press"===e.type,document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}},i.prototype.showMenu=function(i,n,o){var r,s=document.createElement("div"),a=[];s.className="menu",this.viewer.container.appendChild(s),this.menus.push(s);for(var l=0;l<i.length;++l){var c=i[l],u=c.title,h=c.target;r=this.createMenuItem(s,u),"function"==typeof h?this.addCallbackToMenuItem(r,h):Array.isArray(h)?a.push({menuItem:r,target:h}):t.logger.warn("Invalid context menu option:",u,h)}var d=s.getBoundingClientRect(),p=d.width,g=d.height,m=this.viewer.container.getBoundingClientRect(),v=m.width,f=m.height,E=e.isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput();for(E&&(n-=p),n<0&&(n=0),v<n+p&&(n=v-p)<0&&(n=0),o<0&&(o=0),f<o+g&&(o=f-g)<0&&(o=0),s.style.top=Math.round(o)+"px",s.style.left=Math.round(n)+"px",l=0;l<a.length;++l){var A=a[l];d=(r=A.menuItem).getBoundingClientRect(),n=Math.round((E?d.left:d.right)-m.left),o=Math.round(d.top-m.top),this.addSubmenuCallbackToMenuItem(r,A.target,n,o)}},i.prototype.createMenuItem=function(e,t){var i=document.createElement("div");return i.className="menuItem",i.setAttribute("data-i18n",t),i.textContent=Autodesk.Viewing.i18n.translate(t),e.appendChild(i),i},i.prototype.addCallbackToMenuItem=function(e,t){var i=this;e.addEventListener("click",function(e){return i.hide(),t(),e.preventDefault(),!1},!1)},i.prototype.addSubmenuCallbackToMenuItem=function(e,t,i,n){var o=this;e.addEventListener("click",function(){o.showMenu(t,i,n)},!1)},i.prototype.hide=function(){if(this.open){for(var e=0;e<this.menus.length;++e)this.menus[e]&&this.menus[e].parentNode.removeChild(this.menus[e]);return this.menus=[],this.open=!1,document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener),this.isTouch=!1,!0}return!1},Autodesk.Viewing.Private.ContextMenu=i}(),function(){"use strict";Autodesk.Viewing.UI;var e=Autodesk.Viewing.Private,t=function(t){this.viewer=t,this.contextMenu=new e.ContextMenu(t)};t.prototype.constructor=t,t.prototype.show=function(e){var t=this.viewer.getSelectionCount(),i=this.viewer.getSelectionVisibility(),n={numSelected:t,hasSelected:0<t,hasVisible:i.hasVisible,hasHidden:i.hasHidden},o=this.buildMenu(e,n);this.viewer.runContextMenuCallbacks(o,n),o&&0<o.length&&this.contextMenu.show(e,o)},t.prototype.hide=function(){return this.contextMenu.hide()},t.prototype.buildMenu=function(e,t){return null},Autodesk.Viewing.UI.ObjectContextMenu=t}(),Autodesk.Viewing.Private.Preferences=function(e,t){function i(e,i){if(u){if(h.hasTag(e,"no-storage"))return;var n=t.prefix+e;return void 0!==i?localStorage[n]=i:i=localStorage[n],i}}function n(e,t){if("string"==typeof e&&"function"!=typeof h[e]){var n=i(e),o=!1;if(void 0!==n)try{n=JSON.parse(n),o=!0}catch(e){}h[e]=o?n:t,c[e]={}}else s.logger.log("Preferences: invalid name="+e)}function o(e){u&&(e=t.prefix+e,delete localStorage[e])}"string"==typeof t&&(t={prefix:t}),t||(t={}),t.prefix||(t.prefix="Autodesk.Viewing.Preferences."),t.hasOwnProperty("localStorage")||(t.localStorage=!0);var r=Autodesk.Viewing,s=Autodesk.Viewing.Private,a={},l={},c={},u=t.localStorage&&function(){var e=t.prefix+"test";try{var i=window.localStorage;return i.setItem(e,"1"),i.removeItem(e),!0}catch(e){return!1}}(),h=this;e.addEventListener(r.PREF_CHANGED_EVENT,function(e){var t=l[e.name];if(t){var i=t.changed;i&&i(e.value)}}),e.addEventListener(r.PREF_RESET_EVENT,function(e){var t=l[e.name];if(t){var i=t.reset;i&&i(e.value)}}),this.load=function(e){a=e;for(var t in a)a.hasOwnProperty(t)&&n(t,a[t])},this.tag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(a);for(var i=0;i<t.length;++i)c[t[i]][e]=!0}},this.untag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(a);for(var i=0;i<t.length;++i)c[t[i]][e]=!1}},this.hasTag=function(e,t){var i=c[e];return!!i&&!0===i[t]},this.add=function(e,t,i){if(!a.hasOwnProperty(e)){if(a[e]=t,n(e,t),i){Array.isArray(i)||(i=[i]);for(var o=0;o<i.length;++o)this.tag(i[o],e)}return!0}return s.logger.log("Preferences: "+e+" already exists"),!1},this.remove=function(e,t){return!!a.hasOwnProperty(e)&&(delete a[e],delete c[e],delete this[e],t&&o(e),!0)},this.reset=function(t,i){t&&void 0===i&&(i=!0);for(var n in a)if(a.hasOwnProperty(n)){if(t){var s=!!c[n][t];if(i&&!s||!i&&s)continue}this.set(n,a[n],!1)&&e.fireEvent({type:r.PREF_RESET_EVENT,name:n,value:this[n]}),o(n)}},this.get=function(e){return this[e]},this.set=function(t,n,o){return this[t]!==n&&(this[t]=n,i(t,n),(void 0===o||o)&&e.fireEvent({type:r.PREF_CHANGED_EVENT,name:t,value:n}),s.logger.track({category:"pref_changed",name:t,value:n}),!0)},this.addListeners=function(e,t,i){l[e]={changed:t,reset:i}},this.removeListeners=function(e){void 0!==l[e]&&delete l[e]}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(e,t,i,n){function o(e){var t=0<=e?Math.floor(e):Math.ceil(e);return{intPart:t,fracPart:e-t}}function r(e,t,i){var n="";return i&&0===e&&(n+="-"),n+=0<t?e.toFixed(t):e.toFixed(0)}function s(e,t,i){for(var n="",s=1,a=e<0,l=0;l<t;++l)s*=2;e>0?e+=.5/s:e-=.5/s;var c,u;i?u=e:(n+=r(c=o(e/12).intPart,0,a)+"' ",(u=e-12*c)<0&&(u=-u));var h=o(u).intPart,d=o((u-h)*s).intPart;if(0!==d&&0===h||(n+=r(h,0)),0!==d){for(h<0&&d<0&&(d=-d);d%2==0;)d/=2,s/=2;0!==h&&(n+="-"),n+=r(d,0)+"/"+r(s,0)}return n+='"'}function a(e,t){var i="";e<0&&(i="-",e=Math.abs(e));var n=o(e),s=n.intPart,a=100*n.fracPart;return i+r(s,0)+" m "+r(a,t)+" cm"}function l(e,t){var i="";e<0&&(i="-",e=Math.abs(e));var n=o(e),s=n.intPart,a=12*n.fracPart;return i+r(s,0)+"' "+r(a,t)+'"'}var c;null===n&&(n=3);try{if(1===i)c=Autodesk.Viewing.i18n.translate(e?"Yes":"No");else if(24===i){var u=e.split(" ");c=[];for(var h=0;h<u.length;++h)c.push(Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(u[h]),t,3,n));c=c.join(", ")}else 2!==i&&3!==i||!isNaN(e)?"ft-and-fractional-in"===t?c=s(12*e,n):"ft-and-fractional-in^2"===t?c=s(12*e,n)+" "+String.fromCharCode(178):"ft-and-decimal-in"===t?c=l(e,n):"ft-and-decimal-in^2"===t?c=l(e,n)+" "+String.fromCharCode(178):"decimal-in"===t||"in"===t||"inch"===t?c=r(e,n)+'"':"decimal-in^2"===t||"in^2"===t||"inch^2"===t?c=r(e,n)+'" '+String.fromCharCode(178):"decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t?c=r(e,n)+"'":"decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t?c=r(e,n)+"' "+String.fromCharCode(178):"fractional-in"===t?c=s(e,n,!0):"fractional-in^2"===t?c=s(e,n,!0)+" "+String.fromCharCode(178):"m-and-cm"===t?c=a(e,n):"m-and-cm^2"===t?c=a(e,n)+" "+String.fromCharCode(178):3===i&&t?(t=t.replace("^2",String.fromCharCode(178)),t=t.replace("^3",String.fromCharCode(179)),c=r(e,n)+" "+t):c=t?e+" "+t:3===i?r(e,n):e:c="NaN"}catch(i){c=t?e+" "+t:e}return c},Autodesk.Viewing.Private.convertUnits=function(e,t,i,n,o){if(i=i||1,e===t&&1==i)return n;var r=1;switch(t){case"mm":r=1e3;break;case"cm":r=100;break;case"m":r=1;break;case"in":r=39.37007874;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":r=3.280839895;break;case"decimal-in":r=39.37007874;break;case"decimal-ft":r=3.280839895;break;case"fractional-in":r=39.37007874;break;case"m-and-cm":r=1}var s=1;switch(e){case"mm":s=.001;break;case"cm":s=.01;break;case"m":s=1;break;case"in":s=.0254;break;case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":s=.3048;break;case"decimal-in":s=.0254;break;case"decimal-ft":s=.3048;break;case"fractional-in":s=.0254;break;case"m-and-cm":s=1}return"square"===o?n*Math.pow(r*s*i,2):n*r*s*i},AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private;t.OptionSlider=function(t,i,n,o,r){function s(e){e.target!=a.stepperElement&&(a.stepperElement.value=a.sliderElement.value),a.fireChangeEvent()}var a=this;this.tbody=o;var l=r&&r.insertAtIndex?r.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l);var c=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=t+"_slider",this.sliderElement.min=i,this.sliderElement.max=n,c.appendChild(this.caption),c.appendChild(this.sliderElement),c=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=t+"_stepper",this.stepperElement.min=i,this.stepperElement.max=n,this.stepperElement.step=1,this.stepperElement.style.width="64px",c.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(e){e.target!=a.sliderElement&&(a.sliderElement.value=a.stepperElement.value),a.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",s,!1),this.sliderElement.addEventListener("input",s,!1)},t.OptionSlider.prototype.constructor=t.OptionSlider,e.EventDispatcher.prototype.apply(t.OptionSlider.prototype),t.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(e)}},t.OptionSlider.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},t.OptionSlider.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox=function(t,i,n,o){var r=this;this.tbody=i;var s=o&&o.insertAtIndex?o.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(s);var a=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),a.appendChild(this.caption),a=this.sliderRow.insertCell(1),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=t+"_check",this.checkElement.checked=n,a.appendChild(this.checkElement),this.blockEvent=!1,this.checked=n,this.checkElement.addEventListener("change",function(e){r.fireChangeEvent()},!1),e.isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(e){e.preventDefault(),e.target.click()})),this.checkElement.addEventListener("click",function(e){e.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(e){r.checkElement.disabled||(r.checkElement.checked=!r.checkElement.checked,r.fireChangeEvent())},!1)},t.OptionCheckbox.prototype.constructor=t.OptionCheckbox,e.EventDispatcher.prototype.apply(t.OptionCheckbox.prototype),t.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(e)}},t.OptionCheckbox.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},t.OptionCheckbox.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},t.OptionCheckbox.prototype.getValue=function(){return this.checkElement.checked},t.OptionCheckbox.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},t.OptionLabel=function(t,i,n){this.tbody=i;var o=n&&n.insertAtIndex?n.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(o);var r=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),r.appendChild(this.caption),r.colSpan="2",r.style.paddingLeft="10px",r.style.paddingRight="10px",this.blockEvent=!1},t.OptionDropDown=function(t,i,n,o,r,s){var a=this;this.tbody=i;var l=s&&s.insertAtIndex?s.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(l),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=t+"_dropdown",this.dropdownElement.className="optionDropDown";for(var c=0;c<n.length;c++){var u=document.createElement("option");u.value=c,u.setAttribute("data-i18n",n[c]),u.textContent=e.i18n.translate(n[c]),this.dropdownElement.add(u)}this.selectedIndex=this.dropdownElement.selectedIndex=o;var h=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),h.appendChild(this.caption),r?(h.colSpan="2",h.style.paddingLeft="10px",h.style.paddingRight="10px",this.sliderRow=this.tbody.insertRow(l),(h=this.sliderRow.insertCell(0)).appendChild(this.dropdownElement),h.colSpan="2",this.dropdownElement.style.width="100%"):(h=this.sliderRow.insertCell(1)).appendChild(this.dropdownElement),h.style.paddingLeft="5px",h.style.paddingRight="5px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(e){a.fireChangeEvent()},!1)},t.OptionDropDown.prototype.constructor=t.OptionDropDown,e.EventDispatcher.prototype.apply(t.OptionDropDown.prototype),t.OptionDropDown.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},t.OptionDropDown.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},t.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(e)}},t.OptionDropDown.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e}}(),function(){"use strict";var e=function(e){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,e.appendChild(this.bg),this.widthScale=this.fg.clientWidth};e.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*e*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(e){var t=this,i=Autodesk.Viewing,n=Autodesk.Viewing.Private;this.viewer=e,Autodesk.Viewing.UI.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70,marginTop:20}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.celToggle=new n.OptionCheckbox("Cel Shaded",this.tbody,!1),this.addEventListener(this.celToggle,"change",function(i){var n=t.celToggle.checked;e.prefs.set("celShaded",n),e.impl.toggleCelShading(n)}),this.saoToggle=new n.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(i){var n=t.saoToggle.checked;e.prefs.set("ambientShadows",n),e.setQualityLevel(n,e.impl.renderer().settings.antialias)}),this.saoRadius=new n.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.saoIntensity=new n.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new n.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(i){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))}),this.groundShadowColor=new n.OptionCheckbox("Shadow Color",this.tbody),i.isIE11||(this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(i){var n=t.groundShadowColor.checkElement.value;e.setGroundShadowColor(new THREE.Color(parseInt(n.substr(1,7),16)))}),this.groundReflectionAlpha=new n.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(i){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))}),this.groundReflectionColor=new n.OptionCheckbox("Reflection Color",this.tbody),i.isIE11||(this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(i){var n=t.groundReflectionColor.checkElement.value;e.setGroundReflectionColor(new THREE.Color(parseInt(n.substr(1,7),16)))});for(var o=[],r=0;r<n.LightPresets.length;r++)o.push(n.LightPresets[r].name);this.envSelect=new n.OptionDropDown("Environment",this.tbody,o,e.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(i){var n=t.envSelect.selectedIndex;e.setLightPreset(n)});var s=e.impl.renderer().getToneMapMethod();this.toneMapMethod=new n.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],s),this.addEventListener(this.toneMapMethod,"change",function(){var i=t.toneMapMethod.selectedIndex;e.impl.setTonemapMethod(i)}),this.exposureBias=new n.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(i){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.exposureBias.setDisabled(0==s),this.whiteScale=new n.OptionSlider("Light Intensity",-5,20,this.tbody);var a=0;e.impl.dir_light1&&(a=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(a),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(i){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.fovAngle=new n.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",function(i){e.setFOV(parseFloat(t.fovAngle.value))}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(i){var n=parseFloat(t.fovAngle.value),o=e.getFOV();n!=o&&t.fovAngle.setValue(o)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(e){t.syncUI()}),this.addVisibilityListener(function(){t.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var e=this.viewer.impl,t=0;e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias());var i=e.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(i),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==i),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV()),this.celToggle.setValue(e.renderer().settings.toonShaded)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.bgSelect=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict";var e=Autodesk.Viewing,t=Autodesk.Viewing.UI,i=function(i,n,o){this.viewer=i,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=-1!==navigator.userAgent.search("Mac OS");var r="Layer Manager",s=i.config.viewableName,a=!0;s&&"W2D"!==s&&(r=e.i18n.translate(r)+": "+s,a=!1),this.filterImageId=o+"-layerFilterImageId",t.DockingPanel.call(this,i.container,o,r,{localizeTitle:a}),this.container.classList.add("layersPanel"),this.filterContainer=document.createElement("div"),this.filterContainer.className="filterBox",this.filterContainer.id=this.container.id+"-search-container",this.container.appendChild(this.filterContainer),this.createScrollContainer({heightAdjustment:105,marginTop:5});var l=this;i.model?l.build():l.addEventListener(i,e.GEOMETRY_LOADED_EVENT,function(){l.build()}),this.addVisibilityListener(function(){l.resizeToContent()})};(i.prototype=Object.create(t.DockingPanel.prototype)).constructor=i,i.prototype.uninitialize=function(){t.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.visibilityImages=null,this.scrollContainer=null,this.filterContainer=null},i.prototype.build=function(){function i(){l&&clearTimeout(l),l=setTimeout(n,500)}function n(){function e(i){var n=[];if(-1!==i.name.toLowerCase().indexOf(t))n.push(i);else if(!i.isLayer)for(var o=i.children,r=0;r<o.length;++r)n=n.concat(e(o[r]));return n}if(a.value){var t=a.value.toLowerCase();h&&0<h.childCount&&c.setLayerVisible(e(h),!0,!0)}else c.setLayerVisible(null,!0);l=null}var o=this,r=document.createElement("div");r.className="filterSearch",o.filterContainer.appendChild(r);var s=document.createElement("div");s.className="filterImage",s.id=o.filterImageId,s.title=e.i18n.translate("Show/hide all layers"),r.appendChild(s),o.visibilityImages[o.filterImageId]=s,o.addEventListener(s,"click",function(e){o.onImageClick(null,e),e.stopPropagation()});var a=this.filterField=document.createElement("input");a.className="filterInput",a.placeholder=e.i18n.translate("Enter filter term"),a.setAttribute("data-i18n","[placeholder]Enter filter term"),a.type="search",a.incremental="incremental",r.appendChild(a);var l=null,c=o.viewer;a.addEventListener("keyup",function(e){i()}),a.addEventListener("click",function(e){""!==a.value?setTimeout(function(){""===a.value&&(c.setLayerVisible(null,!0),e.preventDefault())},1):c.setLayerVisible(null,!0)});var u=function(){var e=new t.TreeDelegate;return e.getTreeNodeId=function(e){return e.id},e.getTreeNodeLabel=function(e){return o.getNodeLabel(e)},e.getTreeNodeClass=function(e){return o.getNodeClass(e)},e.isTreeNodeGroup=function(e){return o.isGroupNode(e)},e.shouldCreateTreeNode=function(e){return o.shouldInclude(e)},e.onTreeNodeClick=function(e,t,i){o.onClick(t,i)},e.onTreeNodeRightClick=function(e,t,i){o.onRightClick(t,i)},e.onTreeNodeDoubleClick=function(e,t,i){o.onDoubleClick(t,i)},e.onTreeNodeIconClick=function(e,t,i){o.onIconClick(t,i)},e.createTreeNode=function(e,t){o.createNode(e,t)},e}(),h=o.layersRoot=o.viewer.model.getLayersRoot();h&&(o.tree=new t.Tree(u,h,o.scrollContainer,{excludeRoot:!0}),o.resizeToContent(),o.update(),o.addEventListener(o.viewer,e.LAYER_VISIBILITY_CHANGED_EVENT,function(){o.update()}))},i.prototype.update=function(){function e(e,t){var i;i=1===t?"layerVisible":0===t?"layerHidden":"layerMixed",e.classList.remove("layerVisible"),e.classList.remove("layerHidden"),e.classList.remove("layerMixed"),e.classList.add(i)}function t(e,t){0===t?o.tree.addClass(e.id,"dim"):o.tree.removeClass(e.id,"dim")}function i(e){var t;if(0<e.length)for(var i=0;i<e.length;++i){var n=e[i];if(void 0===t?t=n:0===n&&1===t?t=-1:1===n&&0===t&&(t=-1),-1===t)break}else t=0;return t}function n(r){var s=r.id,a=o.visibilityImages[s];if(!r.isLayer){for(var l=r.children,c=[],u=0;u<l.length;++u)c=c.concat(n(l[u]));var h=i(c);return e(a,h),t(r,h),c}var d=o.viewer.isLayerVisible(r)?1:0;return e(a,d),t(r,d),[d]}var o=this,r=this.layersRoot&&0<this.layersRoot.childCount?n(o.layersRoot):[];e(o.visibilityImages[o.filterImageId],i(r))},i.prototype.setLayerVisible=function(e,t){var i=e?e.id:this.filterImageId,n="layerVisible"!==this.visibilityImages[i].className;this.viewer.setLayerVisible(e,n,t),this.filterField.value="",this.viewer.clearSelection()},i.prototype.getNodeLabel=function(e){return e.isLayer||0===e.childCount?e.name:e.name+" ("+e.childCount+")"},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){return!e.isLayer},i.prototype.shouldInclude=function(e){return!0},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){var i=this.tree.delegate();if(i.isTreeNodeGroup(e)){var n=i.getTreeNodeId(e);this.tree.setCollapsed(n,t),this.resizeToContent()}},i.prototype.isGroupCollapsed=function(e){var t=this.tree.delegate();if(t.isTreeNodeGroup(e)){var i=t.getTreeNodeId(e);return this.tree.isCollapsed(i)}return!1},i.prototype.onClick=function(e,t){},i.prototype.onDoubleClick=function(e,t){},i.prototype.onRightClick=function(e,t){},i.prototype.onImageClick=function(e,t){},i.prototype.getContentSize=function(){var e=this.filterContainer,t=e.clientHeight+80,i=e.clientWidth,n=this.tree;if(n){var o=n.getRootContainer();if(o)return{height:o.clientHeight+t,width:Math.max(o.clientWidth,i)}}return{height:t,width:i}},i.prototype.createNode=function(t,i){var n=document.createElement("div");i.children&&i.children.length>0?i.insertBefore(n,i.children[0]):i.appendChild(n),n.title=e.i18n.translate("Show/hide this layer"),this.visibilityImages[t.id]=n;var o=document.createElement("label");o.textContent=this.getNodeLabel(t),i.appendChild(o);var r=this;this.addEventListener(n,"click",function(e){r.onImageClick(t,e),e.stopPropagation()})},Autodesk.Viewing.UI.LayersPanel=i}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(e,t,i,n){Autodesk.Viewing;Autodesk.Viewing.UI.DockingPanel.call(this,e,t,i,n),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0;var o=this,r=n&&void 0!==n.width?n.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=r+"px",this.container.style.top="100px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.className="settings-tabs",this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=n&&n.heightAdjustment?n.heightAdjustment:110,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver)return!0;for(i=0;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0;for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.remove("selectedmouseout");return!0}t=t.parentNode}}),this.addEventListener(this.container,"mouseout",function(e){var t=e.toElement||e.relatedTarget;if(o.mouseOver){for(;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}o.mouseOver=!1;for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.contains("tabselected")&&o.panelTabs[i].classList.add("selectedmouseout")}}),this.expandID=function(e){return t+"-"+e}},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(e){e&&(this.container.style.display="block"),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,e)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(e,t,i){function n(t){o.selectTab(e)}var o=this;if(void 0!==this.tabIdToIndex[e])return!1;var r=i&&void 0!==i.className?i.className:null,s=i&&void 0!==i.width?i.width:200,a=i&&void 0!==i.index?i.index:this.panelTabs.length,l=document.createElement("li");l._id=e,l.id=this.expandID(l._id);var c=document.createElement("a"),u=document.createElement("span");u.setAttribute("data-i18n",t),u.textContent=Autodesk.Viewing.i18n.translate(t),c.appendChild(u),l.appendChild(c),this.tabs.appendChild(l);var h=document.createElement("table");h._id=e+"-table",h.id=this.expandID(h._id),h.className="settings-table adsk-lmv-tftable "+r;var d=document.createElement("tbody");return h.appendChild(d),this.scrollContainer.appendChild(h),this.addEventListener(l,"touchstart",av.touchStartToClick),this.addEventListener(l,"click",n),this.panelTabs.push(l),this.tabIdToIndex[e]=a,s>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=s+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(e){var t=this.tabIdToIndex[e];if(!t)return!1;this.panelTabs.splice(t,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={};for(var i=this.panelTabs.length,n=0;n<i;n++){var o=this.panelTabs[n];this.tabIdToIndex[o._id]=n}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(e){var t=this.tabIdToIndex[e];return void 0!==this.panelTabs[t]},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1;for(var t=this.panelTabs.length,i=0;i<t;i++){var n=this.panelTabs[i],o=document.getElementById(this.expandID(n._id+"-table"));e===n._id?(n.classList.add("tabselected"),o.style.display="table",this.mouseOver||n.classList.add("selectedmouseout")):(n.classList.remove("tabselected"),o.style.display="none",this.mouseOver||this.panelTabs[i].classList.remove("selectedmouseout"))}return this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t];return i&&i.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(e,t,i,n,o){if(void 0===this.tabIdToIndex[e])return null;var r=document.getElementById(this.expandID(e+"-table")),s=new Autodesk.Viewing.Private.OptionCheckbox(t,r.tBodies[0],i,o);return s.changeListener=function(e){var t=e.detail.target.checked;n(t)},this.addEventListener(s,"change",s.changeListener),this.addControl(e,s)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(e,t,i,n,o,r,s){if(void 0===this.tabIdToIndex[e])return null;var a=document.getElementById(this.expandID(e+"-table")),l=new Autodesk.Viewing.Private.OptionSlider(t,i,n,a.tBodies[0],s);return l.setValue(o),l.sliderElement.step=l.stepperElement.step=1,this.addEventListener(l,"change",function(e){r(e)}),this.addControl(e,l)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(e,t,i,n,o,r){if(void 0===this.tabIdToIndex[e])return null;var s=document.getElementById(this.expandID(e+"-table")),a=new Autodesk.Viewing.Private.OptionDropDown(t,s.tBodies[0],i,n,r);return this.addEventListener(a,"change",function(e){o(e)}),this.addControl(e,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(e,t,i){if(void 0===this.tabIdToIndex[e])return null;if(!t.hasOwnProperty("sliderRow")){var n=i&&i.insertAtIndex?i.insertAtIndex:-1,o=i&&i.caption?i.caption:null,r=document.getElementById(this.expandID(e+"-table"));n>r.length&&(n=-1);var s=r.tBodies[0].insertRow(n),a=s.insertCell(0);if(o){var l=document.createElement("div");l.setAttribute("data-i18n",o),l.textContent=Autodesk.Viewing.i18n.translate(o),a.appendChild(l),a=s.insertCell(1)}else a.colSpan=2;a.appendChild(t),t.sliderRow=s,t.tbody=r.tBodies[0]}var c=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString());return this.controlIdCount=this.controlIdCount+1,this.controls[c]=t,this.resizeToContent(),c},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(e){var t;if(void 0===(t="object"==typeof e&&e.tbody?e:this.controls[e]))return!1;var i=t.tbody,n=t.sliderRow.rowIndex;return i.deleteRow(n),delete this.controls[e],this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(e){return this.controls[e]||null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=this.panelTabs.length>this.panelTabs[0]?0:null,i=0;i<this.panelTabs.length;i++){var n=this.panelTabs[i];if(this.isTabSelected(n._id)){t=n;break}}return t&&(e+=document.getElementById(this.expandID(n._id+"-table")).clientHeight),{height:e,width:this.container.clientWidth}},function(){"use strict";var e=function(){};e.instances=[],e.displayError=function(t,i,n,o,r){var s=document.createElement("div");s.className="alertBox error",t.appendChild(s);var a=o;a||(a="img-item-not-found");var l=document.createElement("div");l.className="alertBoxImage "+a,s.appendChild(l);var c=document.createElement("div");c.className="alertBoxMsg",s.appendChild(c);var u=n;u||(u=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var h=document.createElement("div");h.className="alertBoxTitle",h.textContent=u,c.appendChild(h);var d=document.createElement("div");if(d.className="alertBoxText",d.textContent=i,c.appendChild(d),r){var p=document.createElement("div");p.className="alertBoxContent",c.appendChild(p);var g=document.createElement("ul");g.className="alertBoxContent";for(var m=0;m<r.length;m++){var v=r[m];if(v){var f=document.createElement("li");g.appendChild(f);var E=this.extractList(v);if(E.list.length){var A=this.generateListElement(list);g.appendChild(A)}f.innerHTML=E.msg}}p.appendChild(g)}var y=document.createElement("div");y.className="alertBoxOK",y.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var T={alertBox:s,container:t};y.addEventListener("click",function(i){s.style.visibility="hidden",t.removeChild(s),e.instances.splice(e.instances.indexOf(T),1)}),s.appendChild(y),s.style.visibility="visible",e.instances.push(T)},e.displayErrors=function(t,i,n){var o=document.createElement("div");o.className="alertBox errors",t.appendChild(o);var r=i;r||(r="img-item-not-found");var s=document.createElement("div");s.className="alertBoxImage "+r,o.appendChild(s);var a=document.createElement("div");a.className="alertBoxMsg errors",o.appendChild(a);for(var l=0;l<n.length;l++){var c=n[l].header;c||(c=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var u=document.createElement("div");u.className="alertBoxTitle errors",u.textContent=c,a.appendChild(u);var h=document.createElement("div");h.className="alertBoxText errors";var d=n[l].msg,p=this.extractList(d);if(p.list.length){var g=document.createElement("div"),m=this.generateListElement(p.list);g.appendChild(m),h.textContent=p.msg,h.appendChild(g)}else h.textContent=d;if(a.appendChild(h),n[l].hints){var v=document.createElement("ul");v.className="alertBoxContent";for(var f=n[l].hints,E=0;E<f.length;E++){var A=f[E];if(A){var y=document.createElement("li");if(v.appendChild(y),(p=this.extractList(A)).list.length){m=this.generateListElement(p.list);v.appendChild(m)}y.innerHTML=p.msg}}a.appendChild(v)}}var T=document.createElement("div");T.className="alertBoxOK",T.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:o,container:t};T.addEventListener("click",function(i){o.style.visibility="hidden",t.removeChild(o),e.instances.splice(e.instances.indexOf(w),1)}),o.appendChild(T),o.style.visibility="visible",e.instances.push(w)},e.extractList=function(e){var t={msg:e,list:[]};if(e&&-1!=e.indexOf("<ul>")){var i=e.split("<ul>");t.msg=i[0],i=i[1].split("</ul>"),t.list=i[0].split(", "),1===t.list.length&&(t.list=i[0].split(","))}return t},e.generateListElement=function(e){for(var t=document.createElement("ul"),i=0;i<e.length;i++){var n=document.createElement("li");n.textContent=e[i],t.appendChild(n)}return t},e.dismiss=function(){if(e.instances.length>0){var t=e.instances.pop();return t.alertBox.style.visibility="hidden",t.container.removeChild(t.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=e}(),function(){"use strict";var e=Autodesk.Viewing,t=function(){};t.instances=[],t.displayMessage=function(i,n,o,r,s){if(!(t.instances.length>0)){var a=n.msgTitleKey,l=n.msgTitleDefaultValue||a,c=n.messageKey,u=n.messageDefaultValue||c,h=n.buttonText,d=n.checkboxChecked||!1,p=document.createElement("div");p.className="hud",i.appendChild(p);var g=document.createElement("div");if(g.className="hudTitle",g.textContent=e.i18n.translate(a,{defaultValue:l}),g.setAttribute("data-i18n",a),p.appendChild(g),o){var m=document.createElement("div");m.className="hudClose",m.innerHTML="&times;",m.addEventListener("click",function(e){t.dismiss(),o&&o(e)}),p.appendChild(m)}var v=document.createElement("div");if(v.className="hudMessage",v.textContent=e.i18n.translate(c,{defaultValue:u}),v.setAttribute("data-i18n",u),p.appendChild(v),r){var f=document.createElement("div");f.className="hudButton",f.textContent=e.i18n.translate(h,{defaultValue:h}),f.setAttribute("data-i18n",h),f.addEventListener("click",r),p.appendChild(f)}if(s){var E=document.createElement("div"),A=document.createElement("input");A.className="hudCheckbox",A.type="checkbox",A.checked=d,E.appendChild(A);var y="Do not show this message again",T=document.createElement("label");T.setAttribute("for",y),T.setAttribute("data-i18n",y),T.textContent=e.i18n.translate(y,{defaultValue:y}),E.appendChild(T),A.addEventListener("change",s),p.appendChild(E)}var w={hudMessage:p,container:i};t.instances.push(w)}},t.dismiss=function(){if(t.instances.length>0){var e=t.instances.pop();return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=t}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(){};n.prototype.constructor=n,n.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},n.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},n.prototype.getTreeNodeLabel=function(e){return e.name},n.prototype.shouldCreateTreeNode=function(e){return!0},n.prototype.forEachChild=function(e,t){for(var i=e.children?e.children.length:0,n=0;n<i;++n)t(e.children[n])},n.prototype.createTreeNode=function(e,t,i){var n=document.createElement("label");t.appendChild(n);var o=this.getTreeNodeLabel(e);i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o},n.prototype.onTreeNodeClick=function(e,t,i){},n.prototype.onTreeNodeIconClick=function(e,t,i){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},n.prototype.onTreeNodeDoubleClick=function(e,t,i){},n.prototype.onTreeNodeRightClick=function(e,t,i){},n.prototype.getTreeNodeClass=function(e){return""},n.prototype.onTreeNodeHover=function(e,t,i){};var o=function(e,t,i,n){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=n||{};this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var o=this.myRootContainer=this.createHtmlElement_(i,"div","treeview"),r=this.rootElem=this.createElement_(t,o,n,0);this.setInputHandlers_(),n&&n.excludeRoot&&r.classList.add("exclude")};o.prototype.constructor=o,o.prototype.show=function(e){var t=this.myRootContainer;t.style.display=e?"block":"none"},o.prototype.getRootContainer=function(){return this.myRootContainer},o.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},o.prototype.delegate=function(){return this.myDelegate},o.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},o.prototype.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},o.prototype.setAllCollapsed=function(e){var t,i;e?(t=function(e){return e.classList.contains("expanded")},i=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},i=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")});for(var n=0;n<this.myGroupNodes.length;++n){var o=this.myGroupNodes[n];t(o)&&i(o)}},o.prototype.addToSelection=function(e){for(var t=this,i=e.length,n=0;n<i;++n){var o=e[n];(function(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)})(o)&&this.addClass(o,"selected")}},o.prototype.removeFromSelection=function(e){for(var t=this,i=e.length-1;i>=0;--i){var n=e[i];(function(e){var i=t.mySelectedNodes.indexOf(e);return-1!==i&&(t.mySelectedNodes.splice(i,1),!0)})(n)&&this.removeClass(n,"selected")}},o.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},o.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},o.prototype.isSelected=function(e){return this.hasClass(e,"selected")},o.prototype.scrollTo=function(e){var t=this.getElementForNode(e);if(t){var i=t.offsetTop;for(t=t.parentNode;t&&t!=this.myRootContainer;)i+=t.offsetTop,t=t.parentNode;this.myRootContainer.parentNode.scrollTop=i}},o.prototype.addClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.add(t),n=n.parentNode}else n.classList.add(t);return!0}return!1},o.prototype.removeClass=function(e,t,i){var n=this.getElementForNode(e);if(n){if(i){n=n.parentNode;for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.remove(t),n=n.parentNode}else n.classList.remove(t);return!0}return!1},o.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},o.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild);this.nodeToElement={},this.nodeIdToNode={}},o.prototype.createElement_=function(e,t,i,n){function o(t,n,o,r){var a=s.createHtmlElement_(t,n,o),l=s.myDelegate.getTreeNodeId(r);a.setAttribute("lmv-nodeId",l);var c=s.createHtmlElement_(a,"header");return s.createHtmlElement_(c,"icon").addEventListener("click",function(t){s.myDelegate.onTreeNodeIconClick(s,e,t),t.stopPropagation(),t.preventDefault()},!1),s.myDelegate.createTreeNode(e,c,i),a}if(void 0===e||null===e)return null;if(!this.myDelegate.shouldCreateTreeNode(e))return null;var r,s=this,a=this.myDelegate.getTreeNodeId(e);if(s.myDelegate.isTreeNodeGroup(e)){r=o(t,"group","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e;l=s.myOptions.excludeRoot?1:0;n==l&&(r.style.left="0px"),s.myGroupNodes.push(r),s.myDelegate.forEachChild(e,function(e){s.createElement_(e,r,i,n+1)})}else{r=o(t,"leaf","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e;var l=s.myOptions.excludeRoot?1:0;n==l&&(r.style.marginLeft="0px")}var c=s.myDelegate.getTreeNodeClass(e);return c&&r.classList.add(c),r},o.prototype.setInputHandlers_=function(){var e=this,i=this.myRootContainer,n=function(t){var n=null,o=!1;do{t&&t!==i?t.hasAttribute("lmv-nodeId")?(n=t,o=!0):t=t.parentElement:(n=null,o=!0)}while(!o);if(n){var r=n.getAttribute("lmv-nodeId");return e.nodeIdToNode[r]||null}return null};t.isTouchDevice()&&(this.hammer=new Hammer.Manager(i,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.on("doubletap",function(t){var i=n(t.target);null!==i&&e.myDelegate.onTreeNodeDoubleClick(e,i,t)}),this.hammer.on("press",function(t){var i=n(t.target);null!==i&&e.myDelegate.onTreeNodeRightClick(e,i,t)})),i.addEventListener("click",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeClick(e,i,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())},!1),i.addEventListener("dblclick",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeDoubleClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("contextmenu",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeRightClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseover",function(t){var i=n(t.target);null!==i&&(e.myDelegate.onTreeNodeHover(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseout",function(t){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()},!1)},o.prototype.createHtmlElement_=function(e,t,i){var n=document.createElement(t);return e.appendChild(n),i&&(n.className=i),n},o.prototype.iterate=function(e,t){if(void 0!==e&&null!==e&&this.myDelegate.shouldCreateTreeNode(e)){var i=this.getElementForNode(e);if(i){t(e,i);var n=this;this.myDelegate.forEachChild(e,function(e){n.iterate(e,t)})}}},i.TreeDelegate=e.TreeDelegate=n,i.Tree=e.Tree=o}(),function(){"use strict";var e=function(){},t=Autodesk.Viewing,i=Autodesk.Viewing.Private;e.prototype.constructor=e,e.prototype.getNodeId=function(e){throw"getId is not implemented."},e.prototype.getNodeLabel=function(e){return e.name},e.prototype.getNodeClass=function(e){return""},e.prototype.hasThumbnail=function(e){return!1},e.prototype.getThumbnailOptions=function(e){return null},e.prototype.getThumbnail=function(e){return null},e.prototype.onNodeClick=function(e,t,i){},e.prototype.onNodeHover=function(e,t,i){},e.prototype.selectItem=function(e){},e.prototype.deselectItem=function(e){},e.prototype.hasContent=function(e){return!1},e.prototype.addContent=function(e,t){};var n=function(e,t,i){this.myDelegate=e,this.mySelectedIds=[];this.myRootContainerId=i+"-browserview",this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),document.getElementById(i).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)};n.prototype.constructor=n,n.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},n.prototype.getRootContainer=function(){return this.myRootContainer},n.prototype.delegate=function(){return this.myDelegate},n.prototype.addToSelection=function(e){for(var t=this,i=0,n=e.length;i<n;++i){var o=e[i];if(function(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}(o)){var r=t.idToElement[o];void 0===r?t.myDelegate.selectItem(o):r.classList.add("selected")}}},n.prototype.removeFromSelection=function(e){for(var t=this,i=e.length-1;i>=0;--i){var n=e[i];if(function(e){var i=t.mySelectedIds.indexOf(e);return-1!=i&&(t.mySelectedIds.splice(i,1),!0)}(n)){var o=this.idToElement[n];void 0===o?t.myDelegate.deselectItem(n):o.classList.remove("selected")}}},n.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},n.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},n.prototype.createElements=function(e,t){if(e)for(var i=this,n=0;n<e.length;n++){var o=e[n];i.createElement(o,t)}},n.prototype.createElement=function(e,n){var o=this,r=o.myDelegate.getNodeId(e),s=document.createElement("item");n.appendChild(s),this.idToElement[r]=s,s.onmouseover=function(){o.myDelegate.onNodeHover(o,e)},s.onclick=function(t){o.myRootContainer.querySelector(".flipped").removeClass("flipped"),o.myDelegate.onNodeClick(o,e,t)};var a=document.createElement("div");a.classList.add("card"),s.appendChild(a);var l=document.createElement("div");l.classList.add("browserElement"),a.appendChild(l);var c=o.myDelegate.getNodeLabel(e),u=document.createElement("label");u.innerHTML=c,l.appendChild(u),u.onclick=function(t){o.myDelegate.onNodeClick(o,e,t)};var h=o.myDelegate.getThumbnail(e);if(h){var d=document.createElement("img");if(d.classList.add("thumb"),!1===LMV_THIRD_PARTY_COOKIE){var p=o.myDelegate.getThumbnailOptions(e);t.Document.requestThumbnailWithSecurity(p,function(e,n){e?i.logger.error("Failed to load thumbnail: "+h,t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)):(d.src=window.URL.createObjectURL(n),d.onload=function(){window.URL.revokeObjectURL(d.src)})})}else d.src=h;l.appendChild(d),d.onclick=function(t){o.myDelegate.onNodeClick(o,e,t)}}o.myDelegate.hasContent(e)&&o.myDelegate.addContent(e,a),s.classList.add(o.myDelegate.getNodeClass(e))},Autodesk.Viewing.Private.BrowserDelegate=e,Autodesk.Viewing.Private.Browser=n}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing.Private;e.WEBGL_HELP_LINK=null,e.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You dont have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We cant display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Theres nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldnt connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":"<title> Sorry </title><message>The file extension loaded into the Viewer is not supported.</message><hint> Try a different file.</hint>"}},e.currentError=null,e.currentErrors=null,e.ErrorHandler=function(){},e.ErrorHandler.prototype.constructor=e.ErrorHandler,e.ErrorHandler.getErrorCode=function(e){return 403===e||401===e?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===e?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:e>=500?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE},e.ErrorHandler.reportError=function(t,i,n,o,r,s){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){var a={category:"error",code:i,message:n,httpStatusCode:o,httpStatusText:r};e.logger.track(a,!0),e.ErrorHandler.currentError=[t,i,n,s];var l=e.ErrorInfoData[i];if(l){(g={defaultValue:""}).defaultValue=l["default-msg"];var c=l.img,u=l["globalized-msg"],h=this.parseErrorString(u,g);if(i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var d=e.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",p=0;p<h.hints.length;p++)-1!==h.hints[p].indexOf('href="WEBGL_HELP"')&&(h.hints[p]=h.hints[p].replace('href="WEBGL_HELP"','href="'+d+'"'));e.AlertBox.displayError(t,h.msg,h.header,c,h.hints)}else{var c="img-unsupported",g={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(n,g),(h=this.parseErrorString(i,g)).header||(h.header="warning"===s?Autodesk.Viewing.i18n.translate("header-warning"):""),e.AlertBox.displayError(t,h.msg,h.header,c,h.hints)}}},e.ErrorHandler.reportErrors=function(t,i){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){e.ErrorHandler.currentErrors=[t,i];for(var n={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},o=[],r=0;r<i.length;r++)if(i[r].code){this.parseArguments(i[r].message,n);var s=this.parseErrorString(i[r].code,n);s.header||(s.header="warning"===i[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),o.push(s);var a={category:"error",code:i[r].code,message:i[r].message};e.logger.track(a,!0)}if(o.length){e.AlertBox.displayErrors(t,"img-unsupported",o)}}},e.ErrorHandler.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e;else{t.defaultValue=e[0];for(var i=1;i<e.length;i++)t[(i-1).toString()]=e[i]}},e.ErrorHandler.parseErrorString=function(e,t){var i={msg:null,msgList:null,header:null,hints:null};if(!e)return i;var n=Autodesk.Viewing.i18n.translate(e,t);if(!n)return i;if(-1!=n.indexOf("<title>")){o=n.split("<title>")[1].split("</title>");i.header=o[0],n=o[1]}if(n&&-1!=n.indexOf("<message>")){var o=n.split("<message>")[1].split("</message>");i.msg=o[0],n=o[1]}else i.msg=n;if(n&&-1!=n.indexOf("<hint>")){i.hints=[];for(var r=n.split("<hint>"),s=0;s<r.length;s++){var a=r[s].split("</hint")[0];i.hints.push(a)}}return i},e.ErrorHandler.localize=function(){if(e.AlertBox.instances.length>0)if(e.AlertBox.dismiss(),e.ErrorHandler.currentError){var t=e.ErrorHandler.currentError.shift(),i=e.ErrorHandler.currentError;e.ErrorHandler.reportError(t,i[0],i[1],i[2])}else{var t=e.ErrorHandler.currentErrors.shift(),n=e.ErrorHandler.currentErrors[0];e.ErrorHandler.reportErrors(t,n)}}}(),function(){"use strict";var e=function(e,t){this.viewer=e,this.options=t,this.id=""};e.prototype.load=function(){return!0},e.prototype.unload=function(){return!0},e.prototype.getState=function(e){},e.prototype.restoreState=function(e,t){return!0},e.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={},Autodesk.Viewing.Private.logger.warn("Extension cache runtime creation; missing ViewingApplication context."));var e=this.viewer.extensionCache[this.id];return e||(e=this.viewer.extensionCache[this.id]={}),e},Autodesk.Viewing.Extension=e}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=new function(){function e(e,t){return!o.hasOwnProperty(e)&&(o[e]=t,!0)}function t(e){return o.hasOwnProperty(e)?o[e]:null}function i(e){return!!o.hasOwnProperty(e)&&(delete o[e],!0)}function n(e){for(var t in o)o.hasOwnProperty(t)&&o[t].hasOwnProperty("populateDefaultOptions")&&o[t].populateDefaultOptions(e)}var o={};return{registerExtension:e,getExtension:t,unregisterExtension:i,popuplateOptions:n}},n=function(){};n.prototype={loadExtension:function(n,o){this.loadedExtensions||(this.loadedExtensions={});var r=!1;if(this.getExtension(n))t.logger.info("Extension already loaded: "+n);else{var s=i.getExtension(n);if(s){var a=new s(this,o);a.id=n,(r=a.load())&&(this.loadedExtensions[n]=a,t.logger.info("Extension loaded: "+n),this.fireEvent({type:e.EXTENSION_LOADED_EVENT,extensionId:n}))}else t.logger.warn("Extension not found: "+n)}return r},getExtension:function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null},unloadExtension:function(i){var n=!1,o=this.getExtension(i);return o?(n=o.unload(),t.logger.info("Extension unloaded: "+i),delete this.loadedExtensions[i],this.fireEvent({type:e.EXTENSION_UNLOADED_EVENT,extensionId:i})):t.logger.warn("Extension not found: "+i),n},apply:function(e){var t=n.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension}},Autodesk.Viewing.theExtensionManager=i,Autodesk.Viewing.ExtensionMixin=n}(),function(){"use strict";var e=Autodesk.Viewing;e.Private.init_UnifiedCamera=function(t){if(void 0===e.UnifiedCamera){var i=function(e,i){t.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/i,this.left=-e/2,this.right=e/2,this.top=i/2,this.bottom=-i/2,this.clientWidth=e,this.clientHeight=i,this.target=new t.Vector3(0,0,-1),this.worldup=new t.Vector3(0,1,0),this.orthographicCamera=new t.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new t.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()};i.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,(i.prototype=Object.create(t.Camera.prototype)).clone=function(){var e=new i(2*this.right,2*this.top);return t.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},i.prototype.__computeFovPosition=function(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone();var i=this.target.clone().sub(this.position),n=t.Math.degToRad(this.fov),o=t.Math.degToRad(e),r=i.length()*Math.tan(.5*n)/Math.tan(.5*o),s=i.normalize().multiplyScalar(-r);return this.target.clone().add(s)},i.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},i.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var e=i.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,n=t*this.aspect;this.left=this.orthographicCamera.left=-n,this.right=this.orthographicCamera.right=n,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},i.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},i.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},i.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},i.prototype.setLens=function(e,i){void 0===i&&(i=24);var n=2*t.Math.radToDeg(Math.atan(i/(2*e)));return this.setFov(n),n},i.prototype.getCameraChangedEvent=function(){return{type:e.CAMERA_CHANGE_EVENT,camera:this}},e.UnifiedCamera=i}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private;e.ESCAPE_EVENT="escape",e.PROGRESS_UPDATE_EVENT="progress",e.FULLSCREEN_MODE_EVENT="fullScreenMode",e.NAVIGATION_MODE_CHANGED_EVENT="navmode",e.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",e.VIEWER_RESIZE_EVENT="viewerResize",e.VIEWER_INITIALIZED="viewerInitialized",e.VIEWER_UNINITIALIZED="viewerUninitialized",e.MODEL_ROOT_LOADED_EVENT="svfLoaded",e.GEOMETRY_LOADED_EVENT="geometryLoaded",e.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",e.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",e.MODEL_UNLOADED_EVENT="modelUnloaded",e.EXTENSION_LOADED_EVENT="extensionLoaded",e.EXTENSION_UNLOADED_EVENT="extensionUnloaded",e.SELECTION_CHANGED_EVENT="selection",e.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",e.ISOLATE_EVENT="isolate",e.HIDE_EVENT="hide",e.SHOW_EVENT="show",e.CAMERA_CHANGE_EVENT="cameraChanged",e.EXPLODE_CHANGE_EVENT="explodeChanged",e.FIT_TO_VIEW_EVENT="fitToView",e.CUTPLANES_CHANGE_EVENT="cutplanesChanged",e.TOOL_CHANGE_EVENT="toolChanged",e.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",e.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",e.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",e.RESET_EVENT="reset",e.PREF_CHANGED_EVENT="PrefChanged",e.PREF_RESET_EVENT="PrefReset",e.ANIMATION_READY_EVENT="animationReady",e.HYPERLINK_EVENT="hyperlink",e.LOAD_GEOMETRY_EVENT="load_geometry",e.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};var i=e.isMobileDevice(),n=0;e.DefaultSettings={ambientShadows:!0,antialiasing:!i,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!i,lineRendering:!0,pointRendering:!0,lightPreset:t.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:i,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNavigation:!0,envMapBackground:!1,firstPersonToolPopup:!0};var o=function(i,o){if("undefined"==typeof THREE&&t.logger.warn("Initializing LMV without the THREE.js dependency is not supported.","Call Autodesk.Viewing.Initializer() first or preload the dependencies manually."),i){if(this.clientContainer=i,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(e.isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=o,this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this;var r={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!0};this.prefs=new t.Preferences(this,r)}this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=n++,this.impl=new t.Viewer3DImpl(this.canvas,this)};o.populateConfigOptions=function(e){},o.prototype.constructor=o,e.EventDispatcher.prototype.apply(o.prototype),e.ScreenModeMixin.prototype.apply(o.prototype),e.ExtensionMixin.prototype.apply(o.prototype),o.ScreenMode=e.ScreenMode,o.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},o.prototype.start=function(e,t,i,n){if(this.started)return 0;this.started=!0;var o=this,r=o.initialize();return 0!==r?(n&&setTimeout(function(){n(r)},1),r):(setTimeout(function(){o.setUp(o.config)},1),e&&this.loadModel(e,t,i,n),0)},o.prototype.registerUniversalHotkeys=function(){var t,i,n,o=this,r=e.theHotkeyManager.KEYCODES;t=function(){return o.navigation.setRequestFitToView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[r.f],onPress:t}]),t=function(){return o.navigation.setRequestHomeView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[r.h],onPress:t},{keycodes:[r.HOME],onPress:t}]),i=function(){return!(!o.objectContextMenu||!o.objectContextMenu.hide())||(o.fireEvent({type:e.ESCAPE_EVENT}),!0)},e.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[r.ESCAPE],onRelease:i}]),t=function(){return n=o.getActiveNavigationTool(),o.setActiveNavigationTool("pan")},i=function(){return o.setActiveNavigationTool(n)};var s=[{keycodes:[r.SHIFT],onPress:t,onRelease:i},{keycodes:[r.SPACE],onPress:t,onRelease:i}];e.theHotkeyManager.pushHotkeys("Autodesk.Pan",s,{tryUntilSuccess:!0})},o.prototype.createControls=function(){var t=this,i=t.impl;return t.navigation=new e.Navigation(i.camera),t.__initAutoCam(i),t.utilities=new e.ViewingUtilities(i,t.autocam,t.navigation),t.clickHandler=new e.DefaultHandler(i,t.navigation,t.utilities),t.toolController=new e.ToolController(i,t,t.autocam,t.utilities,t.clickHandler),t.toolController.registerTool(new e.GestureHandler(t)),t.toolController.registerTool(e.theHotkeyManager),t.toolController.activateTool(e.theHotkeyManager.getName()),t.registerUniversalHotkeys(),t.toolController.registerTool(new e.OrbitDollyPanTool(i,t)),t.toolController},o.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var i=this.getDimensions();if(this.canvas.width=i.width,this.canvas.height=i.height,e.isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var n=e.detectWebGL();if(n<=0)return-1===n?e.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:e.ErrorCodes.BROWSER_WEBGL_DISABLED}var r=this;this.onResizeCallback=function(e){r.resize()},window.addEventListener("resize",this.onResizeCallback,!1),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var s=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(s),!s.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner);for(var a=1;a<=3;a++){var l=document.createElement("div");l.className="bounce"+a,this.loadSpinner.appendChild(l)}}return this.initSettings(),this.viewerState=new t.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.fireEvent(e.VIEWER_INITIALIZED),0},o.prototype.setUp=function(e){if(this.config=e,this.config&&this.config.hasOwnProperty("extensions"))for(var t=this.config.extensions,i=0;i<t.length;++i)this.loadExtension(t[i],this.config);var n=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig;this.setCanvasClickBehavior(n)},o.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var i in this.loadedExtensions)try{this.unloadExtension(i)}catch(n){t.logger.error("Failed to unload extension: "+i,n,e.errorCodeString(e.ErrorCodes.VIEWER_INTERNAL_ERROR)),t.logger.track({category:"error_unload_extension",extensionId:i,error_message:n.message,call_stack:n.stack})}this.loadedExtensions=null}t.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.model=null,this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null),this.impl.unloadCurrentModel()},o.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},o.prototype.localize=function(){e.i18n.localize()},o.prototype.__initAutoCam=function(e){function i(e){o.autocamCamera.isPerspective!==r.isPerspective&&(o.autocamCamera.isPerspective?o.navigation.toPerspective():o.navigation.toOrthographic()),o.navigation.setVerticalFov(o.autocamCamera.fov,!1),o.navigation.setView(o.autocamCamera.position,o.autocamCamera.target),o.navigation.setPivotPoint(o.autocamCamera.pivot),o.navigation.setCameraUpVector(o.autocamCamera.up),e&&o.navigation.setWorldUpVector(o.autocamCamera.worldup),o.impl.syncCamera(e)}function n(e){o.utilities?o.utilities.pivotActive(e,!1):o.impl.controls.pivotActive(e,!1)}var o=this,r=e.camera;r.pivot||(r.pivot=new THREE.Vector3(0,0,0)),r.target||(r.target=new THREE.Vector3(0,0,0)),r.worldup||(r.worldup=r.up.clone()),o.autocamCamera=r.clone(),o.autocamCamera.target=r.target.clone(),o.autocamCamera.pivot=r.pivot.clone(),o.autocamCamera.worldup=r.worldup.clone(),o.autocam=new t.Autocam(o.autocamCamera,o.navigation),o.autocam.cameraChangedCallback=i,o.autocam.pivotDisplayCallback=n,o.autocam.canvas=o.canvas,o.addEventListener("cameraChanged",function(e){var t=e.camera;o.autocam.sync(t)}),o.autocam.sync(r)},o.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,t.logger.reportRuntimeStats(),t.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,e.theHotkeyManager.popHotkeys("Autodesk.FitToView"),e.theHotkeyManager.popHotkeys("Autodesk.Home"),e.theHotkeyManager.popHotkeys("Autodesk.Escape"),e.theHotkeyManager.popHotkeys("Autodesk.Pan"),e.theHotkeyManager.popHotkeys("Autodesk.Orbit"),t.clearPropertyWorkerCache(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.fireEvent(e.VIEWER_UNINITIALIZED),this.listeners={},t.logger.log("viewer destroy")},o.prototype.finish=function(){this.tearDown(),this.uninitialize()},o.prototype.load=function(e,i,n,o,r,s){t.logger.warn("viewer.load() is deprecated. Please use viewer.loadModel() instead.");var a={ids:null,sharedPropertyDbPath:i,acmSessionId:r,loadOptions:s};return this.loadModel(e,a,n,o)},o.prototype.loadModel=function(i,n,o,r,s){function a(){if(e.theHotkeyManager)if(d.model.is2d())e.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,i=function(){return t=d.getActiveNavigationTool(),d.setActiveNavigationTool("orbit")},n=function(){return d.setActiveNavigationTool(t)},o=[{keycodes:[e.theHotkeyManager.KEYCODES.ALT],onPress:i,onRelease:n}];e.theHotkeyManager.pushHotkeys("Autodesk.Orbit",o,{tryUntilSuccess:!0})}}function l(){if(!e.isNodeJS){var t=d.model.is2d()?"pan":"orbit";d.setActiveNavigationTool(t),d.setDefaultNavigationTool(t),d.toolController&&d.toolController.activateTool("gestures")}}function c(e){var t=!1;d.model||(d.model=e,t=!0),d.impl.addModel(e),d.loadSpinner&&(d.loadSpinner.style.display="None"),t&&(e.is2d()&&d.activateLayerState("Initial"),a(),l()),o&&o(e)}function u(e,t,i,n){d.loadSpinner&&(d.loadSpinner.style.display="None"),r&&r(e,t,i,n)}function h(){d.impl.needsRender=!0,d.removeEventListener(e.GEOMETRY_LOADED_EVENT,h)}var d=this;n=n||{},this.addEventListener(e.GEOMETRY_LOADED_EVENT,h);var p,g=i.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),m=g?g[1]:null;return p=n&&n.fileLoader?n.fileLoader:e.FileLoaderManager.getFileLoaderForExtension(m),p?new p(this.impl).loadFile(i,n,c,u,s):(t.logger.error("File extension not supported:"+m,e.errorCodeString(e.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),u(e.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0,m),!1)},o.prototype.getDimensions=function(){if(this.container){var t={};return this.getScreenMode()===e.ScreenMode.kFullScreen?(t.width=screen.width,t.height=screen.height):t=this.container.getBoundingClientRect(),{width:t.width,height:t.height}}return null},o.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},o.prototype.getCamera=function(){return this.impl.camera},o.prototype.getState=function(e){return this.viewerState.getState(e)},o.prototype.restoreState=function(t,i,n){var o=this.viewerState.restoreState(t,i,n);return o&&this.fireEvent({type:e.VIEWER_STATE_RESTORED_EVENT,value:o}),o},o.prototype.setViewFromArray=function(e,t){var i=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},n={position:new THREE.Vector3(e[0]-i.x,e[1]-i.y,e[2]-i.z),target:new THREE.Vector3(e[3]-i.x,e[4]-i.y,e[5]-i.z),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};this.impl.setViewFromCamera(n)},o.prototype.setViewFromViewBox=function(e,i){var n=this.model;if(!n||n.is2d()){if(i&&i.length){var o,r=n.getData().metadata.views;for(o=0;o<r.length&&r[o].name!=i;o++);if(o<r.length){var s=r[o].layer_state;s&&this.activateLayerState(s)}}this.impl.setViewFromViewBox(this.model,e,i,!1)}else t.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")},o.prototype.activateLayerState=function(t){if(t&&t.length){var i=this.model.getData().metadata,n=i?i.layer_states:null;if(!n)return;var o;for(o=0;o<n.length&&n[o].name!=t;o++);if(o<n.length){var r=n[o].visible_layers,s={};if(r&&0<r.length)for(var a=0;a<r.length;a++)s[r[a]]=1;var l=[],c=[];for(var u in i.layers)1===s[i.layers[u].name]?l.push(u):c.push(u);this.impl.setLayerVisible(l,!0),this.impl.setLayerVisible(c,!1),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}}},o.prototype.getLayerStates=function(){var e=this.model,t=e?e.getData().metadata:null,i=t?t.layers:null,n=t?t.layer_states:null;if(!i||!n)return null;var o,r={},s={};for(var a in i)if(i.hasOwnProperty(a)){var l=parseInt(a),c=i[a];r[o="string"==typeof c?c:c.name]=!0,this.impl.isLayerVisible(l)&&(s[o]=!0)}var u,h,d=[];for(u=0;u<n.length;++u){var p=n[u],g=p.visible_layers,m={};if(!p.hidden){if(g&&0<g.length)for(h=0;h<g.length;++h)o=g[h],r.hasOwnProperty(o)&&(m[o]=!0);d.push({name:p.name,description:p.description,active:function(e,t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(i.length!==n.length)return!1;for(var o=0;o<i.length;++o){var r=i[o];if(e[r]!==t[r])return!1}return!0}(s,m)})}}return 0<d.length?d:null},o.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},o.prototype.getProperties=function(i,n,o){t.logger.track({name:"get_props_count",aggregate:"count"}),this.model?this.model.getProperties(i,n,o):o&&o(e.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},o.prototype.getObjectTree=function(t,i){this.model?this.model.getObjectTree(t,i):i&&i(e.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},o.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},o.prototype.search=function(t,i,n,o,r){this.searchText=t,this.model?this.model.search(t,i,n,o,r):n&&n(e.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},o.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},o.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},o.prototype.isolate=function(e){if(this.model){var t=this.model.getData();if(t&&t.is2d&&t.loadDone&&"hasObjectProperties"in t)this.impl.visibilityManager.isolate(e);else{var i=this;this.model.getObjectTree(function(){i.impl.visibilityManager.isolate(e)})}}},o.prototype.isolateById=function(e){return t.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(e)},o.prototype.setBackgroundColor=function(e,t,i,n,o,r){this.impl.setClearColors(e,t,i,n,o,r)},o.prototype.toggleSelect=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(e)},o.prototype.select=function(e){"number"==typeof e&&(e=[e]),this.impl.selector.setSelection(e)},o.prototype.clearSelection=function(){this.impl.selector.clearSelection()},o.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},o.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},o.prototype.setSelectionMode=function(e){this.impl.selector.setSelectionMode(e)},o.prototype.getSelection=function(){return this.impl.selector.getSelection()},o.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var i=0;i<t.length;i++)for(var n=0;n<t[i].selection.length;n++)e(t[i].model,t[i].selection[n]);return t},o.prototype.hide=function(e){t.logger.track({name:"hide",aggregate:"count"}),this.impl.visibilityManager.hide(e)},o.prototype.hideById=function(e){this.hide(e)},o.prototype.show=function(e){this.impl.visibilityManager.show(e)},o.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0)},o.prototype.toggleVisibility=function(e){this.impl.visibilityManager.toggleVisibility(e)},o.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},o.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},o.prototype.explode=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.explode is not applicable to 2D"):(t.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(e))},o.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},o.prototype.setQualityLevel=function(e,i){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set("ambientShadows",e),this.prefs.set("antialiasing",i),this.impl.togglePostProcess(e,i))},o.prototype.setGhosting=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",e),this.impl.toggleGhosting(e))},o.prototype.setGroundShadow=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):(this.prefs.set("groundShadow",e),this.impl.toggleGroundShadow(e))},o.prototype.setGroundReflection=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):(this.prefs.set("groundReflection",e),this.impl.toggleGroundReflection(e))},o.prototype.setEnvMapBackground=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):(this.prefs.set("envMapBackground",e),this.impl.toggleEnvMapBackground(e))},o.prototype.setRenderPrism=function(e){t.logger.warn("viewer.setRenderPrism() has been deprecated and will get removed in version 2.15")},o.prototype.setFirstPersonToolPopup=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"):this.prefs.set("firstPersonToolPopup",e)},o.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"):this.prefs.firstPersonToolPopup},o.prototype.setProgressiveRendering=function(e){this.prefs.set("progressiveRendering",e),this.impl.toggleProgressive(e)},o.prototype.setSwapBlackAndWhite=function(e){this.prefs.set("swapBlackAndWhite",e),this.impl.toggleSwapBlackAndWhite(e)},o.prototype.setOptimizeNavigation=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):(this.prefs.set("optimizeNavigation",e),this.impl.setOptimizeNavigation(e))},o.prototype.setNavigationLock=function(t){this.navigation.getIsLocked()!==t&&(this.navigation.setIsLocked(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},o.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},o.prototype.setNavigationLockSettings=function(t){this.navigation.setLockSettings(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},o.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},o.prototype.setActiveNavigationTool=function(t){if(t===this._pushedTool||!t&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return(!t||t===this.getDefaultNavigationToolName())&&null===this._pushedTool?(this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):!!this.impl.controls.activateTool(t)&&(this._pushedTool=t,this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0)},o.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},o.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},o.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},o.prototype.getFOV=function(){return this.navigation.getVerticalFov()},o.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},o.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},o.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},o.prototype.hideLines=function(t){function i(o){t&&o.model.hideLines(t),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("lineRendering",!t);var n=this;this.impl.hideLines(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},o.prototype.hidePoints=function(t){function i(o){t&&o.model.hidePoints(t),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("pointRendering",!t);var n=this;this.impl.hidePoints(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},o.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},o.prototype.fitToView=function(e,t){(t=t||this.model)&&(t.isObjectTreeLoaded()||t.is2d()?this.impl.fitToView(e,t):this.impl.fitToView(null,t))},o.prototype.setClickConfig=function(e,t,i){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in n){var o=n[e];if(t in o)return o[t]=i,!0}return!1},o.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var n=i[e];if(t in n)return n[t]}return null},o.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set("clickToSetCOI",e);var i=this.getClickConfig("click","onObject");e?-1===i.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},o.prototype.initSettings=function(){this.prefs.load(e.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","lightPreset","envMapBackground","firstPersonToolPopup"]),this.prefs.untag("3d",["swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.hidePoints(!this.prefs.pointRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);var t=this.prefs.backgroundColorPreset;if(t)try{var i=JSON.parse(t);this.impl.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5])}catch(e){this.prefs.set("backgroundColorPreset",null)}var n=this.prefs.lightPreset;this.impl.setLightPreset(n)},o.prototype.setLightPreset=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"):(this.prefs.set("lightPreset",e),this.impl.setLightPreset(e))},o.prototype.setUsePivotAlways=function(e){this.prefs.set("alwaysUsePivot",e),this.navigation.setUsePivotAlways(e)},o.prototype.setReverseZoomDirection=function(e){this.prefs.set("reverseMouseZoomDir",e),this.navigation.setReverseZoomDirection(e)},o.prototype.setReverseHorizontalLookDirection=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):(this.prefs.set("reverseHorizontalLookDirection",e),this.navigation.setReverseHorizontalLookDirection(e))},o.prototype.setReverseVerticalLookDirection=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",e),this.navigation.setReverseVerticalLookDirection(e))},o.prototype.setZoomTowardsPivot=function(e){this.prefs.set("zoomTowardsPivot",e),this.navigation.setZoomTowardsPivot(e)},o.prototype.setOrbitPastWorldPoles=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",e),this.navigation.setOrbitPastWorldPoles(e))},o.prototype.setUseLeftHandedInput=function(e){this.prefs.set("leftHandedMouseSetup",e),this.navigation.setUseLeftHandedInput(e)},o.prototype.setLayerVisible=function(i,n,o){function r(e){if(e.isLayer)return[e.index];if(e.children){for(var t=[],i=e.children,n=0;n<i.length;++n)t=t.concat(r(i[n]));return t}return[]}if(!this.model||this.model.is2d()){var s=this.model.getLayersRoot();if(s&&0!==s.childCount){if(null===i&&(i=[s]),Array.isArray(i)||(i=[i]),o){var a=r(s);this.impl.setLayerVisible(a,!1),this.impl.visibilityManager.isolate(),n=!0}for(var l=[],c=0;c<i.length;++c){var u=r(i[c]);l=l.concat(u)}this.impl.setLayerVisible(l,n),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}}else t.logger.warn("Viewer3D.setLayerVisible is not yet implemented for 3D")},o.prototype.isLayerVisible=function(e){return this.model&&!this.model.is2d()?(t.logger.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(e&&e.isLayer&&this.impl.isLayerVisible(e.index))},o.prototype.anyLayerHidden=function(){function e(t){if(t.isLayer)return!i.impl.isLayerVisible(t.index);for(var n=t.children,o=0;o<n.length;++o)if(e(n[o]))return!0;return!1}if(this.model&&!this.model.is2d())return t.logger.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1;var i=this,n=i.model.getLayersRoot();return!(!n||!e(n))},o.prototype.setGroundShadowColor=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(e)},o.prototype.setGroundShadowAlpha=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(e)},o.prototype.setGroundReflectionColor=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(e)},o.prototype.setGroundReflectionAlpha=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(e)},o.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},o.prototype.setCutPlanes=function(e){this.model&&this.model.is2d()?t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlanes(e)},o.prototype.getScreenShot=function(e,t,i){return this.impl.getScreenShot(e,t,i)},o.prototype.getScreenShotBuffer=function(e,t,i){return this.impl.getScreenShotBuffer(e,t,i)},o.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},o.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},o.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},o.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},o.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},o.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},o.prototype.initContextMenu=function(){function e(e){var i=e.button;return"buttons"in e&&(!t.__firefoxLMBfix||1&e.buttons?2===i&&1&e.buttons&&(i=0,t.__firefoxLMBfix=!0):(t.__firefoxLMBfix=!1,i=0)),i===(!!t.navigation&&t.navigation.getUseLeftHandedInput()?0:2)}(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var t=this,i=this.canvas||this.container;i.addEventListener("mousedown",function(i){e(i)&&(t.startX=i.clientX,t.startY=i.clientY)}),i.addEventListener("mouseup",function(i){return e(i)&&i.clientX===t.startX&&i.clientY===t.startY&&t.triggerContextMenu(i),!0},!1)},o.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},o.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},o.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(i)&&this.contextMenuCallbacks[i](e,t)},o.prototype.playAnimation=function(e){var t=this.impl.keyFrameAnimator;t&&t.play(0,e)},o.prototype.joinLiveReview=function(e){this.liveReviewClient||(this.liveReviewClient=new t.LiveReviewClient(this));var i=this.liveReviewClient;t.loadDependency("lmv_io","socket.io-1.3.5.js",function(){i.joinLiveReviewSession(e)})},o.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},o.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},o.prototype.worldToClient=function(e){return this.impl.worldToClient(e)},o.prototype.clientToWorld=function(e,t,i){return this.impl.clientToWorld(e,t,i)},o.prototype.modelHasTopology=function(){return!(!this.model||!this.model.getData().topology)},o.prototype.setSelectionColor=function(e){this.impl.setSelectionColor(e)},o.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new t.ViewCubeUi(this),this.viewCubeUi.create())},o.prototype.displayViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.displayViewCube(e,!1)},o.prototype.displayViewCubeUI=function(e){this.viewCubeUi&&this.viewCubeUi.setVisible(e)},o.prototype.setViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(e)},o.prototype.setThemingColor=function(e,t,i){(i=i||this.model).setThemingColor(e,t),this.impl.invalidate(!0)},o.prototype.clearThemingColors=function(e){(e=e||this.model).clearThemingColors(),this.impl.invalidate(!0)},o.prototype.transferModel=function(e,t){var i=this.impl.findModel(e);if(i){var n=[];this.getAggregateSelection(function(t,i){t.id==e&&n.push(i)});var o=this.impl.visibilityManager.getIsolatedNodes(i),r=this.impl.visibilityManager.getHiddenNodes(i),s=this.impl.matman().exportModelMaterials(i);this.impl.removeModel(i),t.model=i,t.impl.addModel(i),t.impl.matman().importModelMaterials(s),t.loadSpinner&&(t.loadSpinner.style.display="None"),i.loader&&i.loader.viewer3DImpl===this.impl&&(i.loader.viewer3DImpl=t.impl),i.getData().loadDone&&t.impl.onLoadComplete(i),t.impl.selector.setSelection(n,i),0!=o.length?t.impl.visibilityManager.isolate(o,i):0!=r.length&&t.impl.visibilityManager.hide(r,i)}},o.prototype.hideModel=function(e){var t=this.impl.modelQueue(),i=t.hideModel(e),n=this.impl.model;return i&&n&&n.id===e&&(this.impl.model=null,t.isEmpty()||(this.impl.model=t.getModels()[0]),this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),i},o.prototype.showModel=function(e){var t=this.impl.modelQueue(),i=t.showModel(e);return i&&!this.model&&(this.impl.model=t.getModels()[0],this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),i},o.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels()},Autodesk.Viewing.Viewer3D=o}(),(av=Autodesk.Viewing).ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14},av.errorCodeString=function(e){return"ErrorCode:"+e+"."},function(){"use strict";function e(e,o,r){if(e.urlPattern=r.urn,e.tileSize=r.tileSize?r.tileSize:512,e.texWidth=r.resolution[0],e.texHeight=r.resolution[1],e.paperWidth=r.paperWidth,e.paperHeight=r.paperHeight,e.paperUnits=r.paperUnits,e.levelOffset=i.LeafletLoader.computeLevelOffset(e.tileSize),i.offline&&t.isMobileDevice()){var s=n.getSubItemsWithProperties(o,{role:"leaflet-zip"},!1);s.length>0&&(e.maxLevel=s[0].max_level-e.levelOffset)}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,t,n){function o(e){if(e){var t,n=e.children?e.children.length:0;if("geometry"===e.type&&n){var r=0;for(t=0;t<n;t++){var a=e.children[t];a&&"view"===a.type&&(s.myViewGeometry[a.guid]=e,r++)}s.myNumViews[e.guid]=r}else if("application/autodesk-db"==e.mime&&e.urn)0===e.urn.indexOf(i.ViewingService.OSS_PREFIX)?s.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):s.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("/")+1);else if(0<n)for(t=0;t<n;t++)o(e.children[t])}}function r(e){if(e)for(var t=e.children?e.children.length:0,i=0;i<t;i++)e.children[i].parent=e,r(e.children[i])}this.myPath=t,this.myData=e,this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=n;var s=this;o(e),r(this.myData)};n.prototype.constructor=n,n.load=function(e,o,r,s){function a(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),window.location.protocol+"//"+window.location.host+t):t}return e}function l(e){var t=n.getSubItemsWithProperties(e.getRootItem(),{type:"folder",role:"viewable"},!0)[0];return n.getSubItemsWithProperties(t,{type:"geometry"},!0).length}function c(e,t){var i=[],n=0,o=0;t=t||"children";var r=function(e){var s=e[t]||[],a=e.messages||[];a.filter(function(e){return"error"===e.type}).length>0&&(n+=1),"inprogress"===e.status&&(o+=1),Array.prototype.push.apply(i,a.slice(0));for(var l=s.length;l--;r(s[l]));};r(e);var s="translated";s=n>0?"failed":s,s=o>0?"processing":s;for(var a=i.length;a--;i[a].$translation=s);return i}function u(s){function h(e){if(/<[^>]*script/.test(e))r&&r(t.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading");else{var i="string"==typeof e?JSON.parse(e):e,a=new n(i,g,s);if(l(a)>0)p=c(a.getRootItem()),o&&o(a,p);else if(r){p=c(a.getRootItem());var u=t.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT;r(u,"No viewable content",p)}}}function d(e,n,o){if(401===e&&void 0===LMV_THIRD_PARTY_COOKIE)LMV_THIRD_PARTY_COOKIE=!1,i.refreshRequestHeader(i.token.accessToken),u(s);else{var a=c(o);if(r){var l="Error: "+e+" ("+n+")",h=t.Private.ErrorHandler.getErrorCode(e);r(h,l,e,n,a)}}}var p,g=a(e),m={queryParams:s?"acmsession="+s:""};i.ViewingService.getManifest(i.initLoadContext(m),g,h,d)}"function"!=typeof arguments[1]&&(i.logger.warn("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(o=arguments[2]),"function"==typeof arguments[3]&&(r=arguments[3])),s?i.ViewingService.getACMSession(t.getApiEndpoint(),s,u,r):u()},n.requestThumbnailWithSecurity=function(e,t){var n=function(e){t(null,e)},o=function(){t("error",null)},r={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},s="urn:"+e.urn;i.ViewingService.getThumbnail(i.initLoadContext(),s,n,o,r)},n.prototype.getFullPath=function(e){if(!e)return e;var n=e;if(i.offline){if(-1==n.indexOf(t.Private.offlineResourcePrefix))if(-1!==n.indexOf(t.Private.ViewingService.OSS_PREFIX)){var o=n.substr(n.indexOf("/")+1),r=decodeURIComponent(o),s=r.substr(r.indexOf("/"));n=decodeURIComponent(t.Private.offlineResourcePrefix)+s}else n=decodeURIComponent(t.Private.offlineResourcePrefix)+n.substr(n.indexOf("/"))}else 0===e.indexOf("urn")?n=t.getItemApi()+e:0===e.indexOf("$file$")&&(n=this.myPath.replace("/bubble.json","")+e.replace("$file$",""));return n},n.prototype.getThumbnailOptions=function(e,t,i){var n=t||200,o=i||200;return{urn:this.myData.urn,width:n,height:o,guid:encodeURIComponent(e.guid),acmsession:this.acmSessionId}},n.prototype.getThumbnailPath=function(e,i,n){var o=this.getThumbnailOptions(e,i,n),r=t.getThumbnailApi()+o.urn+"?guid="+o.guid+"&width="+o.width+"&height="+o.height;return o.acmsession&&(r+="&acmsession="+o.acmsession),r},n.prototype.getViewablePath=function(t,i){if("geometry"===t.type){var o=[];if("3d"===t.role?o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-svf"},!1):"2d"===t.role&&((o=n.getSubItemsWithProperties(t,{role:"leaflet"},!1)).length>0&&i&&e(i,t,o[0]),0===o.length&&(o=n.getSubItemsWithProperties(t,{role:"image"},!1)),0===o.length&&(o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-f2d"},!1)),0===o.length&&(o=n.getSubItemsWithProperties(t,{role:"tileRoot"},!0))),o.length>0)return this.getFullPath(o[0].urn)}else if("view"===t.type){var r=this.getViewGeometry(t);if(r)return this.getViewablePath(r)}return""},n.prototype.getPropertyDbPath=function(){return this.getFullPath(this.myPropertyDb)},n.prototype.getRootItem=function(){return this.myData},n.prototype.getPath=function(){return this.myPath},n.prototype.getItemById=function(e){function t(i){if(!i)return null;for(var n in i){var o=i[n];if("guid"===n&&o===e)return i;if(null!==o&&"object"==typeof o&&"parent"!==n){var r=t(o);if(r)return r}}return null}return t(this.myData)},n.getSubItemsWithProperties=function(e,t,i){var o=[];if(!e)return[];for(var r=e.children?e.children.length:0,s=0;s<r;s++){var a=e.children[s];(function(e,t){for(var i in t)if(!(i in e)||t[i]!==e[i])return!1;return!0})(a,t)&&o.push(a),i&&o.push.apply(o,n.getSubItemsWithProperties(a,t,i))}return o},n.prototype.getViewGeometry=function(e){return this.myViewGeometry[e.guid]},n.prototype.getNumViews=function(e){return this.myNumViews[e.guid]||0},n.prototype.getParentId=function(e){var t=this.getItemById(e);if(!t)return null;var i=t.parent;return i?i.guid:null},n.prototype.getMessages=function(e,t){var i=[];if(!e)return i;var n=null;t&&(n=this.getRootItem());for(var o=e;o&&(!t||parent!==n);){if(o.messages)for(var r=0;r<o.messages.length;r++)i.push(o.messages[r]);o=o.parent}return i},t.Document=n}(),function(){"use strict";function e(e){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5;var t=void 0,i=void 0,n=null,o={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==n&&(n=e,e&&(e.hasOwnProperty("target")||(e.target=new THREE.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new THREE.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return n},this.setScreenViewport=function(e){o=e},this.getScreenViewport=function(){return o},this.__setUp=function(e){return!(!e||!n||0===e.clone().normalize().sub(n.worldup).lengthSq())&&(n.worldup.copy(e).normalize(),n.dirty=!0,!0)},this.__getUp=function(){return n?n.worldup:new THREE.Vector3(0,1,0)},this.setView=function(e,t){n&&e&&t&&(n.position.copy(e),n.target.copy(t),n.dirty=!0)},this.orientCameraUp=function(){n&&this.isActionEnabled("roll")&&(n.up.copy(this.getAlignedUpVector()),n.dirty=!0)},this.getPivotPoint=function(){return n?n.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(e){n&&e&&(n.pivot.copy(e),n.dirty=!0)},this.getPosition=function(){return n?n.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(e){n&&e&&(n.position.copy(e),n.dirty=!0)},this.setTarget=function(e){n&&e&&(n.target.copy(e),n.dirty=!0)},this.getTarget=function(){return n?n.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return n?n.target.clone().sub(n.position):new THREE.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return n?e.center().sub(n.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.isPointVisible=function(e){return(new THREE.Frustum).setFromMatrix(n.projectionMatrix.clone().multiply(n.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,t){if((!n||n.isPerspective)&&(e<6.88?e=6.88:e>100&&(e=100),n&&this.isActionEnabled("fov"))){if(Math.abs(n.fov-e)<=1e-6)return;if(t){var i=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),o=this.getPosition(),r=this.getEyeVector(),s=THREE.Math.degToRad(n.fov),a=THREE.Math.degToRad(e),l=i?this.getPivotPlaneDistance():r.length(),c=l*Math.tan(.5*s)/Math.tan(.5*a),u=r.normalize().multiplyScalar(l-c);this.setPosition(o.add(u)),i&&this.setTarget(this.getTarget().add(u))}n.setFov(e),n.dirty=!0}},this.computeFit=function(t,i,n,o,r){if(!o||o.empty())return{position:t,target:i};r=void 0===r?1:r;for(var s=o.center(),a=o.size(),l=t.clone().sub(i).normalize(),c=Math.tan(THREE.Math.degToRad(.5*n)),u=0,h=this.computeOrthogonalUp(t,i),d=l.clone().cross(h).normalize(),p=new THREE.Vector3,g=0===a.z?4:8,m=0;m<g;m++){p.set(0==(1&m)?-.5*a.x:.5*a.x,0==(2&m)?-.5*a.y:.5*a.y,0==(4&m)?-.5*a.z:.5*a.z);var v=0;e.isPerspective&&(v=p.dot(l));var f=Math.abs(p.dot(h)),E=Math.abs(p.dot(d)),A=v+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*f/c;u<A&&(u=A),u<(A=v+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*E/(r*c))&&(u=A)}return s.add(h.multiplyScalar(-u*this.FIT_TO_VIEW_VERTICAL_OFFSET)),s.add(d.multiplyScalar(u*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),l.multiplyScalar(u),{position:s.clone().add(l),target:s}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),n=t.clone().sub(e);if(0===n.lengthSq())return n.copy(i);var o=n.clone().cross(i);return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()},this.fitBounds=function(e,t,i){var o=this.getTarget(),r=this.getPosition();if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:r,target:o};var s=this.getVerticalFov(),a=this.computeFit(r,o,s,t,n.aspect),l=i?this.computeOrthogonalUp(r,o):n.up;return e?(n.up.copy(l),this.setView(a.position,a.target)):this.setRequestTransitionWithUp(!0,a.position,a.target,s,l),this.setPivotPoint(a.target),this.setPivotSetFlag(!0),a},this.computeOverviewDistance=function(e){if(this.__is2D){var t=e.size(),i=n.aspect,o=t.x/i,r=t.y;return Math.max(o,r)}var s=this.getVerticalFov(),a=(t=e.size()).length();return 0===a&&(a=2),n.isPerspective?.5*a/Math.tan(THREE.Math.degToRad(.5*s)):a},this.applyDollyConstraint=function(e,o){var r=e;if((t||o)&&e>1){var s,a=n.isPerspective?this.getEyeToCenterOfBoundsVec(o):this.getEyeVector();s=t?2*this.computeOverviewDistance(t):2*this.computeOverviewDistance(o);var l=Math.abs(s/a.length());l=Math.max(l,1),r=Math.min(r,l)}if(i&&this.__is2D){var c=n.clientHeight/i/-(a=this.getEyeVector()).z;c=Math.min(c,1),r=Math.max(r,c)}return r},this.applyPanningConstraint2D=function(e){if(this.__is2D&&t){var i=n.position.x+e.x,o=n.position.y+e.y;i=THREE.Math.clamp(i,t.min.x,t.max.x),o=THREE.Math.clamp(o,t.min.y,t.max.y);var r=i-n.position.x,s=o-n.position.y,a=Math.min(e.x,0),l=Math.min(e.y,0),c=Math.max(e.x,0),u=Math.max(e.y,0);r=THREE.Math.clamp(r,a,c),s=THREE.Math.clamp(s,l,u),e.x=r,e.y=s}},this.updateCamera=function(){n&&(n.updateProjectionMatrix(),this.orient(n,n.target,n.position,n.up),n.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,n){t=e,i=n}}var t=Autodesk.Viewing.Private;e.prototype.constructor=e,e.prototype.setIs2D=function(e){this.__is2D=!!e},e.prototype.getIs2D=function(){return this.__is2D},e.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},e.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},e.prototype.orient=function(){function e(){t||(t=new THREE.Matrix4,i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3)}var t,i,n,o;return function(r,s,a,l){e();var c=t.elements;o.subVectors(a,s).normalize(),0===o.lengthSq()&&(o.z=1),i.crossVectors(l,o).normalize(),0===i.lengthSq()&&(l.z>l.y?o.y-=1e-4:o.z+=1e-4,i.crossVectors(l,o).normalize()),n.crossVectors(o,i),c[0]=i.x,c[4]=n.x,c[8]=o.x,c[1]=i.y,c[5]=n.y,c[9]=o.y,c[2]=i.z,c[6]=n.z,c[10]=o.z,r.setRotationFromMatrix(t)}}(),e.prototype.fov2fl=function(e){var t=THREE.Math.degToRad(e);return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},e.prototype.fl2fov=function(e){e<=0&&(e=1e-4);var t=2*Math.atan(12/e);return THREE.Math.radToDeg(t)},e.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera();t.up.copy(e),t.dirty=!0}},e.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getCameraRightVector=function(e){var t=new THREE.Vector3,i=e?this.getWorldUpVector():this.getCamera().up,n=this.getEyeVector();return t.crossVectors(n,i),0===t.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z+=1e-4,t.crossVectors(n,i)),t.normalize()},e.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},e.prototype.getWorldUpVector=function(){return this.__getUp().clone()},e.prototype.getWorldRightVector=function(){var e=new THREE.Vector3;return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},e.prototype.getVerticalFov=function(){return this.getCamera().fov},e.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},e.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},e.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},e.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},e.prototype.setReverseHorizontalLookDirection=function(e){this.getIs2D()?t.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!e},e.prototype.setReverseVerticalLookDirection=function(e){this.getIs2D()?t.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!e},e.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},e.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(t.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},e.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(t.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},e.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},e.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},e.prototype.setOrbitPastWorldPoles=function(e){this.getIs2D()?t.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!e},e.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(t.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},e.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},e.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},e.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},e.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},e.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},e.prototype.getIsLocked=function(){return this.__options.lockNavigation},e.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},e.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},e.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},e.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},e.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},e.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},e.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},e.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},e.prototype.getRequestHomeView=function(){return this.__homeViewRequested},e.prototype.setRequestTransition=function(e,t,i,n,o,r){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:o,pivot:r?r.clone():i.clone()}:null},e.prototype.setRequestTransitionWithUp=function(e,t,i,n,o,r,s){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:o.clone(),worldUp:r||this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:null},e.prototype.getRequestTransition=function(){return this.__destinationView},e.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},e.prototype.getTransitionActive=function(){return this.__transitionActive},e.prototype.getWorldSize=function(e){var t=this.getScreenViewport(),i=t.width/t.height,n=2*e*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),o=n*i;return new THREE.Vector2(o,n)},e.prototype.getWorldPoint=function(e,t){e=2*e-1,t=2*(t=1-t)-1;var i,n=this.getCamera();n.isPerspective&&(i=(i=new THREE.Vector3(e,t,1)).unproject(n));var o,r,s=this.getEyeVector(),a=this.getPosition();if(!n.isPerspective||isNaN(i.x)){var l=this.getWorldSize(s.length()),c=this.getCameraRightVector(!1).multiplyScalar(.5*e*l.x),u=this.getCameraUpVector().multiplyScalar(.5*t*l.y);o=s.clone().add(c).add(u).normalize()}else o=i.sub(a).normalize();var h=this.getPivotPoint();if(this.__pivotIsSetFlag&&(this.getIs2D()||n.isPerspective&&this.isPointVisible(h))){var d=o.dot(s);r=0!==d?Math.abs(h.sub(a).dot(s))/d:h.sub(a).length()}else r=n.isPerspective?.5*(n.near+n.far):n.orthoScale;return o.multiplyScalar(r).add(a)},e.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition();return e.sub(i).dot(t.normalize())},e.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var n=this.getWorldSize(i),o=e*n.x,r=t*n.y,s=this.getCameraRightVector(!1).multiplyScalar(o),a=this.getCameraUpVector().multiplyScalar(r),l=s.add(a);this.applyPanningConstraint2D(l),this.setView(this.getPosition().add(l),this.getTarget().add(l))}},e.prototype.dollyFromPoint=function(e,t,i){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var n=this.getPosition(),o=t.clone().sub(n),r=this.getEyeVector();if(!this.getCamera().isPerspective){var s=r.lengthSq(),a=r.dot(o);if(0==a)return;o.multiplyScalar(s/a),t=n.clone().add(o)}var l=o.length(),c=l+e;c<this.__minDistance&&(c=this.__minDistance);var u=c/l;if(u=this.applyDollyConstraint(u,i),Math.abs(u-1)>this.__kEpsilon){o.multiplyScalar(u),o.set(-o.x,-o.y,-o.z);var h=o.add(t),r=this.getEyeVector();this.getCamera().isPerspective||r.multiplyScalar(u),this.setView(h,r.add(h))}}},e.prototype.toPerspective=function(){if(this.getIs2D())t.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)}},e.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},e.snapToAxis=function(e){var t=new THREE.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},Autodesk.Viewing.Navigation=e}(),function(){"use strict";function e(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],o=Array.isArray(n),r=e[i],s=Array.isArray(r);o&&s?(n?o||(n=[n]):n=[],r?s||(r=[r]):r=[],e[i]=r.concat(n)):e[i]=n}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,t){this.appContainerId=e,this.container=document.getElementById(e),this.options=t||{},this.myRegisteredViewers={},this.myDocument=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.bubble=null,this.extensionCache={};var i=this;this.onHyperlinkHit=function(e){var t=e.data.href,n=i.bubble.search({viewableID:t});if(n&&n.length>0)i.selectItem(n[0].data);else{var o=new RegExp(/^https?:\/\//);t.match(o)||(t="http://"+t),window.open(t)}},this.onLoadGeometry=function(e){var t=e.data;i.selectItem(t.item,t.onSuccessCb,t.onErrorCb)}};n.prototype.k3D="3D",n.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},n.prototype.registerViewer=function(e,n,o){e===this.k3D?(o=o||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(o.hasOwnProperty("disableBrowserContextMenu")||(o.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[e]={},this.myRegisteredViewers[e].class=n,this.myRegisteredViewers[e].config=o):i.logger.error("The only acceptable viewer type is k3D.",t.errorCodeString(t.ErrorCodes.VIEWER_INTERNAL_ERROR))},n.prototype.getViewerClass=function(e){return this.myRegisteredViewers.hasOwnProperty(e)?this.myRegisteredViewers[e].class:null},n.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},n.prototype.getViewer=function(t){var i=this.myRegisteredViewers[this.k3D];if(!i)return null;var n={};e(n,i.config),e(n,t);var o=i.class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===o)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(n),this.myCurrentViewer;this.setCurrentViewer(null);for(var r=this.getViewerContainer();r.hasChildNodes();)r.removeChild(r.lastChild);var s=new o(r,n);return this.setCurrentViewer(s),s},n.prototype.setCurrentViewer=function(e){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=e,this.myCurrentViewer&&(e.addEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),e.addEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),e.extensionCache=this.extensionCache)},n.prototype.getCurrentViewer=function(){return this.myCurrentViewer},n.prototype.loadDocument=function(e,n,o,r){var s=this;i.logger.track({category:"load_document",urn:0==e.indexOf("urn:")?e.substring(4):e}),t.Document.load(e,function(e,t){s.myDocument=e,s.bubble=new Autodesk.Viewing.BubbleNode(e.myData),s.onDocumentLoaded(e,t),n&&n(e,t)},function(e,t,i,n,r){s.onDocumentFailedToLoad(e,t,r),o&&o(e,t,i,n,r)},r)},n.prototype.onDocumentLoaded=function(e,t){i.logger.log(e,t)},n.prototype.onDocumentFailedToLoad=function(e,n,o){i.logger.error(t.errorCodeString(e),n,o)},n.prototype.getDefaultGeometry=function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t].useAsDefault;if(!0===n||"true"===n)return e[t]}return e[0]},n.prototype.selectItem=function(e,t,n){var o={},r=this.myDocument.getViewablePath(e,o);if(!r)return!1;var s,a,l,c,u=!1;if("geometry"===e.type&&"3d"===e.role){var h=e.properties;if(h)for(var d in h)if(h.hasOwnProperty(d)&&h[d]._UnitLinear){c=h[d]._UnitLinear;break}u=!0,a=e.name,l=e}else if("view"===e.type&&"3d"===e.role)s=e,u=!0,(l=this.myDocument.getViewGeometry(e))&&(a=l.name);else if("geometry"===e.type&&"2d"===e.role){var p=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{mime:"application/autodesk-f2d"},!1),g=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{role:"leaflet"},!1),m=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{role:"image"},!1);(p.length>0||g.length>0||m.length>0)&&(u=!0),a=e.name,l=e}else"view"===e.type&&"2d"===e.role&&(s=e,u=!0,(l=this.myDocument.getViewGeometry(e))&&(a=l.name));if(!u)return!1;var v=r.indexOf("urn:");i.logger.track({category:"load_viewable",role:e.role,type:e.type,urn:-1!==v?r.substring(v+4):r});var f=this.myDocument.getMessages(e,!0),E=this,A=this.myCurrentViewer&&this.urn===r,y=function(){var i=E.myCurrentViewer;s&&s.camera?i.setViewFromArray(s.camera,s.name):s&&s.viewbox?i.setViewFromViewBox(s.viewbox,s.name):A&&i.setViewFromFile(),c&&E.myCurrentViewer.setModelUnits(c),t&&t(E.myCurrentViewer,e,f)},T=function(e,t,i,o){n&&n(e,t,i,o,f)},w=!1;if(A)y&&y(),w=!0;else{this.urn=null;var b={defaultModelStructureTitle:a,viewableName:a};e.hasOwnProperty("extensions")&&(b.extensions=Array.isArray(e.extensions)?e.extensions:[e.extensions]);var C=this.getViewer(b);if(C){var S={ids:null,bubbleNode:this.bubble?this.bubble.findByGuid(e.guid):null,sharedPropertyDbPath:this.myDocument.getPropertyDbPath(),acmSessionId:this.myDocument.acmSessionId,loadOptions:o,useConsolidation:this.options.useConsolidation||!1,consolidationMemoryLimit:this.options.useConsolidation||104857600};C.started?(C.loadModel(this.myDocument.getFullPath(r),S,y,T),w=!0):w=0===C.start(this.myDocument.getFullPath(r),S,y,T),this.urn=r}}return!!w&&(this.selectedItem=e,this.onItemSelected(e,l),!0)},n.prototype.onItemSelected=function(e,t){if(i.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(e.guid)),this.itemSelectedObservers)for(var n=this.getCurrentViewer(),o=0;o<this.itemSelectedObservers.length;++o){var r=this.itemSelectedObservers[o];r.onItemSelected&&r.onItemSelected(n,e,t)}},n.prototype.addItemSelectedObserver=function(e){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(e)},n.prototype.selectItemById=function(e,t,i){var n=this.myDocument.getItemById(e);return!!n&&this.selectItem(n,t,i)},n.prototype.getSelectedItem=function(){return this.selectedItem},t.ViewingApplication=n}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.ViewCubeUi=function(e){this.viewer=e,this.container=null,this.cube=null,this.viewcube=null,this.infoButton=null,this.homeViewContainer=null};var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var e=this.viewer.config,t=!(!e||void 0===e.wantInfoButton)&&e.wantInfoButton;this.initContainer(),t&&this.initInfoButton(),this.initHomeButton()},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeUI",this.viewer.container.appendChild(this.container)},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div"),this.infoButton.className="infoButton",this.infoButton.style.cursor="pointer",this.container.appendChild(this.infoButton);var e=this;this.infoButton.addEventListener("click",function(t){var i=e.viewer.getPropertyPanel(!0),n=!i.areDefaultPropertiesShown()||!i.isVisible();n&&i.showDefaultProperties(),n!==i.isVisible()&&i.setVisible(n)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var e=document.createElement("div");e.className="homeViewWrapper",e.style.cursor="pointer",this.container.appendChild(e),this.homeViewContainer=e;var t=this;e.addEventListener("click",function(e){t.viewer.navigation.setRequestHomeView(!0)}),this._initHomeMenu(e)}},_initHomeMenu:function(e){var t=this.viewer,i=t.autocam,n=this;this.hideHomeViewMenu=function(e){a.style.display="none",document.removeEventListener("click",n.hideHomeViewMenu)};var o=document.createElement("div");o.className="homeViewMenuHandle";var r=document.createElement("img"),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";r.src=s,r.width=r.height=18,o.appendChild(r),o.addEventListener("mouseover",function(e){r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"}),o.addEventListener("mouseleave",function(e){r.src=s}),e.appendChild(o);var a=document.createElement("div");a.className="homeViewMenu",this.viewer.container.appendChild(a);var l=document.createElement("div");l.className="homeViewMenuItem",l.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home"),a.appendChild(l),l.addEventListener("click",function(e){i.setCurrentViewAsHome(!1),n.hideHomeViewMenu(e)});var c=document.createElement("div");c.className="homeViewMenuItem",c.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home"),a.appendChild(c),c.addEventListener("click",function(e){i.setCurrentViewAsHome(!0),n.hideHomeViewMenu(e)});var u=document.createElement("div");u.className="homeViewMenuItem",u.textContent=Autodesk.Viewing.i18n.translate("Reset Home"),a.appendChild(u),u.addEventListener("click",function(e){i.resetHome(),n.hideHomeViewMenu(e)}),e.addEventListener("mouseover",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(o.style.display="block")}),e.addEventListener("mouseleave",function(e){o.style.display="none"}),o.addEventListener("click",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu)),e.stopPropagation()}),e.addEventListener("contextmenu",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu))})},setVisible:function(e){this.container.style.display=e?"block":"none"},displayViewCube:function(e,t){if(t&&this.viewer.prefs.set("viewCube",e),e&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new avp.Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=e?"block":"none",this._positionHomeButton(),e&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var e,t=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,i=this.viewer.container.getBoundingClientRect(),n=this.homeViewContainer.getBoundingClientRect();if(t){var o=this.viewcube.getBoundingClientRect();e=i.left+i.width-o.left-n.width}else if(this.infoButton){var r=this.infoButton.getBoundingClientRect();e=i.left+i.width-r.left+r.width-n.width}else e=10;this.homeViewContainer.style.right=e+"px"}},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.infoButton=null,this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}};var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,avu=Autodesk.Viewing.UI,ave=Autodesk.Viewing.Extensions,stringToDOM=avp.stringToDOM=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild};!function(){"use strict";av.TOOLBAR_CREATED_EVENT="toolbarCreated",av.VIEW_CUBE_CREATED_EVENT="viewCubeCreated",av.SIDE_BAR_OPEN_EVENT="SIDE_BAR_OPEN_EVENT",av.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};var e=function(e,t){t||(t={}),t.startOnInitialize=!1,av.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null};e.populateConfigOptions=function(e){e.hasOwnProperty("wantInfoButton")||(e.wantInfoButton=!0),e.hasOwnProperty("disabledExtensions")||(e.disabledExtensions={}),["measure","hyperlink","section"].forEach(function(t){e.disabledExtensions.hasOwnProperty(t)||(e.disabledExtensions[t]=!1)})},(e.prototype=Object.create(av.Viewer3D.prototype)).constructor=e,e.prototype.initialize=function(){var e=av.Viewer3D.prototype.initialize.call(this);if(e>0)return avp.ErrorHandler.reportError(this.container,e),e;var t=this;if(this.toolController){var i=new av.HotGestureTool(this);this.toolController.registerTool(i),this.toolController.activateTool(i.getName())}return this.getToolbar(!0),this.addEventListener(av.FULLSCREEN_MODE_EVENT,function(e){t.resizePanels({viewer:t}),t.updateFullscreenButton(e.mode)}),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new avp.ProgressBar(this.container),this.addEventListener(av.PROGRESS_UPDATE_EVENT,function(e){void 0!==e.percent&&t.progressbar.setPercent(e.percent)},!1),this.selectionActive=!1,this.addEventListener(av.SELECTION_CHANGED_EVENT,function(e){t.selectionActive=e.dbIdArray.length>0,t.prefs.openPropertiesOnSelect&&t.getPropertyPanel(!0).setVisible(t.selectionActive)}),this.addEventListener(av.ISOLATE_EVENT,function(e){(t.prefs.openPropertiesOnSelect||e.nodeIdArray[0]===e.model.getRootId())&&t.propertygrid&&t.propertygrid.setVisible(e.nodeIdArray.length>0||t.selectionActive)}),this.addEventListener(av.VIEWER_STATE_RESTORED_EVENT,function(e){t.renderoptions&&t.renderoptions.syncUI();var i=t.getSettingsPanel(!0);i&&i.syncUI()}),this.addEventListener(av.VIEWER_RESIZE_EVENT,function(e){t.resizePanels(),t.viewCubeUi&&t.viewCubeUi.cube&&t.viewCubeUi.cube.refreshCube(),t.updateToolbarButtons(e.width,e.height),t.centerToolBar&&t.centerToolBar()}),this.addEventListener(av.NAVIGATION_MODE_CHANGED_EVENT,function(e){t.updateToolbarButtons(t.container.clientWidth,t.container.clientHeight),t.centerToolBar&&t.centerToolBar()}),this.initEscapeHandlers(),this.localize(),this.run(),0},e.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),av.theHotkeyManager.popHotkeys("Autodesk.ROLL"),av.theHotkeyManager.popHotkeys("Autodesk.FOV"),this.removeEventListener(av.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.onRenderOptionChanged=null,this.removeEventListener(av.VIEWER_STATE_RESTORED_EVENT,this.onRestoreState),this.onRestoreState=null,this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.centerToolBar=null,this.toolbar=null,av.Viewer3D.prototype.uninitialize.call(this)},e.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,this.getToolbar(!0),av.Viewer3D.prototype.setUp.call(this,e)},e.prototype.tearDown=function(){av.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.removeEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube)},e.prototype.loadModel=function(e,t,i,n,o){function r(e){l.running?l.createUI(e):avp.logger.error("createUI expects the viewer to be running.",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR))}function s(e){setTimeout(function(){r(e),i&&i.call(i,e)},1)}function a(e){avp.ErrorHandler.reportError(l.container,e),n&&n.apply(n,arguments)}var l=this;return av.Viewer3D.prototype.loadModel.call(this,e,t,s,a,o)},e.prototype.createUI=function(e){if(this.model===e){var t=this,i=this;this.initViewCube=function(){setTimeout(function(){i.displayViewCube(i.prefs.viewCube),i.removeEventListener(av.GEOMETRY_LOADED_EVENT,i.initViewCube)},1)};var n=this.config.disabledExtensions||{};this.initHotkeys(e),this.loadExtension("Autodesk.DefaultTools.NavTools",i.config),this.initModelTools(e),avp.ENABLE_DEBUG&&this.initDebugTools(),this.toolbar.container.style.display="block",this.fireEvent({type:av.TOOLBAR_CREATED_EVENT}),this.config.wantInfoButton=!0,this.createViewCube(),this.fireEvent({type:av.VIEW_CUBE_CREATED_EVENT}),this.centerToolBar=function(){t.toolbar.container.style.left="calc(50% - "+t.toolbar.getDimensions().width/2+"px)"},this.toolbar.addEventListener(avu.ToolBar.Event.SIZE_CHANGED,this.centerToolBar),this.initModality(),this.resize(),e.is2d()?(i.prefs.useFirstPersonNavigation?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){n.measure||i.loadExtension("Autodesk.Measure",i.config),n.hyperlink||i.loadExtension("Autodesk.Hyperlink",i.config)},1)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){i.prefs.useFirstPersonNavigation?i.loadExtension("Autodesk.FirstPerson",i.config):i.loadExtension("Autodesk.Beeline",i.config),i.prefs.fusionOrbit&&i.loadExtension("Autodesk.Viewing.FusionOrbit",i.config),n.measure||i.loadExtension("Autodesk.Measure",i.config),n.section||i.loadExtension("Autodesk.Section",i.config),n.hyperlink||i.loadExtension("Autodesk.Hyperlink",i.config),avp.isExperimentalFlagEnabled("billboards",i.config)&&(i.loadExtension("Autodesk.Comments",i.config),i.loadExtension("Autodesk.BillboardGui",i.config))},1),setTimeout(function(){avp.isExperimentalFlagEnabled("sidebar-ui",i.config)&&i.loadExtension("Autodesk.SideBarUi",i.config)},1),this.addEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube));var o=function(){if(i.modelstructure){var e=function(e){var t=i.config.defaultModelStructureTitle?i.config.defaultModelStructureTitle:"";i.modelstructure.setModel(e,t)},t=function(e){};i.model.getObjectTree(e,t)}i.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,o)};this.addEventListener(av.OBJECT_TREE_CREATED_EVENT,o)}},e.prototype.addOptionToggle=function(e,t,i,n,o){var r=o?this.prefs[o]:null;i="boolean"==typeof r?r:i;var s=document.createElement("li");s.className="toolbar-submenu-listitem";var a=document.createElement("input");a.className="toolbar-submenu-checkbox",a.type="checkbox",a.id=t,s.appendChild(a);var l=document.createElement("label");return l.setAttribute("for",t),l.setAttribute("data-i18n",t),l.textContent=av.i18n.translate(t),s.appendChild(l),e.appendChild(s),a.checked=i,a.addEventListener("touchstart",av.touchStartToClick),l.addEventListener("touchstart",av.touchStartToClick),s.addEventListener("touchstart",av.touchStartToClick),a.addEventListener("click",function(e){n(a.checked),e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),s.addEventListener("click",function(e){n(!a.checked),e.stopPropagation()}),o&&this.prefs.addListeners(o,function(e){a.checked=e},function(e){a.checked=e,n(e)}),a},e.prototype.addOptionList=function(e,t,i,n,o,r){var s=this.prefs[r];n="number"==typeof s?s:n;var a=function(e){var t=e.target.selectedIndex;o(t),e.stopPropagation()},l=document.createElement("select");l.className="optionDropDown",l.id="selectMenu_"+t;for(var c=0;c<i.length;c++){var u=document.createElement("option");u.value=c,u.setAttribute("data-i18n",i[c]),u.textContent=Autodesk.Viewing.i18n.translate(i[c]),l.add(u)}var h=document.createElement("li");h.className="toolbar-submenu-select";var d=document.createElement("div");return d.className="toolbar-submenu-selectlabel",d.setAttribute("for",t),d.setAttribute("data-i18n",t),d.textContent=av.i18n.translate(t),h.appendChild(d),h.appendChild(l),e.appendChild(h),l.selectedIndex=n,l.onchange=a,l.addEventListener("touchstart",function(e){e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),r&&this.prefs.addListeners(r,function(e){l.selectedIndex=e},function(e){l.selectedIndex=e,o(e)}),l},e.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0);e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},e.prototype.showRenderingOptions=function(e){this.renderoptions.setVisible(e)},e.prototype.showLayerManager=function(e){this.layersPanel.setVisible(e)},e.prototype.initHotkeys=function(e){var t,i,n=this,o=av.theHotkeyManager.KEYCODES;if(!e.is2d()){var r;t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(r=n.getActiveNavigationTool(),n.setActiveNavigationTool("fov"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(n.setActiveNavigationTool(r),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[o.CONTROL,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})}var s;t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(s=n.getActiveNavigationTool(),n.setActiveNavigationTool("worldup"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(n.setActiveNavigationTool(s),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[o.ALT,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})},e.prototype.setModelStructurePanel=function(e){var t=this;return(e instanceof av.UI.ModelStructurePanel||null===e)&&(this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=e,e&&(this.addPanel(this.modelstructure),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.structurebutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)}),t.model&&t.model.getObjectTree(function(e){t.modelstructure.setModel(e)})),!0)},e.prototype.setLayersPanel=function(e){var t=this;return this.model&&!this.model.is2d()?(avp.logger.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1):(e instanceof av.UI.LayersPanel||!e)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.layerButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.setPropertyPanel=function(e){var t=this;return(e instanceof av.UI.PropertyPanel||!e)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.propertiesbutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getPropertyPanel=function(e){return!this.propertygrid&&e&&this.setPropertyPanel(new ave.ViewerPropertyPanel(this)),this.propertygrid},e.prototype.setSettingsPanel=function(e){var t=this;return(e instanceof av.UI.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.viewerOptionButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getSettingsPanel=function(e){return!this.viewerSettingsPanel&&e&&this.setSettingsPanel(new ave.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},e.prototype.initModelTools=function(e){var t=this;if(e.is2d()){var i=new ave.ViewerLayersPanel(this);this.setLayersPanel(i);var n=new avu.Button("toolbar-layersTool");n.setToolTip("Layer Manager"),n.setIcon("adsk-icon-layers"),n.onClick=function(e){t.layersPanel||t.setLayersPanel(new ave.ViewerLayersPanel(t)),t.showLayerManager(!t.layersPanel.isVisible())},this.settingsTools.addControl(n),this.settingsTools.layerButton=n}else{if(!t.modelstructure){var o={docStructureConfig:t.config.docStructureConfig};t.setModelStructurePanel(new ave.ViewerModelStructurePanel(t,"Browser",o))}var r=new avu.Button("toolbar-modelStructureTool");r.setToolTip("Model browser"),r.setIcon("adsk-icon-structure"),r.onClick=function(e){t.showModelStructurePanel(!t.modelstructure.isVisible())},this.settingsTools.addControl(r),this.settingsTools.structurebutton=r,this.initExplodeSlider()}t.addEventListener(av.RESET_EVENT,function(){t.model&&!t.model.is2d()&&(t.explode(0),t.explodeSlider.value=0),t.showAll()});var s=new avu.Button("toolbar-propertiesTool");s.setToolTip("Properties"),s.setIcon("adsk-icon-properties"),s.onClick=function(e){var i=t.getPropertyPanel(!0);i.setVisible(!i.isVisible())},s.setVisible(!t.prefs.openPropertiesOnSelect),this.settingsTools.addControl(s),this.settingsTools.propertiesbutton=s;var a=new ave.ViewerSettingsPanel(this,e);this.setSettingsPanel(a),a.syncUI();var l=new avu.Button("toolbar-settingsTool");if(this.viewerOptionButton=l,l.setIcon("adsk-icon-settings"),l.setToolTip("Settings"),this.settingsTools.addControl(l),this.createViewerOptionsMenu(e),avp.ENABLE_DEBUG&&!e.is2d()){this.renderoptions=new avp.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var c=new avu.Button("toolbar-renderOptionsTool");c.setToolTip("Rendering options"),c.setIcon("adsk-icon-settings-render"),c.onClick=function(e){t.showRenderingOptions(!t.renderoptions.isVisible())},this.settingsTools.addControl(c)}if(this.canChangeScreenMode()){var u=new avu.Button("toolbar-fullscreenTool",{collapsible:!1});u.setToolTip("Full screen"),u.setIcon("adsk-icon-fullscreen"),u.onClick=function(e){t.nextScreenMode()},this.settingsTools.addControl(u),this.settingsTools.fullscreenbutton=u,this.updateFullscreenButton(this.getScreenMode())}},e.prototype.setPropertiesOnSelect=function(e){this.prefs.set("openPropertiesOnSelect",e),this.settingsTools.propertiesbutton.setVisible(!e)},e.prototype.addDivider=function(e){var t=document.createElement("li");return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},e.prototype.createViewerOptionsMenu=function(e){function t(e){if(i.getExtension("Autodesk.SideBarUi")){var t=Autodesk.SideBarUi.Content;return void i.fireEvent({type:av.SIDE_BAR_OPEN_EVENT,content:t.Settings})}var n=i.getSettingsPanel(!0);n.isVisible()?i.showViewer3dOptions(!1):(i.showViewer3dOptions(!0),n.selectTab(e))}var i=this;this.viewerOptionButton.onClick=function(){t(ave.ViewerSettingTab.Performance)}},e.prototype.initDebugTools=function(){var e=new avu.ControlGroup("debugTools");this.debugMenu=e;var t=new avu.Button("toolbar-debugTool");t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e)},e.prototype.createDebugSubmenu=function(e){function t(){i.localize()}var i=this,n=document.createElement("div");n.id="toolbar-debugToolSubmenu",n.classList.add("toolbar-submenu"),n.classList.add("toolbar-settings-sub-menu"),n.classList.add("adsk-hidden"),this.debugMenu.subMenu=n,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(n),this.initModelStats(),this.addDivider(n),this.addDivider(n);var o=["English","Chinese Simplified","Chinese Traditional","Japanese","Czech","Korean","Polish","Russian","French","German","Italian","Spanish","Portuguese Brazil","Turkish"],r=["en","zh-Hans","zh-Hant","ja","cs","ko","pl","ru","fr","de","it","es","pt-br","tr"],s=i.selectedLanguage?i.selectedLanguage:0;this.addOptionList(n,"Language",o,s,function(e){var n=r[e];i.selectedLanguage=e,avp.setLanguage(n,t)},null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);var a=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"];this.addOptionList(n,"Error",a,0,function(e){var t=e+1;avp.ErrorHandler.reportError(i.container,t,"")},null).parentNode.style.paddingBottom="15px";var l=n.getBoundingClientRect();this.debugMenu.subMenu.style.width=l.width+"px",this.container.removeChild(n),e.container.appendChild(n);var c=l.left+l.width,u=this.container.getBoundingClientRect().right;if(c>u){var h=-(c-u+10)+"px";this.debugMenu.subMenu.style.left=h}e.onMouseOver=function(e){n.classList.remove("adsk-hidden")},e.onMouseOut=function(e){n.classList.add("adsk-hidden")},av.isTouchDevice()&&(e.onClick=function(e){n.classList.toggle("adsk-hidden")})},e.prototype.initModelStats=function(){function e(e){var t=i.impl,n="";i.model&&(n+="Geom&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().geomPolyCount+"<br>",n+="Instance&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().instancePolyCount+"<br>",n+="Fragments:&nbsp;"+t.modelQueue().getFragmentList().getCount()+"<br>",n+="Geoms:&nbsp;"+t.modelQueue().getGeometryList().geoms.length+"<br>",n+="Loading&nbsp;time:&nbsp;"+(t.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),n+="# "+(e||""),i.modelStats.innerHTML=n}function t(){i.modelStats=document.createElement("div"),i.modelStats.className="statspanel",i.container.appendChild(i.modelStats),i.addEventListener(av.PROGRESS_UPDATE_EVENT,function(t){t.message&&e(t.message)}),i.fpsDisplay=document.createElement("div"),i.fpsDisplay.className="fps",i.container.appendChild(i.fpsDisplay)}var i=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(n){n&&!i.modelStats&&(t(),e("")),i.modelStats.style.visibility=n?"visible":"hidden",i.fpsDisplay.style.visibility=n?"visible":"hidden",i.impl.fpsCallback=n?function(e){i.fpsDisplay.textContent=""+(0|e)}:null})},e.prototype.initEscapeHandlers=function(){var e=this;this.addEventListener(av.ESCAPE_EVENT,function(t){if(!e.contextMenu||!e.contextMenu.hide())if(e.renderoptions&&e.renderoptions.isVisible())e.renderoptions.setVisible(!1);else{if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void avp.HudMessage.dismiss();if(e.selectionActive)e.clearSelection();else if(e.areAllVisible()){if(!avp.AlertBox.dismiss()){for(var i=0;i<e.dockingPanels.length;++i){var n=e.dockingPanels[i];if("none"!==n.container.style.display&&""!==n.container.style.display)return void(n.container===e.modelstructure?e.showModelStructurePanel(!1):n.setVisible(!1))}e.escapeScreenMode()}}else e.showAll()}})},e.prototype.showViewCubeUI=function(e){this.viewCubeUi.setVisible(e)},e.prototype.displayViewCube=function(e,t){this.viewCubeUi.displayViewCube(e,t)},e.prototype.getToolbar=function(e){if(!this.toolbar&&e){var t=av.UI;this.toolbar=new t.ToolBar("guiviewer3d-toolbar"),this.navTools=new t.RadioButtonGroup(av.TOOLBAR.NAVTOOLSID),this.modelTools=new t.ControlGroup(av.TOOLBAR.MODELTOOLSID),this.settingsTools=new t.ControlGroup(av.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),this.toolbar.container.style.display="none"}return this.toolbar},e.prototype.showModelStructurePanel=function(e){this.modelstructure.setVisible(e),e&&this.modelstructure instanceof ave.ViewerModelStructurePanel&&(this.modelstructure.setSelection(this.getSelection()),this.modelstructure.setIsolation(this.getIsolatedNodes()))},e.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},e.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen";switch(e){case av.ScreenMode.kNormal:this.isScreenModeSupported(av.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen");break;case av.ScreenMode.kFullBrowser:t=this.isScreenModeSupported(av.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case av.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},e.prototype.localize=function(){av.i18n.localize(),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),avp.ErrorHandler.localize()},e.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},e.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e);return t>-1&&(this.dockingPanels.splice(t,1),!0)},e.prototype.resizePanels=function(e){e=e||{};var t=this.toolbar.getDimensions().height,i=this.getDimensions(),n=i.height;e.dimensions&&e.dimensions.height?n=e.dimensions.height:e.dimensions={height:i.height,width:i.width},e.dimensions.height=n-t;var o=e?e.viewer:null;o||(o=this);var r=e?e.dockingPanels:null;r||(r=o.dockingPanels);var s,a,l=o.container.getBoundingClientRect(),c=l.top,u=l.bottom,h=l.left,d=l.right;e&&e.dimensions?(s=e.dimensions.width,a=e.dimensions.height,u=e.dimensions.height):(s=l.width,a=l.height);for(var p=0;p<r.length;++p){var g=r[p].container,m=g.getBoundingClientRect(),v=m.top,f=m.bottom,E=m.left,A=m.right,y=m.width,T=m.height;y&&T&&(s<y&&(y=Math.round(s),g.style.width=y+"px"),a<T&&(T=Math.round(a),g.style.height=T+"px"),(d<A||g.dockRight)&&(E=Math.round(d-y-h),g.style.left=E+"px"),(u<f||g.dockBottom)&&((v=Math.round(u-T-c))<0&&(v=0),g.style.top=v+"px"),g.style.maxWidth=Math.round(s)+"px",g.style.maxHeight=Math.round(a)+"px")}},e.prototype.initExplodeSlider=function(){var e=this,t=new avu.Button("toolbar-explodeTool");t.setIcon("adsk-icon-explode"),t.setToolTip("Explode model"),e.modelTools.addControl(t,{index:0});this.explodeSubmenu=avp.stringToDOM('<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>');var i;i=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios"),i.appendChild(this.explodeSubmenu);var n=this.explodeSubmenu.querySelector(".explode-slider");e.explodeSlider=n,n.oninput=function(t){e.explode(n.value)},n.onchange=function(t){e.explode(n.value)},this.explodeSubmenu.onclick=function(e){e.stopPropagation()};var o=t.container.querySelector(".adsk-control-tooltip");t.onClick=function(i){var r=t.getState();r===avu.Button.State.INACTIVE?(t.setState(avu.Button.State.ACTIVE),o.style.display="none",e.explodeSubmenu.style.display="",avp.logger.track({category:"tool_changed",name:"explode"})):r===avu.Button.State.ACTIVE&&(t.setState(avu.Button.State.INACTIVE),o.style.display="",n.parentNode.style.display="none",e.explode(0),e.explodeSlider.value=0)}},e.prototype.initInspectTools=function(){var e=new avu.Button("toolbar-inspectTools");e.setToolTip("Inspect"),e.setIcon("measure"),e.setVisible(!1),this.modelTools.addControl(e);var t=new avu.RadioButtonGroup("toolbar-inspectSubMenu");t.addClass("toolbar-vertical-group"),t.setVisible(!1),this.modelTools.addControl(t),e.container.insertBefore(t.container,e.container.firstChild),e.onMouseOver=function(){t.setVisible(!0)},e.onMouseOut=function(){t.setVisible(!1)},av.isTouchDevice()&&(e.onClick=function(e){t.setVisible(!t.isVisible())})},e.prototype.initModality=function(){function e(t){for(var i=0;i<2&&t.parentElement;){var n=t.id;if(0===n.indexOf("toolbar-")){if(n.indexOf("arrow")===n.length-5)return;return e(t.parentElement)||t}t=t.parentElement,i++}}function t(e){return e.id.substring(8,e.id.length)}function i(e){return e.classList.contains("active")}function n(e){var t=document.createEvent("Event");t.initEvent("click",!0,!0),e.dispatchEvent(t)}function o(e,t,i){a[e]=i?t:void 0}function r(r){if(!r.target.classList.contains("clickoff")){var l=e(r.target);if(l){var c=t(l);if(s[c]&&!("sectionTool"===c&&(r.target.classList.contains("adsk-icon-section-analysis")||r.target.querySelector(".adsk-icon-section-analysis"))||a[c]&&(o(c,l,!1),i(l)))){for(var u in a){var h=a[u];if(h){var d=t(h);i(h)?s[c][d]||n(h):o(d,h,!1)}}o(c,l,!0)}}}}var s={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{},measureTool:{},explodeTool:{},billboardTool:{}},a={};this.toolbar.container.addEventListener("click",r,!0)},e.prototype.updateToolbarButtons=function(e,t){if(this.getToolbar(!1)){var i,n;n=e>310?"block":"none",(i=this.modelTools.getControl("toolbar-explodeTool"))&&i.setDisplay(n),n=e>380?"block":"none",(i=this.modelTools.getControl("toolbar-collaborateTool"))&&i.setDisplay(n),n=e>515?"block":"none";var o=this.navTools.getControl("toolbar-cameraSubmenuTool");o&&(o.setDisplay(n),(i=o.subMenu.getControl("toolbar-homeTool"))&&i.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(i=o.subMenu.getControl("toolbar-fitToViewTool"))&&i.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),(i=o.subMenu.getControl("toolbar-focalLengthTool"))&&i.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(i=o.subMenu.getControl("toolbar-rollTool"))&&i.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),n=e>700?"block":"none",(i=this.modelTools.getControl("toolbar-measureTool"))&&i.setDisplay(n),(i=this.modelTools.getControl("toolbar-sectionTool"))&&i.setDisplay(n),n=e>740?"block":"none",(i=this.navTools.getControl("toolbar-beelineTool"))&&i.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),(i=this.navTools.getControl("toolbar-firstPersonTool"))&&i.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),(i=this.navTools.getControl("toolbar-zoomTool"))&&i.setDisplay(this.navigation.isActionEnabled("zoom")?n:"none"),(i=this.navTools.getControl("toolbar-panTool"))&&i.setDisplay(this.navigation.isActionEnabled("pan")?n:"none"),(i=this.navTools.getControl("toolbar-orbitTools"))&&i.setDisplay(this.navigation.isActionEnabled("orbit")?n:"none")}},avp.GuiViewer3D=e}(),function(){"use strict";function e(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control")}var t=Autodesk.Viewing;Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},t.EventDispatcher.prototype.apply(e.prototype),e.prototype.constructor=e,e.prototype.container=null,e.prototype.getId=function(){return this._id},e.prototype.setVisible=function(t){if(!this.container.classList.contains("adsk-hidden")===t)return!1;t?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var i={type:e.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:t};return this.fireEvent(i),!0},e.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},e.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},e.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},e.prototype.setCollapsed=function(t){if(!this._isCollapsible||this.isCollapsed()===t)return!1;t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var i={type:e.Event.COLLAPSED_CHANGED,isCollapsed:t};return this.fireEvent(i),!0},e.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},e.prototype.isCollapsible=function(){return this._isCollapsible},e.prototype.addClass=function(e){this.container.classList.add(e)},e.prototype.removeClass=function(e){this.container.classList.remove(e)},e.prototype.getPosition=function(){var e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}},e.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect();return{width:e.width,height:e.height}},e.prototype.setDisplay=function(e){this.container.style.display=e},Autodesk.Viewing.UI.Control=e}(),function(){"use strict";function e(i,n){t.Control.call(this,i,n);var o=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(t){var i={type:e.Event.SIZE_CHANGED,childEvent:t};o.fireEvent(i)}}var t=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},e.prototype=Object.create(t.Control.prototype),e.prototype.constructor=e,e.prototype.addControl=function(i,n){var o=n&&void 0!==n.index?n.index:this._controls.length;if(null!==this.getControl(i.getId()))return!1;var r={type:e.Event.CONTROL_ADDED,control:i,index:o};return o<this._controls.length?(this.container.insertBefore(i.container,this._controls[o].container),this._controls.splice(o,0,i)):(this.container.appendChild(i.container),this._controls.push(i)),i.addEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),i.addEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),i instanceof e&&i.addEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var i=this._controls[t];if(i===e||"string"==typeof e&&e===i.getId())return t}return-1},e.prototype.removeControl=function(i){var n="string"==typeof i?this.getControl(i):i;if(!n)return!1;var o=this._controls.indexOf(n);if(-1===o)return!1;this._controls.splice(o,1),this.container.removeChild(n.container);var r={type:e.Event.CONTROL_REMOVED,control:n,index:o};return n.removeEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),n.removeEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),n instanceof e&&n.removeEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t];return null},e.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},e.prototype.getNumberOfControls=function(){return this._controls.length},e.prototype.setCollapsed=function(t){if(!this._isCollapsible)return!1;var i=!1;return this._controls.forEach(function(e){e.isCollapsible()&&e.setCollapsed(t)&&(i=!0)}),i&&(t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:e.Event.COLLAPSED_CHANGED,isCollapsed:t})),i},Autodesk.Viewing.UI.ControlGroup=e}(),function(){"use strict";function e(e,i){t.ControlGroup.call(this,e,i),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var t=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,Autodesk.Viewing.UI.ToolBar=e}(),function(){"use strict";function e(n,o){i.Control.call(this,n,o);var r=this;this._state=e.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(t){r.getState()!==e.State.DISABLED&&(r.fireEvent(e.Event.CLICK),r.onClick&&r.onClick(t)),t.stopPropagation()}),t.isTouchDevice()?this.container.addEventListener("touchstart",t.touchStartToClick):(this.container.addEventListener("mouseover",function(e){r.onMouseOver(e)}),this.container.addEventListener("mouseout",function(e){r.onMouseOut(e)})),this.addClass("adsk-button"),this.addClass(e.StateToClassMap[this._state])}var t=Autodesk.Viewing,i=Autodesk.Viewing.UI;e.Event={VISIBILITY_CHANGED:i.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:i.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},e.State={ACTIVE:0,INACTIVE:1,DISABLED:2},e.StateToClassMap=function(){var t=e.State,i={};return i[t.ACTIVE]="active",i[t.INACTIVE]="inactive",i[t.DISABLED]="disabled",i}(),e.prototype=Object.create(i.Control.prototype),e.prototype.constructor=e,e.prototype.setState=function(t){if(t===this._state)return!1;this.removeClass(e.StateToClassMap[this._state]),this.addClass(e.StateToClassMap[t]),this._state=t;var i={type:e.Event.STATE_CHANGED,state:t};return this.fireEvent(i),!0},e.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},e.prototype.getState=function(){return this._state},e.prototype.onClick=function(e){},e.prototype.onMouseOver=function(e){},e.prototype.onMouseOut=function(e){},Autodesk.Viewing.UI.Button=e}(),function(){"use strict";function e(e,n){t.Button.call(this,e,n),this.arrowButton=new t.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new t.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var o=this;this.arrowButton.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.toggleFlyoutVisible=function(){o.subMenu.setVisible(!o.subMenu.isVisible())},this.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(o.setIcon(e.target.getActiveButton().iconClass),o.setToolTip(e.target.getActiveButton().getToolTip()),o.setState(t.Button.State.ACTIVE),o.onClick=e.button.onClick):o.setState(t.Button.State.INACTIVE)},this.subMenu.addEventListener(t.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var r=i.stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(r,this.subMenu.container.firstChild),r.addEventListener("click",function(e){o.subMenu.setVisible(!1),e.stopPropagation()})}var t=Autodesk.Viewing.UI,i=Autodesk.Viewing.Private;e.prototype=Object.create(t.Button.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.removeControl=function(e){e.removeEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.setState=function(e){if(e===t.Button.State.INACTIVE){var i=this.subMenu.getActiveButton();i&&i.setState(t.Button.State.INACTIVE)}t.Button.prototype.setState.call(this,e)},e.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},e.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(t.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=e}(),function(){"use strict";function e(i,n){t.ControlGroup.call(this,i,n);var o=this;this._activeButton=null,this._handleButtonStateChange=function(i){var n=t.Button.State;i.state===n.ACTIVE?(o._activeButton=i.target,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!0}),o._controls.forEach(function(e){e!==i.target&&e.getState()!==n.DISABLED&&e.setState(n.INACTIVE)})):i.target===o._activeButton&&(o._activeButton=null,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!1}))}}var t=Autodesk.Viewing.UI;e.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e,i){return e instanceof t.Button&&(!!t.ControlGroup.prototype.addControl.call(this,e,i)&&(e.addEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},e.prototype.removeControl=function(e){var i="string"==typeof e?this.getControl(e):e;return!(null===i||!t.ControlGroup.prototype.removeControl.call(this,i))&&(i.removeEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},e.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=e}(),function(){"use strict";function e(e,t){i.DomDispatcher.prototype.apply(this),this.viewer=e,this.container=t}var t=AutodeskNamespace("Autodesk.SideBarUi.Content"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils"),n=Autodesk.Viewing;t.Settings=e;var o=e.prototype;e.IDS={SHOW_VIEWCUBE:1,ACT_ON_PIVOT:2,ZOOM_TOWARDS_PIVOT:3,LEFT_MOUSE_PIVOT:4,FUSION_ORBIT:5,FIRST_PERSON_WALK:6,REVERSE_MOUSE_ZOOM:7,ORBIT_PAST_POLES:8,OPEN_PROPS_ON_SELECT:9,LEFT_HAND_MOUSE_SETUP:10,MAX_NAV:11,GHOSTING:11,SMOOTH_NAVIGATION:12,ANTIALIASING:13,AMBIENT_SHADOWS:14,GROUND_SHADOWS:15,GROUND_REFLECTIONS:16,ENV_MAP_BG:17,PROGRESSIVE_RENDERING:18,SWAP_BLACK_AND_WHITE:19},e.ELEMENTS=[{id:1,text:"Show ViewCube",pref:"viewCube",defaultValue:!0,mode:["3d"]},{id:2,text:"ViewCube acts on pivot",pref:"alwaysUsePivot",defaultValue:!1,mode:["3d"]},{id:3,text:"Zoom towards pivot",pref:"zoomTowardsPivot",defaultValue:!1,mode:["3d"]},{id:4,text:"Set pivot with left mouse button",pref:"clickToSetCOI",defaultValue:!1,mode:["3d"]},{id:5,text:"Fusion style orbit",pref:"fusionOrbit",defaultValue:!1,mode:["3d"]},{id:6,text:"First person walk",pref:"useFirstPersonNavigation",defaultValue:!1,mode:["3d"]},{id:7,text:"Reverse mouse zoom direction",pref:"reverseMouseZoomDir",defaultValue:!1,mode:["2d","3d"]},{id:8,text:"Orbit past world poles",pref:"orbitPastWorldPoles",defaultValue:!0,mode:["3d"]},{id:9,text:"Open properties on select",pref:"openPropertiesOnSelect",defaultValue:!0,mode:["2d","3d"]},{id:10,text:"Left handed mouse setup",pref:"leftHandedMouseSetup",defaultValue:!1,mode:["2d","3d"]},{id:11,text:"Ghost hidden objects",pref:"ghosting",defaultValue:!0,mode:["3d"]},{id:12,text:"Smooth navigation",pref:"optimizeNavigation",defaultValue:n.isMobileDevice(),mode:["3d"]},{id:13,text:"Anti-aliasing",pref:"antialiasing",defaultValue:!0,mode:["3d"]},{id:14,text:"Ambient shadows",pref:"ambientShadows",defaultValue:!0,mode:["3d"]},{id:15,text:"Ground shadow",pref:"groundShadow",defaultValue:!0,mode:["3d"]},{id:16,text:"Ground reflection",pref:"groundReflection",defaultValue:!0,mode:["3d"]},{id:17,text:"Environment map for background",pref:"envMapBackground",defaultValue:!0,mode:["3d"]},{id:18,text:"Progressive model display",pref:"progressiveRendering",defaultValue:!0,mode:["2d","3d"]},{id:19,text:"Swap black and white",pref:"swapBlackAndWhite",defaultValue:!1,mode:["2d"]}],o.load=function(){var t=e.ELEMENTS;e.createDom(this,this.viewer,this.container,t),this.onPrefChangedBinded=this.onPrefChanged.bind(this),this.viewer.addEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefResetBinded=this.onPrefReset.bind(this),this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded)},o.unload=function(){this.viewer.removeEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefChangedBinded=null,this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded),this.onPrefResetBinded=null,this.unhookEvents()},o.getTitle=function(){return"Settings"},o.onPrefChanged=function(t){var i=t.name,n=e.getIdFromPref(i);if(-1!==n){var o='[data-value="'+n+'"]';this.container.querySelector(o).querySelector("input").checked=t.value}},o.onPrefReset=function(t){var i=t.name,n=e.getIdFromPref(i);-1!==n&&(this.onPrefChanged(t),e.setState(this.viewer,n,t.value))},e.getIdFromPref=function(t){var i=-1;return e.ELEMENTS.forEach(function(e){e.pref===t&&(i=e.id)}),i},e.setState=function(t,i,n){var o=e.IDS;switch(i){case o.SHOW_VIEWCUBE:t.displayViewCube(n);break;case o.ACT_ON_PIVOT:t.setUsePivotAlways(n);break;case o.ZOOM_TOWARDS_PIVOT:t.setZoomTowardsPivot(n);break;case o.LEFT_MOUSE_PIVOT:t.setClickToSetCOI(n);break;case o.FUSION_ORBIT:n?t.loadExtension("Autodesk.Viewing.FusionOrbit",null):t.unloadExtension("Autodesk.Viewing.FusionOrbit",null);break;case o.FIRST_PERSON_WALK:n?(t.unloadExtension("Autodesk.Beeline",null),t.loadExtension("Autodesk.FirstPerson",null)):(t.unloadExtension("Autodesk.FirstPerson",null),t.loadExtension("Autodesk.Beeline",null));case o.REVERSE_MOUSE_ZOOM:t.setReverseZoomDirection(n);break;case o.ORBIT_PAST_POLES:t.setOrbitPastWorldPoles(n);break;case o.OPEN_PROPS_ON_SELECT:t.setPropertiesOnSelect(n);break;case o.LEFT_HAND_MOUSE_SETUP:t.setUseLeftHandedInput(n);break;case o.GHOSTING:t.setGhosting(n);break;case o.SMOOTH_NAVIGATION:t.setOptimizeNavigation(n);break;case o.ANTIALIASING:t.setQualityLevel(t.prefs.ambientShadows,n);break;case o.AMBIENT_SHADOWS:t.setQualityLevel(n,t.prefs.antialiasing);break;case o.GROUND_SHADOWS:t.setGroundShadow(n);break;case o.GROUND_REFLECTIONS:t.setGroundReflection(n);break;case o.ENV_MAP_BG:t.setEnvMapBackground(n);break;case o.PROGRESSIVE_RENDERING:t.setProgressiveRendering(n);break;case o.SWAP_BLACK_AND_WHITE:t.setSwapBlackAndWhite(n);break;default:console.log(i)}},e.createDom=function(t,i,n,o){var r=i.model.is2d()?"2d":"3d",s=o.filter(function(e){return-1!==e.mode.indexOf(r)}),a=s.filter(function(t){return t.id<e.IDS.MAX_NAV}),l=s.filter(function(t){return t.id>=e.IDS.MAX_NAV});e.createTable(n,a,"Navigation and selection"),e.createTable(n,l,"Performance and appearance");s.forEach(function(t){var o='[data-value="'+t.id+'"]';n.querySelector(o).querySelector("input").checked=e.isChecked(i,t)}),t.hookEvent(n,"click","tr",function(t,n){var o=parseInt(n.getAttribute("data-value")),r=n.querySelector("input");t.target!==r&&(r.checked=!r.checked);var s=r.checked;e.setState(i,o,s)});var c=document.createElement("button");c.className="lmv-sidebar-menu-button",c.setAttribute("data-i18n","Restore default settings"),c.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),n.appendChild(c),t.hookEvent(c,"click","button",function(e,t){var n=r;i.prefs.reset(n)})},e.createTable=function(t,i,n){var o=document.createElement("div");o.classList.add("lmv-sidebar-menu-heading"),o.setAttribute("data-i18n",n),o.textContent=Autodesk.Viewing.i18n.translate(n),t.appendChild(o);var r=document.createElement("table");r.classList.add("adsk-lmv-tftable"),r.classList.add("adsk-lmv-settings");var s=i.map(e.renderOption);return r.innerHTML=s.join("\n"),t.appendChild(r),r},e.renderOption=function(e){var t=Autodesk.Viewing.i18n.translate(e.text);return'<tr data-value="'+e.id+'"><td><div data-i18n="'+e.text+'">'+t+'</div></td><td><input type="checkbox"></td></tr>'},e.isChecked=function(e,t){var i=t.pref?e.prefs[t.pref]:null;return"boolean"==typeof i?i:t.defaultValue}}(),function(){"use strict";function e(){}var t=AutodeskNamespace("Autodesk.Viewing.Private"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");i.DomDispatcher=e,e.prototype={constructor:e,apply:function(t){t.hookEvent=e.prototype.hookEvent,t.unhookEvents=e.prototype.unhookEvents,t.eventsHooked=[]},hookEvent:function(e,i,n,o){var r=function(e){var i=t.DomUtils.seekSelectorUp(e.target,n);i&&o(e,i)};e.addEventListener(i,r),this.eventsHooked.push({domElem:e,eventStr:i,callback:r})},unhookEvents:function(){this.eventsHooked.forEach(function(e){e.domElem.removeEventListener(e.eventStr,e.callback)}),this.eventsHooked.length=0}},i.seekSelectorUp=function(e,i){for(;e;){if(t.DomUtils.matchesSelector(e,i))return e;e=e.parentNode}return e},i.matchesSelector=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)},i.removeChildren=function(e){e.innerHTML=""},i.remove=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),i.DomDispatcher.prototype.apply(this),this.currentContent=null}var t=AutodeskNamespace("Autodesk.SideBarUi"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils");AutodeskNamespace("Autodesk.SideBarUi.Content");e.populateDefaultOptions=function(e){e.experimental.push("--sidebar-ui")},e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,t.SideBarUi=e;var n=e.prototype;n.load=function(){return this.openSideMenuBinded=this.openSideMenu.bind(this),this.viewer.addEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),!0},n.unload=function(){return this.viewer.removeEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),this.openSideMenuBinded=null,this.currentContent&&(this.currentContent.unload(),this.currentContent=null),this.domNav&&(i.remove(this.domNav),this.domNav=null),this.unhookEvents(),!0},n.createSlidingSideBar=function(e){var t=this.domNav=document.createElement("div");t.className="lmv-sidebar-menu--slide-left";t.innerHTML=['<button class="lmv-sidebar-menu__title">',"</button>",'<button class="lmv-sidebar-menu-button lmv-sidebar-menu-button__cross">&times;</button>','<div class="lmv-sidebar-menu__content">',"</div>"].join(""),e.appendChild(t),this.domContent=this.domNav.querySelector(".lmv-sidebar-menu__content"),this.domCloseBtn=this.domNav.querySelector("button.lmv-sidebar-menu__title"),this.setCloseButton(),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu__title",function(e){this.toggleCollapsed()}.bind(this)),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu-button__cross",function(e){this.closeSideMenu()}.bind(this))},n.setCloseButton=function(e){var t=e||"Close";this.domCloseBtn.setAttribute("data-i18n",t),this.domCloseBtn.textContent=Autodesk.Viewing.i18n.translate(t)},n.openSideMenu=function(e){if(this.domNav||this.createSlidingSideBar(this.viewer.container),this.currentContent&&(this.currentContent.unload(),this.currentContent=null,i.removeChildren(this.domContent)),e.content){var t=e.content;this.currentContent=new t(this.viewer,this.domContent),this.currentContent.load();var n=this.currentContent.getTitle();this.setCloseButton(n)}var o=this.domNav;requestAnimationFrame(function(){o.classList.remove("is-collapsed"),o.classList.add("is-active")})},n.toggleCollapsed=function(){this.domNav.classList.toggle("is-collapsed"),this.domNav.scrollTop=0},n.closeSideMenu=function(){this.domNav.classList.remove("is-active")},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SideBarUi",e)}(),function(){function e(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(e,t){return window.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=window.JSINTERFACE}AutodeskNamespace("Autodesk.Viewing");var t=e.prototype;t.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},t.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},t.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},t.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},t.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},t.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},t.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},t.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},t.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},t.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},t.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},t.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},t.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},t.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},t.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},t.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},t.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},t.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},t.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},t.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},t.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},t.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},t.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},Autodesk.Viewing.MobileCallbacks=e,window.MobileCallbacks=e}(),function(){"use strict";function e(e){return"application/autodesk-db"==e.mime&&e.urn?0===e.urn.indexOf("urn:adsk.objects:os.object")?e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):e.urn.substr(0,e.urn.lastIndexOf("/")+1):null}function t(n,o){if(this.parent=o,this.id=i++,this.data=n,this.isLeaf="geometry"===n.type&&("3d"===n.role||"2d"===n.role||"lod"===n.role),Array.isArray(n.children)){this.children=[];for(var r=n.children.length,s=0;s<r;s++)this.children[s]=new t(n.children[s],this);for(s=0;s<r;s++){var a=e(n.children[s]);a&&(this.sharedPropertyDbPath=a),"lod"===n.children[s].role&&(this.lodNode=this.children[s])}}}var i=1;t.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},t.prototype.findPropertyDbPath=function(){return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},t.prototype._raw=function(){return this.data},t.prototype.name=function(){return this.data.name},t.prototype.guid=function(){return this.data.guid},t.prototype.urn=function(e){var t=this.data.urn;if(!e)return t;for(var i=this.parent;!t&&i;)t=i.data.urn,i=i.parent;return t},t.prototype.getTag=function(e){return(this.data.tags?this.data.tags:this.data)[e]},t.prototype.setTag=function(e,t){this.data.tags?this.data.tags[e]=t:this.data[e]=t},t.prototype.isGeomLeaf=function(){return this.isLeaf},t.prototype.isViewable=function(){return"viewable"===this.data.role},t.prototype.getLodNode=function(){return this.lodNode},t.prototype.isGeometry=function(){return"geometry"===this.data.type},t.prototype.is2D=function(){return"2d"===this.data.role},t.prototype.is3D=function(){return"3d"===this.data.role},t.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},t.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},t.prototype.getPlacementTransform=function(){return this.data.placement},t.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},t.prototype.findViewableParent=function(){for(var e=this;e&&!e.isViewable();)e=e.parent;return e},t.prototype.findParentGeom2Dor3D=function(){for(var e=this;e&&!e.is2DGeom()&&!e.is3DGeom();)e=e.parent;return e},t.prototype.getViewableRootPath=function(){if(!this.isGeomLeaf())return null;var e=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",t=this.search({mime:e});return t&&t.length?t[0].data.urn:null},t.prototype.findByGuid=function(e){var t=null;return this.traverse(function(i){if(i.data.guid===e)return t=i,!0}),t},t.prototype.search=function(e){var t=[];return this.traverse(function(i){var n=!0;for(var o in e)if(!i.data.hasOwnProperty(o)||i.data[o]!==e[o]){n=!1;break}n&&t.push(i)}),t.length?t:null},t.prototype.searchByTag=function(e){var t=[];return this.traverse(function(i){var n=!0;for(var o in e)if(i.getTag(o)!==e[o]){n=!1;break}n&&t.push(i)}),t.length?t:null},t.prototype.traverse=function(e){if(e(this))return!0;if(this.children)for(var t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0;return!1},t.prototype.getLevel=function(){var e=this.getTag("level");return Array.isArray(e)?e[0]:e},t.MODEL_NODE={role:"3d",type:"geometry"},t.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},t.SHEET_NODE={role:"2d",type:"geometry"},t.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},t.VIEWABLE_NODE={role:"viewable"},Autodesk.Viewing.BubbleNode=t}(),Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},i=document.getElementsByClassName("toolbar-menu");return i&&i.length>0&&(t=i[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}},function(){"use strict";var e=Autodesk.Viewing,t=(Autodesk.Viewing.Private,Autodesk.Viewing.UI),i=Autodesk.Viewing.Extensions,n={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};i.ViewerModelStructurePanel=function(e,i,o){this.viewer=e,(o=o||{}).heightAdjustment=75,t.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",i,o),this.clickConfig=o&&o.docStructureConfig?o.docStructureConfig:n,this.isMac=-1!==navigator.userAgent.search("Mac OS"),this.initSearchBox(),this.prevSearchResults=[],this.prevSearchString=""},i.ViewerModelStructurePanel.prototype=Object.create(t.ModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.constructor=i.ViewerModelStructurePanel,i.ViewerPanelMixin.call(i.ViewerModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.initialize=function(){t.ModelStructurePanel.prototype.initialize.call(this);var i=this;i.addEventListener(i.viewer,e.SELECTION_CHANGED_EVENT,function(e){i.setSelection(e.nodeArray.slice())}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){i.setIsolation(e.nodeIdArray.slice())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!0)}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!1)})},i.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null,t.ModelStructurePanel.prototype.uninitialize.call(this)},i.ViewerModelStructurePanel.prototype.handleAction=function(e,t){for(var i in e)switch(e[i]){case"selectOnly":this.viewer.select(t);break;case"deselectAll":this.viewer.select([]);break;case"selectToggle":this.viewer.toggleSelect(t);break;case"isolate":this.viewer.isolate(t);break;case"showAll":this.viewer.isolate(null);break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(t);break;case"show":this.viewer.show(t);break;case"toggleVisibility":this.viewer.toggleVisibility(t)}},i.ViewerModelStructurePanel.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey},i.ViewerModelStructurePanel.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=this,n="click";i.ctrlDown(t)&&(n+="Ctrl"),t.shiftKey&&(n+="Shift"),t.altKey&&(n+="Alt"),this.clickConfig&&this.clickConfig[n]?i.handleAction(this.clickConfig[n].onObject,e):this.viewer.select(e)}},i.ViewerModelStructurePanel.prototype.onDoubleClick=function(e,t){this.handleAction(["focus"],e)},i.ViewerModelStructurePanel.prototype.onHover=function(e,t){this.viewer.impl.rolloverObjectNode(e)},i.ViewerModelStructurePanel.prototype.onRightClick=function(e,t){if(this.isMac&&t.ctrlKey&&0===t.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,e):this.viewer.select(e),null;var i=[],n=!0;if(t.shiftKey||this.isMac&&t.metaKey||t.ctrlKey&&(this.isMac||2===t.button))for(var o=this.viewer.impl.selector.getSelection(),r=0;r<o.length;++r)o[r]!==e?i.push(o[r]):n=!1;return n&&i.push(e),this.viewer.select(i),this.viewer.contextMenu.show(t)},i.ViewerModelStructurePanel.prototype.setHidden=function(e,t){this.uiCreated||this.createUI();for(var i=0;i<e.length;++i)this.tree.iterate(e[i],function(e,i){i.classList.toggle("dim",t),i.classList.toggle("visible",!t)})},i.ViewerModelStructurePanel.prototype.setIsolation=function(e){if(void 0!==this.rootId&&null!==this.rootId){if(this.tree&&this.tree.iterate(this.rootId,function(e,t){t.classList.remove("dim"),t.classList.remove("visible")}),e.length>0){if(1===e.length&&e[0]===this.rootId)return;this.setHidden([this.rootId],!0),this.setHidden(e,!1)}this.searchbox&&!this.inSearchIsolate&&(this.searchbox.value="")}},i.ViewerModelStructurePanel.prototype.initSearchBox=function(){function t(){if(!r.isSearching){for(var e=0;e<r.prevSearchResults.length;e++)r.tree.setCollapsed(r.prevSearchResults[e],!0,!0);if(0===i.value.length)r.isSearching=!1,r.prevSearchString="",o.isolate();else{if(r.prevSearchString==i.value)return;r.isSearching=!0,o.search(i.value,function(e){if(r.inSearchIsolate=!0,o.isolate(e),r.inSearchIsolate=!1,e.length){for(var t=0;t<e.length;t++)r.tree.setCollapsed(e[t],!1,!0);r.resizeToContent(),r.tree.scrollTo(e[0])}r.prevSearchResults=e,r.isSearching=!1},null,["name"])}}}var i=document.createElement("input");i.className="toolbar-search-box",i.type="search",i.results=5,i.placeholder=e.i18n.translate("Filter by name"),i.incremental="incremental",i.autosave=this.container.id+"search_autosave",i.setAttribute("data-i18n","[placeholder]Filter by name"),this.scrollContainer.parentNode.insertBefore(i,this.scrollContainer),this.searchbox=i;var n,o=this.viewer,r=this;i.addEventListener("input",function(e){clearTimeout(n),n=setTimeout(t,500)}),i.addEventListener("change",function(e){clearTimeout(n),t()})}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.UI,i=function(e){this.viewer=e,this.currentNodeIds=[],this.currentModel=null,this.isSelection=!1,this.isDirty=!0,this.propertyNodeId=null,t.PropertyPanel.call(this,e.container,"ViewerPropertyPanel","Object Properties Loading...")};(i.prototype=Object.create(t.PropertyPanel.prototype)).constructor=i,e.Extensions.ViewerPanelMixin.call(i.prototype),i.prototype.initialize=function(){t.PropertyPanel.prototype.initialize.call(this);var i=this;i.addEventListener(i.viewer,e.AGGREGATE_SELECTION_CHANGED_EVENT,function(e){e.selections&&e.selections.length?(i.currentNodeIds=e.selections[0].dbIdArray,i.currentModel=e.selections[0].model,i.isSelection=e.selections[0].dbIdArray.length>0):i.isSelection=!1,i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){0==e.nodeIdArray.length&&i.isSelection||(i.currentModel=e.model,i.currentNodeIds=e.nodeIdArray,i.isDirty=!0,i.requestProperties())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),this.currentModel=i.viewer.model,this.currentNodeIds=i.viewer.getSelection(),0===this.currentNodeIds.length?this.currentNodeIds=i.viewer.getIsolatedNodes():this.isSelection=!0},i.prototype.setTitle=function(e,i){e||(e="Object Properties",(i=i||{}).localizeTitle=!0),t.PropertyPanel.prototype.setTitle.call(this,e,i)},i.prototype.setVisible=function(e){t.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},i.prototype.visibilityChanged=function(){t.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},i.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},i.prototype.setNodeProperties=function(e){var t=this;this.propertyNodeId=e,t.currentModel.getProperties(e,function(e){if(t.setTitle(e.name),t.setProperties(e.properties),t.highlight(t.viewer.searchText),t.resizeToContent(),t.isVisible()){var i=t.viewer.toolController,n=i.lastClickX,o=i.lastClickY,r=t.container.getBoundingClientRect(),s=r.left,a=r.top,l=r.width,c=r.height,u=t.viewer.canvas.getBoundingClientRect(),h=u.left,d=u.top,p=u.width,g=u.height;s<=n&&n<s+l&&a<=o&&o<a+c&&(n<s+l/2&&n+l<h+p?(t.container.style.left=Math.round(n-h)+"px",t.container.dockRight=!1):h<=n-l?(t.container.style.left=Math.round(n-h-l)+"px",t.container.dockRight=!1):n+l<h+p?(t.container.style.left=Math.round(n-h)+"px",t.container.dockRight=!1):o+c<d+g?(t.container.style.top=Math.round(o-d)+"px",t.container.dockBottom=!1):d<=o-c&&(t.container.style.top=Math.round(o-d-c)+"px",t.container.dockBottom=!1))}})},i.prototype.showDefaultProperties=function(){var e=this.currentModel.getRootId();e?this.setNodeProperties(e):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),t.PropertyPanel.prototype.showDefaultProperties.call(this))},i.prototype.areDefaultPropertiesShown=function(){var e=this.currentModel.getRootId();return this.propertyNodeId===e},i.prototype.uninitialize=function(){t.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},i.prototype.onCategoryClick=function(e,i){t.PropertyPanel.prototype.onCategoryClick.call(this,e,i),this.resizeToContent()},i.prototype.onCategoryIconClick=function(e,i){t.PropertyPanel.prototype.onCategoryIconClick.call(this,e,i),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=i}(),function(){"use strict";var e=function(e){var t=e.container;Autodesk.Viewing.UI.LayersPanel.call(this,e,t,t.id+"ViewerLayersPanel"),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)};(e.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype)).constructor=e,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(e.prototype),e.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize.call(this)},e.prototype.onRestoreState=function(){this.update()},e.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,i)}},e.prototype.onRightClick=function(e,t){var i=!(t.shiftKey||t.metaKey||t.ctrlKey);this.setLayerVisible(e,i)},e.prototype.onImageClick=function(e,t){this.isMac&&t.ctrlKey||this.setLayerVisible(e)},e.prototype.onTitleClick=function(e){this.viewer.setLayerVisible(null,!0)},e.prototype.onTitleDoubleClick=function(e){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=e}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.UI;i.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};var o=function(o,r){this.viewer=o,this.is3dMode=!r.is2d(),n.SettingsPanel.call(this,o.container,"ViewerSettingsPanel"+o.id,"Settings",{width:400,heightAdjustment:155}),this.addTab(i.ViewerSettingTab.Navigation,"Navigation and selection",{className:"navigation"}),this.addTab(i.ViewerSettingTab.Performance,"Performance and appearance",{className:"performance"}),this.restoreDiv=document.createElement("div"),this.restoreDiv.className="viewer-restore-defaults",this.restoreDiv.setAttribute("data-i18n","Restore default settings"),this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),this.addEventListener(this.restoreDiv,"touchstart",e.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){var e=r.is2d()?"2d":"3d";o.prefs.reset(e),o.impl.setLightPresetFromFile(o.model)},!1),this.container.appendChild(this.restoreDiv),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.modelPreferenceCount&&t.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI.")};(o.prototype=Object.create(n.SettingsPanel.prototype)).constructor=o,i.ViewerPanelMixin.call(o.prototype),o.prototype.uninitialize=function(){this.viewer=null,n.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},o.prototype.addCheckbox=function(e,t,i,o,r){function s(e){r&&a.prefs.set(r,e),o(e)}var a=this.viewer,l=a.prefs[r];i="boolean"==typeof l?l:i;var c=n.SettingsPanel.prototype.addCheckbox.call(this,e,t,i,s),u=this.getControl(c);return u.saveKey=r,r?a.prefs.addListeners(r,function(e){u.setValue(e)},function(e){u.setValue(e),o(e)}):u.sliderRow.classList.add("logicalgroup"),a.prefs.hasTag(r,"no-storage")&&(u.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},o.prototype.addDropdown=function(e,i,n,o,r,s,a){var l=new t.OptionDropDown(e,i,n,o,r);return this.addEventListener(l,"change",s),a&&this.viewer.prefs.addListeners(a,function(e){l.dropdownElement.selectedIndex=e},function(e){l.dropdownElement.selectedIndex=e,s(e)}),l},o.prototype.removeCheckbox=function(e){return this.viewer.prefs.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),n.SettingsPanel.prototype.removeCheckbox.call(this,e)},o.prototype.createNavigationPanel=function(){var e=this.viewer,t=i.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(t,"Show ViewCube",!0,function(t){e.displayViewCube(t)},"viewCube"),this.addCheckbox(t,"ViewCube acts on pivot",!1,function(t){e.setUsePivotAlways(t)},"alwaysUsePivot"),this.addCheckbox(t,"Zoom towards pivot",!1,function(t){e.setZoomTowardsPivot(t)},"zoomTowardsPivot"),this.addCheckbox(t,"Set pivot with left mouse button",!1,function(t){e.setClickToSetCOI(t)},"clickToSetCOI"),this.addCheckbox(t,"Fusion style orbit",!1,function(t){t?e.loadExtension("Autodesk.Viewing.FusionOrbit",null):e.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(t,"First person walk",!1,function(t){t?(e.unloadExtension("Autodesk.Beeline",null),e.loadExtension("Autodesk.FirstPerson",null)):(e.unloadExtension("Autodesk.FirstPerson",null),e.loadExtension("Autodesk.Beeline",null))},"useFirstPersonNavigation")),this.addCheckbox(t,"Reverse mouse zoom direction",!1,function(t){e.setReverseZoomDirection(t)},"reverseMouseZoomDir"),this.is3dMode&&this.addCheckbox(t,"Orbit past world poles",!0,function(t){e.setOrbitPastWorldPoles(t)},"orbitPastWorldPoles"),this.addCheckbox(t,"Open properties on select",!0,function(t){e.setPropertiesOnSelect(t)},"openPropertiesOnSelect"),this.addCheckbox(t,"Left handed mouse setup",!1,function(t){e.setUseLeftHandedInput(t)},"leftHandedMouseSetup")},o.prototype.refreshParentCheckbox=function(e,t){for(var i=this,n=0;n<e.length;n++)if(!1===i.getControl(e[n]).getValue())return void i.getControl(t).setValue(!1);i.getControl(t).setValue(!0)},o.prototype.createPerformancePanel=function(){function n(e,t){for(var i=0;i<e.length;i++)o.getControl(e[i]).setChecked(t)}var o=this,r=this.viewer,s=i.ViewerSettingTab.Performance,a=this.scrollContainer.childNodes[1],l={perfoptimizationGroup:[],visualoptimizationGroup:[]};if(this.is3dMode){this.perfOptimizationBoxId=this.addCheckbox(s,"Performance Optimization",!1,function(e){n(l.perfoptimizationGroup,e)}),this.optimizeNavigationhkBoxId=this.addCheckbox(s,"Smooth navigation",e.isMobileDevice(),function(e){r.setOptimizeNavigation(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"optimizeNavigation"),l.perfoptimizationGroup.push(this.optimizeNavigationhkBoxId),this.progressiveRenderChkBoxId=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"progressiveRendering"),l.perfoptimizationGroup.push(this.progressiveRenderChkBoxId),this.visualOptimizationBoxId=this.addCheckbox(s,"Visual Quality Optimization",!1,function(e){n(l.visualoptimizationGroup,e)}),this.antialiasingChkBoxId=this.addCheckbox(s,"Anti-aliasing",!0,function(e){r.setQualityLevel(r.prefs.ambientShadows,e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"antialiasing"),l.visualoptimizationGroup.push(this.antialiasingChkBoxId),this.ambientshadowsChkBoxId=this.addCheckbox(s,"Ambient shadows",!0,function(e){r.setQualityLevel(e,r.prefs.antialiasing),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"ambientShadows"),l.visualoptimizationGroup.push(this.ambientshadowsChkBoxId),this.groundShadowChkBoxId=this.addCheckbox(s,"Ground shadow",!0,function(e){r.setGroundShadow(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundShadow"),l.visualoptimizationGroup.push(this.groundShadowChkBoxId),this.groundReflectionChkBoxId=this.addCheckbox(s,"Ground reflection",!1,function(e){r.setGroundReflection(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundReflection"),l.visualoptimizationGroup.push(this.groundReflectionChkBoxId),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.ghosthiddenChkBoxId=this.addCheckbox(s,"Ghost hidden objects",!0,function(e){r.setGhosting(e)},"ghosting"),this.displayLinesId=this.addCheckbox(s,"Display Lines",!0,function(e){r.hideLines(!e)},"lineRendering"),this.displayPointsId=this.addCheckbox(s,"Display Points",!0,function(e){r.hidePoints(!e)},"pointRendering"),this.environmentLabel=new t.OptionLabel("Environment",a.tBodies[0]),this.environmentLabel.sliderRow.classList.add("logicalgroup"),this.envMapBackgroundChkBoxId=this.addCheckbox(s,"Environment Image Visible",!0,function(e){r.setEnvMapBackground(e)},"envMapBackground");for(var c=[],u=0;u<t.LightPresets.length;u++)c.push(t.LightPresets[u].name);var h=this.envSelect=this.addDropdown("Environment and Lighting Selection",a.tBodies[0],c,r.impl.currentLightPreset(),!0,function(e){var t=h.dropdownElement.selectedIndex;r.setLightPreset(t)},"lightPreset")}this.is3dMode||(this.perfOptimizationLabel=new t.OptionLabel("Performance Optimization",a.tBodies[0]),this.perfOptimizationLabel.sliderRow.classList.add("logicalgroup"),this.progressiveRenderChkBoxId2d=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e)},"progressiveRendering"),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(s,"Switch sheet color white to black",!0,function(e){r.setSwapBlackAndWhite(e)},"swapBlackAndWhite"))},o.prototype.syncUI=function(){var e=this.viewer,t=this.getControl(this.perfOptimizationBoxId),i=this.getControl(this.visualOptimizationBoxId),n=this.getControl(this.optimizeNavigationhkBoxId),o=this.getControl(this.antialiasingChkBoxId);o&&o.setValue(e.prefs.antialiasing);var r=this.getControl(this.ambientshadowsChkBoxId);r&&r.setValue(e.prefs.ambientShadows);var s=this.getControl(this.groundShadowChkBoxId);s&&s.setValue(e.prefs.groundShadow);var a=this.getControl(this.groundReflectionChkBoxId);a&&a.setValue(e.prefs.groundReflection);var l=this.getControl(this.envMapBackgroundChkBoxId);l&&l.setValue(e.impl.isEnvMapBackground());var c=this.getControl(this.progressiveRenderChkBoxId);c&&c.setValue(e.prefs.progressiveRendering);var u=this.getControl(this.swapBlackAndWhiteChkBoxId);u&&u.setValue(e.prefs.swapBlackAndWhite);var h=this.getControl(this.ghosthiddenChkBoxId);if(h&&h.setValue(e.prefs.ghosting),this.is3dMode){var d=c.getValue(),p=n.getValue(),g=o.getValue(),m=r.getValue(),v=s.getValue(),f=a.getValue();d&&p?t.setValue(!0):t.setValue(!1),g&&m&&v&&f?i.setValue(!0):i.setValue(!1)}},i.ViewerSettingsPanel=o}(),function(){"use strict";function e(e){t.ObjectContextMenu.call(this,e)}var t=Autodesk.Viewing.UI,i=Autodesk.Viewing.Private;e.prototype=Object.create(t.ObjectContextMenu.prototype),e.prototype.constructor=e,e.prototype.buildMenu=function(e,t){var n=this,o=[],r=this.viewer.navigation,s=this.viewer.model.is2d(),a=this.viewer.container.getBoundingClientRect(),l=e.clientX-a.left,c=e.clientY-a.top,u=n.viewer.impl.hitTest(l,c,!1);u&&u.dbId&&(-1==u.model.selector.getSelection().indexOf(u.dbId)&&this.viewer.impl.selector.setSelection([u.dbId],u.model),t.hasSelected=!0,t.hasVisible=!0),t.hasSelected&&(o.push({title:"Isolate",target:function(){var e=n.viewer.getAggregateSelection(),t=n.viewer.impl.modelQueue().getModels().concat();for(e.forEach(function(e){e.model.visibilityManager.isolate(e.selection);var i=t.indexOf(e.model);i>=0&&t.splice(i,1)});t.length;)t.pop().visibilityManager.setAllVisibility(!1);n.viewer.clearSelection(),i.logger.track({name:"isolate_count",aggregate:"count"})}}),t.hasVisible&&o.push({title:"Hide Selected",target:function(){var e=n.viewer.impl.visibilityManager;n.viewer.getAggregateSelection(function(t,i){e.hide(i,t)}),n.viewer.clearSelection()}}),t.hasHidden&&o.push({title:"Show Selected",target:function(){var e=n.viewer.getSelection();n.viewer.clearSelection(),n.viewer.show(e)}})),s&&o.push({title:"Show All Layers",target:function(){n.viewer.setLayerVisible(null,!0)}}),o.push({title:"Show All Objects",target:function(){n.viewer.showAll(),i.logger.track({name:"showall",aggregate:"count"})}});var h=n.viewer.getAggregateSelection();return!s&&1===h.length&&r.isActionEnabled("gotoview")&&o.push({title:"Focus",target:function(){if((h=n.viewer.getAggregateSelection()).length>0){var e=h[0];n.viewer.fitToView(e.selection,e.model)}else 0===h.length&&n.viewer.fitToView();i.logger.track({name:"fittoview",aggregate:"count"})}}),t.hasSelected&&o.push({title:"Clear Selection",target:function(){n.viewer.clearSelection(),i.logger.track({name:"clearselection",aggregate:"count"})}}),o},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=e}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){function e(){i.impl.setLightPreset(0,!0),i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}var i=this.viewer,n=new t.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);return i.setModelStructurePanel(n),i.hideLines(!1),i.setGhosting(!1),i.setQualityLevel(!1,!0),i.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),!0},e.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},t.CAM360Extension=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",t.CAM360Extension)}(),function(){"use strict";function e(e,t,n){i.ViewerModelStructurePanel.call(this,e,t,n),this.viewer=e}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),i=Autodesk.Viewing.Extensions;e.prototype=Object.create(i.ViewerModelStructurePanel.prototype),e.prototype.constructor=e,e.prototype.sortCamNodes=function(e,t){function i(e,t){function i(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function n(n){var r=i(n.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA");r?("CAM_Setup"==r?o.camSetupNodes.push(e):"CAM_Operation"==r?o.camOperationNodes.push(e):"CAM_Tool"===r?o.camToolNodes.push(e):"CAM_Stock"===r?o.camStockNodes.push(e):"CAM_Folder"==r&&o.camFolderNodes.push(e),o.camNodes.push(e)):o.camModelNodes.push(e),t()}function r(e,i,n){t()}o.viewer.getProperties(e,n,r)}function n(){r.length>0?i(r.shift(),n):t()}this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[];var o=this,r=[];e.enumNodeChildren(e.getRootId(),function(e){r.push(e)},!0),r.shift(),n()},e.prototype.setModel=function(e,t){var n=this;n.sortCamNodes(e,function(){i.ViewerModelStructurePanel.prototype.setModel.call(n,e,t),n.SetCAMNodeVisible(!1),n.setVisible(!0),n.ExpandSetupNodes(),n.resizeToContent()})},e.prototype.initialize=function(){function e(i){t.SetCAMNodeVisible(!1),t.removeEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}i.ViewerModelStructurePanel.prototype.initialize.call(this);var t=this;this.viewer.model&&this.viewer.model.isLoadDone()||t.addEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),t.addEventListener(t.viewer,Autodesk.Viewing.SHOW_EVENT,function(e){var i=e.nodeIdArray;if(i)for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(e){var i=e.nodeArray;if(i)for(var n=0;n<i.length;n++)t.HideHightlightCAMNode(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(e){var i=e.nodeIdArray;if(i)if(0==i.length)t.SetModelVisible(),t.SetCAMNodeVisible(!0);else for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])})},e.prototype.IsCAMNode=function(e){return-1!==this.camNodes.indexOf(e)},e.prototype.IsCAMSetupNode=function(e){return-1!==this.camSetupNodes.indexOf(e)},e.prototype.IsCAMStockNode=function(e){return-1!==this.camStockNodes.indexOf(e)},e.prototype.IsCAMToolNode=function(e){return-1!==this.camToolNodes.indexOf(e)},e.prototype.IsCAMOperationNode=function(e){return-1!==this.camOperationNodes.indexOf(e)},e.prototype.IsCAMFolderNode=function(e){return-1!==this.camFolderNodes.indexOf(e)},e.prototype.shouldInclude=function(e){return!this.IsCAMStockNode(e)},e.prototype.isGroupNode=function(e){return!this.IsCAMOperationNode(e)&&i.ViewerModelStructurePanel.prototype.isGroupNode.call(this,e)},e.prototype.setNodeVisibility=function(e,t){t?this.viewer.show(e):this.viewer.hide(e)},e.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var e=0;e<this.camModelNodes.length;e++)this.setNodeVisibility(this.camModelNodes[e],!0)},e.prototype.SetCAMNodeVisible=function(e){if(this.camNodes){for(var t=0;t<this.camNodes.length;t++)this.setNodeVisibility(this.camNodes[t],e);this.SetToolNodeVisible(!1)}},e.prototype.SetToolNodeVisible=function(e){if(this.camToolNodes)for(var t=0;t<this.camToolNodes.length;t++)this.setNodeVisibility(this.camToolNodes[t],e)},e.prototype.HideHightlightNode=function(e){var t=this.viewer.impl,i=this;i.instanceTree.enumNodeFragments(e,function(e){t.highlightFragment(i.model,e,!1,!0)},!0)},e.prototype.HideHightlightCAMNode=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this;o.instanceTree.enumNodeChildren(e,function(e){t?o.IsCAMStockNode(e)||o.HideHightlightNode(e):i?o.IsCAMToolNode(e)&&o.HideHightlightNode(e):n&&o.HideHightlightNode(e)},!1)},e.prototype.setCamNodeVisibility=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this;t?this.instanceTree.enumNodeChildren(e,function(e){var t=o.IsCAMStockNode(e);o.setNodeVisibility(e,t)}):i?this.instanceTree.enumNodeChildren(e,function(e){o.IsCAMToolNode(e)&&o.setNodeVisibility(e,!1)}):n&&this.instanceTree.enumNodeChildren(e,function(e){o.setNodeVisibility(e,!1)})},e.prototype.onClick=function(e,t){i.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.SetModelVisible(),this.setCamNodeVisibility(e),this.viewer.fitToView()},e.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var e=0;e<this.camSetupNodes.length;e++)this.tree.setCollapsed(this.camSetupNodes[e],!1)},t.CAMModelStructurePanel=e}(),function(){"use strict";function e(e){var t="";e<0&&(t="-",e=-e);var i=~~(e/3600),n=~~(e%3600/60),o=e%60,r=t;return i>0&&(r+=i+":"+(n<10?"0":"")),r+=n+":"+(o<10?"0":""),r+=o.toFixed(2)}var t=Autodesk.Viewing,i=t.UI;t.ANIMATION_PLAY_EVENT="animationPlayEvent",t.ANIMATION_PAUSE_EVENT="animationPauseEvent",t.ANIMATION_SEEK_EVENT="animationSeekEvent",t.ANIMATION_PREVIOUS_FRAME_EVENT="animationPreviousFrameEvent",t.ANIMATION_NEXT_FRAME_EVENT="animationNextFrameEvent",t.ANIMATION_TRACK_UPDATE_EVENT="animationTrackUpdateEvent",t.ANIMATION_TOOLBAR_CLOSE_EVENT="animationToolbarCloseEvent";var n=function(e,i){t.Extension.call(this,e,i),this.viewer=e,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.playButtonIsPaused=!0,this.prevAnimationTime=-1};(n.prototype=Object.create(t.Extension.prototype)).constructor=n,n.prototype.load=function(){var e=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),e.model&&e.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),e.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},n.prototype.unload=function(){var e=this.viewer;if(this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),e.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var i=e.getToolbar(!1);i&&i.getControl(t.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return e.removeEventListener(t.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.removeEventListener(t.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.removeEventListener(t.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.removeEventListener(t.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(e.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},n.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var e=this.viewer,t=e.impl.keyFrameAnimator;t&&(this.prevAnimationTime>0&&(t.goto(this.prevAnimationTime),this.prevAnimationTime=-1),t.play(0,this.onPlayCallbackBinded),this.updatePlayButton(t.isPaused),e.toolbar&&e.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},n.prototype.pause=function(){if(!this.isPaused()){var e=this.viewer.impl.keyFrameAnimator;e&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.isPlaying=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&(e.isPlaying&&!e.isPaused)},n.prototype.isPaused=function(){var e=this.viewer.impl.keyFrameAnimator;return!!e&&e.isPaused},n.prototype.rewind=function(){this.setTimelineValue(0)},n.prototype.setTimelineValue=function(e){var t=this.viewer.impl.keyFrameAnimator;if(t){var i=(e=Math.min(Math.max(0,e),1))*t.duration;t.goto(i),this.updateUI()}},n.prototype.prevKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.prev(),this.updateUI())},n.prototype.nextKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(e.next(),this.updateUI())},n.prototype.getDuration=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.duration:0},n.prototype.getDurationLabel=function(){return e(this.getDuration())},n.prototype.getCurrentTime=function(){var e=this.viewer.impl.keyFrameAnimator;return e?e.currentTime:0},n.prototype.getCurrentTimeLabel=function(){return e(this.getCurrentTime())},n.prototype.onAnimationReady=function(){var e=this.viewer;this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),e.impl.keyFrameAnimator&&(e.toolbar&&e.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),e.addEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},n.prototype.updateUI=function(){var t=this.viewer.impl.keyFrameAnimator;this.animTools&&t&&(this.animTools.input.value=t.duration>0?t.currentTime/t.duration*100:0,this.animTools.lapse.value=e(t.currentTime),this.animTools.lapseLeft.value=e(t.currentTime-t.duration),this.updatePlayButton(t.isPaused),this.updateToolbarBackground())},n.prototype.onPlayCallback=function(i){if(this.animTools){var n=this.viewer.impl.keyFrameAnimator;this.viewer.fireEvent({type:t.ANIMATION_TRACK_UPDATE_EVENT,data:{time:n.currentTime,duration:n.duration}}),this.animTools.input.value=i,this.animTools.lapse.value=e(n.currentTime),this.animTools.lapseLeft.value=e(n.currentTime-n.duration),i>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},n.prototype.updatePlayButton=function(e){if(this.playButton&&e!==this.playButtonIsPaused){this.playButtonIsPaused=e;var i=this.viewer.impl.keyFrameAnimator;e?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.viewer.fireEvent({type:t.ANIMATION_PAUSE_EVENT,data:{time:i.currentTime,duration:i.duration}})):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause"),this.viewer.fireEvent({type:t.ANIMATION_PLAY_EVENT,data:{time:i.currentTime,duration:i.duration}}))}},n.prototype.resetExplode=function(e,t){var i=this.viewer;i.model.is2d()||0===i.getExplodeScale()||(t&&i.explodeSlider&&(i.explodeSlider.value=e),i.explode(e))},n.prototype.adjustToolbarPosition=function(){var e=this.viewer;if(e.toolbar){var t=e.toolbar.getDimensions().width;t>e.container.getBoundingClientRect().width&&(t=e.modelTools.getDimensions().width);var i=t-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12;this.animTools.input.style.width=i+"px",this.toolbar.container.style.left="calc(50% - "+t/2+"px)"}},n.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},n.prototype.updateToolbarBackground=function(){if(this.animTools){var e=this.animTools.input,t=e.value,i="#393939";e.style.background="-webkit-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-moz-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-ms-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-o-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="linear-gradient(to right,#ffffff "+t+"%, "+i+" "+t+"%)"}},n.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var e=this.viewer.impl.keyFrameAnimator;if(!e)return;e.isPlaying&&!e.isPaused&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(t.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},n.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},n.prototype.onExplode=function(){var e=this.viewer.impl.keyFrameAnimator;e&&(0!==e.currentTime&&(this.prevAnimationTime=e.currentTime,e.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},n.prototype.onToolbarCreated=function(){var n=this.viewer,o=this;this.onToolbarCreatedBinded&&(n.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new i.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),n.container.appendChild(this.toolbar.container),this.animTools=new i.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new i.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){o.isPaused()?o.play():o.pause()},n.modelTools.addControl(this.playButton),n.modelTools.resetModelButton&&(n.modelTools.resetModelButton.onClick=function(t){n.showAll();var i=n.impl.keyFrameAnimator;i&&(i.goto(0),s.value=0,r.value=e(0),l.value=e(-i.duration),o.updatePlayButton(!0)),o.resetExplode(0,!0),o.updateToolbarBackground()}),this.animTools.backwardButton=new i.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(e){var i=n.impl.keyFrameAnimator;void 0!==i&&i&&(i.prev(),n.fireEvent({type:t.ANIMATION_PREVIOUS_FRAME_EVENT,data:{time:i.currentTime,duration:i.duration}}),o.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new i.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(e){var i=n.impl.keyFrameAnimator;void 0!==i&&i&&(i.next(),n.fireEvent({type:t.ANIMATION_NEXT_FRAME_EVENT,data:{time:i.currentTime,duration:i.duration}}),o.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new i.Control("toolbar-animationTimeLapse");var r=this.animTools.lapse=document.createElement("input");r.type="text",r.value="0",r.className="animationTimeLapse",r.disabled=!0,this.animTools.timeText.container.appendChild(r),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new i.Control("toolbar-animationTimeline");var s=this.animTools.input=document.createElement("input");s.type="range",s.value="0",s.className="animationTimeline",t.isIE11&&(s.style["padding-top"]="0",s.style["padding-bottom"]="0",s.style["margin-top"]="10px"),this.animTools.timeline.container.appendChild(s),s.addEventListener("input",function(i){var a=n.impl.keyFrameAnimator;if(void 0!==a&&a){var c=s.value*a.duration/100;r.value=e(c),l.value=e(c-a.duration),a.goto(c),n.fireEvent({type:t.ANIMATION_SEEK_EVENT,data:{time:c,duration:a.duration}}),o.updatePlayButton(a.isPaused),o.updateToolbarBackground()}});var a=document.createElement("div");a.className="adsk-control-tooltip",a.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(a),s.addEventListener("mouseover",function(e){e.target===s&&(a.style.visibility="visible")}),s.addEventListener("mouseout",function(e){e.target===s&&(a.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new i.Control("toolbar-animationRemainingTime");var l=this.animTools.lapseLeft=document.createElement("input");l.type="text",l.value="0",l.className="animationTimeLapse",l.disabled=!0,this.animTools.timeLeftText.container.appendChild(l),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new i.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){o.hideAnimateToolbar(),n.fireEvent({type:t.ANIMATION_TOOLBAR_CLOSE_EVENT})},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=n,t.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",n)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Private,i=e.Extensions.Collaboration;i.InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},i.ViewTransceiver=function(i){function n(e){m=!0;var t=JSON.parse(e.data.msg);w.restoreState(t),g.impl.invalidate(!0,!1,!0),m=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg;!0===t[1]||f||(t[0]!=d&&(d=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),v=!1,g.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),g.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(v||f){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z];r(n),n.unshift(f),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),d!=n[0]&&(d=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:d}}))}}function l(e,t,i){e&&!y&&(y=document.createElement("div")).classList.add("collabPointer"),e&&!T?(g.container.appendChild(y),T=!0):!e&&T&&(g.container.removeChild(y),T=!1),e&&(y.style.left=t-6+"px",y.style.top=i-6+"px")}function c(e){if(!v&&!f){var t=e.data.msg;A.origin.set(t[1],t[2],t[3]),A.direction.set(t[4],t[5],t[6]);var i=A.at(g.getCamera().near);i.project(g.getCamera()),l(!0,(i=g.impl.viewportToClient(i.x,i.y)).x,i.y)}}function u(e){if(v){var t=g.impl.clientToViewport(e.canvasX,e.canvasY);g.impl.viewportToRay(t,A);var n=[A.origin.x,A.origin.y,A.origin.z,A.direction.x,A.direction.y,A.direction.z];r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function h(e){if(!m){var t=w.getState(b);i.sendMessage("state",JSON.stringify(t),p.channelId)}}var d,p=this,g=this.viewer=null,m=!1,v=!1,f=!1,E=this.client=i,A=new THREE.Ray,y=null,T=!1;this.channelId=null;var w,b={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){v=!0,l(!1)},this.updatePointer=function(e){u(e)},this.connectCamera=function(e){f=!e},this.attach=function(i){g&&this.detach(),this.viewer=g=i,w=new t.ViewerState(g),E.addEventListener("cameraChange",s),E.addEventListener("pointerMove",c),E.addEventListener("viewerState",n),g.hasEventListener(e.CAMERA_CHANGE_EVENT,a)||g.addEventListener(e.CAMERA_CHANGE_EVENT,a),g.hasEventListener(e.SELECTION_CHANGED_EVENT,h)||(g.addEventListener(e.SELECTION_CHANGED_EVENT,h),g.addEventListener(e.ISOLATE_EVENT,h),g.addEventListener(e.HIDE_EVENT,h),g.addEventListener(e.SHOW_EVENT,h),g.addEventListener(e.EXPLODE_CHANGE_EVENT,h),g.addEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,h),g.addEventListener(e.CUTPLANES_CHANGE_EVENT,h))},this.detach=function(){E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),g&&(g.removeEventListener(e.CAMERA_CHANGE_EVENT,a),g.removeEventListener(e.SELECTION_CHANGED_EVENT,h),g.removeEventListener(e.ISOLATE_EVENT,h),g.removeEventListener(e.HIDE_EVENT,h),g.removeEventListener(e.SHOW_EVENT,h),g.removeEventListener(e.EXPLODE_CHANGE_EVENT,h),g.removeEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,h),g.removeEventListener(e.CUTPLANES_CHANGE_EVENT,h),this.viewer=g=null,w=null)}},i.ViewTransceiver.prototype.constructor=i.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(i.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Extensions,i=e.Private,n=e.UI,o=t.Collaboration;t.Collaboration.Collaboration=function(t,i){e.Extension.call(this,t,i),i&&i.rtc&&i.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},t.Collaboration.Collaboration.prototype=Object.create(e.Extension.prototype),t.Collaboration.Collaboration.prototype.constructor=t.Collaboration.Collaboration,t.Collaboration.Collaboration.prototype.initNetwork=function(e){this.p2p&&!e||(this.viewtx=new o.ViewTransceiver(this.client),this.interceptor=new o.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new i.P2PClient(this.client))},t.Collaboration.Collaboration.prototype.createUI=function(){var e=this,r=this.viewer;if(this.initNetwork(!1),this.panel=new o.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),t.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new n.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(t){var i=e.panel.isVisible();if(!document.getElementById("collabBox"))if(i||e.inviteDivInstantiated)e.panel.setVisible(!1,!0),e.panel.reset();else{var n=new o.CollabPromptBox,s=r.container;n.start(s,function(){e.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(t){if(t){if(r.model){var o=r.model.getData();e.viewtx.channelId=o.basePath,e.viewtx.attach(r),e.client.connect(e.viewtx.channelId),e.client.join(e.viewtx.channelId)}r.toolController.activateTool(e.interceptor.getName());e.collabButton.setState(n.Button.State.ACTIVE),i.logger.track({category:"viewer_rtc_start"})}else i.logger&&e.client.isConnected()&&i.logger.track({category:"viewer_rtc_stop"}),e.p2p.hangup(),e.viewtx.detach(r),e.viewtx.channelId=null,e.client.disconnect(),e.panel.reset(),r.toolController.deactivateTool(e.interceptor.getName()),e.collabButton.setState(n.Button.State.INACTIVE)}),r.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var s=new CollabPromptBox,a=r.container;s.start(a,function(){e.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},t.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},t.Collaboration.Collaboration.prototype.load=function(){function e(){function e(i){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),n.createUI()}n.client=i.MessageClient.GetInstance(n.options?n.options.messageServerURL:void 0),n.socketErrorHandler=function(e){i.ErrorHandler.reportError(t.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,e.data),n.close()},n.client.addEventListener("socketError",n.socketErrorHandler),n.presenceChannelId=window.location.host,n.client.isConnected(),t.modelTools?n.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e)}var t=this.viewer,n=this;return i.loadDependency("lmv_io","socket.io-1.3.5.js",e),!0},t.Collaboration.Collaboration.prototype.unload=function(){var e=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(e),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),e.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,e.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},e.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",t.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){function e(e,i,n,o){this.viewer=e,this.client=i,this.p2p=n,this.viewtx=o;t.UI.DockingPanel.call(this,e.container,"CollabPanel","Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","dockingPanelScroll"),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style.float="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(t){var i=new CollabPromptBox,n=e.container;i.start(n,function(){var e=Autodesk.Viewing.i18n.translate("Please Join My Live Review");document.location.href="mailto:?subject="+e},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("dockingPanelScroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0;var r=this;this.addEventListener(i,"userListChange",function(e){if(!e.channelId||e.channelId===r.viewtx.channelId){var t=r.client.getChannelInfo(r.viewtx.channelId);t&&r.updateUsers(t.users)}}),this.addEventListener(this.viewtx,"controlChange",function(e){e.channelId===r.viewtx.channelId&&r.updateUserInControl(e.data.lastInControl)}),this.addEventListener(i,"chatReceived",function(e){e.channelId===r.viewtx.channelId&&r.updateChatHistory(e)}),this.textInput.onkeyup=function(e){r.handleChatInput(e)},this.addEventListener(this.p2p,"remoteStreamAdded",function(e){r.videoPanel||r.createVideoPanel(),r.remoteVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"localStreamAdded",function(e){r.videoPanel||r.createVideoPanel(),r.localVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"remoteHangup",function(e){r.removeVideoPanel()})}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=(t.UI,i.Collaboration);Autodesk.Viewing.startLiveReviewSession=function(){o.Panel&&o.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){o.Panel&&o.Panel.endSession()};e.prototype=Object.create(t.UI.DockingPanel.prototype),e.prototype.constructor=e,e.prototype.startSession=function(){var e=this;if(!this.isVisible()){var t=new CollabPromptBox,i=this.viewer.container;t.start(i,function(){e.setVisible(!0,!0)},"Start a Live Review","Start Review")}},e.prototype.endSession=function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())},e.prototype.updateUsers=function(e){for(var t=document.createElement("tbody"),i=0;i<e.length;i++){var n=t.insertRow(-1);n.id=e[i].id;var o=n.insertCell(0);o.style.width="14px",o.style.cursor="default";var r=document.createElement("div");r.classList.add("statusBase"),r.classList.add("statusNormal"),r.innerHTML="&#9679",o.appendChild(r),n.insertCell(1).textContent=e[i].name}this.table.replaceChild(t,this.tbody),this.tbody=t,this.fixComponentPlacement()},e.prototype.updateUserInControl=function(e){for(var t=0;t<this.tbody.rows.length;t++){var i=this.tbody.rows[t],n=i.cells[0].childNodes[0];i.id==e?(n.classList.remove("statusNormal"),n.classList.add("statusInControl"),n.innerHTML="&#9784",i.cells[1].style.color="#4CBA36"):(n.classList.remove("statusInControl"),n.classList.add("statusNormal"),n.innerHTML="&#9679",i.cells[1].style.color="#ffffff")}},e.prototype.updateChatHistory=function(e){var t=this.client.getUserById(e.data.from,e.channelId);if("/"!=e.data.msg.charAt(0)){if(this.chatHistory.lastUser!=t.name){var i=document.createElement("p"),n=document.createElement("div");n.classList.add("heading"),n.style.float="left",n.style.fontStyle="normal",n.style.color="#857E7E",n.textContent=t.name,i.appendChild(n);var o=document.createElement("div");o.classList.add("heading"),o.style.textAlign="right",o.style.fontStyle="normal",o.style.color="#857E7E",o.textContent=(new Date).toLocaleTimeString(),i.appendChild(o),this.chatHistory.appendChild(i),this.chatHistory.lastUser=t.name}else{var r=document.createElement("br");this.chatHistory.appendChild(r)}var s=document.createElement("span");s.classList.add("messageText"),s.textContent=e.data.msg,this.chatHistory.appendChild(s),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},e.prototype.handleChatInput=function(e){13==e.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},e.prototype.fixComponentPlacement=function(e){var t=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel?(t+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+t+"px)"):this.chatHistory.style.height="calc(100% - "+t+"px)"},e.prototype.createVideoPanel=function(e){this.videoPanel=document.createElement("div"),this.videoPanel.classList.add("videoPanel"),this.localVideo=document.createElement("video"),this.localVideo.autoplay=!0,this.localVideo.muted=!0,this.localVideo.classList.add("videoInset"),this.videoPanel.appendChild(this.localVideo),this.remoteVideo=document.createElement("video"),this.remoteVideo.autoplay=!0,this.remoteVideo.classList.add("videoMain"),this.videoPanel.appendChild(this.remoteVideo);var t=this,i=document.createElement("div");i.classList.add("dockingPanelClose"),i.innerHTML="&times",i.title=Autodesk.Viewing.i18n.translate("End video call"),i.onclick=function(e){t.p2p.hangup(),t.removeVideoPanel()},this.videoPanel.appendChild(i),this.content.insertBefore(this.videoPanel,this.chatHistory),this.fixComponentPlacement()},e.prototype.removeCollabPrompt=function(){var e=document.getElementById("collabBox");e&&(e.style.visibility="hidden",this.viewer.container.removeChild(e))},e.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},e.prototype.reset=function(e){if(this.tbody){var t=document.createElement("tbody");this.table.replaceChild(t,this.tbody),this.tbody=t}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(e,t,i,o,r){if(e&&!document.getElementById("collabBox")){var s=document.createElement("div");s.id="collabBox",s.className="collabBox",e.appendChild(s);var a=document.createElement("div");a.className="collabBoxTitle",a.textContent=Autodesk.Viewing.i18n.translate(i,{defaultValue:i}),s.appendChild(a);var l=document.createElement("span");l.className="collabBoxText";p="Enter your name";r&&(p="Review URL"),l.textContent=Autodesk.Viewing.i18n.translate(p,{defaultValue:p}),s.appendChild(l);var c=document.createElement("span");c.className="collabBoxInputContainer",s.appendChild(c);var u=document.createElement("input");if(u.type="text",u.className="collabBoxInputText",r){var h=window.location.toString();-1==h.indexOf("?")?h+="?invited=true":h+="&invited=true",Autodesk.Viewing.Private.docItemId&&(h+="&itemid="+Autodesk.Viewing.Private.docItemId),h+="&doNotRedirect=true",u.value=h}c.appendChild(u),u.onkeyup=function(i){13==i.keyCode&&(s.style.visibility="hidden",e.removeChild(s),n.setUserName(u.value),t())};var d=document.createElement("div");if(d.className="collabBoxClose",d.innerHTML="&times;",d.addEventListener("click",function(t){s.style.visibility="hidden",e.removeChild(s)}),s.appendChild(d),r){(l=document.createElement("span")).className="collabBoxText",l.style.marginTop="0px";var p="Copy and send this URL to invite others";l.textContent=Autodesk.Viewing.i18n.translate(p,{defaultValue:p}),s.appendChild(l)}else{var g=document.createElement("div");g.className="collabBoxOK",g.textContent=Autodesk.Viewing.i18n.translate(o,{defaultValue:o}),g.addEventListener("click",function(i){s.style.visibility="hidden",e.removeChild(s),""!==u.value.trim()&&n.setUserName(u.value),t()}),s.appendChild(g)}s.style.visibility="visible",u.focus(),r&&u.select()}},o.DockingCollabPanel=e,o.CollabPromptBox=CollabPromptBox}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension,Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){function e(){return r=n.getActiveNavigationTool(),n.setActiveNavigationTool(i.tool.getName()),!0}function t(){return n.setActiveNavigationTool(r||n.defaultNavigationToolName),!0}var i=this,n=this.viewer,o=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(n.impl,n),n.toolController.registerTool(this.tool),this.createUI();var r;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";var s=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:e,onRelease:t}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,s),this.onToolChanged=function(e){if(-1!==e.toolName.indexOf("beeline")&&i.beelineButton){var t=e.active?o.Button.State.ACTIVE:o.Button.State.INACTIVE;i.beelineButton.setState(t)}},n.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(){var e=this.viewer;if(e.getToolbar&&e.getSettingsPanel){var t=e.getToolbar(!0),i=Autodesk.Viewing.UI,n=t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),o=new i.Button("toolbar-beelineTool");o.setToolTip("Walk to"),o.setIcon("adsk-icon-walk"),o.onClick=function(t){var n=o.getState();n===i.Button.State.INACTIVE?e.setActiveNavigationTool("beeline"):n===i.Button.State.ACTIVE&&e.setActiveNavigationTool()},this.beelineButton=o;var r=n.getControl("toolbar-cameraSubmenuTool");r?n.addControl(this.beelineButton,{index:n.indexOf(r.getId())}):n.addControl(this.beelineButton);var s=this,a=function(){e.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);var t=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,i=e.getSettingsPanel(!0);s.viewerOption_LookHorId=i.addCheckbox(t,"Reverse horizontal look direction",!1,function(t){e.setReverseHorizontalLookDirection(t)},"reverseHorizontalLookDirection"),s.viewerOption_LookVertId=i.addCheckbox(t,"Reverse vertical look direction",!1,function(t){e.setReverseVerticalLookDirection(t)},"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?a():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a)}},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.beelineButton){var t=e.getToolbar(!1);t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId()),this.beelineButton=null}return e.getSettingsPanel&&(e.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId),e.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId)),e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(e,t){function i(){c.revertToStartState()}function n(e){var t={};t.target=e.target.clone(),t.worldup=e.worldup.clone(),t.position=e.position.clone(),t.up=e.up.clone();for(var i=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],n=0;n<i.length;n++)t[i[n]]=e[i[n]];return t}function o(e,t){if(!(e.target.equals(t.target)&&e.position.equals(t.position)&&e.worldup.equals(t.worldup)&&e.up.equals(t.up)))return!1;for(var i=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],n=0;n<i.length;n++)if(e[i[n]]!==t[i[n]])return!1;return!0}function r(i){var n=new THREE.Vector3(i.x,i.y,1),o=e.hitTestViewport(n.clone(),!1);if(!o||!o.intersectPoint)return[];var r=new THREE.Raycaster,s=n.clone(),a=e.camera,l=new THREE.Vector3(s.x,s.y,1);s.z=-1,s=s.unproject(a),(l=l.unproject(a)).sub(s).normalize(),r.set(p.isPerspective?a.position:s,l);for(var c=[],u=o.fragId instanceof Array?o.fragId:[o.fragId],h=0;h<u.length;h++){var d=e.getRenderProxy(t.model,u[h]);avp.VBIntersector.meshRayCast(d,r,c)}return c.sort(function(e,t){return e.distance-t.distance}),c}function s(){p.isPerspective||(p.toPerspective(),g.activatePivot(!1)),p.getFocalLength()>l&&p.setFocalLength(l,!0)}var a={GO_TO:0,PASS_THROUGH:1,DEFAULT:0},l=28,c=this,u=t,h=t.container,d=t.autocam,p=t.navigation,g=t.utilities,m=["beeline"],v=0,f=!1,E=0,A=null,y=null,T=new THREE.Vector3,w=new THREE.Vector3,b=new THREE.Vector3,C=new THREE.Vector3,S=!1,k=new THREE.Vector3,M=new THREE.Vector3,x=null,R=null;this.getNames=function(){return m},this.getName=function(){return m[0]},this.activate=function(e){E=0,t.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,i),d.userLookSpeed=.8,this.showHUDMessage(!0)},this.deactivate=function(){t.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,i),this.revertToStartState(),this.showHUDMessage(!1)},this.getCursor=function(){return f?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":E<=1?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":null},this.update=function(){var e=p.getCamera();f=!1;var i=!1;if(1===E){var o=k.clone().sub(M);if(0!==o.x||0!==o.y){f=!0,M.x+=.7*o.x,M.y+=.7*o.y;var r=p.getWorldUpVector().dot(p.getCameraUpVector()),s=t.prefs.reverseHorizontalLookDirection?-1:1,a=t.prefs.reverseVerticalLookDirection?-1:1;o.x*=r<0?-s:s,o.y*=a,d.sync(p.getCamera()),d.look(o),i=!0,x=n(e)}}return i},this.revertToStartState=function(){g.pivotActive(!1),v=0,S=!0},this.attemptFlight=function(e,t){if(p.isActionEnabled("walk")){var i=r(e);i.length>0&&(T=i[0].point,w=i[i.length-1].point,c.fly(1e3,t))}},this.fly=function(e,t){switch(g.setPivotPoint(t===a.GO_TO?T:w,!0,!0),s(),b=p.getPosition(),y=e,t){case a.GO_TO:C=b.clone().lerp(T,.8);break;case a.PASS_THROUGH:var i=2*d.camera.near/w.clone().sub(b).length();g.setPivotPoint(b.clone().lerp(w,1+10*i),!0,!0),C=b.clone().lerp(w,1+i);break;default:return}v=1,S=!1,A=null,requestAnimationFrame(c.step)},this.step=function(e){var t=p.getCamera();if(!S){if(null===A)x=n(t),A=e;else if(!o(t,x))return void c.revertToStartState();var i=e-A,r=i<y?i/y:1,s=b.clone().lerp(C,r),a=p.getEyeVector();a.multiplyScalar(p.getPivotPoint().sub(p.getPosition()).length()/a.length()),p.setView(s,a.add(s)),x=n(t),g.activatePivot(!1),i<y?requestAnimationFrame(c.step):c.revertToStartState()}},this.handleGesture=function(e){switch(Autodesk.Viewing.Private.HudMessage.dismiss(),e.type){case"dragstart":return R="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===R&&this.handleMouseMove(e);case"dragend":return"drag"===R&&(this.handleButtonUp(e,0),R=null,!0)}return!1},this.handleButtonDown=function(e,t){return Autodesk.Viewing.Private.HudMessage.dismiss(),E+=1<<t,0===t&&(M.x=k.x=e.canvasX,M.y=k.y=e.canvasY,!0)},this.handleButtonUp=function(e,t){return E-=1<<t,0===t},this.handleSingleClick=function(e,t){if(Autodesk.Viewing.Private.HudMessage.dismiss(),0!==t)return this.revertToStartState(),!1;var i={x:e.normalizedX,y:e.normalizedY};switch(v){case 0:c.attemptFlight(i,a.GO_TO);break;case 1:c.revertToStartState()}return!0},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!(!e.pointers||1!==e.pointers.length)&&(c.attemptFlight({x:e.normalizedX,y:e.normalizedY},a.PASS_THROUGH),!0)},this.handleDoubleClick=function(e,t){return 0===t&&(c.attemptFlight({x:e.normalizedX,y:e.normalizedY},a.PASS_THROUGH),!0)},this.handleMouseMove=function(e){return k.x=e.canvasX,k.y=e.canvasY,1===E&&(s(),!0)},this.handleBlur=function(e){return this.revertToStartState(),!1},this.showOrthoWarningMessage=function(){var e={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."},t=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(h,e,t)},this.showFocalWarningMessage=function(){var e={msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."},t=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(h,e,t)},this.watchCamera=function(e){if(u.toolController.getActiveToolName()===m[0]||u.toolController.getActiveToolName()===m[1]){var t=p.getCamera(),i=t&&!t.isPerspective,n=p.getFocalLength()>l;i?c.showOrthoWarningMessage():n?c.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}},this.showHUDMessage=function(e){var t=p.getCamera(),i=t&&!t.isPerspective,n=p.getFocalLength()>l;e&&i?c.showOrthoWarningMessage():e&&n?c.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss(),e?u.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.watchCamera):u.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.watchCamera)}},function(){"use strict";function e(e,t,i){return function(){var o=t.getState();o===n.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(n.Button.State.ACTIVE)):o===n.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(n.Button.State.INACTIVE))}}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),i=Autodesk.Viewing,n=i.UI,o=function(e,t){i.Extension.call(this,e,t)};(o.prototype=Object.create(i.Extension.prototype)).constructor=o,o.prototype.load=function(){var e=this.viewer,t=new i.FovTool(e),n=new i.WorldUpTool(e.impl,e);return e.toolController.registerTool(t),e.toolController.registerTool(n),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},o.prototype.createUI=function(){var t=this.viewer,o=t.getToolbar(!0).getControl(i.TOOLBAR.NAVTOOLSID),r=function(e){return t.navigation.isActionEnabled(e)?"block":"none"};if(t.model.is3d()){var s=new n.ComboButton("toolbar-orbitTools");s.setToolTip("Orbit"),s.setIcon("adsk-icon-orbit-constrained"),s.setDisplay(r("orbit")),this.createOrbitSubmenu(s),o.addControl(s),o.orbittoolsbutton=s,s.setState(n.Button.State.ACTIVE),o.returnToDefault=function(){s.setState(n.Button.State.ACTIVE)}}var a=new n.Button("toolbar-panTool");a.setToolTip("Pan"),a.setIcon("adsk-icon-pan"),a.onClick=e(t,a,"pan"),a.setDisplay(r("pan")),o.addControl(a),o.panbutton=a,t.model.is2d()&&(o.returnToDefault=function(){a.setState(n.Button.State.ACTIVE)},o.returnToDefault());var l=new n.Button("toolbar-zoomTool");l.setToolTip("Zoom"),l.setIcon("adsk-icon-zoom"),l.onClick=e(t,l,"dolly"),l.setDisplay(r("zoom")),o.addControl(l),o.dollybutton=l;var c=new n.ComboButton("toolbar-cameraSubmenuTool");c.setToolTip("Camera interactions"),c.setIcon("adsk-icon-camera"),c.saveAsDefault(),this.createCameraSubmenu(c),o.addControl(c),o.camerabutton=c},o.prototype.createOrbitSubmenu=function(t){var o=this.viewer,r=o.getToolbar(!0).getControl(i.TOOLBAR.NAVTOOLSID),s=new n.Button("toolbar-freeOrbitTool");s.setToolTip("Free orbit"),s.setIcon("adsk-icon-orbit-free"),s.onClick=e(o,s,"freeorbit"),t.addControl(s),r.freeorbitbutton=s;var a=new n.Button("toolbar-orbitTool");a.setToolTip("Orbit"),a.setIcon("adsk-icon-orbit-constrained"),a.onClick=e(o,a,"orbit"),t.addControl(a),r.orbitbutton=a,t.onClick=a.onClick},o.prototype.createCameraSubmenu=function(t){var o=this.viewer,r=o.getToolbar(!0).getControl(i.TOOLBAR.NAVTOOLSID),s=function(e){return o.navigation.isActionEnabled(e)?"block":"none"};if(i.isTouchDevice()){var a=new n.Button("toolbar-homeTool");a.setToolTip("Home"),a.setIcon("adsk-icon-home"),a.onClick=function(){o.navigation.setRequestHomeView(!0);var e=o.getDefaultNavigationToolName();o.setActiveNavigationTool(e),t.restoreDefault()},a.setDisplay(s("gotoview")),t.addControl(a),r.homebutton=a}var l=new n.Button("toolbar-fitToViewTool");if(l.setToolTip("Fit to view"),l.setIcon("adsk-icon-fit-to-view"),l.onClick=function(e){o.fitToView(o.getSelection());var i=o.getDefaultNavigationToolName();o.setActiveNavigationTool(i),t.restoreDefault()},l.setDisplay(s("gotoview")),t.addControl(l),r.fovbutton=l,o.model.is3d()){var c=new n.Button("toolbar-focalLengthTool");c.setToolTip("Focal length"),c.setIcon("adsk-icon-fov"),c.onClick=e(o,c,"fov"),c.setDisplay(s("fov")),t.addControl(c),r.fovbutton=c}var u=new n.Button("toolbar-rollTool");u.setToolTip("Roll"),u.setIcon("adsk-icon-roll"),u.onClick=e(o,u,"worldup"),u.setDisplay(s("roll")),t.addControl(u),r.rollbutton=u},o.prototype.initCameraStateMachine=function(e){var t=this,n=this.viewer,o=n.getToolbar(!0).getControl(i.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(e){"fov"===e.toolName&&t.showFocalLengthOverlay(e.active)},n.addEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(e){n.getDefaultNavigationToolName()===e.id&&o.returnToDefault()},n.addEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},o.prototype.initFocalLengthOverlay=function(){var e=this.focallength=document.createElement("div");e.className="focallength";var t=document.createElement("table"),i=document.createElement("tbody");t.appendChild(i),e.appendChild(t),this.viewer.container.appendChild(e);var n=i.insertRow(-1),o=n.insertCell(0);o.setAttribute("data-i18n","Focal Length"),o.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),(o=n.insertCell(1)).textContent="",o.style.width="4em",o.style.textAlign="right",this.fovCell=o,e.style.visibility="hidden"},o.prototype.showFocalLengthOverlay=function(e){function t(e){if(e){var t={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};i.Private.HudMessage.displayMessage(a.container,t)}else i.Private.HudMessage.dismiss()}function n(e){e&&o(),s.focallength&&(s.focallength.style.visibility=e?"visible":"hidden")}function o(){var e=a.getFocalLength();l!==e&&(l=e,s.fovCell.textContent=e.toString()+" mm")}function r(e){if(o(),"fov"===a.toolController.getActiveToolName()){var i=a.navigation.getCamera(),r=i&&!i.isPerspective;n(!r),t(r)}}var s=this,a=this.viewer,l=0,c=a.navigation.getCamera(),u=c&&!c.isPerspective;n(e&&!u),t(e&&u),e?a.addEventListener(i.CAMERA_CHANGE_EVENT,r):a.removeEventListener(i.CAMERA_CHANGE_EVENT,r)},o.prototype.unload=function(){return this.destroyUI(),!0},o.prototype.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1);if(!t)return!0;var o=t.getControl(i.TOOLBAR.NAVTOOLSID);return!o||(e.model&&e.model.is3d()&&(o.orbittoolsbutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.orbittoolsbutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.orbittoolsbutton.getId()),o.orbittoolsbutton=null,o.orbitbutton.onClick=null,o.orbitbutton=null,o.freeorbitbutton.onClick=null,o.freeorbitbutton=null),o.removeControl(o.panbutton.getId()),o.panbutton.onClick=null,o.panbutton=null,o.removeControl(o.dollybutton.getId()),o.dollybutton.onClick=null,o.dollybutton=null,o.camerabutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.camerabutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.camerabutton.getId()),o.camerabutton.onClick=null,o.camerabutton=null,o.rollbutton.onClick=null,o.rollbutton=null,o.fovbutton.onClick=null,o.fovbutton=null,this.focallength=null,e.removeEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,e.removeEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},t.NavToolsExtension=o,i.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",o)}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=t.UI,n=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)};(n.prototype=Object.create(Autodesk.Viewing.Extension.prototype)).constructor=n,n.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},n.prototype.load=function(){var i=this,n=this.viewer;if(this.hasUI=Autodesk.Viewing.Private.GuiViewer3D&&n instanceof Autodesk.Viewing.Private.GuiViewer3D,this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!n.toolController)return!1;this.options=this.options||{};var o={};return o.onCloseCallback=function(e){i.enableMeasureTool(!1)},o.calibrationFactor=this.options.calibrationFactor,o.snapperOptions=this.options.snapperOptions,this.forceCalibrate=this.options.forceCalibrate,this.isCalibrated=null!=this.options.calibrationFactor,this.tool=new e.MeasureTool(n,o),n.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0},n.prototype.unload=function(){var e=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},n.prototype.isActive=function(){return this.tool.isActive()},n.prototype.setActive=function(e){return this.enableMeasureTool(e)},n.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},n.prototype.getMeasurement=function(e,t){var i=null;return this.isActive()&&(i=this.tool.getMeasurement(e,t)),i},n.prototype.getUnitOptions=function(){return[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}]},n.prototype.getPrecisionOptions=function(e){if(e)t=["1","1/2","1/4","1/8","1/16","1/32","1/64"];else var t=["0","0.1","0.01","0.001","0.0001","0.00001"];return t},n.prototype.getDefaultUnit=function(){return this.viewer.model.getDisplayUnit()},n.prototype.openCalibrationRequiredDialog=function(){this.hasUI&&this.calibrationToolButton&&(this.CalibrationRequiredDialog||(this.CalibrationRequiredDialog=new Autodesk.Viewing.Extensions.Measure.CalibrationRequiredDialog(this,this.viewer,"calibration-required","Calibration Required",this.options)),this.CalibrationRequiredDialog.setVisible(!0))},n.prototype.enableMeasureTool=function(e){var t=this.viewer.toolController,i=1==this.selectedTool;return this.viewer.impl.disableRollover(e),e&&!i?!this.forceCalibrate||this.forceCalibrate&&this.tool.isCalibrated()?(t.activateTool("measure"),this.selectedTool=1,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):(this.openCalibrationRequiredDialog(),!1):!(e||!i)&&(t.deactivateTool("measure"),this.selectedTool=0,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},n.prototype.enableCalibrationTool=function(e){var t=this.viewer.toolController,i=2==this.selectedTool;return this.viewer.impl.disableRollover(e),e&&!i?(t.activateTool("calibration"),this.selectedTool=2,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("calibration"),this.selectedTool=0,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},n.prototype.createUI=function(){var e=this,n=this.viewer.getToolbar(!0).getControl(t.TOOLBAR.MODELTOOLSID),o=new i.ComboButton("toolbar-measurementSubmenuTool");o.setToolTip("Measure"),o.setIcon("adsk-icon-measure"),o.saveAsDefault(),this.createMeasurementSubmenu(o),n.measurementSubmenuButton=o,n&&n.addControl(o,{index:0});var r=[{keycodes:[t.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return 1==e.selectedTool?e.enableMeasureTool(!1):2!=e.selectedTool||void 0}}];t.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,r)},n.prototype.createMeasurementSubmenu=function(e){var n=this,o=this.viewer,r=o.getToolbar(!0).getControl(t.TOOLBAR.MODELTOOLSID);this.measureToolButton=new i.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(e){n.enableCalibrationTool(!1),n.enableMeasureTool(!(1==n.selectedTool))},this.onMeasureButtonStateChange=function(e){e.state===i.Button.State.ACTIVE?(n.enableMeasureTool(!0),n.selectedTool=1):e.state===i.Button.State.INACTIVE&&(n.enableMeasureTool(!1),n.selectedTool=0)},this.measureToolButton.addEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),e.addControl(this.measureToolButton),r.measureToolButton=this.measureToolButton,this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this.calibrationToolButton=new i.Button("toolbar-calibrationTool"),this.calibrationToolButton.setToolTip("Calibrate"),this.calibrationToolButton.setIcon("calibration-icon"),this.calibrationToolButton.onClick=function(e){n.enableMeasureTool(!1),n.enableCalibrationTool(!(2==n.selectedTool))},this.onCalibrationButtonStateChange=function(e){e.state===i.Button.State.ACTIVE?(n.enableCalibrationTool(!0),n.selectedTool=2):e.state===i.Button.State.INACTIVE&&(n.enableCalibrationTool(!1),n.selectedTool=0)};var s=function(t){n.calibrationToolButton&&n.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),n.selectedTool=0,e.restoreDefault(),n.enableMeasureTool(!0)};this.calibrationToolButton.addEventListener(i.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange),o.addEventListener("finished-calibration",s),e.addControl(this.calibrationToolButton),r.calibrationToolButton=this.calibrationToolButton},n.prototype.destroyUI=function(){var e=this.viewer;this.measureToolButton&&this.measureToolButton.removeEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),this.calibrationToolButton&&this.calibrationToolButton.removeEventListener(i.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange);var n=e.getToolbar(!1);if(n){var o=n.getControl(t.TOOLBAR.MODELTOOLSID);if(o){var r=null;this.measureToolButton&&((r=o.getControl("toolbar-inspectSubMenu"))?r.removeControl(this.measureToolButton.getId()):o.removeControl(this.measureToolButton.getId())),this.calibrationToolButton&&((r=o.getControl("toolbar-inspectSubMenu"))?r.removeControl(this.calibrationToolButton.getId()):o.removeControl(this.calibrationToolButton.getId())),this.measureToolButton=null,this.calibrationToolButton=null}}t.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},e.MeasureExtension=n,t.theExtensionManager.registerExtension("Autodesk.Measure",n)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(e,t){function i(){k.updateLabelPositions()}function n(){l.clearMeasurement()}function o(){return!!U&&U.isActive()}function r(){k||(k=new a(c)),k.hide(),M&&!o()&&(M.setVisible(!0),M.updatePanel(),c.model&&c.model.is2d()&&M.isolate.setVisibility(!1),y?M.disableUnitOption(0):M.disableUnitOption())}function s(){k&&(k.hide(),k.destroy()),b={},M&&(M.setVisible(!1),M.updatePanel())}function a(e){function t(){c.impl.overlayScenes[m]||c.impl.createOverlayScene(m)}function i(e,t){if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n&&t(n)}}function n(){O&&(c.impl.removeOverlay(m,O),O=null),_.length>0&&(c.impl.removeMultipleOverlays(m,_),_.length=0)}function r(){F.length>0&&(c.impl.removeMultipleOverlays(m,F),F.length=0)}function s(){G.length>0&&(c.impl.removeMultipleOverlays(m,G),G.length=0)}function a(){W.length>0&&(c.impl.removeMultipleOverlays(m,W),W.length=0)}var u=this,h=!1,d=.7,m="MeasureTool-common",v=null,b=null,C=null,k=null,M=null,R=null,P=null,V=null,I={first:{},second:{}},N={first:{},second:{}},D={first:{},second:{}},L={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},O=null,_=[],B={},F=[],G=[],W=[],j=[];this.showFirstVertex=function(e){if(o())U.updateCalibrationLine(e.x,e.y,e.z,e.x,e.y,e.z,1,!1,!0,E);else{var t=this.setScale(e);this.showEndPoint("first",e,t)}},this.showSecondVertex=function(e){if(!o()){var t=this.setScale(e);this.showEndPoint("second",e,t)}};var Y=null;this.showEndPoint=function(e,i,n){v||(v=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:d,transparent:!0,depthTest:!1,depthWrite:!1})),t();var o=I[e],r=o.mesh;if(r||(Y||(Y=new THREE.SphereGeometry(1)),o.geometry=Y,r=o.mesh=new THREE.Mesh(o.geometry,v),c.impl.addOverlay(m,r)),r.scale.x=n,r.scale.y=n,r.scale.z=n,r.position.set(i.x,i.y,i.z),r.visible=!0,c.impl.invalidate(!1,!1,!0),f||S){var s=o.label;if(!s){(s=o.label=document.createElement("div")).className="measure-label",c.container.appendChild(s),s.style.pointerEvents="none";var a=document.createElement("div");a.className="adsk-icon-"+e+" measure-label-icon",s.appendChild(a)}s.classList.toggle("visible",!0),o.position=i.clone(),this.updateLabelPositions()}},this.setScale=function(e){var t=c.navigation,i=t.getCamera(),n=t.getEyeVector(),o=t.getPosition(),r=e.clone(),s=i.isPerspective?r.sub(o).dot(n.normalize()):t.getEyeVector().length(),a=t.getVerticalFov(),l=2*s*Math.tan(THREE.Math.degToRad(.5*a)),u=t.getScreenViewport(),h=window.devicePixelRatio||1;return 5*l/(u.height*h)},this.updateScale=function(){var e=this;i(I,function(t){var i=t.mesh;if(i){var n=e.setScale(i.position);i.scale.x=n,i.scale.y=n,i.scale.z=n}}),i(F,function(e){var t=this.setScale(e.geometry.vertices[0]);e.material.dashSize=4*t,e.material.gapSize=2*t}),i(N,function(t){i(t.line,function(t){e.setCylinderScale(t)})}),i(_,function(t){e.setCylinderScale(t)});for(var t in L)if(L.hasOwnProperty(t)){var n=L[t];n.line&&this.setCylinderScale(n.line)}},this.showFirstEdge=function(e,t){o()?U.updateCalibrationLine(t.x,t.y,t.z,t.x,t.y,t.z,1,!1,!0,E):this.showEdge("first",e,t)},this.showSecondEdge=function(e,t){o()||this.showEdge("second",e,t)},this.showEdge=function(e,i,n){b||(b=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:d,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),t();var o=N[e];if(o.line&&c.impl.removeMultipleOverlays(m,o.line),o.line=this.drawEdgeAsCylinder(i,b,5,1),c.impl.addMultipleOverlays(m,o.line),f||S){var r=o.label;if(!r){(r=o.label=document.createElement("div")).className="measure-label",c.container.appendChild(r),r.style.pointerEvents="none";var s=document.createElement("div");s.className="adsk-icon-"+e+" measure-label-icon",r.appendChild(s)}r.classList.toggle("visible",!0),o.intersectPoint=n.clone(),this.updateLabelPositions()}},this.drawEdgeAsCylinder=function(e,t,i,n){var o=[];if(1==n)for(r=0;r<e.vertices.length;r+=2){s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i);this.setCylinderScale(s),o.push(s)}else for(var r=0;r<e.vertices.length-1;r++){var s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i);this.setCylinderScale(s),o.push(s)}return o},this.drawLineAsCylinder=function(e,t,i){var n;return 2==e.vertices.length&&(n=this.cylinderMesh(e.vertices[0],e.vertices[1],t,i),this.setCylinderScale(n)),n};var q=null;this.cylinderMesh=function(e,t,i,n){var o=(new THREE.Vector3).subVectors(t,e),r=new THREE.Matrix4;r.lookAt(e,t,(new THREE.Object3D).up),r.multiply((new THREE.Matrix4).set(n,0,0,0,0,0,n,0,0,-o.length(),0,0,0,0,0,1)),q||(q=new THREE.CylinderGeometry(.1,.1,1,8,1,!0));var s=new THREE.Mesh(q,i);return s.applyMatrix(r),s.lmv_line_width=n,s.position.x=(t.x+e.x)/2,s.position.y=(t.y+e.y)/2,s.position.z=(t.z+e.z)/2,s},this.setCylinderScale=function(e){var t=this.setScale(e.position);e.hasOwnProperty("lmv_line_width")&&(t*=e.lmv_line_width),e.scale.x=t,e.scale.z=t},this.showFirstFace=function(e,t){this.showFace("first",e,t)},this.showSecondFace=function(e,t){this.showFace("second",e,t)},this.showFace=function(e,i,n){C||(C=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:d,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),t();var o=D[e];if(o.mesh&&c.impl.removeOverlay(m,o.mesh),o.mesh=new THREE.Mesh(i,C),c.impl.addOverlay(m,o.mesh),f||S){var r=o.label;if(!r){(r=o.label=document.createElement("div")).className="measure-label",c.container.appendChild(r),r.style.pointerEvents="none";var s=document.createElement("div");s.className="adsk-icon-"+e+" measure-label-icon",r.appendChild(s)}r.classList.toggle("visible",!0),o.intersectPoint=n.clone(),this.updateLabelPositions()}},this.drawExtensionFace=function(e,i,n){P||(P=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),t();var o=new THREE.Mesh(e,P);o.position.set(i.x,i.y,i.z);var r=o.position.clone();r.add(n),o.lookAt(r),o.updateMatrixWorld(),G.push(o),c.impl.addOverlay(m,o)},this.drawGreyOutPlane=function(e){V||(V=new THREE.MeshPhongMaterial({color:0,ambient:0,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),t();var i=c.model.getMetadata("page_dimensions","page_width"),n=c.model.getMetadata("page_dimensions","page_height"),o=new THREE.Shape;o.moveTo(0,0),o.lineTo(i,0),o.lineTo(i,n),o.lineTo(0,n),o.lineTo(0,0);var r=z=c.model.getClip(e),s=r.contours[0],a=new THREE.Path;a.moveTo(r.points[s[0]].x,r.points[s[0]].y);for(var l=1;l<s.length;l++)a.lineTo(r.points[s[l]].x,r.points[s[l]].y);a.lineTo(r.points[s[0]].x,r.points[s[0]].y),o.holes.push(a);var u=new THREE.ShapeGeometry(o),h=new THREE.Mesh(u,V);W.push(h),c.impl.addOverlay(m,h)},this.getEdgeLength=function(e){for(var t=0,i=e.clone().vertices,n=0;n<i.length;n+=2)c.model.is2d()&&c.model.pageToModel(i[n],i[n+1],H),t+=i[n].distanceTo(i[n+1]);return t=Autodesk.Viewing.Private.convertUnits(c.model.getUnitString(),y,w,t),Autodesk.Viewing.Private.formatValueWithUnits(t,y,3,T)},this.getCircularArcRadius=function(e){var t=e.radius;if(t){if(c.model.is2d()){var i=e.center.clone(),n=e.vertices[0].clone();c.model.pageToModel(i,n,H),t=i.distanceTo(n)}return t=Autodesk.Viewing.Private.convertUnits(c.model.getUnitString(),y,w,t),Autodesk.Viewing.Private.formatValueWithUnits(t,y,3,T)}},this.getFaceArea=function(e){for(var t=0,i=e.vertices,n=new THREE.Vector3,o=new THREE.Vector3,r=0;r<i.length;r+=3)n.subVectors(i[r+1],i[r]),o.subVectors(i[r+2],i[r]),t+=n.length()*o.length()*Math.sin(n.angleTo(o))/2;return t=Autodesk.Viewing.Private.convertUnits(c.model.getUnitString(),y,w,t,"square"),y?Autodesk.Viewing.Private.formatValueWithUnits(t,y+"^2",3,T):Autodesk.Viewing.Private.formatValueWithUnits(t,null,3,T)},this.updateLabels=function(){E===SNAP_EDGE?N.first.label.children[0].textContent=this.getEdgeLength(p):E===SNAP_FACE&&(D.first.label.children[0].textContent=this.getFaceArea(p)),A===SNAP_EDGE?N.second.label.children[0].textContent=this.getEdgeLength(g):A===SNAP_FACE&&(D.second.label.children[0].textContent=this.getFaceArea(g))},this.updateLabelPositions=function(){function e(e,t,i){var n=c.navigation.getCamera(),o=c.navigation.getScreenViewport(),r=new THREE.Vector3(e,t,i);return r=r.project(n),{x:Math.round((r.x+1)/2*o.width)+5,y:Math.round((1-r.y)/2*o.height)+5}}for(var t in L)if(L.hasOwnProperty(t)){var i=L[t];if(o=i.label){l=e((i.p1.x+i.p2.x)/2,(i.p1.y+i.p2.y)/2,(i.p1.z+i.p2.z)/2);o.style.top=l.y+"px",o.style.left=l.x+"px",j.push(o)}}if(B&&(o=B.label)){l=e((B.p1.x+B.p2.x)/2,(B.p1.y+B.p2.y)/2,(B.p1.z+B.p2.z)/2);o.style.top=l.y+"px",o.style.left=l.x+"px",j.push(o)}for(var t in D)if(D.hasOwnProperty(t)){var n=D[t],o=n.label,r=n.intersectPoint;if(o&&r){l=e(r.x,r.y,r.z);o.style.top=l.y+"px",o.style.left=l.x+"px",j.push(o)}}for(var t in N)if(N.hasOwnProperty(t)){var s=N[t],o=s.label,r=s.intersectPoint;if(o&&r){l=e(r.x,r.y,r.z);o.style.top=l.y+"px",o.style.left=l.x+"px",j.push(o)}}for(var t in I)if(I.hasOwnProperty(t)){var a=I[t],o=a.label,r=a.position;if(o&&r){var l=e(r.x,r.y,r.z);o.style.top=l.y+"px",o.style.left=l.x+"px",j.push(o)}}for(var u=0;u<j.length;u++)for(var h=0;h<u;h++)this.labelsOverlapDetection(j[h],j[u]);j=[]},this.labelsOverlapDetection=function(e,t){var i=e.getBoundingClientRect(),n=t.getBoundingClientRect();n.top<=i.bottom&&n.bottom>=i.top&&(n.right>=i.left&&n.right<=i.right?t.style.left=parseInt(t.style.left,10)-(n.right-i.left)+"px":n.left>=i.left&&n.left<=i.right?t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px":n.left<=i.left&&n.right>=i.right&&(t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px"))},this.drawLine=function(e,i,n){function r(e,i,n,o,r,s,a,l){var p=L[e],g=p.line,v=p.label,E=new THREE.Vector3(i,n,o),A=new THREE.Vector3(r,s,a);if(g&&(c.impl.removeOverlay(m,g),p.line=null),v&&v.classList.remove("visible"),E.distanceTo(A)>=Math.pow(.1,T)&&l){var y="xyz"===e||!h&&f;g||(p.material=new THREE.MeshBasicMaterial({color:parseInt(p.color,16),depthTest:!1,depthWrite:!1}),t()),p.material.opacity=f?1:d;var w=p.geometry=new THREE.Geometry;w.vertices.push(E),w.vertices.push(A);var b="xyz"===e?5:"z"===e?1:2;if(g=p.line=u.drawLineAsCylinder(w,p.material,b),c.impl.addOverlay(m,g),g.visible=y,p.p1=E,p.p2=A,"xyz"!=e||f){if(!v){if(v=p.label=document.createElement("div"),v.className="measure-length","xyz"===e){var C=document.createElement("div");C.className="measure-length-text",v.appendChild(C)}v.style.pointerEvents="none",p.axis&&(v.className="adsk-icon-axis-"+e+" measure-label-axis measure-label-axis-"+e),c.container.appendChild(v)}p.axis||u.updateDistance(),v.classList.toggle("visible",y)}}}if(o())U.updateCalibrationLine(e.x,e.y,e.z,i.x,i.y,i.z,T,f,x.isSnapped(),E);else{r("xyz",e.x,e.y,e.z,i.x,i.y,i.z,!0);var s=c.navigation.getAlignedUpVector(),a=Math.abs(s.x),l=Math.abs(s.y),p=Math.abs(s.z),g=!n&&function(e,t){var i=Math.pow(.1,T);return!(Math.abs(e.x-t.x)>=i&&Math.abs(e.y-t.y)<i&&Math.abs(e.z-t.z)<i||Math.abs(e.y-t.y)>=i&&Math.abs(e.x-t.x)<i&&Math.abs(e.z-t.z)<i||Math.abs(e.z-t.z)>=i&&Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i)}(e,i);p>a&&p>l?(r("x",e.x,e.y,e.z,i.x,e.y,e.z,g),r("y",i.x,e.y,e.z,i.x,i.y,e.z,g),r("z",i.x,i.y,e.z,i.x,i.y,i.z,g)):l>a&&l>p?(r("x",e.x,e.y,e.z,i.x,e.y,e.z,g),r("z",i.x,e.y,e.z,i.x,e.y,i.z,g),r("y",i.x,e.y,i.z,i.x,i.y,i.z,g)):(r("y",e.x,e.y,e.z,e.x,i.y,e.z,g),r("z",e.x,i.y,e.z,e.x,i.y,i.z,g),r("x",e.x,i.y,i.z,i.x,i.y,i.z,g))}this.updateLabelPositions()},this.updateDistance=function(){var e=L.xyz.label;e&&(e.children[0].textContent="~ "+l.getDistance("xyz"))},this.updateAngle=function(){var e=B.label;e&&(e.children[0].textContent="~ "+l.getAngle())},this.drawExtensionLine=function(e,i,n){var o,r,s,a,l=new THREE.Vector3,u=new THREE.Vector3;if(l.subVectors(i,e),u.subVectors(n,i),a=l.dot(u),l.subVectors(n,i),a=-a/l.dot(l),l.subVectors(n,i),l.multiplyScalar(a),s=l.add(i),a<0)o=i,r=s;else{if(!(a>1))return;o=n,r=s}R||(R=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),t(),R.opacity=f?1:d;var h=this.setScale(o);R.dashSize=4*h,R.gapSize=2*h;var p=new THREE.Geometry;p.vertices.push(o),p.vertices.push(r),p.computeLineDistances();var g=new THREE.Line(p,R);F.push(g),c.impl.addOverlay(m,g)},this.drawExtensionLinePointToPoint=function(e,i){var n=e,o=i;R||(R=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),t(),R.opacity=f?1:d;var r=this.setScale(n);R.dashSize=4*r,R.gapSize=2*r;var s=new THREE.Geometry;s.vertices.push(n),s.vertices.push(o),s.computeLineDistances();var a=new THREE.Line(s,R);F.push(a),c.impl.addOverlay(m,a)},this.nearestPointsInSegmentToSegment=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3;o.subVectors(t,e),r.subVectors(n,i),s.subVectors(e,i);var a,l,c,u,h=o.dot(o),d=o.dot(r),p=r.dot(r),g=o.dot(s),m=r.dot(s),v=h*p-d*d,f=v,E=v;return v<.001?(l=0,f=1,u=m,E=p):(u=h*m-d*g,(l=d*m-p*g)<0?(l=0,u=m,E=p):l>f&&(l=f,u=m+d,E=p)),u<0?(u=0,-g<0?l=0:-g>h?l=f:(l=-g,f=h)):u>E&&(u=E,-g+d<0?l=0:-g+d>h?l=f:(l=-g+d,f=h)),a=Math.abs(l)<.001?0:l/f,c=Math.abs(u)<.001?0:u/E,o.multiplyScalar(a),r.multiplyScalar(c),s.add(o),s.sub(r),o.add(e),r.add(i),[o,r]},this.edgeToEdgeMeasure=function(e,t,i){var n=x.getEndPointsInEdge(e),r=n[0].clone(),s=n[1].clone(),a=(n=x.getEndPointsInEdge(t))[0].clone(),l=n[1].clone(),c=this.nearestPointInPointToLine(r,a,l),u=this.nearestPointInPointToLine(s,a,l),h=new THREE.Vector3,d=new THREE.Vector3;if(h.subVectors(r,s),d.subVectors(a,l),h.normalize(),d.normalize(),this.isEqualVectors(h,d,.01)||this.isInverseVectors(h,d,.01)||o())return r.distanceTo(i)<=s.distanceTo(i)?(this.drawLine(r,c),this.drawExtensionLine(r,a,l),[r,c]):(this.drawLine(s,u),this.drawExtensionLine(s,a,l),[s,u]);var p=this.nearestPointInPointToLine(i,r,s),g=this.angleVectorToVector(h,d);return r.distanceTo(a)<r.distanceTo(l)&&r.distanceTo(a)<s.distanceTo(a)&&r.distanceTo(a)<s.distanceTo(l)?this.drawAngleLineToLine(r,p,a,l,g):r.distanceTo(l)<r.distanceTo(a)&&r.distanceTo(l)<s.distanceTo(a)&&r.distanceTo(l)<s.distanceTo(l)?this.drawAngleLineToLine(r,p,l,a,g):s.distanceTo(a)<r.distanceTo(a)&&s.distanceTo(a)<r.distanceTo(l)&&s.distanceTo(a)<s.distanceTo(l)?this.drawAngleLineToLine(s,p,a,l,g):this.drawAngleLineToLine(s,p,l,a,g),g},this.curvedEdgeToEdgeMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=null,o=null,r=e.vertices,s=x.getEndPointsInEdge(t),a=0;a<r.length;a+=2){var l=this.nearestPointsInSegmentToSegment(r[a],r[a+1],s[0],s[1]),c=l[0].distanceTo(l[1]);c<i&&(i=c,n=l[0],o=l[1])}return this.drawLine(n,o),[n,o]},this.curvedEdgeToCurvedEdgeMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=null,o=null,r=e.vertices,s=t.vertices,a=0;a<r.length;a+=2)for(var l=0;l<s.length;l+=2){var c=this.nearestPointsInSegmentToSegment(r[a],r[a+1],s[l],s[l+1]),u=c[0].distanceTo(c[1]);u<i&&(i=u,n=c[0],o=c[1])}return this.drawLine(n,o),[n,o]},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o=new THREE.Vector3,r=new THREE.Vector3;return o.subVectors(t,e),r.subVectors(i,t),n=o.dot(r),o.subVectors(i,t),n=-n/o.dot(o),o.subVectors(i,t),o.multiplyScalar(n),o.add(t)},this.pointToEdgeMeasure=function(e,t,i){var n=x.getEndPointsInEdge(t),o=n[0],r=n[1],s=this.nearestPointInPointToLine(e,o,r),a=this.nearestPointInPointToLine(i,o,r),l=new THREE.Vector3;return l.subVectors(a,s),l.add(e),this.drawLine(l,a),this.drawExtensionLinePointToPoint(e,l),[e,s]},this.edgeToPointMeasure=function(e,t){var i=x.getEndPointsInEdge(e),n=i[0],o=i[1],r=this.nearestPointInPointToLine(t,n,o);return this.drawLine(t,r),this.drawExtensionLine(t,n,o),[t,r]},this.curvedEdgeToVertexMeasure=function(e,t){for(var i=e.vertices,n=Number.MAX_VALUE,o=null,r=0;r<i.length;r+=2){var s=this.nearestPointInPointToSegment(t,i[r],i[r+1]),a=t.distanceTo(s);a<n&&(n=a,o=s)}return this.drawLine(t,o),[t,o]},this.faceToFaceMeasure=function(e,t,i,n){var o=t.clone(),r=n.clone(),s=this.angleVectorToVector(t,n);if(o.x<=r.x+.01&&o.x>=r.x-.01&&o.y<=r.y+.01&&o.y>=r.y-.01&&o.z<=r.z+.01&&o.z>=r.z-.01||o.x<=.01-r.x&&o.x>=-r.x-.01&&o.y<=.01-r.y&&o.y>=-r.y-.01&&o.z<=.01-r.z&&o.z>=-r.z-.01){var a=new THREE.Vector3;a.subVectors(e,i);var l=o.dot(a)/o.dot(r);a.addVectors(i,r.multiplyScalar(l));var c=2*a.distanceTo(e),u=new THREE.PlaneBufferGeometry(c,c);return this.drawExtensionFace(u,e,t),this.drawLine(i,a,!0),[i,a,s]}return s=this.drawAngleFaceToFace(e,t,i,n)},this.angleVectorToVector=function(e,t){return 180*e.angleTo(t)/Math.PI},this.intersectPlaneToPlane=function(e,t,i,n){var o=new THREE.Vector3;o.crossVectors(t,n);var r,s=o.x>=0?o.x:-o.x,a=o.y>=0?o.y:-o.y,l=o.z>=0?o.z:-o.z;r=s>a?s>l?1:3:a>l?2:3;var c,u,h=new THREE.Vector3;switch(c=-t.dot(e),u=-n.dot(i),r){case 1:h.x=0,0!==o.x?(h.y=(u*t.z-c*n.z)/o.x,h.z=(c*n.y-u*t.y)/o.x):(h.y=-u*t.z/(t.z*n.y),h.z=-c*n.y/(t.z*n.y));break;case 2:h.y=0,0!==o.y?(h.x=(c*n.z-u*t.z)/o.y,h.z=(u*t.x-c*n.x)/o.y):(h.x=-c*n.z/(t.x*n.z),h.z=-u*t.x/(t.x*n.z));break;case 3:h.z=0,0!==o.z?(h.x=(u*t.y-c*n.y)/o.z,h.y=(c*n.x-u*t.x)/o.z):(h.x=-u*t.y/(t.y*n.x),h.y=-c*n.x/(t.y*n.x))}var d=new THREE.Vector3;return d.addVectors(h,o.multiplyScalar(100)),[this.nearestPointInPointToLine(e,h,d),this.nearestPointInPointToLine(i,h,d)]},this.drawAngle=function(e,i,o,r,s,a){k||(k=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),M=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1})),t(),n();var l=e.distanceTo(i),u=new THREE.CircleGeometry(l,100,0,s*Math.PI/180),h=new THREE.Mesh(u,k),d=h.geometry.vertices[0].clone();h.geometry.vertices.push(d),h.position.set(e.x,e.y,e.z);var p=h.position.clone();p.add(r),h.lookAt(p),h.updateMatrixWorld();var g=h.geometry.vertices[1].clone(),v=h.geometry.vertices[h.geometry.vertices.length-2].clone();g.applyMatrix4(h.matrixWorld),v.applyMatrix4(h.matrixWorld);var f=new THREE.Vector3,E=new THREE.Vector3,A=new THREE.Vector3,y=new THREE.Vector3;f.subVectors(g,e),E.subVectors(v,e),A.subVectors(i,e),y.subVectors(o,e);var T,w=f.angleTo(A),b=f.angleTo(y),C=E.angleTo(A),S=E.angleTo(y);T=(w<=.001&&w>=-.001||b<=.001&&b>=-.001)&&(C<=.001&&C>=-.001||S<=.001&&S>=-.001)?0:(w<=Math.PI+.001&&w>=Math.PI-.001||b<=Math.PI+.001&&b>=Math.PI-.001)&&(C<=Math.PI+.001&&C>=Math.PI-.001||S<=Math.PI+.001&&S>=Math.PI-.001)?Math.PI:w<=C+.001&&w>=C-.001||w<=S+.001&&w>=S-.001?w:b;var x=new THREE.Matrix4;x.makeRotationAxis(r,T),x.multiply(h.matrix),h.matrix=x,h.rotation.setFromRotationMatrix(h.matrix),h.updateMatrixWorld(),g=h.geometry.vertices[1].clone(),v=h.geometry.vertices[h.geometry.vertices.length-2].clone(),g.applyMatrix4(h.matrixWorld),v.applyMatrix4(h.matrixWorld),f.subVectors(g,e),E.subVectors(v,e),w=f.angleTo(A),b=f.angleTo(y),C=E.angleTo(A),S=E.angleTo(y),w>=.001&&b>=.001&&((x=new THREE.Matrix4).makeRotationAxis(r,2*-T),x.multiply(h.matrix),h.matrix=x,h.rotation.setFromRotationMatrix(h.matrix));var R=new THREE.CircleGeometry(.9*l,100,0,s*Math.PI/180);R.vertices.splice(0,1),h.updateMatrixWorld(),R.applyMatrix(h.matrixWorld);var P=this.drawEdgeAsCylinder(R,M,2.5,0),V=new THREE.Geometry,I=new THREE.Geometry;V.vertices.push(h.geometry.vertices[0].clone(),h.geometry.vertices[1].clone()),I.vertices.push(h.geometry.vertices[0].clone(),h.geometry.vertices[h.geometry.vertices.length-2].clone()),V.applyMatrix(h.matrixWorld),I.applyMatrix(h.matrixWorld);var N=this.drawLineAsCylinder(V,M,2.5),D=this.drawLineAsCylinder(I,M,2.5);O=h,_=P.concat([N,D]),c.impl.addOverlay(m,O),c.impl.addMultipleOverlays(m,_),a.copy(h.geometry.vertices[Math.round(h.geometry.vertices.length/2)-1]),a.applyMatrix4(h.matrixWorld)},this.drawAngleFaceToFace=function(e,t,i,n){var o=this.intersectPlaneToPlane(e,t,i,n),r=new THREE.Vector3,s=new THREE.Vector3;r.subVectors(e,o[0]),s.subVectors(i,o[1]);var a=this.angleVectorToVector(r,s),u=o[0].clone(),h=new THREE.Vector3;h.crossVectors(t,n),h.normalize();var d=(o=this.intersectPlaneToPlane(e,t,u,h))[0].clone(),p=(o=this.intersectPlaneToPlane(i,n,u,h))[0].clone(),g=new THREE.Vector3;if(this.drawAngle(u,d,p,h,a,g),f){var m=B.label;if(!m){(m=B.label=document.createElement("div")).className="measure-length",c.container.appendChild(m);var v=document.createElement("div");v.className="measure-length-text",m.appendChild(v),m.style.pointerEvents="none"}m.children[0].textContent=l.getAngle(),m.classList.toggle("visible",!0),B.p1=g.clone(),B.p2=g.clone(),this.updateLabelPositions()}return a},this.drawAngleLineToLine=function(e,t,i,n,o){var r=e,s=new THREE.Vector3,a=new THREE.Vector3,u=new THREE.Vector3;a.subVectors(e,t),u.subVectors(i,n),s.crossVectors(a,u),s.normalize();var h=t,d=new THREE.Vector3;d.subVectors(r,i),d.add(n);var p=new THREE.Vector3;if(this.drawAngle(r,h,d,s,o,p),f){var g=B.label;if(!g){(g=B.label=document.createElement("div")).className="measure-length",c.container.appendChild(g);var m=document.createElement("div");m.className="measure-length-text",g.appendChild(m),g.style.pointerEvents="none"}g.children[0].textContent=l.getAngle(),g.classList.toggle("visible",!0),B.p1=p.clone(),B.p2=p.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3;o.subVectors(i,e),o.cross(n),r.crossVectors(t,n);var s=o.divide(r);return(r=t.clone()).multiplyScalar(s),o.addVectors(e,r),o},this.nearestPointInPointToPlane=function(e,t,i){var n=new THREE.Vector3,o=i.clone(),r=new THREE.Vector3;r.subVectors(e,t);var s=-o.dot(r)/o.dot(o);return n.addVectors(e,o.multiplyScalar(s)),n},this.faceToPointMeasure=function(e,t,i,n){var o=e.vertices[0],r=this.nearestPointInPointToPlane(n,o,t),s=i.clone(),a=new THREE.Vector3;a.subVectors(s,r),a.add(n);var l=2*r.distanceTo(i),c=new THREE.PlaneBufferGeometry(l,l);return this.drawExtensionFace(c,i,t),this.drawLine(n,r),[n,r]},this.nearestPointInPointToTriangle=function(e,t,i,n){var o,r=Number.MAX_VALUE;if(o=this.pointProjectsInTriangle(e,t,i,n))return o;var s=this.nearestPointInPointToSegment(e,t,i);return e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,t,n),e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,i,n),e.distanceTo(s)<r&&(o=s.clone()),o},this.pointToFaceMeasure=function(e,t,i,n){var o=t.vertices[0],r=this.nearestPointInPointToPlane(e,o,i),s=n.clone(),a=new THREE.Vector3;return a.subVectors(s,r),a.add(e),this.drawLine(s,a),this.drawExtensionLinePointToPoint(e,a),[e,r]},this.curvedFaceToVertexMeasure=function(e,t){for(var i,n=Number.MAX_VALUE,o=e.vertices,r=0;r<o.length;r+=3){var s=this.nearestPointInPointToTriangle(t,o[r],o[r+1],o[r+2]);t.distanceTo(s)<n&&(n=t.distanceTo(s),i=s)}return this.drawLine(i,t),[i,t]},this.pointProjectsInTriangle=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3;o.subVectors(i,t),r.subVectors(n,t),a.crossVectors(o,r),s.subVectors(e,t),o.cross(s);var l=o.dot(a)/a.dot(a);if(s.cross(r),(t=1-l-(i=s.dot(a)/a.dot(a)))>=0&&t<=1&&i>=0&&i<=1&&l>=0&&l<=1){var c=THREE.Triangle.normal(t,i,n);return this.nearestPointInPointToPlane(e,t,c)}},this.nearestPointsInLineSegmentToTriangle=function(e,t,i,n,o){var r,s,a=[],l=Number.MAX_VALUE,c=this.pointProjectsInTriangle(e,i,n,o);c&&e.distanceTo(c)<l&&(l=e.distanceTo(c),a[0]=e,a[1]=c);var u=this.pointProjectsInTriangle(t,i,n,o);u&&t.distanceTo(u)<l&&(l=t.distanceTo(u),a[0]=t,a[1]=u),r=i,s=n;var h=this.nearestPointsInSegmentToSegment(e,t,r,s);return h[0].distanceTo(h[1])<l&&(l=h[0].distanceTo(h[1]),a[0]=h[0].clone(),a[1]=h[1].clone()),r=i,s=o,(h=this.nearestPointsInSegmentToSegment(e,t,r,s))[0].distanceTo(h[1])<l&&(l=h[0].distanceTo(h[1]),a[0]=h[0].clone(),a[1]=h[1].clone()),r=n,s=o,(h=this.nearestPointsInSegmentToSegment(e,t,r,s))[0].distanceTo(h[1])<l&&(a[0]=h[0].clone(),a[1]=h[1].clone()),a},this.nearestPointsInEdgeToFace=function(e,t,i){for(var n=[],o=Number.MAX_VALUE,r=0;r<i.vertices.length;r+=3){var s=this.nearestPointsInLineSegmentToTriangle(e,t,i.vertices[r],i.vertices[r+1],i.vertices[r+2]);s[0].distanceTo(s[1])<o&&(o=s[0].distanceTo(s[1]),n=s)}return n},this.nearestPointsInTriangleToTriangle=function(e,t,i,n,o,r){function s(e,t,i,n){var o=l.pointProjectsInTriangle(e,t,i,n);o&&e.distanceTo(o)<u&&(u=e.distanceTo(o),c[0]=e,c[1]=o)}function a(e,t,i,n){var o=l.nearestPointsInSegmentToSegment(e,t,i,n);o[0].distanceTo(o[1])<u&&(u=o[0].distanceTo(o[1]),c=o)}var l=this,c=[],u=Number.MAX_VALUE;return s(e,n,o,r),s(t,n,o,r),s(i,n,o,r),s(n,e,t,i),s(o,e,t,i),s(r,e,t,i),a(e,t,n,o),a(e,t,n,r),a(e,t,o,r),a(e,i,n,o),a(e,i,n,r),a(e,i,o,r),a(t,i,n,o),a(t,i,n,r),a(t,i,o,r),c},this.curvedEdgeToFaceMeasure=function(e,t){for(var i=Number.MAX_VALUE,n=[],o=e.vertices,r=0;r<o.length;r+=2){var s=this.nearestPointsInEdgeToFace(o[r],o[r+1],t);s[0].distanceTo(s[1])<i&&(i=s[0].distanceTo(s[1]),n=s)}return this.drawLine(n[0],n[1]),[n[0],n[1]]},this.curvedFaceToFaceMeasure=function(e,t){var i=Number.MAX_VALUE,n=[],o=e.vertices,r=t.vertices;e.computeBoundingSphere(),t.computeBoundingSphere();var s=new THREE.Sphere,a=new THREE.Sphere,l=[],c=Number.MAX_VALUE,u=[],h=[];e.bSpheres=[],t.bSpheres=[];for(d=0;d<o.length;d+=3)s.setFromPoints([o[d],o[d+1],o[d+2]]),e.bSpheres.push(s.clone()),(m=s.center.distanceTo(t.boundingSphere.center)+s.radius+t.boundingSphere.radius)<c&&(c=m);for(d=0;d<o.length;d+=3)(g=(s=e.bSpheres[d/3]).center.distanceTo(t.boundingSphere.center)-s.radius-t.boundingSphere.radius)<=c&&u.push(d);c=Number.MAX_VALUE;for(p=0;p<r.length;p+=3)a.setFromPoints(r[p],r[p+1],r[p+2]),t.bSpheres.push(a.clone()),(m=a.center.distanceTo(e.boundingSphere.center)+a.radius+e.boundingSphere.radius)<c&&(c=m);for(p=0;p<r.length;p+=3)(g=(a=t.bSpheres[p/3]).center.distanceTo(e.boundingSphere.center)-a.radius-e.boundingSphere.radius)<=c&&h.push(p);c=Number.MAX_VALUE;for(var d=0;d<u.length;d++){s=e.bSpheres[u[d]/3];for(var p=0;p<h.length;p++){a=t.bSpheres[h[p]/3];var g=s.center.distanceTo(a.center)-s.radius-a.radius,m=s.center.distanceTo(a.center)+s.radius+a.radius;m<c&&(c=m,l.push({i:u[d],j:h[p],value:g}))}}for(var v=0;v<l.length;v++)if(l[v].value<=c&&l[v].value<i){var f=this.nearestPointsInTriangleToTriangle(o[l[v].i],o[l[v].i+1],o[l[v].i+2],r[l[v].j],r[l[v].j+1],r[l[v].j+2]);f[0].distanceTo(f[1])<i&&(i=f[0].distanceTo(f[1]),n=f)}return this.drawLine(n[0],n[1]),[n[0],n[1]]},this.faceToEdgeMeasure=function(e,t,i,n,o){var r,s,a=x.getEndPointsInEdge(n);a[0].distanceTo(i)<a[1].distanceTo(i)?(r=a[0],s=a[1]):(r=a[1],s=a[0]);var l=new THREE.Vector3;l.subVectors(s,r);var c=this.angleLineToPlane(l,t);if(l.dot(t)<=.01&&l.dot(t)>=-.01){var u=e.vertices[0],h=this.nearestPointInPointToPlane(r,u,t),d=this.nearestPointInPointToLine(o,r,s);return this.faceToPointMeasure(e,t,i,d),[r,h,c]}var p=this.nearestPointInPointToLine(o,r,s);return this.drawAngleEdgeToFace(e.vertices[0],t,i,r,p,c),c},this.edgeToFaceMeasure=function(e,t,i,n,o){var r,s,a=x.getEndPointsInEdge(e);a[0].distanceTo(o)<a[1].distanceTo(o)?(r=a[0],s=a[1]):(r=a[1],s=a[0]);var l=new THREE.Vector3;l.subVectors(s,r);var c=this.angleLineToPlane(l,n);if(l.dot(n)<=.01&&l.dot(n)>=-.01){var u=i.vertices[0],h=this.nearestPointInPointToPlane(r,u,n),d=new THREE.Vector3;d.subVectors(o,h),d.add(r);var p=new THREE.Vector3;return p.subVectors(o,h),p.add(s),this.drawLine(d,o),this.drawExtensionLinePointToPoint(d,p),[r,h,c]}var g=this.nearestPointInPointToLine(t,r,s);return this.drawAngleEdgeToFace(i.vertices[0],n,o,r,g,c),c},this.angleLineToPlane=function(e,t){var i=this.angleVectorToVector(e,t);return i>90?i-=90:i=90-i,i},this.drawAngleEdgeToFace=function(e,t,i,n,o,r){var s=this.intersectPointLineToPlane(e,t,n,o);if(s){var a=o;if(90===r)u=i.clone();else var u=this.nearestPointInPointToPlane(o,e,t);var h=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3;d.subVectors(o,n),p.subVectors(u,s),h.crossVectors(d,p),h.normalize();var g=new THREE.Vector3;if(this.drawAngle(s,a,u,h,r,g),f){var m=B.label;if(!m){(m=B.label=document.createElement("div")).className="measure-length",c.container.appendChild(m);var v=document.createElement("div");v.className="measure-length-text",m.appendChild(v),m.style.pointerEvents="none"}m.children[0].textContent=l.getAngle(),m.classList.toggle("visible",!0),B.p1=g.clone(),B.p2=g.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3;o.subVectors(n,i),r.subVectors(i,e);var s=t.dot(o),a=-t.dot(r);return Math.abs(s)<.001?null:(o.multiplyScalar(a/s),o.add(i),o)},this.nearestVertexInVertexToEdge=function(e,t){for(var i,n=Number.MAX_VALUE,o=0;o<t.vertices.length;o++){var r=e.distanceTo(t.vertices[o]);n>r&&(i=t.vertices[o],n=r)}return i},this.isEqualVectors=function(e,t,i){return Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i},this.isInverseVectors=function(e,t,i){return Math.abs(e.x+t.x)<=i&&Math.abs(e.y+t.y)<=i&&Math.abs(e.z+t.z)<=i},this.setSimple=function(e){if(h!=e){h=e;for(var t in L)if("xyz"!==t&&L.hasOwnProperty(t)){var i=L[t];i.line&&(i.line.visible=!e,i.label&&i.label.classList.toggle("visible",!e))}c.impl.invalidate(!1,!1,!0)}},this.hide=function(){var e;for(e in I)if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(t.mesh.visible=!1),t.label&&t.label.classList.remove("visible")}for(e in N)if(N.hasOwnProperty(e)){var i=N[e];if(i.line)for(var o in i.line)i.line[o].visible=!1;i.label&&i.label.classList.remove("visible")}for(e in D)if(D.hasOwnProperty(e)){var l=D[e];l.mesh&&(l.mesh.visible=!1),l.label&&l.label.classList.remove("visible")}for(e in L)if(L.hasOwnProperty(e)){var u=L[e];u.line&&(u.line.visible=!1),u.label&&u.label.classList.remove("visible")}B.label&&B.label.classList.remove("visible"),n(),R&&r(),P&&s(),V&&a(),c.impl.invalidate(!1,!1,!0)},this.hideClick=function(e){if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(t.mesh.visible=!1),t.label&&t.label.classList.remove("visible")}if(N.hasOwnProperty(e)){var i=N[e];if(i.line)for(var o in i.line)i.line[o].visible=!1;i.label&&i.label.classList.remove("visible")}if(D.hasOwnProperty(e)){var a=D[e];a.mesh&&(a.mesh.visible=!1),a.label&&a.label.classList.remove("visible")}for(var l in L)if(L.hasOwnProperty(l)){var u=L[l];u.line&&(u.line.visible=!1),u.label&&u.label.classList.remove("visible")}B.label&&B.label.classList.remove("visible"),n(),R&&r(),P&&s(),c.impl.invalidate(!1,!1,!0)},this.destroy=function(){var e;for(e in I)if(I.hasOwnProperty(e)){var t=I[e];t.mesh&&(c.impl.removeOverlay(m,t.mesh),t.mesh=t.geometry=null),t.label&&(t.label.parentNode.removeChild(t.label),t.label=null)}for(e in N)if(N.hasOwnProperty(e)){var i=N[e];i.line&&(c.impl.removeMultipleOverlays(m,i.line),i.line=i.intersectPoint=null),i.label&&(i.label.parentNode.removeChild(i.label),i.label=null)}for(e in D)if(D.hasOwnProperty(e)){var o=D[e];o.mesh&&(c.impl.removeOverlay(m,o.mesh),o.mesh=o.intersectPoint=null),o.label&&(o.label.parentNode.removeChild(o.label),o.label=null)}v=null,C=null,b=null,k=null,R=null,r(),P=null,s(),V=null,a();for(e in L)if(L.hasOwnProperty(e)){var l=L[e];l.line&&(c.impl.removeOverlay(m,l.line),l.material=l.line=l.geometry=null),l.label&&(l.label.parentNode.removeChild(l.label),l.label=null),l.material=l.line=l.geometry=l.label=l.p1=l.p2=null}n(),B.label&&(B.label.parentNode.removeChild(B.label),B.label=null),B.label=B.p1=B.p2=null,Y&&Y.dispose(),q&&q.dispose(),c.impl.overlayScenes[m]&&c.impl.removeOverlayScene(m)}}var l=this,c=e,u=t||{},h=["measure"],d=!1,p=null,g=null,m=!1,v=0,f=!1,E=null,A=null,y="",T=null,w=u.calibrationFactor?u.calibrationFactor:1,b={},C=0,S=!1,k=null,M=null,x=null,R=null,P=null,V=null,I=null,N=null,D=null,L=null,O=null,_=null,H=null,B=null,F=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,z=null,U=null,G=!1;this.register=function(){if(F&&!M&&(M=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(l,c,"measure-panel","Measure",t),c.addPanel(M)),!x){var i=u?u.snapperOptions:null;x=new Autodesk.Viewing.Extensions.Measure.Snapper(e,i),c.toolController.registerTool(x)}L||(L=new Autodesk.Viewing.Extensions.Measure.MagnifyingGlass(e),c.toolController.registerTool(L)),U||(U=new Autodesk.Viewing.Extensions.Measure.CalibrationTool(e,l,x,t),c.toolController.registerTool(U))},this.deregister=function(){this.deactivate(),M&&(c.removePanel(M),M.uninitialize()),c.toolController.deregisterTool(x),c.toolController.deregisterTool(L),x=null,L=null},this.isActive=function(){return d},this.getNames=function(){return h},this.getName=function(){return h[0]},this.getCursor=function(){return m||o()?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto"},this.activate=function(){d=!0,v=0,m=!1,y||(y=c.model.getDisplayUnit()),null===T&&(T=c.model&&c.model.is2d()?3:1),r(),c.clearSelection(),c.toolController.activateTool("snapper"),c.toolController.activateTool("magnifyingGlass"),c.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),c.addEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.deactivate=function(){d=!1,p=g=null,b={},this.clearMeasurement(),s(),x&&x.isActive()&&c.toolController.deactivateTool("snapper"),L&&L.isActive()&&c.toolController.deactivateTool("magnifyingGlass"),c.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),c.removeEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.update=function(){return!1},this.enableCalibrate=function(e){x.enableCalibrate(e)},this.getUnits=function(){return y},this.setUnits=function(e){y!==e&&(y=e,k&&k.updateDistance())},this.getPrecision=function(){return T},this.setPrecision=function(e){T!==e&&(T=e,k&&k.updateDistance())},this.setCalibrationFactor=function(e){w=e},this.getDistance=function(e){if(c.model){var t=Autodesk.Viewing.Private.convertUnits(c.model.getUnitString(),y,w,b[e]||0);return Autodesk.Viewing.Private.formatValueWithUnits(t,y,3,T)}},this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(C,String.fromCharCode(176),3,T)},this.isCalibrated=function(){return U.isCalibrated()},this.getMeasurement=function(e,t){y=e||y,T=t||T;var i=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"];return{from:i[this.getFirstGeometry().type],to:i[this.getSecondGeometry().type],distance:this.getDistance("xyz"),deltaX:this.getDistance("x"),deltaY:this.getDistance("y"),deltaZ:this.getDistance("z"),angle:this.getAngle(),unitType:y,precision:T}},this.clearMeasurement=function(){p=g=null,E=A=null,O=_=null,H=B=null,v=1,b={},C=0,z=null,k&&k.hide(),M&&(M.updatePanel(),M.hideMeasureResult(),M.isolateMeasure&&this.clearIsolate()),c.model.is2d()&&(e.impl.updateViewportId(0),x&&x.setFirstClickVpId(null))},this.clearRubberBand=function(){g=null,A=null,k.hideClick("second")},this.clearFirstPick=function(){g?(k.hide(),p=g.clone(),E=A,R=P,V=I,O=_,H=B,N=D,c.model.is2d()&&(e.impl.updateViewportId(H),x&&x.setFirstClickVpId(H)),S=!0,E===SNAP_VERTEX?k.showFirstVertex(p):E===SNAP_EDGE?k.showFirstEdge(p,R):E===SNAP_FACE?k.showFirstFace(p,R):E===SNAP_CIRCULARARC?(p.center=g.center,p.radius=g.radius,k.showFirstEdge(p,R)):E===SNAP_CURVEDFACE&&k.showFirstFace(p,R),S=!1,g=null,A=null,_=null,B=null,D=null,v=2,b={},C=0,M&&M.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),M&&M.showSelection1()},this.clearSecondPick=function(){g=null,A=null,_=null,B=null,v=2,b={},C=0,k.hideClick("second"),M&&M.isolateMeasure&&this.clearIsolate(),c.model.is2d()&&(e.impl.updateViewportId(H),x&&x.setFirstClickVpId(H))},this.getIndicator=function(){return k},this.getFirstGeometry=function(){return{type:E,geometry:p}},this.getSecondGeometry=function(){return{type:A,geometry:g}},this.getEdgeLength=function(e){return k.getEdgeLength(e)},this.getFaceArea=function(e){return k.getFaceArea(e)},this.getCircularArcRadius=function(e){return k.getCircularArcRadius(e)},this.isolateMeasurement=function(){if(O&&_){var e=[O,_];c.isolate(e)}},this.clearIsolate=function(){c.showAll()},this.isIdenticalEdges=function(){if(p.vertices.length===g.vertices.length){for(var e=0;e<p.vertices.length;e++)if(!p.vertices[e].equals(g.vertices[e]))return!1;return!0}return!1},this.isIdenticalFaces=function(){if(p.faceId&&g.faceId){if(p.fragId===g.fragId&&p.faceId===g.faceId)return!0}else if(p.vertices.length===g.vertices.length){for(var e=0;e<p.vertices.length;e++)if(!p.vertices[e].equals(g.vertices[e]))return!1;return!0}return!1},this.isIdenticalGeometries=function(){if(E===A)switch(E){case SNAP_VERTEX:if(p.equals(g))return!0;break;case SNAP_EDGE:return this.isIdenticalEdges();case SNAP_FACE:return this.isIdenticalFaces();case SNAP_CIRCULARARC:case SNAP_CURVEDEDGE:return this.isIdenticalEdges();case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},this._handleMouseEvent=function(t){if(x.isSnapped()){if(0===v&&(this.clearMeasurement(),v=1),1===v)H=x.getViewportIndex(),E=x.getHighlightGeometry(),R=x.getIntersectPoint(),o()&&(U.showLabel(!1),U.showPanel(!1)),c.model.is2d()&&!G&&(e.impl.updateViewportId(H),x&&x.setFirstClickVpId(H)),p=x.getGeometry(),E===SNAP_VERTEX?k.showFirstVertex(p):E===SNAP_EDGE||E===SNAP_CURVEDEDGE?k.showFirstEdge(p,R):E===SNAP_FACE?(V=x.getFaceNormal(),k.showFirstFace(p,R)):E===SNAP_CIRCULARARC?(N=x.getCircularArcCenter(),p.center=x.getCircularArcCenter(),p.radius=x.getCircularArcRadius(),k.showFirstEdge(p,R)):E===SNAP_CURVEDFACE&&k.showFirstFace(p,R),O=x.getSnapNode(),M&&M.showSelection1();else if(2===v){var i=null;if(A=x.getHighlightGeometry(),P=x.getIntersectPoint(),g=x.getGeometry(),A===SNAP_CIRCULARARC&&(g.center=x.getCircularArcCenter(),g.radius=x.getCircularArcRadius()),this.isIdenticalGeometries())return!1;if(E===SNAP_VERTEX&&A===SNAP_VERTEX?(k.showSecondVertex(g),k.drawLine(p,g),i=[p,g]):E===SNAP_EDGE&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.edgeToEdgeMeasure(g,p,P)):E===SNAP_FACE&&A===SNAP_FACE?(I=x.getFaceNormal(),k.showSecondFace(g,P),i=k.faceToFaceMeasure(R,V,P,I)):E===SNAP_VERTEX&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.pointToEdgeMeasure(p,g,P)):E===SNAP_EDGE&&A===SNAP_VERTEX?(k.showSecondVertex(g),i=k.edgeToPointMeasure(p,g)):E===SNAP_VERTEX&&A===SNAP_FACE?(I=x.getFaceNormal(),k.showSecondFace(g,P),i=k.pointToFaceMeasure(p,g,I,P)):E===SNAP_FACE&&A===SNAP_VERTEX?(k.showSecondVertex(g),i=k.faceToPointMeasure(p,V,R,g)):E===SNAP_EDGE&&A===SNAP_FACE?(I=x.getFaceNormal(),k.showSecondFace(g,P),i=k.edgeToFaceMeasure(p,R,g,I,P)):E===SNAP_FACE&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.faceToEdgeMeasure(p,V,R,g,P)):E===SNAP_CIRCULARARC&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),N.equals(D)?(g=k.nearestVertexInVertexToEdge(P,g),A=SNAP_VERTEX,k.showSecondVertex(g),k.drawLine(N,g),i=[N,g]):(k.showSecondEdge(g,P),k.drawLine(N,D),i=[N,D])):E===SNAP_CIRCULARARC&&A===SNAP_VERTEX?(k.showSecondVertex(g),k.drawLine(N,g),i=[N,g]):E===SNAP_VERTEX&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),k.showSecondEdge(g,P),k.drawLine(p,D),i=[p,D]):E===SNAP_CIRCULARARC&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.pointToEdgeMeasure(N,g,P)):E===SNAP_EDGE&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),k.showSecondEdge(g,P),i=k.edgeToPointMeasure(p,D)):E===SNAP_CIRCULARARC&&A===SNAP_FACE?(I=x.getFaceNormal(),k.showSecondFace(g,P),i=k.pointToFaceMeasure(N,g,I,P)):E===SNAP_FACE&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),k.showSecondEdge(g,P),i=k.faceToPointMeasure(p,V,R,D)):E===SNAP_CURVEDEDGE&&A===SNAP_VERTEX?(k.showSecondVertex(g),i=k.curvedEdgeToVertexMeasure(p,g)):E===SNAP_VERTEX&&A===SNAP_CURVEDEDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToVertexMeasure(g,p)):E===SNAP_CURVEDEDGE&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),k.showSecondEdge(g,P),i=k.curvedEdgeToVertexMeasure(p,D)):E===SNAP_CIRCULARARC&&A===SNAP_CURVEDEDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToVertexMeasure(g,N)):E===SNAP_CURVEDEDGE&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToEdgeMeasure(p,g)):E===SNAP_EDGE&&A===SNAP_CURVEDEDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToEdgeMeasure(g,p)):E===SNAP_CURVEDEDGE&&A===SNAP_CURVEDEDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToCurvedEdgeMeasure(p,g)):E!==SNAP_CURVEDEDGE||A!==SNAP_FACE&&A!==SNAP_CURVEDFACE?E!==SNAP_FACE&&E!==SNAP_CURVEDFACE||A!==SNAP_CURVEDEDGE?E===SNAP_CURVEDFACE&&A===SNAP_VERTEX?(k.showSecondVertex(g),i=k.curvedFaceToVertexMeasure(p,g)):E===SNAP_VERTEX&&A===SNAP_CURVEDFACE?(k.showSecondFace(g,P),i=k.curvedFaceToVertexMeasure(g,p)):E===SNAP_CURVEDFACE&&A===SNAP_CIRCULARARC?(D=x.getCircularArcCenter(),k.showSecondEdge(g,P),i=k.curvedFaceToVertexMeasure(p,D)):E===SNAP_CIRCULARARC&&A===SNAP_CURVEDFACE?(k.showSecondFace(g,P),i=k.curvedFaceToVertexMeasure(g,N)):E===SNAP_CURVEDFACE&&A===SNAP_EDGE?(k.showSecondEdge(g,P),i=k.curvedEdgeToFaceMeasure(g,p)):E===SNAP_EDGE&&A===SNAP_CURVEDFACE?(k.showSecondFace(g,P),i=k.curvedEdgeToFaceMeasure(p,g)):E!==SNAP_CURVEDFACE||A!==SNAP_FACE&&A!==SNAP_CURVEDFACE?E===SNAP_FACE&&A===SNAP_CURVEDFACE&&(k.showSecondFace(g,P),i=k.curvedFaceToFaceMeasure(p,g)):(k.showSecondFace(g,P),i=k.curvedFaceToFaceMeasure(p,g)):(k.showSecondEdge(g,P),i=k.curvedEdgeToFaceMeasure(g,p)):(k.showSecondFace(g,P),i=k.curvedEdgeToFaceMeasure(p,g)),f){if(void 0===i.length)C=i,M&&M.showAngleResult();else{var n=i[0].clone(),r=i[1].clone();c.model.is2d()&&c.model.pageToModel(n,r,H),b.xyz=n.distanceTo(r),b.x=Math.abs(n.x-r.x),b.y=Math.abs(n.y-r.y),b.z=Math.abs(n.z-r.z),M&&(E===SNAP_FACE&&A===SNAP_FACE?M.showDistanceResult(!0):M.showDistanceResult()),o()&&(U.updateDistance(b.xyz),U.showPanel(!0),U.showLabel(!0),U.clearSize())}M&&(M.showSelection2(),M.updatePanel()),k.updateDistance(),k.updateAngle(),_=x.getSnapNode(),B=x.getViewportIndex(),M&&M.isolateMeasure&&this.isolateMeasurement(),c.model.is2d()&&(e.impl.updateViewportId(0),x&&x.setFirstClickVpId(null))}k.updateLabelPositions()}return!0}if(2===v){var s=this.inverseProject(t.canvasX,t.canvasY);E===SNAP_VERTEX?k.drawLine(p,s):E===SNAP_EDGE?k.edgeToPointMeasure(p,s):E===SNAP_FACE?k.faceToPointMeasure(p,V,R,s):E===SNAP_CIRCULARARC?k.drawLine(N,s):E===SNAP_CURVEDEDGE?k.curvedEdgeToVertexMeasure(p,s):E===SNAP_CURVEDFACE&&k.curvedFaceToVertexMeasure(p,s)}return!1},this.inverseProject=function(e,t){var i=c.navigation.getCamera(),n=c.navigation.getScreenViewport(),o=new THREE.Vector3;return o.x=e/n.width*2-1,o.y=-(t/n.height*2-1),o.z=0,o=o.unproject(i)},this.handleButtonDown=function(e,t){return m=!0,0!==t||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(f=!0),!1},this.handleMouseMove=function(e){return f=!1,2===v&&(this.clearRubberBand(),this._handleMouseEvent(e)),!1},this.restoreMouseListeners=function(){c.toolController.getTool("gestures").controller.enableMouseButtons(!0)},this.handlePressHold=function(e){if(f=!1,av.isMobileDevice())switch(e.type){case"press":return G=!0,this.clearRubberBand(),this._handleMouseEvent(e),!0;case"pressup":return f=!0,this.restoreMouseListeners(),this.handleSingleClick(e),G=!1,!0}return!1},this.handleGesture=function(e){if(av.isMobileDevice()&&(f=!1,G))switch(this.clearRubberBand(),1==v&&(p=null,E=null,k.hideClick("first")),e.type){case"dragstart":case"dragmove":return this._handleMouseEvent(e),!0;case"dragend":return G=!1,f=!0,this.handleSingleClick(e),this.restoreMouseListeners(),!0;case"pinchstart":case"pinchmove":this._handleMouseEvent(e);break;case"pinchend":return f=!0,this.handleSingleClick(e),this.restoreMouseListeners(),!0}return!1},this.handleButtonUp=function(e,t){return m=!1,!1},this.handleSingleClick=function(e,t){return f&&(this._handleMouseEvent(e)||(this.clearMeasurement(),v=0),1!==v&&2!==v||(v=1===v?2:0),f=!1),!0},this.handleDoubleClick=function(e,t){return!0},this.handleWheelInput=function(e){return k.updateScale(),!1},this.handleSingleTap=function(e){return!0},this.handleDoubleTap=function(e){return!0},this.handleResize=function(){k&&k.updateLabelPositions()}},function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.Private,o=Autodesk.Viewing.UI,r=function(e,i,r,s,a){o.DockingPanel.call(this,i.container,r,s,a),this.kPanelExpandedHeight=310,this.kPanelCollapsedHeight=35,this.isDeltaExpanded=!0,this.isSettingsExpanded=!1,this.isolateMeasure=!1,this.measureTool=e,this.viewer=i,this.parentContainer=i.container,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="300px",this.container.style.width="300px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="200px",this.container.style.left="220px",this.container.style.position="absolute",this.addEventListener(this.closer,"click",function(e){a&&a.onCloseCallback&&a.onCloseCallback()}),this.container.children[0].classList.add("expanded"),(a=a||{}).heightAdjustment||(a.heightAdjustment=40),a.marginTop||(a.marginTop=0),a.left=!1,this.createScrollContainer(a),this.measureResults=document.createElement("div"),this.scrollContainer.appendChild(this.measureResults);var l=this;this.selection1=document.createElement("div"),this.selection1.className="measure-result-container",this.measureResults.appendChild(this.selection1);var c=document.createElement("div");c.className="measure-selectionOne-label",this.selection1.appendChild(c);var u=document.createElement("div");u.className="adsk-icon-first measure-label-icon",c.appendChild(u),this.selection1Result=document.createElement("div"),this.selection1Result.className="measure-selection-result",this.selection1.appendChild(this.selection1Result);var h=document.createElement("div");h.className="adsk-icon-refresh measure-repick",h.addEventListener("click",function(e){l.firstSelectionRepick()},!0),this.selection1.appendChild(h),this.addDivider(this.selection1),this.results=document.createElement("div"),this.results.className="measure-result-container",this.measureResults.appendChild(this.results),this.distIcon=document.createElement("div"),this.distIcon.className="adsk-icon-measure-distance measure-distance-icon",this.results.appendChild(this.distIcon),this.angleIcon=document.createElement("div"),this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon",this.results.appendChild(this.angleIcon),this.distanceDiv=document.createElement("div"),this.distanceDiv.className="measure-result",this.results.appendChild(this.distanceDiv),this.angleDiv=document.createElement("div"),this.angleDiv.className="measure-result",this.results.appendChild(this.angleDiv),this.initialDiv=document.createElement("div"),this.initialDiv.className="measure-initial",this.initialDiv.textContent="0.00",this.results.appendChild(this.initialDiv),this.settingsButton=document.createElement("div"),this.settingsButton.className="adsk-icon-settings measure-settings-button",this.settingsButton.addEventListener("click",function(e){l.showMeasureSettings()},!0),this.results.appendChild(this.settingsButton),this.deltaButton=document.createElement("div"),this.deltaButton.className="adsk-icon-arrow measure-delta-button",this.deltaButton.addEventListener("click",function(e){l.toggle()},!0),this.results.appendChild(this.deltaButton),this.deltaXDiv=document.createElement("div"),this.deltaXDiv.className="measure-delta-result",this.results.appendChild(this.deltaXDiv);var d=document.createElement("span");d.setAttribute("data-i18n","Delta"),d.textContent=t.i18n.translate("Delta"),this.deltaXDiv.appendChild(d);var p=document.createElement("span");p.className="measure-label-axis-x",p.textContent="X",this.deltaXDiv.appendChild(p);var g=document.createElement("span");this.deltaXDiv.appendChild(g),this.deltaYDiv=document.createElement("div"),this.deltaYDiv.className="measure-delta-result",this.results.appendChild(this.deltaYDiv);var m=document.createElement("span");m.setAttribute("data-i18n","Delta"),m.textContent=t.i18n.translate("Delta"),this.deltaYDiv.appendChild(m);var v=document.createElement("span");v.className="measure-label-axis-y",v.textContent="Y",this.deltaYDiv.appendChild(v);var f=document.createElement("span");this.deltaYDiv.appendChild(f),this.deltaZDiv=document.createElement("div"),this.deltaZDiv.className="measure-delta-result",this.results.appendChild(this.deltaZDiv);var E=document.createElement("span");E.setAttribute("data-i18n","Delta"),E.textContent=t.i18n.translate("Delta"),this.deltaZDiv.appendChild(E);var A=document.createElement("span");A.className="measure-label-axis-z",A.textContent="Z",this.deltaZDiv.appendChild(A);var y=document.createElement("span");this.deltaZDiv.appendChild(y),this.addDivider(this.results),this.selection2=document.createElement("div"),this.selection2.className="measure-result-container",this.measureResults.appendChild(this.selection2);var T=document.createElement("div");T.className="measure-selectionTwo-label",this.selection2.appendChild(T);var w=document.createElement("div");w.className="adsk-icon-second measure-label-icon",T.appendChild(w),this.selection2Result=document.createElement("div"),this.selection2Result.className="measure-selection-result",this.selection2.appendChild(this.selection2Result);var b=document.createElement("div");b.className="adsk-icon-refresh measure-repick",b.addEventListener("click",function(e){l.secondSelectionRepick()},!0),this.selection2.appendChild(b),this.addDivider(this.selection2),this.measureSettings=document.createElement("div"),this.measureSettings.className="measure-settings",this.measureSettings.style.display="none",this.measureResults.appendChild(this.measureSettings),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable measure-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.measureSettings.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var C=this.findUnits(),S=[],k=0;k<this.units.length;++k)S.push(this.units[k].name);this.unitList=new n.OptionDropDown("Unit type",this.tbody,S,C),this.addEventListener(this.unitList,"change",function(e){var t=l.unitList.selectedIndex,i=l.units[t].units;l.measureTool.setUnits(i),l.updatePanel(),l.setupPrecision(),n.logger.track({category:"pref_changed",name:"measure/units",value:i})}),this.precisionList=new n.OptionDropDown("Precision",this.tbody,[],-1),this.addEventListener(this.precisionList,"change",function(e){var t=l.precisionList.selectedIndex;l.measureTool.setPrecision(t),l.updatePanel(),n.logger.track({category:"pref_changed",name:"measure/precision",value:t})}),this.setupPrecision(),this.isolate=new n.OptionCheckbox("Isolate measurement",this.tbody,!1),this.addEventListener(this.isolate,"change",function(e){var t=l.isolate.checked;l.isolateMeasure=t,l.isolateMeasure?l.measureTool.isolateMeasurement():l.measureTool.clearIsolate(),n.logger.track({category:"pref_changed",name:"measure/isolate",value:t})}),this.addDivider(this.measureSettings);var M=document.createElement("div");M.className="measure-restart",M.setAttribute("data-i18n","Restart"),M.textContent=t.i18n.translate("Restart"),M.addEventListener("click",function(){l.measureTool.clearMeasurement()},!1),this.measureResults.appendChild(M),this.updatePanel(),this.addVisibilityListener(function(){l.resizeToContent({maxHeight:l.parentContainer.offsetHeight-75})}),this.hideMeasureResult()};r.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(r.prototype),r.prototype.addDropDownMenu=function(e,i,n,o,r){var s=function(e){var t=e.target.selectedIndex;r(t)},a=document.createElement("select");a.className="optionDropDown";for(var l=0;l<n.length;l++){var c=document.createElement("option");c.value=l,c.setAttribute("data-i18n",n[l]),c.textContent=t.i18n.translate(n[l]),a.add(c)}var u=document.createElement("div");u.className="measure-submenu-select";var h=document.createElement("div");return h.className="measure-submenu-selectlabel",h.setAttribute("for",i),h.setAttribute("data-i18n",i),h.textContent=t.i18n.translate(i),u.appendChild(h),u.appendChild(a),e.appendChild(u),a.selectedIndex=o,a.onchange=s,a},r.prototype.addDivider=function(e){var t=document.createElement("div");return t.className="measure-horizontal-divider",e.appendChild(t),t},r.prototype.findUnits=function(){var e,t,i=this.measureTool.getUnits();for(e=0;e<this.units.length;++e){var n=this.units[e].matches;if(n)for(t=0;t<n.length;++t)if(n[t]===i)return e}return 0},r.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);var e,t=this.measureTool.getUnits();e="ft-and-fractional-in"===t||"fractional-in"===t?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"];for(var i=0;i<e.length;++i){var n=document.createElement("option");n.value=i,n.textContent=e[i],this.precisionList.dropdownElement.appendChild(n)}var o=this.measureTool.getPrecision();e.length<=o&&(o=e.length-1,self.measureTool.setPrecision(o)),this.precisionList.dropdownElement.selectedIndex=o},r.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},r.prototype.onTitleClick=function(e){},r.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated"),this.measureTool.getIndicator().setSimple(this.isDeltaExpanded),this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),this.isDeltaExpanded=!0),this.resizeToContent()},r.prototype.toggle=function(){this.deltaCollapse()},r.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")},r.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}},r.prototype.updatePanel=function(){function e(e,i){"angle"===i?e.textContent="~ "+t.measureTool.getAngle():"xyz"===i?e.textContent="~ "+t.measureTool.getDistance(i):e.children[2].textContent=" = ~ "+t.measureTool.getDistance(i)}var t=this;e(this.distanceDiv,"xyz"),e(this.deltaXDiv,"x"),e(this.deltaYDiv,"y"),e(this.deltaZDiv,"z"),e(this.angleDiv,"angle"),this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.initialDiv.textContent=n.formatValueWithUnits(0,null,3,this.measureTool.getPrecision()),this.showSelection1(),this.showSelection2()},r.prototype.showDistanceResult=function(e){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="inline-block",this.distIcon.style.display="inline-block",e?(this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none")):(this.deltaButton.style.display="inline-block",this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"))),this.resizeToContent()},r.prototype.showAngleResult=function(){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="inline-block",this.angleIcon.style.display="inline-block",this.distanceDiv.style.display="none",this.distIcon.style.display="none",this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"),this.resizeToContent()},r.prototype.showSelection1=function(){var e=this.measureTool.getFirstGeometry();null!==e.type&&(e.type===SNAP_VERTEX?(this.selection1Result.setAttribute("data-i18n","Vertex"),this.selection1Result.textContent=t.i18n.translate("Vertex"),this.selection1Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection1Result.setAttribute("data-i18n","Edge"),this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection1Result.setAttribute("data-i18n","Face"),this.selection1Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection1Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"),this.selection1.style.display="block",this.resizeToContent())},r.prototype.showSelection2=function(){var e=this.measureTool.getSecondGeometry();null!==e.type&&(e.type===SNAP_VERTEX?(this.selection2Result.setAttribute("data-i18n","Vertex"),this.selection2Result.textContent=t.i18n.translate("Vertex"),this.selection2Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection2Result.setAttribute("data-i18n","Edge"),this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection2Result.setAttribute("data-i18n","Face"),this.selection2Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection2Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"),this.selection2.style.display="block",this.resizeToContent())},r.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick(),this.selection1Result.textContent=this.selection2Result.textContent,this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.hideMeasureResult=function(){this.clearSelectionOne(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.disableUnitOption=function(e){null!=e?(this.unitList.dropdownElement.children[e].style.display="none",t.isIE11&&(this.unitList.dropdownElement.children[e].disabled=!0,this.unitList.dropdownElement.children[e].style.visibility="hidden")):this.unitList.dropdownElement.disabled=!0},r.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0),this.resizeToContent()},r.prototype.clearSelectionOne=function(){this.selection1Result.setAttribute("data-i18n","Select Object"),this.selection1Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearSelectionTwo=function(){this.selection2Result.setAttribute("data-i18n","Select Object"),this.selection2Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearResult=function(){this.distIcon.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="none",this.angleDiv.style.display="none",this.initialDiv.style.display="inline-block",this.deltaButton.style.display="none",this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"},e.MeasurePanel=r}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.CalibrationTool=function(e,t,i,n){function o(e,t,i){var n=l.navigation.getCamera(),o=l.navigation.getScreenViewport(),r=new THREE.Vector3(e,t,i);return r=r.project(n),{x:Math.round((r.x+1)/2*o.width),y:Math.round((1-r.y)/2*o.height)}}function r(e,t,i){(e.classList.contains(t)&&!i||!e.classList.contains(t)&&i)&&e.classList.toggle(t,i)}function s(){S&&S.clearRect(0,0,S.canvas.width,S.canvas.height),M&&(r(M[1],"visible",!1),r(M[2],"visible",!1))}var a=this,l=e,c=t,u=i,h=n||{},d=["calibration"],p=!1,g=!1,m=null,v=null!=h.calibrationFactor,f=!1,E=n.maxPrecision||5,A=null,y=null,T=null,w=null,b=null,C=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,S=null,k=null,M=null,x=null,R=null,P="#FFD83C",V="#039BE5",I="#000",N=null;this.register=function(){function e(e){endpoint=M[e]=document.createElement("div"),endpoint.className="calibration-endpoint",l.container.appendChild(endpoint);var t=document.createElement("div");t.className="calibration-endpoint-text",t.textContent=e,endpoint.appendChild(t)}if(C&&!b&&(b=new Autodesk.Viewing.Extensions.Measure.CalibrationPanel(a,l,"calibration-panel","Calibration",h),l.addPanel(b)),!S){var t=document.createElement("canvas");l.container.appendChild(t);l.navigation.getScreenViewport();t.width=l.container.clientWidth,t.height=l.container.clientHeight,t.className="calibration-line",(S=t.getContext("2d")).strokeStyle=P,S.lineWidth=3}if(!k){(k=document.createElement("div")).className="calibration-label",r(k,"visible",!1),l.container.appendChild(k);var i=document.createElement("div");i.className="calibration-label-text",k.appendChild(i)}M||(M={},e("1"),e("2"))},this.deregister=function(){this.deactivate(),b&&(l.removePanel(b),b.uninitialize())},this.isActive=function(){return p},this.getNames=function(){return d},this.getName=function(){return d[0]},this.getCursor=function(){return g?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAYCAYAAAD+vg1LAAAAAXNSR0IArs4c6QAAAwZJREFUSA2tVEtLW0EUvjGJefoqSY0x0WBSiY+oNWiUINkU6ioLaaAlG1eudNVFoT+grgopiCkEIbUK1o0lusmurRSEWmmKG6MNtNhNosWqyU2CZPpN8cr15nFD7YHDzHnON2fOGYZhmHkw4XEW+wD4xkT4lMvl6CE0+Y2ohh+dz+cZn89HVS/5+n/d/wVMkXq9Xor2v5SBgsmymQwZHx+vOqlKpXKDXWI3eU6Tg+kqSjSh3W4/s9lsvzUajaNcAK3xY7Dyci3nd6WXSCS60dHRvMfjSRcKBfWV4SYbrVarB8p0PB5nY7HYmdVq/aDX67WlckpKKcvpOjs7X09OTvoPDw8z2Wy2Bu+imJqa+npycnJXGHOt3YRGoSyVSvvMZrNkYWFBs7GxkaoBAXFJcDJhcCW5rq5ur62trQ/EOhyOBhDT2Nj4qVKMqA31ve1yub7Rfufo/PycDA4OxpuamhqECaouhVqtfuD3+1tqa2uZQCCQDoVCWTwknVQDDvIKE1clI1ja09Ozg0cjx8fHpL+/P+50OhMU8f7+Punt7f2I5NdqXRXi9fV1z9jYWCuIWV5eziSTyWAqlXq1urqaw6AwOMiCG4lOYtEturu732xubhK0FQHSvfr6+lsog4HWPIPvIBqNErRiqCiwkkKpVFowZd8xZSQYDLImk+kJ52+xWJ4tLS3hU8yTkZGRBD2Ms4mu6Nun4XA4f3p6SoaGhuJ0+rgg/Bsmt9udYFmWzM3NZdDT05ztWsE5JV0R1AqUCfTt0fb2tjESiRRmZmaOUOcI3w9DY5mdnb03PDzMoDQ/MZFRzM20lO/E38vl8vt46UdAq0WNJWixlEwmu8B1bXioOxwjpgXJ0hMTE1og1qysrDghf+HnKtoD7c7u7i5ZXFzMGY3GF7iFuRR3dHTMr62tXWxtbZH29vZ3RYmECozu54ODAzpdP2hphHZOVigUVjChvgMDA+85fdm1q6vrrU6n+4WR9Zd1ujQ0Nzc/NBgMScSExXwZ2j5oL5Wo46UD/ZvxUemo+AdW1zJzUYr16wAAAABJRU5ErkJggg==), auto"},this.activate=function(){p=!0,f&&T&&w?(x=T,R=w,this.updatePanelPosition(x,R),this.showPanel(!0),this.updateLabelSize(A,y,c.getPrecision()),this.showLabel(!0,!1),this.drawCalibrationLine()):(x=null,R=null),c.enableCalibrate(!0),l.toolController.activateTool("measure"),this.onCameraChangeBinded=this.onCameraChange.bind(this),l.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.deactivate=function(){p=!1,s(),this.showLabel(!1,!1),this.showPanel(!1),c&&c.isActive()&&(c.enableCalibrate(!1),l.toolController.deactivateTool("measure")),l.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.updateDistance=function(e){m=e},this.updatePanelPosition=function(e,t){function i(e,t,i,n){var r=o((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),s=e.x-t.x,a=e.y-t.y,l=null;return(l=n?e.x>t.x?new THREE.Vector2(-a,s).normalize():new THREE.Vector2(a,-s).normalize():e.x<=t.x?new THREE.Vector2(-a,s).normalize():new THREE.Vector2(a,-s).normalize()).multiplyScalar(i),{x:Math.floor(r.x+l.x),y:Math.floor(r.y-l.y)}}function n(e,t,i,n){return e<0||e+i>l.canvas.clientWidth||t<0||t+n>l.canvas.clientHeight}if(b){var r=parseInt(b.container.style.width),s=parseInt(b.container.style.height),a=Math.sqrt(Math.pow(r,2)+Math.pow(s,2))/2,c=i(e,t,a,!0),u=c.x-Math.floor(r/2),h=c.y-Math.floor(s/2);n(u,h,r,s)&&(u=(c=i(e,t,a,!1)).x-Math.floor(r/2),h=c.y-Math.floor(s/2)),n(u,h,r,s)&&(u=l.canvas.clientWidth/2-r/2,h=l.canvas.clientHeight/2-s/2),b.container.style.left=u+"px",b.container.style.top=h+"px"}},this.calibrate=function(e,t){var i=null;return isNaN(t)||(currentSize=Autodesk.Viewing.Private.convertUnits(l.model.getUnitString(),e,1,m),i=t/currentSize,c.setCalibrationFactor(i),c.setUnits(e),c.setPrecision(function(e){return Math.floor(e)===e?0:e.toString().split(".")[1].length||0}(t)),v=!0,A=t,y=e,T=x,w=R),i},this.getCurrentUnits=function(){return c.getUnits()},this.showPanel=function(e){function t(){"Escape"==event.key&&i.isActive()&&f&&(i.showPanel(!1),i.showAddCalibrationLabel(),window.removeEventListener("keyup",arguments.callee))}var i=this;e?b&&(this.clearSize(),b.updatePanel(A,y),window.setTimeout(function(){b.requestedSizeTextbox.focus()},0),b.setVisible(!0),window.addEventListener("keyup",t)):b&&b.setVisible(!1)},this.showLabel=function(e,t){k&&(k.childNodes[0].style.pointerEvents=t?"all":"none",k.classList.visible!=e&&r(k,"visible",e),this.updateLabelPosition())},this.handleButtonDown=function(e,t){return g=!0,!1},this.handleButtonUp=function(e,t){return g=!1,!1},this.isCalibrated=function(){return v},this.updateLabelSize=function(e,t,i){if(""==e)this.updateLabelText(null);else{var n=Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(e),t,3,i);this.updateLabelText(n)}},this.updateLabelText=function(e){e&&""!=e?(k.childNodes[0].setAttribute("data-i18n",e),k.childNodes[0].textContent=av.i18n.translate(e),r(k,"visible",!0),this.updateLabelPosition()):r(k,"visible",!1)},this.updateLabelPosition=function(){if(f&&k&&x&&R){var e=o((x.x+R.x)/2,(x.y+R.y)/2,(x.z+R.z)/2),t=x.x-R.x,i=x.y-R.y,n=null,r=null;if(x.x<R.x?(n=180*Math.atan2(-i,-t)/Math.PI,r=new THREE.Vector2(-i,t).normalize()):(n=180*Math.atan2(i,t)/Math.PI,r=new THREE.Vector2(i,-t).normalize()),r.multiplyScalar(8),k.style.top=e.y-r.y+"px",k.style.left=e.x-Math.floor(k.clientWidth/2)+2*r.x+"px",l.model.is2d()){var s=l.navigation.getCameraUpVector(),a=180*new THREE.Vector3(0,1,0).angleTo(s)/Math.PI;n=-(n+(a=s.x>=0?a:-a)),Math.abs(n)>90&&(n+=180),k.style.transform="rotate("+n+"deg)"}}},this.updateCalibrationLine=function(e,t,i,n,o,r,a,l,c,u){if(l&&!c)return f=!1,x=null,R=null,void s();x=new THREE.Vector3(e,t,i),R=new THREE.Vector3(n,o,r),l?(f=!0,S.setLineDash([]),this.updatePanelPosition(x,R),this.updateLabelPosition(x,R)):(f=!1,S.setLineDash([10,3])),N=u,this.drawCalibrationLine()},this.drawCalibrationLine=function(){function e(e,t,i){if("2"!=e||f){var n=M[e];r(n,"visible",!0),n.style.left=t-parseInt(n.clientWidth)/2+"px",n.style.top=i-parseInt(n.clientHeight)/2+"px"}else r(M[2],"visible",!1)}function t(t,i,n,o){S.save(),S.setLineDash([]),u.isSnapped()&&!f?(S.strokeStyle=V,S.lineWidth=2):(S.strokeStyle=I,S.lineWidth=1),S.beginPath();var r=i.clone();r.multiplyScalar(25),S.moveTo(n.x+r.x,n.y+r.y),S.lineTo(n.x-r.x,n.y-r.y),S.stroke(),S.strokeStyle=I,S.lineWidth=1,r=t.clone(),S.beginPath(),r.multiplyScalar(25),S.moveTo(n.x,n.y),S.lineTo(n.x-r.x,n.y-r.y),S.stroke(),e(o,n.x-r.x,n.y-r.y),S.lineWidth=2,S.strokeStyle=P,S.beginPath(),(r=i.clone()).multiplyScalar(15),S.moveTo(n.x+r.x,n.y+r.y),S.lineTo(n.x-r.x,n.y-r.y),S.stroke();var s=Math.PI/8,a=r.x*Math.cos(s)-r.y*Math.sin(s)+n.x,l=r.x*Math.sin(s)+r.y*Math.cos(s)+n.y,c=-r.x*Math.cos(s)+r.y*Math.sin(s)+n.x,h=-r.x*Math.sin(s)-r.y*Math.cos(s)+n.y;S.beginPath(),S.moveTo(a,l),S.lineTo(c,h),S.stroke(),S.restore()}if(S&&x&&R){s();var i=o(x.x,x.y,x.z),n=o(R.x,R.y,R.z);i.x!=n.x&&i.y!=n.y||f?S.strokeStyle=P:S.strokeStyle=V,S.beginPath(),S.moveTo(i.x,i.y),S.lineTo(n.x,n.y),S.stroke();var a=new THREE.Vector2(n.x-i.x,n.y-i.y).normalize(),l=new THREE.Vector2(i.x-n.x,i.y-n.y).normalize(),c=new THREE.Vector2(i.y-n.y,n.x-i.x).normalize(),h=new THREE.Vector2(n.y-i.y,i.x-n.x).normalize();N==SNAP_VERTEX?(t(a,c,i,"1"),t(l,h,n,"2")):(t(a,c,i,"2"),t(l,h,n,"1"))}},this.clearSize=function(){this.updateLabelText(""),b&&(b.requestedSizeTextbox.value="")},this.showAddCalibrationLabel=function(){var e=this;this.updateLabelText("Add Calibration"),this.showLabel(!0,!0),k.addEventListener("click",function(){k.childNodes[0].style.pointerEvents="none",e.updatePanelPosition(x,R),e.showPanel(!0),e.clearSize(),k.removeEventListener("click",arguments.callee)})},this.onCameraChange=function(){this.drawCalibrationLine(),this.updateLabelPosition()},this.getMaxPrecision=function(){return E}},function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.Private,o=Autodesk.Viewing.UI,r=function(e,i,r,l,c){var u=this;o.DockingPanel.call(this,i.container,r,l,c),this.viewer=i,this.calibrationTool=e,this.parentContainer=i.container,this.container.style.width="270px",this.container.style.height="165px",this.container.classList.add("calibration-panel"),this.addEventListener(this.closer,"click",function(e){u.setVisible(!1),u.calibrationTool.showAddCalibrationLabel()}),(c=c||{}).heightAdjustment||(c.heightAdjustment=40),c.marginTop||(c.marginTop=0),c.left=!1,this.createScrollContainer(c),this.calibrationMenu=document.createElement("div"),this.scrollContainer.appendChild(this.calibrationMenu),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable calibration-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.calibrationMenu.appendChild(this.table),this.row=this.tbody.insertRow(0),this.requestedSizeTextbox=document.createElement("input"),this.requestedSizeTextbox.className="calibration-textbox",this.requestedSizeTextbox.type="text",this.requestedSizeTextbox.autofocus="true",this.addEventListener(this.requestedSizeTextbox,"keyup",function(e){var t=u.requestedSizeTextbox.value;""!==t&&""===t.split(".")[0]&&(u.requestedSizeTextbox.value="0"+t),u.updateLabel()}),this.addEventListener(this.requestedSizeTextbox,"keypress",function(e){if("Backspace"!=e.key&&"ArrowLeft"!=e.key&&"ArrowRight"!=e.key){var t=u.requestedSizeTextbox.value,i=u.requestedSizeTextbox.selectionStart;"."!=(t=[t.slice(0,i),e.key,t.slice(i)].join(""))&&(!a(t)||s(t)>u.calibrationTool.getMaxPrecision())&&e.preventDefault()}});var h=this.row.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Define Size"),this.caption.textContent=t.i18n.translate("Define Size"),h.appendChild(this.caption),(h=this.row.insertCell(1)).style.paddingLeft="5px",h.style.paddingRight="5px",h.appendChild(this.requestedSizeTextbox),this.units=[{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var d=[],p=0;p<this.units.length;++p)d.push(this.units[p].name);this.unitList=new n.OptionDropDown("Unit type",this.tbody,d,0),this.addEventListener(this.unitList,"change",function(e){u.updateLabel()});var g=document.createElement("div");g.className="calibration-button",g.setAttribute("data-i18n","Set Calibration"),g.textContent=t.i18n.translate("Set Calibration"),g.style.width="225px",g.addEventListener("click",function(){var e=u.unitList.selectedIndex,t=u.units[e].units,i=parseFloat(u.requestedSizeTextbox.value);u.calibrationTool.calibrate(t,i)&&(u.calibrationTool.deactivate(),u.viewer.fireEvent({type:"finished-calibration"}))},!1),this.calibrationMenu.appendChild(g)},s=function(e){var t=e.split(".")[1];return t?t.length:0},a=function(e){return!isNaN(parseFloat(e))&&!isNaN(+e)&&parseFloat(e)>=0};r.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(r.prototype),r.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},r.prototype.findUnits=function(){var e,t,i=this.calibrationTool.getCurrentUnits();for(e=0;e<this.units.length;++e){var n=this.units[e].matches;if(n)for(t=0;t<n.length;++t)if(n[t]===i)return e}return 0},r.prototype.updatePanel=function(e,t){this.unitList.setSelectedIndex(this.findUnits()),this.requestedSizeTextbox.value=e},r.prototype.updateLabel=function(){var e=this.unitList.selectedIndex,t=this.units[e].units,i=this.requestedSizeTextbox.value;this.calibrationTool.updateLabelSize(i,t,s(i))};var l=function(e,i,n,r,s){var a=this;o.DockingPanel.call(this,i.container,n,r,s),this.viewer=i,this.measureExt=e,this.parentContainer=i.container,this.container.classList.add("calibration-panel"),this.container.style.width="380px",this.container.style.height="190px",this.container.style.left=(this.viewer.canvas.clientWidth-parseInt(this.container.style.width))/2+"px",this.container.style.top=(this.viewer.canvas.clientHeight-parseInt(this.container.style.height))/2+"px",(s=s||{}).heightAdjustment||(s.heightAdjustment=40),s.marginTop||(s.marginTop=0),s.left=!1,this.createScrollContainer(s),this.dialogBox=document.createElement("div"),this.scrollContainer.appendChild(this.dialogBox);var l=document.createElement("div");l.className="calibration-text";var c="Before using the ruler, the scale for this sheet needs to be set and calibrated.";l.setAttribute("data-i18n",c),l.textContent=t.i18n.translate(c),this.dialogBox.appendChild(l);var u=document.createElement("div");u.className="calibration-button",u.setAttribute("data-i18n","Calibrate Now"),u.textContent=t.i18n.translate("Calibrate Now"),u.style.float="right",u.addEventListener("click",function(){a.measureExt.enableCalibrationTool(!0),a.setVisible(!1)},!1),this.dialogBox.appendChild(u);var h=document.createElement("div");h.className="calibration-button",h.setAttribute("data-i18n","Cancel"),h.textContent=t.i18n.translate("Cancel"),h.style.float="right",h.addEventListener("click",function(){a.setVisible(!1)},!1),this.dialogBox.appendChild(h)};l.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(l.prototype),l.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},e.CalibrationPanel=r,e.CalibrationRequiredDialog=l}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5,SNAP_PRECISION=.001,NO_OVERLAY=0,FACE_OVERLAY=1,EDGE_OVERLAY=2,POINT_OVERLAY=3;Autodesk.Viewing.Extensions.Measure.Snapper=function(e,t){function i(e,t){this.viewer=e,this.snapper=t,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=this.snapper.getDetectRadius()}function n(){return I=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}var o=e,r=t||{},s=r.markupMode?["snapper-markup"]:["snapper"],a=!1,l="MeasureTool-snapper",c=NO_OVERLAY,u=null,h=Number.MAX_VALUE,d=null,p=null,g=null,m=null,v=null,f=null,E=null,A=null,y=!1,T=!1,w=!1,b=null,C=null,S=null,k=null,M=null,x=null,R=null,P=!1;this.markupMode=r.markupMode,this.isActive=function(){return a},this.getNames=function(){return s},this.getName=function(){return s[0]},this.activate=function(){a=!0},this.deactivate=function(){a=!1,this.destroy()},this.getFace=function(){return p},this.getEdge=function(){return g},this.getVertex=function(){return m},this.getGeometry=function(){switch(f){case SNAP_VERTEX:return this.getVertex();case SNAP_EDGE:return this.getEdge();case SNAP_FACE:return this.getFace();case SNAP_CIRCULARARC:case SNAP_CURVEDEDGE:return this.getEdge();case SNAP_CURVEDFACE:return this.getFace()}},this.getSnapNode=function(){return v},this.getHighlightGeometry=function(){return f},this.getIntersectPoint=function(){return E},this.getFaceNormal=function(){return A},this.enableCalibrate=function(e){P=e},this.getEndPointsInEdge=function(e){for(var t=e.vertices,i=[],n=0;n<t.length;++n){for(var o=!1,r=0;r<t.length;++r)if(r!==n&&t[r].equals(t[n])){o=!0;break}o||i.push(t[n])}return i},this.getViewportIndex=function(){return b},this.getCircularArcCenter=function(){return C},this.getCircularArcRadius=function(){return S},this.getDetectRadius=function(){return u},this.isSnapped=function(){return w},this.clearSnapped=function(){p=null,g=null,m=null,f=null,w=!1},this.setClip=function(e){k=e},this.setFirstClickVpId=function(e){M=e},this.isEqualWithPrecision=function(e,t){return Math.abs(e-t)<=SNAP_PRECISION},this.isEqualVectorsWithPrecision=function(e,t){return Math.abs(e.x-t.x)<=SNAP_PRECISION&&Math.abs(e.y-t.y)<=SNAP_PRECISION&&Math.abs(e.z-t.z)<=SNAP_PRECISION},this.isInverseVectorsWithPrecision=function(e,t){return Math.abs(e.x+t.x)<=SNAP_PRECISION&&Math.abs(e.y+t.y)<=SNAP_PRECISION&&Math.abs(e.z+t.z)<=SNAP_PRECISION},this.snapping3D=function(e){v=e.dbId;var t=e.face;E=e.intersectPoint;var i;if(i=void 0===e.fragId.length?[e.fragId]:e.fragId,o.model.hasTopology()){v&&(i=[],o.model.getData().instanceTree.enumNodeFragments(v,function(e){i.push(e)},!0)),p=g=m=null,h=Number.MAX_VALUE;for(b=0;b<i.length;++b){var n=i[b],s=(k=o.impl.getRenderProxy(o.model,n)).geometry,a=o.model.getTopoIndex(n),l=o.model.getTopology(a),c=l.faces,y=l.edges;l.vertices;if(!p){(p=this.faceSnappingWithTopology(t,s,c,k))&&(p.fragId=n);M=(new THREE.Matrix3).getNormalMatrix(k.matrixWorld);A=t.normal.applyMatrix3(M).normalize()}this.edgeSnappingWithTopology(E,s,y,k)}if(m=this.vertexSnappingWithTopology(g,E),p){if(u=this.setDetectRadius(E),d<u)this.drawPoint(m),f=SNAP_VERTEX;else if(h<u){this.drawLine(g);var T=this.edgeIsCircle(g);T?(C=T,S=T.distanceTo(g.vertices[0]),f=SNAP_CIRCULARARC):f=this.edgeIsCurved(g)?SNAP_CURVEDEDGE:SNAP_EDGE}else this.drawFace(p),f=this.faceIsCurved(p)?SNAP_CURVEDFACE:SNAP_FACE;w=!0}}else for(var b=0;b<i.length;++b){var n=i[b],k=o.impl.getRenderProxy(o.model,n),s=k.geometry;if(p=this.faceSnapping(t,s)){p.applyMatrix(k.matrixWorld),g=this.edgeSnapping(p,E),m=this.vertexSnapping(g,E);var M=(new THREE.Matrix3).getNormalMatrix(k.matrixWorld);A=t.normal.applyMatrix3(M).normalize(),u=this.setDetectRadius(E),r.forceSnapVertices||d<u?(this.drawPoint(m),f=SNAP_VERTEX):r.forceSnapEdges||P||h<u?(this.drawLine(g),f=SNAP_EDGE):(this.drawFace(p),f=SNAP_FACE),w=!0;break}}},this.faceSnappingWithTopology=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Geometry,l=t.attributes;if(void 0!==l.index){for(var c=t.vb?t.vb:l.position.array,u=t.vb?t.vbstride:3,h=0;h<i.length;h++){for(var d=i[h].indexList,p=i[h].id,g=0;g<d.length;g+=3)if(e.a===d[g]){if(e.b===d[g+1]&&e.c===d[g+2]||e.b===d[g+2]&&e.c===d[g+1])break}else if(e.a===d[g+1]){if(e.b===d[g]&&e.c===d[g+2]||e.b===d[g+2]&&e.c===d[g])break}else if(e.a===d[g+2]&&(e.b===d[g]&&e.c===d[g+1]||e.b===d[g+1]&&e.c===d[g]))break;if(g<d.length)break}if(h<i.length)for(g=0;g<d.length;g+=3){o.set(c[d[g]*u],c[d[g]*u+1],c[d[g]*u+2]),r.set(c[d[g+1]*u],c[d[g+1]*u+1],c[d[g+1]*u+2]),s.set(c[d[g+2]*u],c[d[g+2]*u+1],c[d[g+2]*u+2]);var m=a.vertices.length;a.vertices.push(o.clone()),a.vertices.push(r.clone()),a.vertices.push(s.clone()),a.faces.push(new THREE.Face3(m,m+1,m+2))}}return a.vertices.length>0?(a.faceId=p,a.applyMatrix(n.matrixWorld),a):null},this.faceSnapping=function(e,t){var i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Geometry,s=t.attributes;if(void 0!==s.index){var a=s.index.array||t.ib,l=t.vb?t.vb:s.position.array,c=t.vb?t.vbstride:3,u=t.offsets;u&&0!==u.length||(u=[{start:0,count:a.length,index:0}]);for(var h=0;h<u.length;++h)for(var d=u[h].start,p=u[h].count,g=u[h].index,m=d;m<d+p;m+=3){var v=g+a[m],f=g+a[m+1],E=g+a[m+2];i.set(l[v*c],l[v*c+1],l[v*c+2]),n.set(l[f*c],l[f*c+1],l[f*c+2]),o.set(l[E*c],l[E*c+1],l[E*c+2]);var A=THREE.Triangle.normal(i,n,o),y=new THREE.Vector3;if(y.set(l[e.a*c],l[e.a*c+1],l[e.a*c+2]),this.isEqualVectorsWithPrecision(A,e.normal)&&this.isEqualWithPrecision(A.dot(i),e.normal.dot(y))){var T=r.vertices.length;r.vertices.push(i.clone()),r.vertices.push(n.clone()),r.vertices.push(o.clone()),r.faces.push(new THREE.Face3(T,T+1,T+2))}}}return r.vertices.length>0?this.getTrianglesOnSameFace(r,e,l,c):null},this.getTrianglesOnSameFace=function(e,t,i,n){var o=!1,r=e.vertices.slice(),s=new THREE.Vector3;s.set(i[t.a*n],i[t.a*n+1],i[t.a*n+2]);var a=new THREE.Vector3;a.set(i[t.b*n],i[t.b*n+1],i[t.b*n+2]);var l=new THREE.Vector3;l.set(i[t.c*n],i[t.c*n+1],i[t.c*n+2]);var c=new THREE.Geometry;c.vertices.push(s),c.vertices.push(a),c.vertices.push(l),c.faces.push(new THREE.Face3(0,1,2));var u=[];do{u=[];for(var h=0;h<r.length;h+=3)if(r[h].equals(s)&&r[h+1].equals(a)&&r[h+2].equals(l))o=!0,u.push(h);else for(var d=0;d<c.vertices.length;d+=3)if(this.trianglesSharedEdge(r[h],r[h+1],r[h+2],c.vertices[d],c.vertices[d+1],c.vertices[d+2])){var p=c.vertices.length;c.vertices.push(r[h].clone()),c.vertices.push(r[h+1].clone()),c.vertices.push(r[h+2].clone()),c.faces.push(new THREE.Face3(p,p+1,p+2)),u.push(h);break}for(var g=u.length-1;g>=0;--g)r.splice(u[g],3)}while(u.length>0);return o?c:null},this.trianglesSharedEdge=function(e,t,i,n,o,r){var s=!1,a=!1,l=!1;return(e.equals(n)||e.equals(o)||e.equals(r))&&(s=!0),(t.equals(n)||t.equals(o)||t.equals(r))&&(a=!0),(i.equals(n)||i.equals(o)||i.equals(r))&&(l=!0),!!(s&a||s&l||a&l)},this.edgeSnappingWithTopology=function(e,t,i,n){var o,r=new THREE.Geometry,s=Number.MAX_VALUE,a=new THREE.Vector3,l=new THREE.Vector3,c=t.attributes;if(void 0!==c.index&&void 0!=i){for(var u=t.vb?t.vb:c.position.array,d=t.vb?t.vbstride:3,p=0;p<i.length;p++)for(var m=i[p].indexList,v=0;v<m.length-1;v++){a.set(u[m[v]*d],u[m[v]*d+1],u[m[v]*d+2]),l.set(u[m[v+1]*d],u[m[v+1]*d+1],u[m[v+1]*d+2]),a.applyMatrix4(n.matrixWorld),l.applyMatrix4(n.matrixWorld);var f=this.distancePointToLine(e,a,l);f<s&&(s=f,o=p)}if(o){m=i[o].indexList;for(var E=0;E<m.length-1;E++)r.vertices.push(new THREE.Vector3(u[m[E]*d],u[m[E]*d+1],u[m[E]*d+2])),r.vertices.push(new THREE.Vector3(u[m[E+1]*d],u[m[E+1]*d+1],u[m[E+1]*d+2]))}}h>=s&&r.vertices.length>0&&(h=s,r.applyMatrix(n.matrixWorld),g=r)},this.edgeSnapping=function(e,t){for(var i=new THREE.Geometry,n=!0,o=!0,r=!0,s=0;s<e.vertices.length;s+=3){for(var a=0;a<e.vertices.length;a+=3)s!==a&&((e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(n=!1),(e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(o=!1),(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(r=!1));n&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+1].clone())),o&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+2].clone())),r&&(i.vertices.push(e.vertices[s+1].clone()),i.vertices.push(e.vertices[s+2].clone())),n=!0,o=!0,r=!0}for(var l,c=new THREE.Geometry,u=Number.MAX_VALUE,d=0;d<i.vertices.length;d+=2){var p=this.distancePointToLine(t,i.vertices[d],i.vertices[d+1]);p<u&&(u=p,l=d)}return c.vertices.push(i.vertices[l].clone()),c.vertices.push(i.vertices[l+1].clone()),c.vertices=this.getConnectedLineSegmentsOnSameLine(i,c.vertices),h=u,c},this.distancePointToLine=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=e.distanceTo(t):o>1?n=e.distanceTo(i):(r.subVectors(e,t),s.subVectors(e,i),r.cross(s),s.subVectors(i,t),n=Math.sqrt(r.dot(r))/Math.sqrt(s.dot(s))),n},this.getConnectedLineSegmentsOnSameLine=function(e,t){var i=e.vertices.slice(),n=t[0],o=t[1],r=[];do{r=[];for(var s=0;s<i.length;s+=2)if(!i[s].equals(n)||!i[s+1].equals(o))for(var a=0;a<t.length;a+=2)if(i[s].equals(t[a])||i[s+1].equals(t[a])||i[s].equals(t[a+1])||i[s+1].equals(t[a+1])){var l=new THREE.Vector3,c=new THREE.Vector3;if(l.subVectors(t[a],t[a+1]),l.normalize(),c.subVectors(i[s],i[s+1]),c.normalize(),this.isEqualVectorsWithPrecision(l,c)||this.isInverseVectorsWithPrecision(l,c)){r.push(s);break}}for(var u=r.length-1;u>=0;--u)t.push(i[r[u]]),t.push(i[r[u]+1]),i.splice(r[u],2)}while(r.length>0);return t},this.vertexSnappingWithTopology=function(e,t){var i=Number.MAX_VALUE,n=new THREE.Vector3;if(e&&e.vertices.length>1){var o=t.distanceTo(e.vertices[0]),r=t.distanceTo(e.vertices[e.vertices.length-1]);o<=r?(i=o,n=e.vertices[0].clone()):(i=r,n=e.vertices[e.vertices.length-1].clone())}return d=i,n},this.vertexSnapping=function(e,t){for(var i=Number.MAX_VALUE,n=new THREE.Vector3,o=0;o<e.vertices.length;++o){var r=t.distanceTo(e.vertices[o]);r<i-SNAP_PRECISION&&(i=r,n=e.vertices[o].clone())}return d=i,n},this.edgeIsCircle=function(e){var t=e.vertices;if(t.length<8)return!1;if(t[0].equals(t[t.length-1])){for(var i=new THREE.Vector3(0,0,0),n=0;n<t.length;n+=2)i.add(t[n]);i.divideScalar(t.length/2);for(var o=i.distanceTo(t[0]),n=0;n<t.length;n+=2)if(!(Math.abs(i.distanceTo(t[n])-o)<=SNAP_PRECISION))return!1;return i}return!1},this.edgeIsCurved=function(e){var t=e.vertices;if(t.length<=2)return!1;if(t[0].equals(t[t.length-1]))return!0;var i=new THREE.Vector3;i.subVectors(t[0],t[1]);for(var n=new THREE.Vector3,o=2;o<t.length;o+=2)if(n.subVectors(t[o],t[o+1]),!this.isEqualVectorsWithPrecision(i,n))return!0;return!1},this.faceIsCurved=function(e){var t=e.vertices,i=e.faces;if(i.length<=1)return!1;for(var n=THREE.Triangle.normal(t[i[0].a],t[i[0].b],t[i[0].c]),o=t[i[0].a],r=1;r<i.length;r++){var s=THREE.Triangle.normal(t[i[r].a],t[i[r].b],t[i[r].c]),a=t[i[r].a];if(!this.isEqualVectorsWithPrecision(n,s)||!this.isEqualWithPrecision(n.dot(o),s.dot(a)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0?Math.atan(e.y/e.x)+Math.PI:e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null},i.prototype.onLineSegment=function(e,t,i,n,o){var r=this.snapper.getIntersectPoint(),s=this.lineGeom.vertices,a=new THREE.Vector3(e,t,r.z),l=new THREE.Vector3(i,n,r.z),c=this.snapper.distancePointToLine(r,a,l);c<=this.detectRadius&&c<this.minDist&&(s.splice(0,2,a,l),this.minDist=c,this.vpIdLine=o)},i.prototype.onCircularArc=function(e,t,i,n,o,r){var s=this.snapper.getIntersectPoint(),a=new THREE.Vector2(s.x,s.y),l=new THREE.Vector2(e,t),c=a.distanceTo(l);a.sub(l);var u=this.snapper.angleVector2(a);if(Math.abs(c-o)<=this.detectRadius){if(n>i&&u>=i&&u<=n)h=new THREE.CircleGeometry(o,100,i,n-i);else{if(!(n<i&&(u>=i||u<=n)))return;var h=new THREE.CircleGeometry(o,100,i,2*Math.PI-i+n)}h.vertices.splice(0,1),h.applyMatrix((new THREE.Matrix4).makeTranslation(e,t,s.z)),this.circularArc=h,this.circularArcCenter=new THREE.Vector3(e,t,s.z),this.circularArcRadius=o,this.vpIdCircular=r}},i.prototype.onEllipticalArc=function(e,t,i,n,o,r,s,a){var l=this.snapper.getIntersectPoint(),c=new THREE.Vector2(l.x,l.y),u=o-this.detectRadius,h=r-this.detectRadius,d=o+this.detectRadius,p=r+this.detectRadius,g=(c.x-e)*(c.x-e)/(u*u)+(c.y-t)*(c.y-t)/(h*h),m=(c.x-e)*(c.x-e)/(d*d)+(c.y-t)*(c.y-t)/(p*p),v=new THREE.Vector2(e,t);c.sub(v),c.x*=r,c.y*=o;var f=this.snapper.angleVector2(c);if(n>2*Math.PI&&(n=2*Math.PI),g>=1&&m<=1&&(n>i&&f>=i&&f<=n||n<i&&(f>=i||f<=n))){var E=new THREE.EllipseCurve(e,t,o,r,i,n,!1),A=new THREE.Path(E.getPoints(50)).createPointsGeometry(50);this.snapper.isEqualWithPrecision(n-i,2*Math.PI)||A.vertices.pop(),A.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,l.z)),this.ellipticalArc=A,this.ellipticalArcCenter=new THREE.Vector3(e,t,l.z),this.vpIdElliptical=a}};var V=function(e,t){var i=4*window.devicePixelRatio,n=!x||!R||Math.abs(x-e)<i&&Math.abs(R-t)<i;return x=e,R=t,n};this.snapping2D=function(e){if(e){var t=e.intersectPoint,n=e.fragId;if(void 0!==n){if(Array.isArray(n)||(n=[n]),E=t,u=this.setDetectRadius(t),!(null!=o.model.getFragmentList()))return w=!0,f=SNAP_VERTEX,m=t,void this.drawPoint(m);for(var s=new i(o,this),a=0;a<n.length;++a){var l=o.impl.getRenderProxy(o.model,n[a]);new Autodesk.Viewing.Private.VertexBufferReader(l.geometry,o.impl.use2dInstancing).enumGeomsForObject(e.dbId,s)}if(s.circularArc){if(b=s.vpIdCircular,null!==M&&M!==b)return;t.distanceTo(s.circularArc.vertices[0])<u?(m=s.circularArc.vertices[0],this.drawPoint(m),f=SNAP_VERTEX):t.distanceTo(s.circularArc.vertices[s.circularArc.vertices.length-1])<u?(m=s.circularArc.vertices[s.circularArc.vertices.length-1],this.drawPoint(m),f=SNAP_VERTEX):(this.lineStripToPieces(s.circularArc),g=s.circularArc,this.drawLine(g),C=s.circularArcCenter,S=s.circularArcRadius,f=SNAP_CIRCULARARC),w=!0}else if(s.ellipticalArc){if(b=s.vpIdElliptical,null!==M&&M!==b)return;t.distanceTo(s.ellipticalArc.vertices[0])<u?(m=s.ellipticalArc.vertices[0],this.drawPoint(m),f=SNAP_VERTEX):t.distanceTo(s.ellipticalArc.vertices[s.ellipticalArc.vertices.length-1])<u?(m=s.ellipticalArc.vertices[s.ellipticalArc.vertices.length-1],this.drawPoint(m),f=SNAP_VERTEX):(this.lineStripToPieces(s.ellipticalArc),g=s.ellipticalArc,this.drawLine(g),C=s.ellipticalArcCenter,S=null,f=SNAP_CIRCULARARC),w=!0}else if(s.lineGeom.vertices.length){if(b=s.vpIdLine,null!==M&&M!==b)return;if(this.markupMode){var c=s.lineGeom.vertices[0],h=s.lineGeom.vertices[1],d=new THREE.Vector3;d.addVectors(c,h),d.divideScalar(2);var p=t.distanceTo(d),v=t.distanceTo(c),A=t.distanceTo(h);g=s.lineGeom,p<u?(m=d,this.drawPoint(m),f=SNAP_VERTEX):v<u?(m=c,this.drawPoint(m),f=SNAP_VERTEX):A<u?(m=h,this.drawPoint(m),f=SNAP_VERTEX):(this.drawLine(g),f=SNAP_EDGE)}else t.distanceTo(s.lineGeom.vertices[0])<u?(m=s.lineGeom.vertices[0],this.drawPoint(m),f=SNAP_VERTEX):r.forceSnapVertices||t.distanceTo(s.lineGeom.vertices[1])<u?(m=s.lineGeom.vertices[1],this.drawPoint(m),f=SNAP_VERTEX):(g=s.lineGeom,this.drawLine(g),f=SNAP_EDGE);w=!0}}}},this.snappingLeaflet=function(e){if(e){var t=e.intersectPoint;E=t,u=this.setDetectRadius(t),this.drawPoint(t),f=SNAP_VERTEX,m=t,w=!0}},this.lineStripToPieces=function(e){for(var t=e.vertices,i=t.length-2;i>0;i--)t.splice(i,0,t[i])},this.createOverlay=function(){o.impl.overlayScenes[l]?c!=NO_OVERLAY&&o.impl.clearOverlay(l):o.impl.createOverlayScene(l)},this.addOverlay=function(e){o.impl.addOverlay(l,e)},this.clearOverlay=function(){o.impl.overlayScenes[l]&&o.impl.clearOverlay(l),c=NO_OVERLAY};var I=null;this.drawFace=function(e){this.createOverlay(),I||n();var t=new THREE.Mesh(e,I,!0);c=FACE_OVERLAY,this.addOverlay(t)};var N=null;this.cylinderMesh=function(e,t,i){var n=(new THREE.Vector3).subVectors(t,e),o=new THREE.Matrix4;o.lookAt(e,t,(new THREE.Object3D).up),o.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-n.length(),0,0,0,0,0,1)),N||(N=new THREE.CylinderGeometry(.5,.5,1,8,1,!0));var r=new THREE.Mesh(N,i);return r.applyMatrix(o),r.position.x=(t.x+e.x)/2,r.position.y=(t.y+e.y)/2,r.position.z=(t.z+e.z)/2,r},this.drawLine=function(e){this.createOverlay(),I||n(),c=EDGE_OVERLAY;for(var t=0;t<e.vertices.length;t+=2){var i=this.cylinderMesh(e.vertices[t],e.vertices[t+1],I);this.setEdgeScale(i),this.addOverlay(i)}},this.drawArc=function(e){this.createOverlay(),I||n(),c=EDGE_OVERLAY;for(var t=0;t<e.vertices.length-1;t++){var i=this.cylinderMesh(e.vertices[t],e.vertices[t+1],I);this.setEdgeScale(i),this.addOverlay(i)}};var D=null;this.drawPoint=function(e){this.createOverlay(),I||n(),D||(D=new THREE.SphereGeometry(1));var t=new THREE.Mesh(D,I);t.position.set(e.x,e.y,e.z),this.setPointScale(t),c=POINT_OVERLAY,this.addOverlay(t)},this.setScale=function(e){var t=o.navigation,i=t.getCamera(),n=t.getEyeVector(),r=t.getPosition(),s=e.position.clone(),a=i.isPerspective?s.sub(r).dot(n.normalize()):t.getEyeVector().length(),l=t.getVerticalFov(),c=2*a*Math.tan(THREE.Math.degToRad(.5*l)),u=t.getScreenViewport(),h=window.devicePixelRatio||1;return 5*c/(u.height*h)},this.setPointScale=function(e){var t=this.setScale(e);e.scale.x=t,e.scale.y=t,e.scale.z=t},this.setEdgeScale=function(e){var t=this.setScale(e);e.scale.x=t,e.scale.z=t},this.updatePointScale=function(){if(c==POINT_OVERLAY){var e=o.impl.overlayScenes[l];if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var n=t.children[i];n&&this.setPointScale(n)}}},this.updateEdgeScale=function(){if(c==EDGE_OVERLAY){var e=o.impl.overlayScenes[l];if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var n=t.children[i];n&&this.setEdgeScale(n)}}},this.setDetectRadius=function(e){var t=av.isMobileDevice()?25:10,i=o.navigation,n=i.getCamera(),r=i.getEyeVector(),s=i.getPosition(),a=e.clone(),l=n.isPerspective?a.sub(s).dot(r.normalize()):i.getEyeVector().length(),c=i.getVerticalFov(),u=2*l*Math.tan(THREE.Math.degToRad(.5*c)),h=i.getScreenViewport(),d=window.devicePixelRatio||1;return t*u/(h.height*d)},this.drawIntersectFace=function(e,t,i,n){this.createOverlay();var o=new THREE.Vector3;o.set(t[e.a*i],t[e.a*i+1],t[e.a*i+2]);var r=new THREE.Vector3;r.set(t[e.b*i],t[e.b*i+1],t[e.b*i+2]);var s=new THREE.Vector3;s.set(t[e.c*i],t[e.c*i+1],t[e.c*i+2]);var a=new THREE.Geometry;a.vertices.push(o),a.vertices.push(r),a.vertices.push(s),a.faces.push(new THREE.Face3(0,1,2));var l=new THREE.Mesh(a,n.material,!0);l.matrixWorld=n.matrixWorld,this.addOverlay(l)},this.handleWheelInput=function(e){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(e,t){return y=!0,!1},this.handleButtonUp=function(e,t){return y=!1,!1},this.handleMouseMove=function(e){if(!y&&(this.clearOverlay(),this.clearSnapped(),!av.isMobileDevice()||V(e.canvasX,e.canvasY))){var t=o.impl.snappingHitTest(e.canvasX,e.canvasY,!1);t&&t.intersectPoint&&(t.face?this.snapping3D(t):t.dbId?this.snapping2D(t):this.snappingLeaflet(t))}return!1},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.destroy=function(){this.clearOverlay(),o.impl.removeOverlayScene(l),D&&(D.dispose(),D=null),N&&(N.dispose(),N=null)},this.handlePressHold=function(e){if(av.isMobileDevice())switch(e.type){case"press":T=!0,this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"pressup":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.handleGesture=function(e){if(T&&av.isMobileDevice())switch(e.type){case"dragstart":case"dragmove":this.onMouseMove({x:e.canvasX,y:e.canvasY});break;case"dragend":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.onMouseDown=function(e){this.onMouseMove(e)},this.onMouseMove=function(e){if(this.clearOverlay(),this.clearSnapped(),!av.isMobileDevice()||V(e.x,e.y)){var t=o.impl.snappingHitTest(e.x,e.y,!1);t&&t.intersectPoint&&(t.face?this.snapping3D(t):t.dbId?this.snapping2D(t):this.snappingLeaflet(t))}},this.nearestPointInPointToEdge=function(e,t){for(var i=e.vertices,n=Number.MAX_VALUE,o=null,r=0;r<i.length;r+=2){var s=this.nearestPointInPointToSegment(t,i[r],i[r+1]),a=t.distanceTo(s);a<n&&(n=a,o=s)}return o},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3;return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o=new THREE.Vector3,r=new THREE.Vector3;return o.subVectors(t,e),r.subVectors(i,t),n=o.dot(r),o.subVectors(i,t),n=-n/o.dot(o),o.subVectors(i,t),o.multiplyScalar(n),o.add(t)}},AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MagnifyingGlass=function(e){function t(){for(var e,t=0,i=4*a.width,n=i*a.height;(n-=i)>0;){for(e=0;e<i;++e)l[n++]=c[t++];n-=i}}var i=e,n=!1,o=["magnifyingGlass"],r=!1,s=null,a=null,l=null,c=null;this.isActive=function(){return n},this.activate=function(){n=!0},this.deactivate=function(){n=!1},this.getNames=function(){return o},this.getName=function(){return o[0]},this.setGlassPosition=function(e,t,i,n,o){e.style.left=t-n-o>0?t-n-o+"px":t+o+"px",e.style.top=i-n-o>0?i-n-o+"px":i+o+"px"},this.drawMagnifyingGlass=function(e,n){var o=window.devicePixelRatio,r=80*o,u=o*(e-20),h=o*(n-20);s||((s=document.createElement("canvas")).className="magnifying-glass",s.width=r,s.height=r,s.style.width="80px",s.style.height="80px",i.container.appendChild(s),a=new ImageData(Math.ceil(r/2),Math.ceil(r/2)),l=new Uint8Array(a.data.buffer),c=new Uint8Array(4*a.width*a.height));var d=s.getContext("2d");d.fillStyle="#FFFFFF",d.fillRect(0,0,r,r);var p=i.canvas.getContext("webgl");i.impl.glrenderer().setRenderTarget(null),p.readPixels(u,i.canvas.height-h-a.height,a.width,a.height,p.RGBA,p.UNSIGNED_BYTE,c),t(),d.putImageData(a,0,0),d.drawImage(s,0,0,a.width,a.height,0,0,r,r),this.setGlassPosition(s,e,n,80,15),s.classList.toggle("visible",!0)},this.clearMagnifyingGlass=function(){s.classList.remove("visible")},this.handlePressHold=function(e){if(av.isMobileDevice())switch(e.type){case"press":r=!0,this.drawMagnifyingGlass(e.canvasX,e.canvasY);break;case"pressup":this.clearMagnifyingGlass(),r=!1}return!1},this.handleGesture=function(e){if(r&&av.isMobileDevice())switch(e.type){case"dragstart":case"dragmove":this.drawMagnifyingGlass(e.canvasX,e.canvasY);break;case"dragend":this.clearMagnifyingGlass(),r=!1;break;case"pinchstart":case"pinchmove":this.drawMagnifyingGlass(e.canvasX,e.canvasY);break;case"pinchend":this.clearMagnifyingGlass()}return!1},this.handleMouseMove=function(e){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonUp=function(e,t){return!1}},function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(e){function t(e){if(m)return!1;var t=e.ctrlKey||o&&e.metaKey,i=e.metaKey&&!o;return t||i||e.shiftKey||e.altKey}var i,n=Autodesk.Viewing.Private,o=-1!=navigator.userAgent.search("Mac OS"),r=e.navigation,s=e.container,a=r.getCamera(),l=["firstperson"],c={SHIFT:0,ALT:0,CONTROL:0},u=Autodesk.Viewing.theHotkeyManager.KEYCODES,h=!1,d=!0,p=!1,g=0,m=null,v=new THREE.Clock(!0),f=-1,E=5e3,A=1,y=1,T=2,w=0,b=0,C=0,S=-1e20,k=0,M=0,x=-1e20,R=0,P=0,V=!1,I=!1,N=!1,D=!1,L=!1,O=!1,_=a.fov,H=a.isPerspective,B=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(i=new Autodesk.Viewing.Extensions.GamepadModule(e)),this.isActive=function(){return h},this.getNames=function(){return l},this.getName=function(){return l[0]},this.activate=function(t){v.start(),H=a.isPerspective,r.toPerspective(),_=a.fov,r.setVerticalFov(75,!0),A=e.model.getUnitScale();var n=e.model.getBoundingBox().size();y=Math.max(Math.min(Math.min(n.x,n.y),n.z)/10,1e-4),e.canvas.focus(),h=!0,e.getFirstPersonToolPopup()&&!B&&G(),addCrosshair(),i&&i.activate(this.getName())},this.deactivate=function(e){h=!1,v.stop(),z(),removeCrosshair(),i&&i.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(e){0===e?T=2:(T*=e>0?1.1:.9)<.01&&(T=.01)},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return m="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===m&&this.handleMouseMove(e);case"dragend":return"drag"===m&&(this.handleButtonUp(e,0),m=null,!0)}return!1},this.handleSingleClick=function(e,t){return!1},this.handleButtonDown=function(e,i){z(),g+=1<<i;var n=t(e);return!(0===i&&!n)||(b=e.pageX-window.innerWidth/2,k=e.pageY-window.innerHeight/2,S=e.pageX,x=e.pageY,R=P=0,C=M=0,p=!0,!0)},this.handleMouseMove=function(e){var t=S<-1e10?0:e.pageX-S,i=x<-1e10?0:e.pageY-x;return S=e.pageX,x=e.pageY,p===d&&(R+=.0035*t,P+=.0035*i),!0},this.handleButtonUp=function(e,t){return g-=1<<t,0!==t||!p||(R=P=0,C=M=0,p=!1,!0)},this.handleKeyDown=function(e,t){z();var i=!1;switch(t){case u.ESCAPE:break;case u.TAB:i=!1;break;case u.SHIFT:c.SHIFT=1,i=!0;break;case u.CONTROL:c.CONTROL=1,i=!0;break;case u.ALT:c.ALT=1,i=!0;break;case u.SPACE:c.SPACE=1,i=!0;break;case u.EQUALS:this.adjustSpeed(1),i=!0;break;case u.DASH:this.adjustSpeed(-1),i=!0;break;case u.ZERO:this.adjustSpeed(0),i=!0;break;case u.UP:case u.w:V=!0,i=!0;break;case u.LEFT:case u.a:N=!0,i=!0;break;case u.DOWN:case u.s:I=!0,i=!0;break;case u.RIGHT:case u.d:D=!0,i=!0;break;case u.q:L=!0,i=!0;break;case u.e:O=!0,i=!0;break;case u.g:case u.F1:i=!0}return i},this.handleKeyUp=function(e,t){var i=!1;switch(t){case u.TAB:i=!1;break;case u.SHIFT:c.SHIFT=0,i=!0;break;case u.CONTROL:c.CONTROL=0,i=!0;break;case u.ALT:c.ALT=0,i=!0;break;case u.SPACE:c.SPACE=0,i=!0;break;case u.UP:case u.w:V=!1,i=!0;break;case u.LEFT:case u.a:N=!1,i=!0;break;case u.DOWN:case u.s:I=!1,i=!0;break;case u.RIGHT:case u.d:D=!1,i=!0;break;case u.q:L=!1,i=!0;break;case u.e:O=!1,i=!0;break;case u.g:C=M=0,U(d=!d),i=!0;break;case u.F1:G(),i=!0}return i},this.handleWheelInput=function(e){return r.getReverseZoomDirection()&&(e*=-1),w+=e,!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return V=I=!1,N=D=!1,L=O=!1,!1},this.update=function(){if(!h||!r.isActionEnabled("walk"))return!1;var e=v.getDelta();f>-1&&(new Date).getTime()-f>E&&z(),a.isPerspective||(console.log("Lost perspective mode: resetting view."),r.toPerspective());var t=a.clone(),n=e*T*y*(1===c.SHIFT?4:1),o=.5*e*y*(1===c.SHIFT?4:1);if(0!=w){var s=1*w*y*(1===c.SHIFT?4:1);t.translateZ(-s),w=0}V&&t.translateZ(-n),I&&t.translateZ(n),N&&t.translateX(-n),D&&t.translateX(n),L&&t.translateY(o),O&&t.translateY(-o);var l=t.position,u=0!==l.distanceToSquared(a.position),d=t.target,p=a.target.clone().sub(a.position),g=p.clone().cross(a.up).normalize();if(0!=P){var m=new THREE.Quaternion;m.setFromAxisAngle(g,-P);var A=p.clone();A.applyQuaternion(m);var b=a.worldup.clone(),C=A.angleTo(b),S=THREE.Math.degToRad(5);C>=S&&C<=Math.PI-S&&(p.applyQuaternion(m),t.up.applyQuaternion(m)),P=0}if(0!=R){var k=new THREE.Quaternion;k.setFromAxisAngle(a.worldup,-R),p.applyQuaternion(k),t.up.applyQuaternion(k),R=0}var M=0!==(d=l.clone().add(p)).distanceToSquared(a.target);return(u||M)&&(r.setView(l,d),r.orientCameraUp()),i&&(a=i.update(a)),a.dirty};var F=function(e,t,i,n,o){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(s,e,i,n,o),t>0?(f=(new Date).getTime(),E=t):(f=-1,E=0))},z=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),f=-1},U=function(e){z();var t=e?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation";F({msgTitleKey:"First Person Tool",messageKey:t,messageDefaultValue:t},0,function(){})},G=function(){z(),F({msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:B},0,function(){},null,function(t){B=t.target.checked,e.setFirstPersonToolPopup(!t.target.checked)})};addCrosshair=function(){n.stringToDOM&&(this.crosshair=n.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),e.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var e=this,t=this.viewer,i=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(-1!==t.toolName.indexOf("firstperson")&&e.firstPersonToolButton){var n=t.active?i.Button.State.ACTIVE:i.Button.State.INACTIVE;e.firstPersonToolButton.setState(n)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,i=Autodesk.Viewing.UI,n=e.getToolbar(!0).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new i.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(n){var o=t.firstPersonToolButton.getState();o===i.Button.State.INACTIVE?e.setActiveNavigationTool("firstperson"):o===i.Button.State.ACTIVE&&e.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var o=n.getControl("toolbar-cameraSubmenuTool");o?n.addControl(this.firstPersonToolButton,{index:n.indexOf(o.getId())}):n.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var t=e.getToolbar(!1);t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),function(){function e(e,t,i,o){var r=i.impl.camera,s=r.worldup,a=r.position,l=n[0].copy(a);l.sub(n[1].copy(s).multiplyScalar(e));var c,u,h,d=n[1].set(-s.x,-s.y,-s.z),p=i.impl.rayIntersect(new THREE.Ray(a,d),!0,!0)||i.impl.rayIntersect(new THREE.Ray(a,s),!0,!0);if(p)u=p.intersectPoint;else{var g=n[1].copy(s).multiplyScalar(l.dot(s)),m=n[2].copy(s).multiplyScalar(t);u=(u=n[3].copy(l).sub(g)).add(m)}c=n[4].copy(u).sub(l).length(),h=n[5].copy(u).sub(l),h=0!==c?h.normalize():h,o.floor=u,o.distanceFromFloor=c,o.floorDirection=h}function t(e,t){return Autodesk.Viewing.Private.convertUnits("meters",t.model.getUnitString(),1,e,"default")}function i(e){for(var t={x:1,y:1},i=e.model.getBoundingBox(),n=e.model.getUnitString(),o=Autodesk.Viewing.Private.convertUnits(n,"meters",1,i.max.x-i.min.x,"default"),r=Autodesk.Viewing.Private.convertUnits(n,"meters",1,i.max.y-i.min.y,"default"),s=Autodesk.Viewing.Private.convertUnits(n,"meters",1,i.max.z-i.min.z,"default"),a=Math.max(o,s);a<1;)a*=10,t.x*=.1;for(var l=r;l<1;)l*=10,t.y*=.1;return t.x=t.x>=1?t.x:t.x*Math.round(a)*.5,t.y=t.y>=1?t.y:t.y*Math.round(l)*.5,t}AutodeskNamespace("Autodesk.Viewing.Extensions.BimWalk");var n=[];Autodesk.Viewing.Extensions.BimWalk.BimWalkTool=function(o){function r(e){if(C)return!1;var t=e.ctrlKey||a&&e.metaKey,i=e.metaKey&&!a;return t||i||e.shiftKey||e.altKey}var s,a=-1!=navigator.userAgent.search("Mac OS"),l=o.navigation,c=l.getCamera(),u=["bimwalk"],h={SHIFT:0,ALT:0,CONTROL:0},d=Autodesk.Viewing.theHotkeyManager.KEYCODES,p=!1,g=!0,m=9.8,v=!1,f=0,E=0,A=0,y=0,T=0,w=!1,b=0,C=null,S=new THREE.Clock(!0),k=4,M=2,x=2,R=0,P=0,V=0,I=0,N=-1e20,D=0,L=0,O=-1e20,_=0,H=0,B=!1,F=!1,z=!1,U=!1,G=!1,W=!1,j=c.fov,Y=c.isPerspective;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(s=new Autodesk.Viewing.Extensions.GamepadModule(o));for(var q=0;q<10;++q)n.push(new THREE.Vector3(0,0,0));this.isActive=function(){return p},this.getNames=function(){return u},this.getName=function(){return u[0]},this.activate=function(e){p=!0,S.start(),Y=c.isPerspective,l.toPerspective();(function(){var e=o.navigation.getScreenViewport();return e.width/e.height}).bind(this);j=c.fov,l.setVerticalFov(60,!0);var n=i(o);k=t(4,o)*n.x,M=t(1,o)*n.x,x=t(2,o)*n.y,m=t(9.8,o)*n.y,T=10*m*n.y,f=o.model.getData().globalOffset.y||0,E=t(1.8,o)*n.y,A=E-.5*E,y=E+.5*E,o.canvas.focus(),s&&s.activate(this.getName())},this.deactivate=function(e){p=!1,S.stop(),s&&s.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.handleGesture=function(e){switch(e.pointers&&e.pointers.length>0&&(e.pageX=e.pointers[0].pageX,e.pageY=e.pointers[0].pageY),e.type){case"dragstart":return C="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===C&&this.handleMouseMove(e);case"dragend":return"drag"===C&&(this.handleButtonUp(e,0),C=null,!0)}return!1},this.handleSingleClick=function(e,t){return!1},this.handleButtonDown=function(e,t){b+=1<<t;var i=r(e);return!(0===t&&!i)||(V=e.pageX-window.innerWidth/2,D=e.pageY-window.innerHeight/2,N=e.pageX,O=e.pageY,_=H=0,I=L=0,w=!0,!0)},this.handleMouseMove=function(e){var t=N<-1e10?0:e.pageX-N,i=O<-1e10?0:e.pageY-O;return N=e.pageX,O=e.pageY,w&&(_+=.0035*t,H+=.0035*i),!0},this.handleButtonUp=function(e,t){return b-=1<<t,0!==t||!w||(_=H=0,I=L=0,w=!1,!0)},this.handleKeyDown=function(e,t){switch(t){case d.SHIFT:case d.CONTROL:case d.ALT:return!0;case d.SPACE:return g=!g,!0;case d.UP:case d.w:return B=!0,!0;case d.LEFT:case d.a:return z=!0,!0;case d.DOWN:case d.s:return F=!0,!0;case d.RIGHT:case d.d:return U=!0,!0;case d.r:return G=!0,!0;case d.f:return W=!0,!0}return!1},this.handleKeyUp=function(e,t){switch(t){case d.SHIFT:case d.CONTROL:case d.ALT:case d.SPACE:return!0;case d.UP:case d.w:return B=!1,!0;case d.LEFT:case d.a:return z=!1,!0;case d.DOWN:case d.s:return F=!1,!0;case d.RIGHT:case d.d:return U=!1,!0;case d.r:return G=!1,!0;case d.f:return W=!1,!0}return!1},this.handleWheelInput=function(e){return l.getReverseZoomDirection()&&(e*=-1),R+=e,!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return B=F=!1,z=U=!1,G=W=!1,!1},this.update=function(){if(!p||!l.isActionEnabled("walk"))return!1;var t=S.getDelta();c.isPerspective||(console.log("Lost perspective mode: resetting view."),l.toPerspective());var i=c.clone(),n=i.position,r=0!==n.distanceToSquared(c.position),a=c.target.clone().sub(c.position),u=a.clone().cross(c.worldup).normalize();if(0!==H){var d=new THREE.Quaternion;d.setFromAxisAngle(u,-H);var w=a.clone();w.applyQuaternion(d);var b=c.worldup.clone(),C=w.angleTo(b),V=THREE.Math.degToRad(5);C>=V&&C<=Math.PI-V&&(a.applyQuaternion(d),i.up.applyQuaternion(d)),H=0}if(0!==_){var I=new THREE.Quaternion;I.setFromAxisAngle(c.worldup,-_),a.applyQuaternion(I),i.up.applyQuaternion(I),_=0}var N=c.worldup,D=a.clone();D.sub(N.clone().multiplyScalar(N.dot(D))),D.normalize();var L=u.clone();L.sub(N.clone().multiplyScalar(N.dot(L))),L.normalize();var O=t*k*(1===h.SHIFT?4:1),j=t*x*(1===h.SHIFT?4:1),Y=new THREE.Vector3(0,0,0);0!==R?(Y.add(D),O=R*M*(1===h.SHIFT?4:1),R=0):(B&&Y.add(D),F&&Y.sub(D),z&&Y.sub(L),U&&Y.add(L),0!==Y.lengthSq()&&Y.normalize()),i.position.add(Y.multiplyScalar(O));N.clone().multiplyScalar(-1);if(g){G&&(E=Math.min(y,E+j)),W&&(E=Math.max(A,E-j));var q={};e(E,f,o,q);var X=Math.acos(q.floorDirection.dot(N))>Math.PI/4;if(v=q.distanceFromFloor<1e-5||v&&X&&q.distanceFromFloor<E)i.position=q.floor.add(q.floorDirection.multiplyScalar(q.distanceFromFloor+E)),P=0;else{var K=(P=Math.min(T,P+t*m))*t;K>q.distanceFromFloor&&(K=q.distanceFromFloor),i.position.add(q.floorDirection.multiplyScalar(K))}}else v=!1,G&&i.position.add(N.multiplyScalar(j)),W&&i.position.sub(N.multiplyScalar(j));newTarget=n.clone().add(a);var Q=0!==newTarget.distanceToSquared(c.target);return(r||Q)&&(l.setView(n,newTarget),l.orientCameraUp()),s&&(c=s.update(c)),c.dirty}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.BimWalk"),Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.constructor=Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension,Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.load=function(){var e=this,t=this.viewer,i=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.BimWalk.BimWalkTool(t),t.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(t){if(-1!==t.toolName.indexOf("bimwalk")&&e.bimWalkToolButton){var n=t.active?i.Button.State.ACTIVE:i.Button.State.INACTIVE;e.bimWalkToolButton.setState(n)}},t.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.createUI=function(){var e=this.viewer;if(e.getToolbar){var t=this,i=Autodesk.Viewing.UI,n=e.getToolbar(!0).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.bimWalkToolButton=new i.Button("toolbar-BimWalkTool"),this.bimWalkToolButton.setToolTip("BIM Walk"),this.bimWalkToolButton.onClick=function(n){var o=t.bimWalkToolButton.getState();o===i.Button.State.INACTIVE?e.setActiveNavigationTool("bimwalk"):o===i.Button.State.ACTIVE&&e.setActiveNavigationTool()},this.bimWalkToolButton.setIcon("adsk-icon-first-person");var o=n.getControl("toolbar-cameraSubmenuTool");o?n.addControl(this.bimWalkToolButton,{index:n.indexOf(o.getId())}):n.addControl(this.bimWalkToolButton)}},Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension.prototype.unload=function(){var e=this.viewer;if(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.bimWalkToolButton){var t=e.getToolbar(!1);t&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.bimWalkToolButton.getId()),this.bimWalkToolButton=null}return e.getActiveNavigationTool()==this.tool.getName()&&e.setActiveNavigationTool(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BimWalk",Autodesk.Viewing.Extensions.BimWalk.BimWalkExtension)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.WebVR"),Autodesk.Viewing.Extensions.WebVR.StereoRenderContext=function(e,t,i,n){function o(e,t,i,n,o){e.matrixWorld.decompose(o.position,o.quaternion,o.scale),n&&o.position.set(0,0,0),o.translateOnAxis(i?d:p,v),o.projectionMatrix.elements=i?t.leftProjectionMatrix:t.rightProjectionMatrix}var e,r,s,a,l,c,u=e.getEyeParameters("left"),h=e.getEyeParameters("right"),d=new THREE.Vector3,p=new THREE.Vector3,g=new THREE.PerspectiveCamera,m=new THREE.PerspectiveCamera,v=10*e.modelScaleFactor,f=null;this.init=function(i,o,c){r=new avp.RenderContext,s=i;var g=1.5*window.devicePixelRatio;a=2*e.getEyeParameters("left").renderWidth/g,l=e.getEyeParameters("right").renderHeight/g,this.settings=r.settings,r.init(s,a,l),d.fromArray(u.offset),p.fromArray(h.offset),f=new VRFrameData,t.worldup&&1==t.worldup.z&&(n.webVR_orbitModel=!1)},this.modeFusion=function(i){var n=new THREE.Vector3(0,0,1);n.applyQuaternion((new THREE.Quaternion).fromArray(i.orientation)).multiplyScalar(2.1*v),t.position.set(n.x,n.y,n.z),t.lookAt(e.target),t.up.set(0,1,0)},this.modeWalkthrough=function(e){e.orientation&&0!=e.orientation[1]&&t.quaternion.fromArray(e.orientation),e.position&&0!=e.position[0]&&t.position.fromArray(e.position).multiplyScalar(v),t.worldup&&1==t.worldup.z&&(t.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2),t.quaternion.multiply((new THREE.Quaternion).fromArray(e.orientation)),e.position&&0!=e.position[0]&&t.position.set(t.position.x,-t.position.z,t.position.y));var i=new THREE.Vector3(0,0,-1);i.applyQuaternion(t.quaternion),t.target=t.position.clone().add(i.clone().multiplyScalar(10))},this.updateCamera=function(){if(e&&e._isPresenting&&(e.depthNear=t.near,e.depthFar=t.far,e.getFrameData(f),(c=f.pose).orientation))return n.webVR_orbitModel?this.modeFusion(c):this.modeWalkthrough(c),t.updateMatrixWorld(),t.dirty=!0,o(t,f,!0,!1,g),o(t,f,!1,!1,m),i&&(i.camera=t.clone(),i.camera.position.set(0,0,0),o(t,f,!0,!0,i.cameraL),o(t,f,!1,!0,i.cameraR)),{L:g,R:m,C:t}},this.beginScene=function(e,i,n,o){r.beginScene(e,t,n,o)},this.renderScenePart=function(e,t,n,o,c){var u=a/2;s.setViewport(0,0,u,l),r.setCamera(g),r.renderScenePart(e,!0,!1,!1,!1),s.setViewport(u,0,u,l),r.setCamera(m),r.renderScenePart(e,!0,!1,!1,!1),i&&(s.setViewport(0,0,u,l),r.setCamera(i.cameraL),r.renderScenePart(i.scene,!0,!1,!1,!1),s.setViewport(u,0,u,l),r.setCamera(i.cameraR),r.renderScenePart(i.scene,!0,!1,!1,!1)),s.setViewport(0,0,a,l)},this.sceneDirty=function(e,t){r.sceneDirty(e,t)},this.endScene=function(){r.endScene()},this.clearAllOverlays=function(){},this.renderOverlays=function(e){},this.composeFinalFrame=function(t,i){r.composeFinalFrame(!0,i),e._isPresenting&&e.submitFrame()},this.cleanup=function(){r.cleanup()},this.setSize=function(e,t,i){a=e,l=t,r.setSize(a,l,i)},this.getMaxAnisotropy=function(){return r.getMaxAnisotropy()},this.hasMRT=function(){return r.hasMRT()},this.initPostPipeline=function(e,t,i){r.initPostPipeline(!1,!1,!1)},this.setClearColors=function(e,t){r.setClearColors(e,t)},this.setAOOptions=function(e,t){r.setAOOptions(e,t)},this.getAORadius=function(){return r.getAORadius()},this.getAOIntensity=function(){return r.getAOIntensity()},this.setTonemapExposureBias=function(e){r.setTonemapExposureBias(e)},this.getExposureBias=function(){return r.getExposureBias()},this.setTonemapMethod=function(e){r.setTonemapMethod(e)},this.getToneMapMethod=function(){return r.getToneMapMethod()},this.toggleTwoSided=function(e){r.toggleTwoSided(e)},this.enter2DMode=function(e){r.enter2DMode(e)},this.getAOEnabled=function(){return!1},this.idAtPixel=function(e,t){return 0},this.overlayUpdate=function(e){r.overlayUpdate(e)},this.rolloverObjectViewport=function(e,t){},this.screenCapture=function(){return console.warn("Screen capture not implemented by stereo render context"),null},this.setUnitScale=function(e){r.setUnitScale(e)},this.getUnitScale=function(){return r.getUnitScale()},this.getColorTarget=function(){return null}},AutodeskNamespace("Autodesk.Viewing.Extensions.WebVR"),Autodesk.Viewing.Extensions.WebVR.VRExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)},Autodesk.Viewing.Extensions.WebVR.VRExtension.populateDefaultOptions=function(e){e.experimental.push("--webVR_orbitModel"),e.experimental.push("--webVR_cursor"),e.experimental.push("--webVR_menu")},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.WebVR.VRExtension,Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.load=function(){var e=this,t=null;return avp.loadDependency("VRFrameData","webvr-polyfill.min.js",function(){navigator.getVRDisplays().then(function(i){if(i.length>0&&(t=i[0]).capabilities.canPresent){var n=e.viewer,o=n.getToolbar(!0),r=Autodesk.Viewing.UI;return e.tool=new Autodesk.Viewing.Extensions.WebVR.VRTool(n,e,t),n.toolController.registerTool(e.tool),e.createUI(o),e.onToolChanged=function(t){var i="vr"===t.toolName&&t.active?r.Button.State.ACTIVE:r.Button.State.INACTIVE;e.vrToolButton&&e.vrToolButton.setState(i)},void n.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,e.onToolChanged)}avp.logger.warn("Attempted to load WebVR extension, but WebVR is not supported.")})}),!0},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.createUI=function(e){var t=this,i=this.viewer,n=Autodesk.Viewing.UI,o=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new n.Button("toolbar-vrTool"),this.vrToolButton.setToolTip("Enable VR mode"),this.vrToolButton.setIcon("adsk-icon-webvr"),this.vrToolButton.onClick=function(e){var o=t.vrToolButton.getState();o===n.Button.State.INACTIVE?i.setActiveNavigationTool("vr"):o===n.Button.State.ACTIVE&&i.setActiveNavigationTool()};var r=o.getControl("toolbar-cameraSubmenuTool");r?o.addControl(this.vrToolButton,{index:o.indexOf(r.getId())}):o.addControl(this.vrToolButton)},Autodesk.Viewing.Extensions.WebVR.VRExtension.prototype.unload=function(){var e=this.viewer;this.onToolChanged&&(e.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0);var t=e.getToolbar(!1);return t&&this.vrToolButton&&t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId()),this.vrToolButton=null,this.tool&&(e.toolController.deregisterTool(this.tool),this.tool=null),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.WebVR",Autodesk.Viewing.Extensions.WebVR.VRExtension),Autodesk.Viewing.Extensions.WebVR.VRTool=function(e,t,i){var n,o,r=e.canvas,s=e.navigation,a=s.getCamera(),l={webVR_cursor:avp.isExperimentalFlagEnabled("webVR_cursor",t.options),webVR_menu:avp.isExperimentalFlagEnabled("webVR_menu",t.options),webVR_orbitModel:avp.isExperimentalFlagEnabled("webVR_orbitModel",t.options)},c=["vr"],u=!1,h=!1;this.activate=function(t){u=!0,e.impl.toggleGroundShadow(!1),e.impl.toggleGroundReflection(!1),s.toPerspective(),s.setVerticalFov(75,!0),s.setRequestFitToView(!0);var c=e.model.getBoundingBox().size();if(i.target=e.model.getBoundingBox().center(),s.setPivotPoint(i.target,!0,!0),s.setView(a.position,i.target),s.setCameraUpVector(new THREE.Vector3(0,1,0)),i.modelScaleFactor=Math.max(Math.min(Math.min(c.x,c.y),c.z)/10,1e-4),i._isPresenting=av.isMobileDevice(),i.requestPresent([{source:r}]).then(function(){e.impl.setLmvDisplay(i),i._isPresenting=!0}),i.resetPose(),av.isMobileDevice()){d(!1),e.setScreenMode(Autodesk.Viewing.ScreenMode.kFullScreen),r.addEventListener("dblclick",function(){u&&e.setActiveNavigationTool()})}(l.webVR_cursor||l.webVR_menu)&&(o=this.initHUD()),n=new Autodesk.Viewing.Extensions.WebVR.StereoRenderContext(i,a,o,l),e.impl.setUserRenderContext(n)},this.initHUD=function(){var t=new THREE.Scene,n=a.clone();if(l.webVR_menu){var o=new Autodesk.Viewing.Extensions.WebVR.Menu(i.modelScaleFactor);o.init(t)}if(l.webVR_cursor){var s=a.worldup&&1==a.worldup.z,c=new Autodesk.Viewing.Extensions.WebVR.Cursor(e.impl,e.autocam,i.modelScaleFactor,s);c.init(t),r.addEventListener("click",c.onClick)}return{scene:t,camera:n,cameraL:n.clone(),cameraR:n.clone(),menu:o,cursor:c,IPD:1.2}},this.update=function(t){if(!i)return!0;h&&!i.isPresenting&&u&&e.setActiveNavigationTool(),h=i.isPresenting;var r=n.updateCamera();return!o||(l.webVR_cursor&&o.cursor.update(r.C,o),l.webVR_menu&&o.menu.update(o.camera),!0)},this.deactivate=function(t){i&&(i.isPresenting&&i.exitPresent(),i._isPresenting=!1),u=!1,d(!0),e.impl.setUserRenderContext(null),e.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),e.resize(e.canvas.clientWidth,e.canvas.clientHeight),e.autocam.resetHome(),o&&l.webVR_cursor&&r.removeEventListener("click",o.cursor.onClick)};var d=function(t){e.displayViewCubeUI(t),e.displayViewCube(t&&!av.isMobileDevice());var i=document.getElementsByClassName("adsk-toolbar");i.length>0&&""!==i[0]&&(i[0].style.display=t?"block":"none")};this.isActive=function(){return u},this.getNames=function(){return c},this.getName=function(){return c[0]}},Autodesk.Viewing.Extensions.WebVR.Menu=function(e){var t,i,n,o,r=16777215;this.init=function(e){function n(e,t,i){return new THREE.Mesh(new THREE.PlaneBufferGeometry(t,1),new THREE.MeshBasicMaterial({map:s.loadTexture(o(e)),color:r,side:THREE.DoubleSide,depthTest:!1,transparent:!0,opacity:i}))}if(!t){var o=Autodesk.Viewing.Private.getResourceUrl,s=THREE.ImageUtils;s.crossOrigin="anonymous";var a=["back.png","zoomin.png","zoomout.png","next.png"];t=new THREE.Object3D,i=new THREE.Object3D;var l=new THREE.Object3D;l.position.set(0,-12,-14),l.rotateX(-.6);for(var c=0;c<a.length;c++){var u=n("res/webvr/"+a[c],2,1);u.position.set(2*(c-a.length/2),0,.1),u.scale.set(.94,.94,.1),l.add(u)}var h=n("res/webvr/bg.png",48,.1);l.add(h),i.add(l),t.add(i),t.visible=!0,e.add(t)}},this.onVisible=function(e){i.rotation.y=e.rotation._z,n=-t.quaternion.y},this.update=function(e){var i=e.quaternion.clone().inverse();t.quaternion.copy(i);var s=t.visible;t.visible=t.quaternion.x>.26&&t.quaternion.x<.4,!s&&t.visible&&this.onVisible(e),o>=0&&o<4&&t.children[0].children[0].children[o].material.color.setHex(r),(o=Math.floor(4.54*(n+t.quaternion.y+.14)*4))>=0&&o<4&&t.children[0].children[0].children[o].material.color.setHex(11184895)},this.onClick=function(){}},Autodesk.Viewing.Extensions.WebVR.Cursor=function(e,t,i,n){var o,r;this.init=function(e){(o=new THREE.Object3D).scale.set(.25,.25,1),o.add(new THREE.Mesh(new THREE.RingGeometry(.6,1,32,32),new THREE.MeshBasicMaterial({color:11141154,depthTest:!1,side:THREE.DoubleSide}))),e.add(o)},this.update=function(t,n){var s;(r=e.hitTestViewport(new THREE.Vector3,!1))?(o.children[0].material.color.setHex(8874),s=r.intersectPoint.clone().sub(t.position).length()):(o.children[0].material.color.setHex(11141154),s=.5*(t.far-t.near));var a=new THREE.Matrix4;a.extractRotation(n.camera.matrixWorld);var l=new THREE.Vector3(0,0,-1);(l=a.multiplyVector3(l)).multiplyScalar(s),o.scale.set(i,i,i),o.position.copy(l),o.lookAt(n.camera.position)},this.onClick=function(){if(r){var e=r.intersectPoint;r.face.normal;n?e.z+=5:e.y+=5;var i=t.getCurrentView();i.position.copy(e),i.center.set(e.x+1e-6,e.y,e.z),i.pivot.set(e.x,e.y,e.z),t.goToView(i)}}},function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}function t(e){function t(){return 100*e.model.getUnitScale()}function i(e){var t=e[1];return e[1]=-e[2],e[2]=t,e}function s(e,t){var i=t.model.getData().globalOffset;return i&&(e[0]+=i.x,e[1]+=i.y,e[2]+=i.z),e}var l=new Autodesk.Viewing.Private.ViewerState(e).getState().viewport,c=l.eye,u=l.target,h=l.up;c=s(c,e),u=s(u,e),c=i(c),u=i(u),h=i(h),u=o([u[0]-c[0],u[1]-c[1],u[2]-c[2]]),h=o(h);var d=function(e){return e.isOrthographic?e.orthographicHeight*e.aspectRatio:r(Math.tan(a(e.fieldOfView)*e.aspectRatio))}(l),p=n(e),g={Projection:{Extent:d,IsOrthographic:l.isOrthographic,NativeAspect:l.aspectRatio},Units:p,View:{Eye:c,At:u,Up:h}};return function(e){var i=t(e.Units);e.View.Eye[0]*=i,e.View.Eye[1]*=i,e.View.Eye[2]*=i,e.Projection.IsOrthographic&&(e.Projection.Extent*=i)}(g),g.Units="CENTIMETER",g}function i(e,t){function i(e,t){var i=1/(100*t.model.getUnitScale());switch(e.toUpperCase()){case"FOOT":1/30.48;break;case"INCH":1/2.54;break;case"KILOMETER":1e-5;break;case"METER":.01;break;case"CENTIMETER":1;break;case"MILLIMETER":10}return i}function n(e){var t=e[1];return e[1]=e[2],e[2]=-t,e}(t=JSON.parse(JSON.stringify(t))).Projection.IsOrthographic=t.Projection.IsOrthographic||t.Projection.isOrthographic;var a=n(t.View.Eye),l=o(n(t.View.At)),c=o(n(t.View.Up)),u=t.Projection.NativeAspect,h=t.Projection.IsOrthographic,d=h?"orthographic":"perspective",p={viewport:{eye:a,target:[a[0]+l[0],a[1]+l[1],a[2]+l[2]],up:c,aspectRatio:u,projection:d,isOrthographic:h}};!function(e,t){var i=t.Projection,n=i.NativeAspect;i.IsOrthographic?e.viewport.orthographicHeight=i.Extent/n:e.viewport.fieldOfView=s(r(Math.tan(i.Extent))/n)}(p,t),function(e,t,n){var o=i(t.Units,n);e.viewport.eye[0]*=o,e.viewport.eye[1]*=o,e.viewport.eye[2]*=o,e.viewport.isOrthographic&&(e.viewport.orthographicHeight*=o)}(p,t,e),function(e,t){var i=t.model.getData().globalOffset;i&&(e[0]-=i.x,e[1]-=i.y,e[2]-=i.z)}(p.viewport.eye,e),p.viewport.target=[p.viewport.eye[0]+10*l[0],p.viewport.eye[1]+10*l[1],p.viewport.eye[2]+10*l[2]],new Autodesk.Viewing.Private.ViewerState(e).restoreState(p)}function n(e){switch(e.model.getUnitScale()){case 1:return"METER";case.3048:return"FOOT";case.0254:return"INCH";case.01:return"CENTIMETER";case.001:return"MILLIMETER";case 1e3:return"KILOMETER";default:return"METER"}}function o(e){var t=e[0],i=e[1],n=e[2],o=Math.sqrt(t*t+i*i+n*n);if(0===o)return e;var r=1/o;return[t*r,i*r,n*r]}function r(e){var t=Math.atan(e);return t<0?t+Math.PI:t}function s(e){return e*(180/Math.PI)}function a(e){return e*(Math.PI/180)}var l=AutodeskNamespace("Autodesk.Viewing.Extensions.RaaS");(c=Object.create(Autodesk.Viewing.Extension.prototype)).constructor=e,l.RaaS=e;var c=e.prototype;c.load=function(){return!0},c.unload=function(){return!0},c.setShot=function(e){},c.getShot=function(){},c.getCameraAsRenderDescriptor=function(){return t(this.viewer)},c.setCameraFromViewName=function(e){this.viewer.model.getDocumentNode().search({type:"3d",role:"view"}),this.viewer.setViewCube(e)},c.setCameraFromRenderDescriptor=function(e){return i(this.viewer,e)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.RaaS",e)}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e;var i=e.prototype;i.load=function(){var e=this.viewer,i=e.getToolbar(!0);return this.tool=new t.ZoomWindowTool(e),e.toolController.registerTool(this.tool),this.createUI(i),!0},i.createUI=function(e){var t=this,i=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);i.dollybutton&&(i.removeControl(i.dollybutton.getId()),this.defaultDollyButton=i.dollybutton),this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("zoomwindowtoolicon-zoom-window"),this.createZoomSubmenu(this.zoomWindowToolButton),i.addControl(this.zoomWindowToolButton);var n=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){t.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(t.viewer.setActiveNavigationTool(),t.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}];Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,n)},i.destroyUI=function(){var e=this.viewer.getToolbar(!1);if(e){var t=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);t&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(t)),t.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,t.panbutton&&this.defaultDollyButton?t.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},i.createNavToggler=function(e,t,i){return function(){var n=t.getState();n===Autodesk.Viewing.UI.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):n===Autodesk.Viewing.UI.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},i.createZoomSubmenu=function(e){var t=this.viewer,i=(t.getToolbar(!0).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"));i.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),i.setIcon("zoomwindowtoolicon-zoom-window"),i.onClick=this.createNavToggler(t,i,"zoomwindow"),e.addControl(i);var n=new Autodesk.Viewing.UI.Button("toolbar-zoomTool");n.setToolTip("Zoom"),n.setIcon("adsk-icon-zoom"),n.onClick=this.createNavToggler(t,n,"dolly"),e.addControl(n),e.onClick=i.onClick},i.unload=function(){var e=this.viewer;return"dolly"!==e.getActiveNavigationTool()&&"zoomwindow"!==e.getActiveNavigationTool()||e.setActiveNavigationTool(),this.destroyUI(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",e)}(),function(){"use strict";function e(e){var n=["zoomwindow"],o=!1,r=!1,s=new THREE.Vector3(0,0,-10),a=new THREE.Vector3(0,0,-10),l=null,c=null,u=null,h=null,d=null,p=e.navigation.getCamera();this.isActive=function(){return o},this.getNames=function(){return n},this.getName=function(){return n[0]},this.onResize=function(){d=null;var t=e.canvas,i=t.clientWidth,n=t.clientHeight,o=new THREE.OrthographicCamera(0,i,0,n,1,1e3);e.impl.overlayScenes.ZoomWindowRect.camera=o},this.activate=function(t){if(o=!0,null===l){var i=null;i=e.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),l=new THREE.LineBasicMaterial({color:i,opacity:.6,linewidth:1})}var n=e.canvas,r=n.clientWidth,s=n.clientHeight,a=new THREE.OrthographicCamera(0,r,0,s,1,1e3);e.impl.createOverlayScene("ZoomWindowRect",l,l,a),e.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),e.toolController.getTool("dolly").activate("orbit")},this.deactivate=function(t){d=null,e.impl.removeOverlayScene("ZoomWindowRect"),o=!1,r=!1,e.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),e.toolController.getTool("dolly").deactivate("orbit")},this.getCursor=function(){switch(e.toolController.getTool("dolly").getTriggeredMode()){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"},this.handleGesture=function(e){return!0},this.handleSingleClick=function(e,t){return!0},this.startDrag=function(t){if(!1===r){if(r=!0,s.x=t.canvasX,s.y=t.canvasY,a.x=t.canvasX,a.y=t.canvasY,null===d){(c=new THREE.Geometry).vertices.push(s.clone(),s.clone(),s.clone(),s.clone(),s.clone()),(u=new THREE.Geometry).vertices.push(s.clone(),s.clone()),(h=new THREE.Geometry).vertices.push(s.clone(),s.clone());var i=new THREE.Line(c,l,THREE.LineStrip),n=new THREE.Line(u,l,THREE.LineStrip),o=new THREE.Line(h,l,THREE.LineStrip);(d=new THREE.Group).add(i),d.add(n),d.add(o)}else c.vertices[0]=s.clone(),c.vertices[1]=s.clone(),c.vertices[2]=s.clone(),c.vertices[3]=s.clone(),c.vertices[4]=s.clone(),u.vertices[0]=s.clone(),u.vertices[1]=s.clone(),h.vertices[0]=s.clone(),h.vertices[1]=s.clone(),u.verticesNeedUpdate=!0,h.verticesNeedUpdate=!0,c.verticesNeedUpdate=!0;e.impl.addOverlay("ZoomWindowRect",d)}},this.handleButtonDown=function(e,t){return 0===t&&(this.startDrag(e),!0)},this.handleMouseMove=function(e){return!(!c||!r)&&(a.x=e.canvasX,a.y=e.canvasY,!0)},this.endDrag=function(t){!0===r&&(e.impl.removeOverlay("ZoomWindowRect",d),r=!1)},this.handleButtonUp=function(e,t){return 0===t&&(this.endDrag(),!0)},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return!1},this.update=function(){if(this.isActive()){if(!c||!r)return this.zoomWindow();c.vertices[1].x=s.x,c.vertices[1].y=a.y,c.vertices[2]=a.clone(),c.vertices[3].x=a.x,c.vertices[3].y=s.y,c.vertices[4]=c.vertices[0];var t=Math.abs(a.x-s.x),n=Math.abs(a.y-s.y),o=t>n?n:t;o>i&&(o=i);var l=.5*o,d=[.5*(a.x+s.x),.5*(a.y+s.y)];return u.vertices[0].x=d[0]-l,u.vertices[0].y=d[1],u.vertices[1].x=d[0]+l,u.vertices[1].y=d[1],h.vertices[0].x=d[0],h.vertices[0].y=d[1]-l,h.vertices[1].x=d[0],h.vertices[1].y=d[1]+l,u.verticesNeedUpdate=!0,h.verticesNeedUpdate=!0,c.verticesNeedUpdate=!0,e.impl.invalidate(!1,!1,!0),!1}},this.getScreenRay=function(e,i,n,o,r){var s=r.position.clone(),a=r.target.clone().clone().sub(s),l=r.up.clone(),c=a.clone().cross(l),u=a.length()*Math.tan(r.fov*t),h=u*r.aspect,d=2*e*h/n-h,p=2*i*u/o-u;l=l.normalize().multiplyScalar(p),c=c.normalize().multiplyScalar(d);var g=new THREE.Vector3,m=new THREE.Vector3;return r.isPerspective?(g=s.clone(),(m=a.clone()).add(l),m.add(c)):((g=s.clone()).add(c),g.add(l),m.add(a)),{rayOrigin:g,rayDirection:m}},this.queryMouseRaySceneIntersection=function(t,i){if(null==e)return null;if(null==e.model)return null;if(e.model.is2d())return null;var n=e.impl.hitTest(t,i,!1);return n?n.intersectPoint:null};this.zoomWindow=function(){var t=p,i=e.canvas.clientWidth,n=e.canvas.clientHeight,o=s.x,r=s.y,l=a.x,c=a.y,u=Math.abs(l-o),h=Math.abs(c-r);if(0===u||0===h)return!1;if(a.copy(s),e.navigation.getIs2D()){var d={x:.5*(o+l),y:.5*(r+c)},g=e.navigation.getEyeVector().length(),m=e.impl.clientToViewport(d.x,d.y),v=e.impl.clientToViewport(i/2,n/2);m.subVectors(m,v),e.navigation.panRelative(m.x/2,m.y/2,g);var f=u/i,E=h/n,A=f>E?f:E;g=e.navigation.getEyeVector().length();var y=e.navigation.getWorldPoint(.5,.5);return e.navigation.dollyFromPoint(g*(A-1),y),!0}var T=null,w=.5*(o+l),b=.5*(r+c),C=this.getScreenRay(w,b,i,n,p);null===(T=this.queryMouseRaySceneIntersection(w,b))&&(T=C.rayOrigin.add(C.rayDirection));var S=t.position.clone(),k=t.target.clone(),M=k.clone().sub(S);M.normalize(),t.up.clone().normalize();var x=u/h>i/n?i/u:n/h,R=1*T.distanceTo(S)/x,P=M.clone().negate().multiplyScalar(R);return S=T.clone().add(P),t.position.set(S.x,S.y,S.z),(k=T.clone()).clone().sub(S).normalize(),t.target.set(k.x,k.y,k.z),t.dirty=!0,!0}}AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");var t=.017453292519943295,i=20;Autodesk.Viewing.Extensions.ZoomWindow.ZoomWindowTool=e}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");var e=Autodesk.Viewing,t=e.UI,i=e.Extensions.FusionOrbit,n=function(t,i){e.Extension.call(this,t,i)};(n.prototype=Object.create(e.Extension.prototype)).constructor=n,n.prototype.load=function(){function t(){o.removeEventListener(e.TOOLBAR_CREATED_EVENT,t),n.createUI()}var n=this,o=this.viewer,r=o.getToolbar?o.getToolbar(!0):void 0;if(this.tool=new i.FusionOrbitTool,this.tool.setViewer(o),o.toolController.registerTool(this.tool),r){var s=r.getControl(e.TOOLBAR.MODELTOOLSID);s&&s.getNumberOfControls()>0?t():o.addEventListener(e.TOOLBAR_CREATED_EVENT,t)}else o.addEventListener(e.TOOLBAR_CREATED_EVENT,t);return!0},n.prototype.createUI=function(){var i=this.viewer,n=i.getToolbar(!1).getControl(e.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=n.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=n.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=n.returnToDefault,n.freeorbitbutton.onClick=function(e){var o=n.freeorbitbutton.getState();o===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit"),n.freeorbitbutton.setState(t.Button.State.ACTIVE)):o===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),n.freeorbitbutton.setState(t.Button.State.INACTIVE))},n.orbitbutton.onClick=function(e){var o=n.orbitbutton.getState();o===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit constrained"),n.orbitbutton.setState(t.Button.State.ACTIVE)):o===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),n.orbitbutton.setState(t.Button.State.INACTIVE))},n.returnToDefault=function(){n.orbittoolsbutton.setState(t.Button.State.ACTIVE),n.orbittoolsbutton.setState(t.Button.State.INACTIVE)},n.orbittoolsbutton.setState(t.Button.State.INACTIVE),i.prefs.fusionOrbitConstrained?(n.orbittoolsbutton.onClick=n.orbitbutton.onClick,n.orbittoolsbutton.setIcon(n.orbitbutton.iconClass),i.setDefaultNavigationTool("orbit")):(n.orbittoolsbutton.onClick=n.freeorbitbutton.onClick,n.orbittoolsbutton.setIcon(n.freeorbitbutton.iconClass),i.setDefaultNavigationTool("freeorbit")),i.setActiveNavigationTool(),n.returnToDefault()},n.prototype.unload=function(){var i=this.viewer,n=i.getToolbar(!1).getControl(e.TOOLBAR.NAVTOOLSID);return n&&(n.orbitbutton&&(n.orbitbutton.onClick=this.classicBehavior.orbitOnClick),n.freeorbitbutton&&(n.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),n.returnToDefault=this.classicBehavior.returnToDefault,n.orbittoolsbutton&&(n.orbitbutton?n.orbittoolsbutton.onClick=n.orbitbutton.onClick:n.orbittoolsbutton.onClick=null,n.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),n.orbittoolsbutton.setState(t.Button.State.ACTIVE))),i.setActiveNavigationTool("orbit"),i.setDefaultNavigationTool("orbit"),i.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},i.FusionOrbitExtension=n,e.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",n)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var e,t,i,n,o,r=Autodesk.Viewing,s=Autodesk.Viewing.Private,a=["fusion orbit","fusion orbit constrained"],l={HORIZONTAL:0,VERTICAL:1,ROLL:2},c={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},u={},h=r.isTouchDevice(),d=!1,p={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},g=this;this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null};var m=function(e){p.buttons[e.touches?0:e.button]=!0,p.src=e.target.className,p.x=0,p.y=0,p.dx=0,p.dy=0,p.firstMove=!0,p.mode=void 0,"ring"===p.src?p.mode=l.ROLL:"edgemark-area"===p.src&&("layout-ver"===e.target.parentNode.className?p.mode=l.HORIZONTAL:"layout-hor"===e.target.parentNode.className&&(p.mode=l.VERTICAL)),w(),e.stopPropagation()},v=function(e){p.buttons[e.touches?0:e.button]=!1,p.src=void 0},f=function(e){p.buttons[0]&&(E(e),A(),p.firstMove=!1)},E=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY;p.firstMove||(p.dx=t-p.x,p.dy=i-p.y),p.x=t,p.y=i},A=function(){switch(p.mode){case l.ROLL:if(!g.navapi.isActionEnabled("roll"))return;break;case l.HORIZONTAL:case l.VERTICAL:if(!g.navapi.isActionEnabled("orbit"))return}var e=o.target.clone().sub(o.position).normalize(),t=e.clone().cross(o.up).normalize(),i=t.clone().cross(e).normalize();if(o.up.copy(i),p.mode===l.ROLL){var r=new THREE.Vector3(p.x-u.center.x,p.y-u.center.y,0),s=new THREE.Vector3(p.dx,p.dy,0).add(r);r.normalize(),s.normalize();var a=r.clone().cross(s),h=Math.asin(a.z);o.up.applyAxisAngle(e,-h*c.ROLL)}else{var d,m;p.mode===l.HORIZONTAL?(m=-p.dx*c.HORIZONTAL,n&&(o.up=Autodesk.Viewing.Navigation.snapToAxis(o.up.clone())),d=o.up):p.mode===l.VERTICAL&&(m=-p.dy*c.VERTICAL,n?(p.firstMove&&(o.up=Autodesk.Viewing.Navigation.snapToAxis(o.up.clone())),d=e.clone().cross(o.up).normalize()):d=t,o.up.applyAxisAngle(d,m));var v=g.navapi.getPivotPoint(),f=o.position.clone().sub(v);f.applyAxisAngle(d,m),o.position.addVectors(v,f);var E=o.target.clone().sub(v);E.applyAxisAngle(d,m),o.target.addVectors(v,E)}o.dirty=!0},y=function(){var e=o.target.clone().sub(o.position).normalize(),t=g.viewer.impl.rayIntersect(new THREE.Ray(o.position,e));return t&&t.intersectPoint?t.intersectPoint:o.target},T=function(e,t){var i=t||e.clone().sub(o.position).normalize();return new THREE.Plane(i,-i.x*e.x-i.y*e.y-i.z*e.z)},w=function(){var e=o.target.clone().sub(o.position).normalize(),t=T(o.position,e).distanceToPoint(o.pivot);o.pivot.copy(e).multiplyScalar(t).add(o.position)},b=function(e){e.touches||0!==e.button||w()},C=function(e){d&&g.viewer.setActiveNavigationTool()},S=function(e,t){var i,n=g.viewer.impl.hitTest(e,t);i=n&&n.intersectPoint?n.intersectPoint:g.viewer.impl.viewportToRay(g.viewer.impl.clientToViewport(e,t)).intersectPlane(T(o.target));var r=o.position.clone().sub(y()).add(i);g.navapi.setRequestTransition(!0,r,i,o.fov)};this.register=function(){(e=s.stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html)).style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),(t=e.querySelector(".ring")).addEventListener("mousedown",m),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),function(e,t){e.addEventListener("mousedown",m),h&&e.addEventListener("touchstart",m)}),window.addEventListener("mouseup",v),window.addEventListener("mousemove",f),(i=e.querySelector(".outside")).addEventListener("mousedown",C);var n=e.querySelector(".circle");n.addEventListener("mousedown",b),h&&(t.addEventListener("touchstart",m),window.addEventListener("touchend",v),window.addEventListener("touchmove",f),i.addEventListener("touchstart",C),n.addEventListener("touchstart",b)),o=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",f),i.removeEventListener("mousedown",C),h&&(window.removeEventListener("touchend",v),window.removeEventListener("touchmove",f),i.removeEventListener("touchstart",C)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,i=void 0},this.activate=function(t){e.style.display="",this.handleResize(),n="fusion orbit constrained"===t;var i=this.viewer.toolController.isToolActivated("hyperlink");i&&this.viewer.toolController.deactivateTool("hyperlink"),n?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),i&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(t){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return a},this.getName=function(){return a[0]},this.update=function(){return!1},this.handleSingleClick=function(e,t){return S(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return S(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){var t,n=this.viewer.impl.canvas.getBoundingClientRect(),o=(t=n.width>n.height?new THREE.Vector2(((e.canvasX+.5)/n.width*2-1)*n.width/n.height,-(e.canvasY+.5)/n.height*2+1):new THREE.Vector2((e.canvasX+.5)/n.width*2-1,(-(e.canvasY+.5)/n.height*2+1)*n.height/n.width)).length()>1.2;return d!==o&&(i.style.cursor=o?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",d=o),!1},this.handleGesture=function(e){return w(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){var i=e.getBoundingClientRect();u.left=i.left+window.pageXOffset,u.top=i.top+window.pageYOffset,u.width=i.width,u.height=i.height,u.center={},u.center.x=u.left+u.width/2,u.center.y=u.top+u.height/2;var n=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);e.style.width=e.style.height=n+"px",e.style.top=e.style.left="calc(50% - "+n/2+"px)",t.style.borderWidth=.1*n+"px"}},AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function e(e,t,i){function o(t){n=t.data.msg;if(a.x=n.x1,a.y=n.y1,l.x=n.x2,l.y=n.y2,c=n.explode,n.command)if("gohome"==n.command)a.x=a.y=0,l.x=l.y=0,e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0),u=null;else if("select"==n.command)(i=e.impl.hitTestViewport(new THREE.Vector3(0,0,0)))?e.impl.selector.toggleSelection(i.dbId,i.model):e.impl.selector.clearSelection();else if("hide"==n.command){var i=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));i&&e.hide(i.dbId)}else if("fly"==n.command)u=u?null:r.target.clone().sub(r.position).normalize();else if("savepoint"==n.command){var n=s.getState(f);m.push(n),alertify.success("Savepoint created.")}else"nextsavepoint"==n.command&&m.length&&(v>=m.length&&(v=0),s.restoreState(m[v++]))}var r,s,a=new THREE.Vector2,l=new THREE.Vector2,c=0,u=null,h=e,d=.02,p=.002,g=1,m=[],v=0,f={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},E=function(){if(!e.impl.model.is2d()){var t=e.impl.model.getData().bbox.size().length();d*=t,p*=t,e.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E)}};e.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,E),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(e){if(t.addEventListener("joystick",o),i.addEventListener("joystick",o),r=h.navigation.getCamera(),h.model){var a=h.model.getBoundingBox();g=.001*a.size().length(),s=new n.ViewerState(h)}},this.deactivate=function(e){t.removeEventListener("joystick",o),i.removeEventListener("joystick",o),r=null,s=null,m.length=0},this.update=function(t){if(r.isPerspective||e.navigation.toPerspective(),u){var i=u.clone().multiplyScalar(p);r.position.add(i),r.target.add(i)}if(0!=c){var n=e.getExplodeScale()+.01*c;n>1&&(n=1),n<0&&(n=0),e.explode(n)}if(0==a.x&&0==a.y&&0==l.x&&0==l.y)return!(!u&&!c);var o=r.target.clone().sub(r.position),s=o.length();o.multiplyScalar(1/s);var h=o.clone().cross(r.up).normalize(),g=o.clone().multiplyScalar(a.y*d);r.position.add(g),r.target.add(g);var m=h.clone().multiplyScalar(a.x*d);r.position.add(m),r.target.add(m);var v=new THREE.Quaternion;v.setFromAxisAngle(h,.05*l.y);var f=o.clone().applyQuaternion(v);r.up.applyQuaternion(v);var E=new THREE.Quaternion;return E.setFromAxisAngle(r.worldup,.05*-l.x),f.applyQuaternion(E),r.up.applyQuaternion(E),f.multiplyScalar(s),r.target.copy(r.position).add(f),u&&u.copy(r.target).sub(r.position).normalize(),!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e,t){return!1},this.handleTouchChange=function(e,t){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=t.UI;n.Collaboration;i.RemoteControl=function(i,o){t.Extension.call(this,i,o),this.viewer=i,this.client=n.MessageClient.GetInstance(),this.p2p=new n.P2PClient(this.client),this.controllerTool=new e(i,this.client,this.p2p),i.toolController.registerTool(this.controllerTool)},i.RemoteControl.prototype=Object.create(t.Extension.prototype),i.RemoteControl.prototype.constructor=i.RemoteControl,i.RemoteControl.prototype.createUI=function(){var e=this,t=this.viewer;this.controlButton=new o.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===o.Button.State.INACTIVE?(e.connect(),this.setState(o.Button.State.ACTIVE)):(e.disconnect(),this.setState(o.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),t.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(t.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body);var i=Autodesk.Viewing.i18n.translate("Go to this link"),n=Autodesk.Viewing.i18n.translate("Scan the QR code with your device"),r=Autodesk.Viewing.i18n.translate("or");this.panel.body.innerHTML=['<p data-i18n="'+i+'">'+i+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>','<p data-i18n="'+r+'">'+r+"</p>",'<p data-i18n="'+n+'">'+n+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},i.RemoteControl.prototype.load=function(){function e(n){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),i.createUI()}var t=this.viewer,i=this;return t.modelTools&&t.modelTools.getNumberOfControls()>0?i.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),!0},i.RemoteControl.prototype.unload=function(){var e=this.viewer;if(this.p2p.hangup(),this.client.disconnect(),e.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{e.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(e){n.logger.error("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},i.RemoteControl.prototype.addCrosshair=function(){this.crosshair=n.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},i.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},i.RemoteControl.prototype.connect=function(e){if(this.client.isConnected())console.log("RemoteControl already connected");else{var t=this;n.loadDependency("lmv_io","socket.io-1.3.5.js",function(){t.connectAux(e)})}},i.RemoteControl.prototype.connectAux=function(e){var t=this,i=this.viewer;t.client.addEventListener("connectSucceeded",function(i){function o(){l&&l.setVisible(!1),t.p2p.removeEventListener("dataChannelAdded",o),t.addCrosshair()}n.logger.log("connect succeeded");var r=i.data.id+"rc";t.client.join(r);var s=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+r+"&env="+n.env,a="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(s),l=t.panel;l&&(l.link.href=s,l.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",l.qrImg.src=a,l.setVisible(!0)),t.p2p.addEventListener("dataChannelAdded",o),e&&e instanceof Function&&e(s)}),i.navigation.toPerspective(),t.client.connect(),i.toolController.activateTool(t.controllerTool.getName())},i.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},t.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",i.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(e){function t(){for(var e in x)if(x.hasOwnProperty(e)&&o.buttons[e].pressed&&.5!=o.buttons[e].value)return w[e]=!0,!0;for(var e in w)if(w.hasOwnProperty(e)&&w[e])return!0;return!(Math.abs(o.axes[k.LEFT_STICK_X])<y&&Math.abs(o.axes[k.LEFT_STICK_Y])<y&&Math.abs(o.axes[k.RIGHT_STICK_X])<y&&Math.abs(o.axes[k.RIGHT_STICK_Y])<y)}function i(){for(var e in S)S.hasOwnProperty(e)&&n(S[e])}function n(e){if(o.buttons[e].value>y)switch(w[e]=!0,e){case S.LEFT_SHOULDER:case S.RIGHT_SHOULDER:x[e]();break;case S.LEFT_TRIGGER:x[e](o.buttons[S.LEFT_TRIGGER].value);break;case S.RIGHT_TRIGGER:x[e](o.buttons[S.RIGHT_TRIGGER].value)}else if(w[e])switch(w[e]=!1,e){case S.SOUTH_BTN:case S.EAST_BTN:case S.WEST_BTN:case S.NORTH_BTN:case S.NORTH_DPAD:case S.SOUTH_DPAD:case S.WEST_DPAD:case S.EAST_DPAD:case S.RIGHT_STICK_BUTTON:case S.LEFT_STICK_BUTTON:x[e]();break;case S.LEFT_TRIGGER:x[e](o.buttons[S.LEFT_TRIGGER].value);break;case S.RIGHT_TRIGGER:x[e](o.buttons[S.RIGHT_TRIGGER].value)}}var o,r,s,a,l,c,u,h,d,p,g=Autodesk.Viewing.Private,m=e.navigation,v=e.container,f=m.getCamera(),E=1,A=0,y=.1,T=6,w={},b=new THREE.Clock(!0),C={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},S={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},k={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},M=function(){},x={};for(var R in S)S.hasOwnProperty(R)&&(x[S[R]]=M);this.activate=function(t){var i=e.model.getBoundingBox().size();E=Math.max(Math.min(Math.min(i.x,i.y),i.z)/10,1e-4),o=navigator.getGamepads()[0],a=new Autodesk.Viewing.Private.ViewerState(e),l=[],c=0,p=t,N(t)},this.deactivate=function(){p=null,a=null},this.update=function(e,n){if(n&&(f=n),e=b.getDelta(),o=navigator.getGamepads()[0],r>-1&&(new Date).getTime()-r>s&&V(),o&&(h=2*e*E*T,f.isPerspective||m.toPerspective(),o&&t())){f.dirty=!0,u&&(d=f.position.z);var a=f.target.clone().sub(f.position),l=a.length();a.multiplyScalar(1/l);var c=a.clone().cross(f.up).normalize();if(Math.abs(o.axes[k.LEFT_STICK_Y])>y){var p=a.clone().multiplyScalar(-o.axes[k.LEFT_STICK_Y]*h);f.position.add(p),f.target.add(p)}if(Math.abs(o.axes[k.LEFT_STICK_X])>y){var g=c.clone().multiplyScalar(o.axes[k.LEFT_STICK_X]*h);f.position.add(g),f.target.add(g)}var v=new THREE.Quaternion,A=a;if(Math.abs(o.axes[k.RIGHT_STICK_Y])>y){var w=f.clone(),C=a.clone();v.setFromAxisAngle(c,-o.axes[k.RIGHT_STICK_Y]*h/2),C.applyQuaternion(v),w.up.applyQuaternion(v);var S=w.worldup.clone(),M=C.angleTo(S),x=THREE.Math.degToRad(5);M>=x&&M<=Math.PI-x&&(A=a.clone().applyQuaternion(v),f.up.applyQuaternion(v))}var R=new THREE.Quaternion;Math.abs(o.axes[k.RIGHT_STICK_X])>y&&(R.setFromAxisAngle(f.worldup,-o.axes[k.RIGHT_STICK_X]*h/2),A.applyQuaternion(R),f.up.applyQuaternion(R)),i(),u&&(f.position.z=d),A.multiplyScalar(l),f.target.copy(f.position).add(A)}return f};var P=function(e,t,i,n,o){Autodesk.Viewing.Private.HudMessage.displayMessage(v,e,i,n,o),t>0?(r=(new Date).getTime(),s=t):(r=-1,s=0)},V=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},I=function(e){V();var t;switch(e){case"up":t=u?"Vertical Lock Mode":"Fly mode"}P({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t},2e3)},N=function(e){switch(e){case"headtracker":x[S.SOUTH_BTN]=G,x[S.SOUTH_DPAD]=D,x[S.NORTH_DPAD]=X,x[S.WEST_BTN]=Y,x[S.LEFT_SHOULDER]=L,x[S.RIGHT_SHOULDER]=O,x[S.LEFT_TRIGGER]=_,x[S.RIGHT_TRIGGER]=B,x[S.RIGHT_STICK_BUTTON]=W,x[S.LEFT_STICK_BUTTON]=j;break;default:x[S.SOUTH_BTN]=G,x[S.EAST_BTN]=F,x[S.WEST_BTN]=Y,x[S.NORTH_BTN]=q,x[S.SOUTH_DPAD]=D,x[S.WEST_DPAD]=z,x[S.EAST_DPAD]=U,x[S.NORTH_DPAD]=X,x[S.LEFT_SHOULDER]=L,x[S.RIGHT_SHOULDER]=O,x[S.LEFT_TRIGGER]=H,x[S.RIGHT_TRIGGER]=B,x[S.RIGHT_STICK_BUTTON]=W,x[S.LEFT_STICK_BUTTON]=j}},D=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},L=function(){u?d+=-o.buttons[S.LEFT_SHOULDER].pressed*h:f.translateY(-o.buttons[S.LEFT_SHOULDER].pressed*h)},O=function(){u?d+=o.buttons[S.RIGHT_SHOULDER].pressed*h:f.translateY(o.buttons[S.RIGHT_SHOULDER].pressed*h)},_=function(t){if(t>y){if(.5==t)return void e.explode(0);var i=A=t;i>1&&(i=1),i<0&&(i=0),e.explode(i)}else e.explode(0)},H=function(e){if(e>y){if(.5==e)return f.fov=75,void(w[S.LEFT_TRIGGER]=!1);f.fov=-45*e+75}else f.fov=75},B=function(e){if(e>y){if(.5==e)return void(w[S.RIGHT_TRIGGER]=!1);T=-5.5*e+6}else T=6},F=function(){var e=a.getState(C);l.push(e),g.logger.log("Savepoint created.")},z=function(){l.length&&(--c<0&&(c=l.length-1),a.restoreState(l[c]))},U=function(){l.length&&(++c>=l.length&&(c=0),a.restoreState(l[c]))},G=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==p&&f.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},W=function(){e.impl.selector.clearSelection()},j=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},Y=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},q=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},X=function(){(u=!u)&&(d=f.position.z),I("up")}}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var e=this,t=this.viewer;this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(t),t.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],t.getToolbar&&(t.getToolbar(!0)?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))),this.onResetBinded=this.onReset.bind(this),t.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return e.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,i),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var e=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),e.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(e.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var e=this.sectionStyle||"X";this.setSectionStyle(e,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(e,t){if(-1===this.supportedStyles.indexOf(e))return!1;var i=this.isActive(),n=this.sectionStyle!==e||!t;return this.sectionStyle=e,i&&n?this.tool.setSection(e):i||(this.enableSectionTool(!0),n?this.tool.setSection(e):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(e){var t=this.viewer.toolController,i=this.tool.isActive();return e&&!i?(t.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var e=this.viewer,t=Autodesk.Viewing.UI;this.sectionToolButton=new t.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var i=e.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(i){var n=i.getControl("toolbar-resetTool");n?i.addControl(this.sectionToolButton,{index:i.indexOf(n.getId())}):i.addControl(this.sectionToolButton,{index:0})}},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(e){function t(e,t){return function(){var i=e.getState(),o=function(){n.enableSectionTool(!0),e instanceof r.ComboButton==!1?n.tool.setSection(t):n.tool.attachControl(!0)};i===r.Button.State.INACTIVE?(e.setState(r.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o()):i===r.Button.State.ACTIVE&&(e.setState(r.Button.State.INACTIVE),n.enableSectionTool(!1)),n.sectionStyle=t}}function i(){var e=function(){var e=new THREE.Vector3;return function(t,i,n){return e.subVectors(t,i),e.lengthSq()<n}}(),t=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),a=o.autocam.getWorldRightVector(),l=o.autocam.getWorldUpVector(),c=o.autocam.getWorldFrontVector();e(l,t,1e-4)?n.sectionYButton.setIcon("adsk-icon-plane-x"):e(l,s,1e-4)?n.sectionYButton.setIcon("adsk-icon-plane-z"):n.sectionYButton.setIcon("adsk-icon-plane-y"),e(a,r,1e-4)?n.sectionXButton.setIcon("adsk-icon-plane-y"):e(a,s,1e-4)?n.sectionXButton.setIcon("adsk-icon-plane-z"):n.sectionXButton.setIcon("adsk-icon-plane-x"),e(c,t,1e-4)?n.sectionZButton.setIcon("adsk-icon-plane-x"):e(c,r,1e-4)?n.sectionZButton.setIcon("adsk-icon-plane-y"):n.sectionZButton.setIcon("adsk-icon-plane-z"),o.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)}var n=this,o=this.viewer,r=Autodesk.Viewing.UI,s=this.sectionXButton=new r.Button("toolbar-sectionTool-x");s.setToolTip("Add X plane"),s.setIcon("adsk-icon-plane-x"),s.onClick=t(s,"X"),e.addControl(s);var a=this.sectionYButton=new r.Button("toolbar-sectionTool-y");a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=t(a,"Y"),e.addControl(a);var l=this.sectionZButton=new r.Button("toolbar-sectionTool-z");l.setToolTip("Add Z plane"),l.setIcon("adsk-icon-plane-z"),l.onClick=t(l,"Z"),e.addControl(l);var c=this.sectionBoxButton=new r.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=t(c,"BOX"),e.addControl(c),o.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var e=this.viewer.getToolbar(!1);if(e){var t=e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(t&&this.sectionToolButton){var i=t.getControl("toolbar-inspectSubMenu");i?i.removeControl(this.sectionToolButton.getId()):t.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(e,t){function i(){V||((E=new THREE.TransformControls(y.camera,y.canvas,"transrotate")).addEventListener("change",o),E.setSnap(Math.PI/2,Math.PI/36),(A=new THREE.TransformControls(y.camera,y.canvas,"translate")).addEventListener("change",o),void 0===y.overlayScenes[R]&&y.createOverlayScene(R),y.addOverlay(R,E),y.addOverlay(R,A),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,r),e.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,s),e.addEventListener(Autodesk.Viewing.HIDE_EVENT,s),e.addEventListener(Autodesk.Viewing.SHOW_EVENT,s),V=!0)}function n(){V&&(y.removeOverlay(R,E),E.removeEventListener("change",o),E=null,y.removeOverlay(R,A),A.removeEventListener("change",o),A=null,y.removeOverlayScene(R),e.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,r),e.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,s),e.removeEventListener(Autodesk.Viewing.HIDE_EVENT,s),e.removeEventListener(Autodesk.Viewing.SHOW_EVENT,s),V=!1)}function o(){y.invalidate(!1,!1,!0)}function r(){E&&E.update(),A&&A.update()}function s(){1===k.length&&(u(!0),r(),l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)))}function a(e){return e.color||new THREE.Color(16777215)}function l(e){init_three_triangulator(),init_three_intersector();var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t);var i=new THREE.Object3D;i.name="section",y.sceneAfter.add(i);var n=new THREE.Object3D;i.add(n);var o=new THREE.Object3D;i.add(o);var r=Autodesk.Viewing.Private,s=r.Intersector.makePlaneBasis(e),l=(new THREE.Matrix4).getInverse(s),c=y.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),u=y.matman().findMaterial(null,c);u.transparent=!0,u.depthTest=!0,u.polygonOffset=!0,u.polygonOffsetFactor=-1,u.polygonOffsetUnits=.1;var h=new THREE.Box3;y.getVisibleBounds(!0).size().length();y.modelQueue().getModels().forEach(function(t){var i=t.getData().instanceTree;if(i){var c=t.getFragmentList();i.enumNodeChildren(t.getRootId(),function(t){if(!i.isNodeHidden(t)&&!i.isNodeOff(t)){var d,p=[];if(i.enumNodeFragments(t,function(t){c.getWorldBounds(t,h),r.Intersector.intersectBoxPlane(e,h)&&(d=c.getVizmesh(t)).geometry&&(d.geometry.is2d||d.geometry.isLines||d.material.cutplanes&&r.Intersector.intersectMeshPlane(e,d,p))},!1),p.length){var g=new THREE.Box3;r.Intersector.convertToPlaneCoords(s,p,g);var m=new r.VertexBufferBuilder(!1,8*p.length),v=a(d.material),f=0|.25*v.r*255.5,E=0|.25*v.g*255.5,A=0|.25*v.b*255.5,T=4278190080|A<<16|E<<8|f,w=new r.Triangulator.ContourSet(p,g);w.snapEdges(),w.sanitizeEdges(),w.stitchContours();for(N=0;N<w.contours.length;N++)for(var b=w.contours[N],f=0|255.5*Math.random(),E=0|255.5*Math.random(),C=(A=0|255.5*Math.random(),b[0],b[b.length-1],1);C<b.length;C++){var S=w.pts[b[C-1]],k=w.pts[b[C]];m.addSegment(S.x,S.y,k.x,k.y,0,.02,T,t,0)}var M={mesh:m.toMesh()};r.BufferGeometryUtils.meshToGeometry(M);var x=M.geometry;x.streamingDraw=!0,x.streamingIndex=!0;var R=new THREE.Mesh(x,u);R.matrix.copy(l),R.matrixAutoUpdate=!1,R.frustumCulled=!1,o.add(R);var P=new r.Triangulator.TriangulatedSurface(w);if(P.indices.length){for(var V=new THREE.BufferGeometry,I=new Float32Array(3*P.pts.length),N=0;N<P.pts.length;N++)I[3*N]=P.pts[N].x,I[3*N+1]=P.pts[N].y,I[3*N+2]=0;V.addAttribute("position",new THREE.BufferAttribute(I,3));for(var D=d.material.packedNormals,L=D?new Uint16Array(2*P.pts.length):new Float32Array(3*P.pts.length),N=0;N<P.pts.length;N++)if(D){var O=.5*(0/Math.PI+1);L[2*N]=65535*O|0,L[2*N+1]=65535}else L[3*N]=0,L[3*N+1]=0,L[3*N+2]=1;V.addAttribute("normal",new THREE.BufferAttribute(L,D?2:3)),D&&(V.attributes.normal.bytesPerItem=2,V.attributes.normal.normalize=!0);var _=new Uint16Array(P.indices.length);_.set(P.indices),V.addAttribute("index",new THREE.BufferAttribute(_,1)),V.streamingDraw=!0,V.streamingIndex=!0;var H=y.matman().cloneMaterial(d.material);H.packedNormals=D,H.cutplanes=null,H.side=THREE.FrontSide,H.depthTest=!0,H.map=null,H.bumpMap=null,H.normalMap=null,H.alphaMap=null,H.specularMap=null,H.transparent=!1,H.depthWrite=!0,H.hatchPattern=!0,H.needsUpdate=!0;var B=(d.material.id+2)*Math.PI*.125,F=Math.tan(B);H.hatchParams=new THREE.Vector2(F,10),H.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,H.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=H.prismType&&(H.defines={},H.defines[H.prismType.toUpperCase()]="","PrismWood"==H.prismType&&(H.defines.NO_UVW=""));var z=new THREE.Mesh(V,H);z.matrix.copy(l),z.matrixAutoUpdate=!1,z.dbId=t,z.fragId=p.fragId,n.add(z)}}}},!0)}})}function c(e,t){var i,n=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),e.normal);if(t){var o=e.projectPoint(t.max),r=e.projectPoint(t.min),s=n.clone().inverse();o.applyQuaternion(s),r.applyQuaternion(s);a=(new THREE.Vector3).subVectors(o,r);i=new THREE.PlaneBufferGeometry(a.x,a.y)}else{var a=2*(t=y.getVisibleBounds()).getBoundingSphere().radius;i=new THREE.PlaneBufferGeometry(a,a)}var l=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),c=new D.SectionMesh(i,l,e),u=e.projectPoint(t.center());c.position.copy(u),c.quaternion.multiply(n);for(var h=Autodesk.Viewing.Private.LightPresets[y.currentLightPreset()].bgColorGradient,d="rgb("+(255-h[0])+","+(255-h[1])+","+(255-h[2])+")",p=new THREE.LineBasicMaterial({color:d,linewidth:1,depthTest:!1}),g=c.geometry.getAttribute("position"),m=0;m<N.length;m++){(i=new THREE.Geometry).vertices.push((new THREE.Vector3).fromArray(g.array,N[m][0]*g.itemSize),(new THREE.Vector3).fromArray(g.array,N[m][1]*g.itemSize));var v=new THREE.Line(i,p);c.add(v),c.outlines.push(v)}return c}function u(e){h(function(t){if(t instanceof D.SectionMesh)if(t.connectivity.length>0){for(var i=(new THREE.Matrix4).getInverse(t.matrixWorld),n=new THREE.Vector3,o=t.geometry.getAttribute("position"),r=0;r<o.length/o.itemSize;r++){var s=t.connectivity[r];null!==L(t.plane,s[0],s[1],n)&&(n.applyMatrix4(i),o.setXYZ(r,n.x,n.y,n.z))}o.needsUpdate=!0,t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere();for(r=0;r<t.outlines.length;r++)(c=t.outlines[r]).geometry.vertices[0].fromArray(o.array,N[r][0]*o.itemSize),c.geometry.vertices[1].fromArray(o.array,N[r][1]*o.itemSize),c.geometry.verticesNeedUpdate=!0}else if(e){var a=y.getVisibleBounds(),l=2*a.getBoundingSphere().radius,n=t.plane.projectPoint(a.center());t.geometry=new THREE.PlaneBufferGeometry(l,l),t.position.copy(n);for(var o=t.geometry.getAttribute("position"),r=0;r<t.outlines.length;r++){var c=t.outlines[r];c.geometry.vertices[0].fromArray(o.array,N[r][0]*o.itemSize),c.geometry.vertices[1].fromArray(o.array,N[r][1]*o.itemSize),c.geometry.verticesNeedUpdate=!0}}})}function h(e){for(var t=0;t<S.length;t++)S[t].traverse(e)}function d(){h(function(e){e instanceof D.SectionMesh&&e.update()}),1===k.length&&l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),y.setCutPlanes(k)}function p(e){for(var t=0;t<S.length;t++)S[t].visible=e;C!==e&&o(),C=e}function g(t){t&&k.length>0&&(1===k.length&&l((new THREE.Plane).setComponents(k[0].x,k[0].y,k[0].z,k[0].w)),e.setCutPlanes(k)),p(t)}function m(e,t){e.attach(t),e.setPosition(t.position),e.visible=!0}function v(e){y.api.navigation.getEyeVector().dot(e)>0&&e.negate();var t=new THREE.Group,i=c(new THREE.Plane(e,0),null);t.add(i),k.push(i.planeVec),S.push(t),y.addOverlay(R,t),m(E,i),E.showRotationGizmos(!0),M=E.getPicker(),d()}function f(){for(var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],t=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],i=new THREE.Group,n=y.getVisibleBounds(),o=n.center(),r=new THREE.Box3(n.min,o),s=[],a=[],l=0;l<e.length;l++){var u=new THREE.Plane(e[l],-1*o.dot(e[l]));if(s.push(u),l>2){var h=u.orthoPoint(r.max),p=u.orthoPoint(r.min),g=(new THREE.Vector3).subVectors(h,p);u.constant-=g.length()}v=c(u,r);i.add(v),a.push(v),k.push(v.planeVec)}for(l=0;l<a.length;l++)for(var v=a[l],f=t[l],T=0;T<f.length;T++){for(var w=[],b=f[T],C=0;C<b.length;C++)w.push(s[b[C]]);v.connectivity.push(w)}S.push(i),y.addOverlay(R,i),m(E,S[0].children[0]),m(A,S[0]),E.showRotationGizmos(!1),M=E.getPicker().concat(A.getPicker()),d()}var E,A,y=e.impl,T=["section"],w=!1,b=!1,C=!0,S=[],k=[],M=[],x="",R="gizmo",P=null,V=!1,I=!0,N=[[0,1],[1,3],[3,2],[2,0]],D=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var L=function(){var e=new THREE.Matrix3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(o,r,s,a){e.set(o.normal.x,o.normal.y,o.normal.z,r.normal.x,r.normal.y,r.normal.z,s.normal.x,s.normal.y,s.normal.z);var l=e.determinant();return 0===l?null:(t.crossVectors(r.normal,s.normal).multiplyScalar(-o.constant),i.crossVectors(s.normal,o.normal).multiplyScalar(-r.constant),n.crossVectors(o.normal,r.normal).multiplyScalar(-s.constant),(a||new THREE.Vector3).copy(t).add(i).add(n).divideScalar(l))}}(),O=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Raycaster,n=y.camera;return function(o,r,s){var a=y.canvas.getBoundingClientRect(),l=(o.clientX-a.left)/a.width*2-1,c=-(o.clientY-a.top)/a.height*2+1;n.isPerspective?(e.set(l,c,.5),e.unproject(n),i.set(n.position,e.sub(n.position).normalize())):(e.set(l,c,-1),e.unproject(n),t.set(0,0,-1),i.set(e,t.transformDirection(n.matrixWorld)));var u=i.intersectObjects(r,s);return u[0]?u[0]:null}}();this.isActive=function(){return w},this.setSection=function(e){switch(this.clearSection(),e){case"X":v(t=new THREE.Vector3(1,0,0));break;case"Y":v(t=new THREE.Vector3(0,1,0));break;case"Z":var t=new THREE.Vector3(0,0,1);v(t);break;case"BOX":f()}x=e},this.clearSection=function(){for(E&&E.detach(),A&&A.detach();k.length>0;)k.pop();for(;S.length>0;){var e=S.pop();y.removeOverlay(R,e)}var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t),y.setCutPlanes()},this.isPlaneOn=function(){return C},this.showPlane=function(e){p(e)},this.attachControl=function(e){e?(m(E,S[0].children[0]),E.highlight(),"BOX"===x&&m(A,S[0])):(E.detach(),A.detach())},this.resetSection=function(){this.setSection(x)},this.getNames=function(){return T},this.getName=function(){return T[0]},this.register=function(){},this.deregister=function(){this.clearSection(),n()},this.activate=function(e){i(),w=!0,b=!1,I=!0,k=k||[],g(!0)},this.deactivate=function(e){w=!1,b=!1;var t=y.sceneAfter.getObjectByName("section");t&&y.sceneAfter.remove(t),g(!1),y.setCutPlanes(),E.detach(),A.detach()},this.update=function(e){return!1},this.handleSingleClick=function(e,t){var i=e.pointers?e.pointers[0]:e,n=O(i,S[0].children);return n&&(m(E,n.object),E.highlight(),o()),!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return b=!0,!!A.onPointerDown(e)||E.onPointerDown(e)},this.handleButtonUp=function(e,t){return b=!1,!!A.onPointerUp(e)||E.onPointerUp(e)},this.handleMouseMove=function(e){if(b){if(A.onPointerMove(e))return d(),E.update(),!0;if(E.onPointerMove(e))return d(),u(),!0}if("touch"!==e.pointerType){var t=e.pointers?e.pointers[0]:e,i=O(t,S[0].children);i&&(I=!1);var n=!!(I||i||O(t,M,!0));E.visible=n,A.visible=void 0!==A.object&&n,p(n)}return!!A.onPointerHover(e)||E.onPointerHover(e)},this.handleGesture=function(e){switch(e.type){case"dragstart":return P="drag",this.handleButtonDown(e,0);case"dragmove":return"drag"===P&&this.handleMouseMove(e);case"dragend":return"drag"===P&&(P=null,this.handleButtonUp(e,0))}return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){},this.handlePressHold=function(e){return!0}},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var SimulationDef=function(){function e(){var e=this;e.SimulationStudies={LSS:"SimCaseLSS",MODAL:"SimCaseModalFrequencies",BUCKLING:"SimCaseStructuralBuckling",THERMAL:"SimCaseThermalSteady",THERMALSTRESS:"SimCaseThermalStress",SHAPEGENERATOR:"SimCaseTopOpt",NAMES:{UNKNOWN:"Unknown",LSS:"Static Stress",MODAL:"Modal Frequencies",BUCKLING:"Structural Buckling",THERMAL:"Thermal",THERMALSTRESS:"Thermal Stress",SHAPEGENERATOR:"Shape Optimization"}},e.studyNode,e.loadCases={},e.pointMasssesNode=-1,e.pointMassNodes=[],e.connectorsNode=-1,e.connectorNodes=[],e.activeLoadCaseKey=null,e.modelNodes=[],e.analysisType=e.SimulationStudies.LSS,e.modelStructurePanel=null,e.simExt=null,e.simNodes=[]}e.prototype={constructor:e};var t=e.prototype;return t.studyName=function(){var e=this.SimulationStudies.NAMES.UNKNOWN;return this.analysisType===this.SimulationStudies.LSS?e=this.SimulationStudies.NAMES.LSS:this.analysisType===this.SimulationStudies.MODAL?e=this.SimulationStudies.NAMES.MODAL:this.analysisType===this.SimulationStudies.BUCKLING?e=this.SimulationStudies.NAMES.BUCKLING:this.analysisType===this.SimulationStudies.THERMAL?e=this.SimulationStudies.NAMES.THERMAL:this.analysisType===this.SimulationStudies.THERMALSTRESS?e=this.SimulationStudies.NAMES.THERMALSTRESS:this.analysisType===this.SimulationStudies.SHAPEGENERATOR&&(e=this.SimulationStudies.NAMES.SHAPEGENERATOR),e},t.reset=function(){var e=this;e.studyNode=-1,e.modelNodes=[],e.analysisType=e.SimulationStudies.LSS,e.loadCases={},e.pointMasssesNode=-1,e.pointMassNodes=[],e.connectorsNode=-1,e.connectorNodes=[],e.activeLoadCaseKey=null,e.simNodes=[],e.modelStructurePanel=null},t.addLoadCase=function(e,t,i){var n=this,o=new aves.Fusion360Sim.SimulationLoadCaseDef;return o.loadCase=i,o.loadCaseName=e,n.loadCases["SIM_LOAD_CASE"+t]=o,1===Object.keys(n.loadCases).length&&(n.activeLoadCaseKey="SIM_LOAD_CASE"+t),o},t.shouldDisplayInTree=function(e){var t=this,i=e.dbId;if(t.simNodes.indexOf(i)<0)return!1;if(t.studyNode===i)return!0;if(null===t.activeLoadCaseKey)return!1;if(t.pointMasssesNode===i)return!0;if(-1!==t.pointMassNodes.indexOf(i))return!0;if(-1!==t.connectorNodes.indexOf(i))return!0;if(t.connectorsNode===i)return!0;for(var n=Object.keys(t.loadCases),o=0;o<n.length;o++){var r=t.loadCases[n[o]];if(r.isImportant(i))return r.shouldDisplayInTree(i)}return!1},e}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=SimulationDef;var SimulationLoadCaseDef=function(){function e(){var e=this;e.loadCase=-1,e.loadCaseName="",e.constraintsNode=-1,e.constraintNodes=[],e.loadsNode=-1,e.loadNodes=[],e.resultsNode=-1,e.undeformedResults=-1,e.resultTypes={},e.resultGroups={},e.modalResults={}}e.prototype={constructor:e};var t=e.prototype;return t.associateResult=function(e,t){this.resultTypes[t]=e},t.associateResultGroup=function(e,t){this.resultGroups[t]=e},t.associateModalResult=function(e,t){var i=[];if(i=this.modalResults[e])i.push(t);else{var n=[];n.push(t),i=n}this.modalResults[e]=i},t.isImportant=function(e){var t=this;return t.loadCase===e||(-1!==t.loadNodes.indexOf(e)||(-1!==t.constraintNodes.indexOf(e)||(t.resultsNode===e||(t.constraintsNode===e||t.loadsNode===e))))},t.shouldDisplayInTree=function(e){var t=this;return t.loadCase===e||(-1!==t.loadNodes.indexOf(e)||(-1!==t.constraintNodes.indexOf(e)||t.resultsNode!==e&&(t.constraintsNode===e||t.loadsNode===e)))},t.reset=function(){var e=this;e.constraintsNode=-1,e.constraintNodes=[],e.loadsNode=-1,e.loadNodes=[],e.resultsNode=-1,e.undeformedResults=-1,e.resultTypes={},e.resultGroups={},e.modalResults={}},e}();Autodesk.Viewing.Extensions.Fusion360Sim.SimulationLoadCaseDef=SimulationLoadCaseDef,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var _ave=(av=Autodesk.Viewing).Extension,aves=av.Extensions,avem=av.theExtensionManager,avu=av.UI,i18n=av.i18n,GalleryPanel=function(){function e(e,t){if(e&&t){var i=e.style.cssText.trim();";"===i.substring(i.length-1)||(i+=";");var n=[];for(var o in t)n[n.length]=[o,t[o]].join(":");n=n.join(";"),e.style.cssText=n}}function t(){var e,t,i,n,o,r,s,a,l,c,u,h,d=this;avu.DockingPanel.prototype.initialize.call(d);var p=d.container;p.classList.add("propertyPanel","simulation-container","position-"+(d.position||"left")+"-corner"),p.dockRight=!0,n=d.legend=document.createElement("div");var g=document.createDocumentFragment(),m=document.createElement("div");m.classList.add("sim-div-Results"),(i=d.resultsGroup=document.createElement("select")).classList.add("simulation-resultGroup"),m.appendChild(i),(o=d.resultTypes=document.createElement("select")).classList.add("simulation-resultTypes"),m.appendChild(o),g.appendChild(m);var v=document.createElement("div");v.classList.add("sim-div-options"),(t=d.optUndeformed=document.createElement("input")).classList.add("sim-undeformedOption"),t.setAttribute("type","checkbox"),t.setAttribute("name","optUndeformed"),t.setAttribute("id","Undeformed"),t.addEventListener("change",function(e){var t=d.simDef.loadCases[d.simDef.activeLoadCaseKey];null!==t&&-1!==t.undeformedResults&&(d.optUndeformed.checked?d.viewer.show(t.undeformedResults):d.viewer.hide(t.undeformedResults))}),t.checked=!1,v.appendChild(t),t.checked=!1,(e=d.labelUndeformed=document.createElement("label")).classList.add("sim-undeformedOptionText"),e.htmlFor="Undeformed",e.setAttribute("data-i18n","Show Undeformed Model"),e.textContent=i18n.translate("Show Undeformed Model"),v.appendChild(e),g.appendChild(v),(r=d.divColorScale=document.createElement("div")).classList.add("sim-div-colorscale"),r.classList.add("sim-div-colorscale-top1"),(s=d.colorScale=document.createElement("div")).classList.add("simulation-colorscale"),r.appendChild(s),(a=d.colorScaleTopText=document.createElement("div")).classList.add("sim-colorScaleTopText"),a.innerHTML="- 3333",r.appendChild(a),(l=d.colorScaleBottomText=document.createElement("div")).classList.add("sim-colorScaleBottomText"),l.innerHTML="- 3333",r.appendChild(l),g.appendChild(r),(c=d.line2=document.createElement("hr")).classList.add("sim-line2"),g.appendChild(c);var f=document.createElement("div");f.classList.add("sim-div-Table"),f.addEventListener("click",function(e){f.classList.add("sim-div-Table-Collapse"),p.classList.add("simulation-container-Collapse"),r.classList.add("sim-div-colorscale-Collapse")}),r.addEventListener("click",function(e){f.classList.remove("sim-div-Table-Collapse"),p.classList.remove("simulation-container-Collapse"),r.classList.remove("sim-div-colorscale-Collapse")}),u=d.tbl=document.createElement("table"),h=d.tblBody=document.createElement("tbody"),u.appendChild(h),u.classList.add("sim-table"),f.appendChild(u),g.appendChild(f),n.appendChild(g),p.appendChild(n)}function i(e,t){for(var i=0;i<e.length;++i){var n=e[i];if(n.displayName===t)return n.displayValue}return null}function n(t,i){var n=!1,o='""';i<=1&&(n=!0,o="none"),t.disabled=n,e(t,{"-webkit-appearance":o,"-moz-appearance":o,appearance:o})}function o(e,t){var i=this;t=t||{},i.viewer=e,i.simDef=null,avu.DockingPanel.call(i,e.container,"Simulation-Panel","Simulation Results"),i.position=t.position||"right"}o.prototype=Object.create(avu.DockingPanel.prototype);var r=o.prototype;return r.constructor=o,r.initialize=function(){var e=this;t.call(e),e.resultsGroup.addEventListener("change",function(t){var i=e.simDef,n=i.loadCases[e.simDef.activeLoadCaseKey];e.viewer.hide(n.resultsNode);var o="fillResultTypes";i.modalAnalysis&&(o="fillModalResultTypes"),e[o](i.activeLoadCaseKey,e.resultsGroup.value),setTimeout(function(){e.setSimObjectsVisibility()},100)}),e.resultTypes.addEventListener("change",function(){var t=e.simDef.loadCases[e.simDef.activeLoadCaseKey];e.viewer.hide(t.resultsNode),e.setSimObjectsVisibility()})},r.setSimulationDef=function(e){function t(e){var t=i(e.properties,"Name");c.setTitle(t)}function n(e,t,i){}function o(e){var t=i(e.properties,"Elements"),n=i(e.properties,"Nodes");c.rowElements.cells[1].innerText=t,c.rowNodes.cells[1].innerText=n}var r,s,a,l,c=this;c.simDef=e,r=1*e.studyNode,-1===e.undeformedResults&&(c.optUndeformed.classList.add("sim-hide"),c.labelUndeformed.classList.add("sim-hide"),c.divColorScale.classList.remove("sim-div-colorscale-top1"),c.divColorScale.classList.add("sim-div-colorscale-top2")),c.viewer.getProperties(r,t,n),s=i18n.translate(e.studyName()),a=c.tblBody,c.rowType?c.rowType.cells[1].innerHTML=s:[{name:"rowType",content:[i18n.translate("Analysis Type"),s]},{name:"rowNodes",content:[i18n.translate("Nodes"),"1872"]},{name:"rowElements",content:[i18n.translate("Elements"),"1084"]},{name:"rowMin",content:[i18n.translate("Min"),"0.000E+02 MPa"]},{name:"rowMax",content:[i18n.translate("Max"),"5.117E+02 MPa"]}].forEach(function(e){c[e.name]=a.insertRow(-1),e.content.forEach(function(t){c[e.name].insertCell(-1).innerHTML=t})}),(l=c.viewer).model.getObjectTree(function(t){c.instanceTree=t,c.fillResultsGroup(c.simDef.activeLoadCaseKey);var i=e.analysisType===e.SimulationStudies.MODAL||e.analysisType===e.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes";c[i](c.simDef.activeLoadCaseKey,c.resultsGroup.value),setTimeout(function(){e.simExt.showResultsDlg(!0),e.simExt.applySettings(),c.setSimObjectsVisibility()},500)});var u=+c.simDef.resultsNode;l.getProperties(u,o,n)},r.processNodes=function(e,t){function n(e,t){function n(n){var o=n.properties,r=i(n.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87");if(r){switch(r){case"SIM_STUDY":a.studyNode=e;var s=i(n.properties,"Study Type");a.analysisType=s;break;case"SIM_POINT_MASSES":a.pointMasssesNode=e;break;case"SIM_POINT_MASS":a.pointMassNodes.push(e);break;case"SIM_CONNECTORS":a.connectorsNode=e;break;case"SIM_CONNECTOR":a.connectorNodes.push(e);break;case"SIM_LOAD_CASE":c=a.addLoadCase(i(n.properties,"Name"),e,e);break;case"SIM_CONSTRAINTS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.constraintsNode=e;break;case"SIM_CONSTRAINT":c.constraintNodes.push(e);break;case"SIM_LOADS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.loadsNode=e;break;case"SIM_LOAD":c.loadNodes.push(e);break;case"SIM_RESULTS_SCALAR_PLOT":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),a.analysisType===a.SimulationStudies.LSS||a.analysisType===a.SimulationStudies.THERMAL||a.analysisType===a.SimulationStudies.THERMALSTRESS||a.analysisType===a.SimulationStudies.SHAPEGENERATOR?c.associateResult(i(o,"Name"),e):c.associateModalResult(i(o,"Name"),e);break;case"SIM_RESULTS_GROUP":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),a.analysisType!==a.SimulationStudies.LSS&&a.analysisType!==a.SimulationStudies.THERMAL&&a.analysisType!==a.SimulationStudies.THERMALSTRESS&&a.analysisType!==a.SimulationStudies.SHAPEGENERATOR||c.associateResultGroup(i(o,"Name"),e);break;case"SIM_RESULTS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.resultsNode=e;break;case"SIM_RESULTS_UNDEFORMED_FEATURE_EDGES_PLOT":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.undeformedResults=e}a.simNodes.push(e)}else a.modelNodes.push(e);t()}function o(e,i,n){t()}e&&l&&l.getProperties(e,n,o)}function o(){s.length>0?n(s.shift(),o):t(a)}var r=this,s=[],a=r.simDef,l=r.viewer,c=null;a?a.reset():a=new aves.Fusion360Sim.SimulationDef,e.enumNodeChildren(e.getRootId(),function(e){s[s.length]=e},!0),o()},r.initModel=function(e,t){var i=this;i.viewer&&(i.processNodes(e,function(e){e.simExt=t,i.setSimulationDef(e)}),i.addEventListener(i.viewer,av.SELECTION_CHANGED_EVENT,function(e){var t=e.nodeArray;t&&i.handleClick(t[0])}))},r.fillResultsGroup=function(e){var t=this,i=t.simDef,o=i.loadCases[e],r=t.resultsGroup;r.options.length=0;for(var s=Object.keys(i.analysisType===i.SimulationStudies.MODAL||i.analysisType===i.SimulationStudies.BUCKLING?o.modalResults:o.resultGroups),a=0;a<s.length;a++){var l=document.createElement("option");l.value=s[a];var c=i.analysisType===i.SimulationStudies.MODAL||i.analysisType===i.SimulationStudies.BUCKLING?s[a]:o.resultGroups[s[a]];l.setAttribute("data-i18n",c),l.textContent=i18n.translate(c),r.add(l)}n(r,r.options.length,!1)},r.fillResultTypes=function(e,t){function o(e,t,i){}function r(e){function t(e){if(i(e.properties,r)===s){var t=document.createElement("option");t.value=e.dbId;var o=u.resultTypes[e.dbId];t.setAttribute("data-i18n",o),t.textContent=i18n.translate(o),l.add(t),n(l,l.options.length,0===c.options.length)}}for(var r="Result group",s=i(e.properties,r),h=Object.keys(u.resultTypes),d=0;d<h.length;d++){var p=+h[d];a.getProperties(p,t,o)}}var s=this,a=s.viewer,l=s.resultTypes,c=s.resultsGroup,u=s.simDef.loadCases[e];l.options.length=0;var h=+t;a.getProperties(h,r,o)},r.fillModalResultTypes=function(e,t){function o(e){if(i(e.properties,"Result type")===u){var t=document.createElement("option");t.value=e.dbId;var o=i(e.properties,"Mode");t.setAttribute("data-i18n",o),t.textContent=o,s.resultTypes.add(t),n(a,a.options.length,0===l.options.length)}}function r(e,t,i){}var s=this,a=s.resultTypes,l=s.resultsGroup,c=s.simDef.loadCases[e];a.options.length=0;for(var u=t,h=c.modalResults[u]||[],d=0;d<h.length;d++){var p=+h[d];s.viewer.getProperties(p,o,r)}},r.uninitialize=function(){avu.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},r.setTitle=function(e,t){e||(e="Simulations",(t=t||{}).localizeTitle=!0),avu.DockingPanel.prototype.setTitle.call(this,e,t)},r.setModelNodesVisible=function(e){var t=this,i=t.viewer;if(t.simDef){var n=t.simDef.modelNodes;if(n&&n.length>0)for(var o=0;o<n.length;o++)i[e?"show":"hide"](n[o])}},r.setNodeVisibility=function(e,t){this.viewer[t?"show":"hide"](e)},r.isSimStudyNode=function(e){return!!this.simDef.studyNode&&this.simDef.studyNode===e},r.handleClick=function(e){var t=this;if(null===t.simDef)return!1;var i=t.simDef.loadCases[t.simDef.activeLoadCaseKey];if(null===i)return!1;for(var n=Object.keys(t.simDef.loadCases),o=0;o<n.length;o++){var r=t.simDef.loadCases[n[o]];if(r.isImportant(e)&&i!==r){-1!==i.loadsNode&&t.viewer.hide(i.loadsNode),-1!==i.constraintsNode&&t.viewer.hide(i.constraintsNode),-1!==i.undeformedResults&&t.viewer.hide(i.undeformedResults),-1!==i.resultsNode&&t.viewer.hide(i.resultsNode),t.simDef.activeLoadCaseKey=n[o],t.fillResultsGroup(t.simDef.activeLoadCaseKey);var s=t.simDef.analysisType===t.simDef.SimulationStudies.MODAL||t.simDef.analysisType===t.simDef.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes";return t[s](t.simDef.activeLoadCaseKey,t.resultsGroup.value),setTimeout(function(){t.simDef.simExt.showResultsDlg(!0),t.setSimObjectsVisibility()},500),!0}}return!1},r.setSimObjectsVisibility=function(e){function t(e){var t=i(e.properties,"Minimal value"),n=i(e.properties,"Maximal value"),r=i(e.properties,"Scale reversed"),s=i(e.properties,"Unit");o.rowMin.cells[1].innerText=t+" "+s,o.rowMax.cells[1].innerText=n+" "+s;var a=i(e.properties,"Lower referential value"),l=i(e.properties,"Upper referential value");"True"===r?(o.colorScale.style.transform="rotate(90deg)",o.colorScale.style.moztransform="rotate(90deg)",o.colorScale.style.webkittransform="rotate(90deg)"):(o.colorScale.style.transform="rotate(-90deg)",o.colorScale.style.moztransform="rotate(-90deg)",o.colorScale.style.webkittransform="rotate(-90deg)"),o.colorScaleTopText.innerHTML="- "+l+" "+s,o.colorScaleBottomText.innerHTML="- "+a+" "+s}function n(e,t,i){}var o=this,r=o.simDef.loadCases[o.simDef.activeLoadCaseKey];if(!o.resultTypes||0===o.resultTypes.options.length||null===r)return o.setModelNodesVisible(!0),void o.simDef.simExt.showResultsDlg(!1);var s=+o.resultTypes.value;o.setModelNodesVisible(!1),-1!==s&&o.viewer.show(s),-1!==r.loadsNode&&o.viewer.show(r.loadsNode),-1!==r.constraintsNode&&o.viewer.show(r.constraintsNode),o.optUndeformed.checked&&-1!==r.undeformedResults&&o.viewer.show(r.undeformedResults),o.viewer.getProperties(s,t,n)},o}();aves.Fusion360Sim.GalleryPanel=GalleryPanel,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(e,t,i){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,e.viewer,t,i),this.viewer=e.viewer,this.ext=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(e){this.simGalleryPanel=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode)&&this.simGalleryPanel.simDef.studyNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&-1!==this.simGalleryPanel.simDef.modelNodes.indexOf(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(e){var t=this;if(!t.simGalleryPanel||!t.simGalleryPanel.simDef)return!1;if(t.isModelNode(e))return!0;if(t.isSimStudyNode(e))return!0;for(var i=t.simGalleryPanel.simDef,n=Object.keys(i.loadCases),o=0;o<n.length;o++)if(i.loadCases[n[o]].resultsNode===e)return!1;return!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(e,t){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.simGalleryPanel.handleClick(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim");var _ave=(av=Autodesk.Viewing).Extension,aves=av.Extensions,avem=av.theExtensionManager;av.GEOMETRY_LOAD_START="geometryLoadStarted";var Simulation=function(){function e(e,n){var o=this;n=n||{};for(var r in t)n[r]=n[r]||t[r];_ave.call(o,e,n),e.addEventListener(av.GEOMETRY_LOAD_START,function(e){i&&o.unload(),"Autodesk.Fusion360.Simulation"===e.data.extensions?i=!0:(o.unload(),i=!1)}),e.addEventListener(av.GEOMETRY_LOADED_EVENT,function(e){o.load()})}var t={},i=!1;e.prototype=Object.create(_ave.prototype);var n=e.prototype;return n.constructor=e,n.load=function(){var e=this,t=e.viewer;return!t.model||(e.galleryPanel=new aves.Fusion360Sim.GalleryPanel(e.viewer),e.viewer.addPanel(e.galleryPanel),e.simButton=new av.UI.Button("toolbar-simulation"),e.simButton.setVisible(!1),e.simButton.setToolTip("Simulation Results"),e.simButton.onClick=function(t){var i=e.galleryPanel.isVisible();e.galleryPanel.setVisible(!i),e.simButton.setState(i?av.UI.Button.State.INACTIVE:av.UI.Button.State.ACTIVE)},e.simButton.setIcon("toolbar-simulationIcon"),t.settingsTools.addControl(e.simButton,{index:1}),e.hideLines=t.prefs.get("lineRendering"),e.ghosting=t.prefs.get("ghosting"),e.ambientShadow=t.prefs.get("ambientShadows"),e.antialiazing=t.prefs.get("antialiasing"),e.lightPreset=t.prefs.get("lightPreset"),t.model.getObjectTree(function(t){setTimeout(function(){e.galleryPanel.initModel(t,e),e.initModelBrowser()},100)}),!0)},n.unload=function(){var e=this;if(e.viewer.model)return e.showResultsDlg(!1),e.viewer.settingsTools.removeControl(this.simButton),e.viewer.removePanel(this.galleryPanel),e.galleryPanel.uninitialize(),e.viewer.hideLines(!e.hideLines),e.viewer.setGhosting(e.ghosting),e.viewer.setQualityLevel(e.ambientShadow,e.antialiazing),e.viewer.setLightPreset(e.lightPreset),!0},n.initModelBrowser=function(){var e=this;setTimeout(function(){e.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(e,"Simulation Model Structure Loading",e.options),e.viewer.setModelStructurePanel(e.modelStructurePanel),e.modelStructurePanel.setGallery(e.galleryPanel)},100)},n.showResultsDlg=function(e){var t=this;t.simButton.setState(e?av.UI.Button.State.ACTIVE:av.UI.Button.State.INACTIVE),t.simButton.setVisible(e),t.galleryPanel.setVisible(e)},n.applySettings=function(){var e=this.viewer;e.hideLines(!1),e.setGhosting(!1),e.setQualityLevel(!1,!0),e.setLightPreset(4)},n.simData=function(){return this.galleryPanel.simDef},e}();aves.Simulation=Simulation,avem.registerExtension("Autodesk.Fusion360.Simulation",aves.Simulation),function(){"use strict";var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),i=function(t,i){e.Extension.call(this,t,i),this.tool=null};(i.prototype=Object.create(e.Extension.prototype)).constructor=i,i.prototype.load=function(){return this.tool=new t.HyperlinkTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),!0},i.prototype.unload=function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},t.HyperlinkExtension=i,e.theExtensionManager.registerExtension("Autodesk.Hyperlink",i)}(),function(){"use strict";var e=Autodesk.Viewing,t=function(t){e.ToolInterface.call(this),this.names=["hyperlink"];var i=this,n=-1,o=!1,r=[],s=[],a=null,l=null,c=null,u={},h=null,d=null,p=null;this.panel=null;var g=function(i,n,o,r){a||(a=document.createElement("div"),t.container.appendChild(a),a.setAttribute("data-i18n","Ctrl + Click to preview the link"),a.textContent=e.i18n.translate("Ctrl + Click to preview the link")),a.className="hyperlink-tooltip",a.style.top=n+20+"px",a.style.left=i+20+"px",a.intersectPoint=r},m=function(){a&&(t.container.removeChild(a),a=null)},v=function(){if(a){var e=t.navigation.getCamera(),i=t.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(a.intersectPoint);n.project(e);var o=Math.round((n.x+1)/2*i.width),r=Math.round((1-n.y)/2*i.height);a.style.left=o+20+"px",a.style.top=r+20+"px"}},f=function(n){t.removeEventListener(e.GEOMETRY_LOADED_EVENT,f);var o=t.model.getData();l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()},E=function(){i.panel&&i.panel.updatePosition(),v()};this.activate=function(n){if(t.model&&t.model.isLoadDone()){var o=t.model.getData();l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()}else t.addEventListener(e.GEOMETRY_LOADED_EVENT,f);t.addEventListener(e.CAMERA_CHANGE_EVENT,E)},this.deactivate=function(i){t.removeEventListener(e.CAMERA_CHANGE_EVENT,E),r=[],s=[],m(),this.panel&&(this.panel.uninitialize(),this.panel=null),t.HyperlinkBack&&(t.HyperlinkBack.uninitialize(),t.HyperlinkBack=null),t.impl.clearOverlay("Hyperlink-bBox"),t.impl.clearOverlay("Hyperlink-bBox-select")},this.update=function(e){return!1},this.handleSingleClick=function(o,a){this.clearSelection(),this.panel&&(this.panel.uninitialize(),this.panel=null);var l=t.impl.hitTest(o.canvasX,o.canvasY,!1);if(l){var c=l.dbId,u=t.model.getDocumentNode(),h=null;u&&(h=u.data.viewableID);var d=new THREE.Vector2(o.canvasX,o.canvasY);if(t.model.is2d()){for(var p in r)if((f=r[p]).dbId===c){var g=l.intersectPoint.x,v=l.intersectPoint.y;if(g>=f.bBox[0]&&g<=f.bBox[2]&&v>=f.bBox[1]&&v<=f.bBox[3]){if(f.node){E=f.node.data.name;this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,E,f.link,h,c,f.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,null,f.link,h);return this.highlightSelection(f.bBoxMesh),!0}}}else if(o.ctrlKey&&s[n]){this.controller.setIsLocked(!1),m();var f=s[n];if(f.node){var E=f.node.data.name;this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,E,f.link,h,c,f.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,d,l.intersectPoint,null,f.link,h,c);return!0}}return!1},this.handleButtonDown=function(e,t){return o=!0,!1},this.handleButtonUp=function(e,t){return o=!1,!1},this.handleMouseMove=function(e){if(!o){if(!t.model.is2d()){var i=t.impl.hitTest(e.canvasX,e.canvasY,!1);if(i){var r=i.dbId;if(r!=n&&(n=r,m()),this.panel&&this.panel.dbId===r)return;s.hasOwnProperty(n)?null!==s[n]&&g(e.canvasX,e.canvasY,s[n],i.intersectPoint):(s[n]=null,this.loadHyperlink3d(n,e.canvasX,e.canvasY,i.intersectPoint))}else m()}return!1}},this.getCursor=function(){return a?"pointer":null},this.loadHyperlinks=function(){if(l)for(var e=0;e<l.length;e++){var t=l[e];this.loadHyperlink2d(t,e)}},this.loadHyperlink2d=function(e,n){t.getProperties(e,function(o){for(var s=o.properties,a=0,l=s.length;a<l;a++){var c=s[a];if("__hyperlink__"===c.displayCategory){var u=null,h=c.displayValue,d=t.model.getDocumentNode();if(d){var p=(d=d.getRootNode()).search({viewableID:h});p&&p.length&&(u=p[0])}r[n]={dbId:e,link:h,node:u},i.highlightText(n);break}}})},this.loadHyperlink3d=function(e,i,n,o){t.getProperties(e,function(r){for(var a=r.properties,l=0,c=a.length;l<c;l++){var u=a[l];if("__hyperlink__"===u.displayCategory){var h=null,d=u.displayValue,p=t.model.getDocumentNode();if(p){var m=(p=p.getRootNode()).search({viewableID:d});m&&m.length&&(h=m[0])}s[e]={link:d,node:h},g(i,n,s[e],o);break}}})},this.getHyperlinks=function(){return _linkCache},this.getThumbnail=function(e,i,n){if(u.hasOwnProperty(e))n(u[e]);else{var o={urn:t.model.getData().urn,width:400,height:400,guid:encodeURIComponent(i.guid),acmsession:t.model.getData().acmSessionId},r=function(t){var i=new FileReader;i.onload=function(t){var i=t.target.result;u[e]=i,n(i)},i.readAsDataURL(t)},s={responseType:"blob",skipAssetCallback:!0,size:o.width,guid:o.guid},a="urn:"+o.urn;avp.ViewingService.getThumbnail(avp.initLoadContext(),a,r,null,s)}},this.highlightText=function(e){var t=c[4*e]-.2,i=c[4*e+1]-.2,n=c[4*e+2]+.2,o=c[4*e+3]+.2;r[e].bBox=[t,i,n,o],this.addRectangle(e,t,i,n,o)},this.addRectangle=function(e,i,n,o,s){var a=new THREE.Vector3(i,n,0),l=new THREE.Vector3(o,n,0),c=new THREE.Vector3(o,s,0),u=new THREE.Vector3(i,s,0),d=new THREE.Geometry;if(d.vertices.push(a),d.vertices.push(l),d.vertices.push(c),d.vertices.push(u),d.faces.push(new THREE.Face3(0,1,2)),d.faces.push(new THREE.Face3(0,3,2)),!h){h=new THREE.MeshBasicMaterial({color:240116,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene("Hyperlink-bBox")}var p=r[e].bBoxMesh=new THREE.Mesh(d,h,!0);t.impl.addOverlay("Hyperlink-bBox",p)},this.highlightSelection=function(e){if(p=e,t.impl.removeOverlay("Hyperlink-bBox",e),!d){d=new THREE.MeshBasicMaterial({color:16744272,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene("Hyperlink-bBox-select")}var i=new THREE.Mesh(e.geometry,d);t.impl.addOverlay("Hyperlink-bBox-select",i)},this.clearSelection=function(){p&&(t.impl.clearOverlay("Hyperlink-bBox-select"),t.impl.addOverlay("Hyperlink-bBox",p),p=null)}};AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink").HyperlinkTool=t}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),t=Autodesk.Viewing,i=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private,Autodesk.Viewing.UI,function(i,n,o,r,s,a,l,c,u,h){function d(e){p.thumbnail.src=e}var p=this;this.viewer=n,this.container=document.createElement("div"),this.container.className="hyperlink-container",n.container.appendChild(this.container),this.container.style.left=o.x+"px",this.container.style.top=o.y-70+"px",this.intersectPoint=r,this.dbId=c,this.triangle=document.createElement("div"),this.triangle.className="hyperlink-container-triangle",this.container.appendChild(this.triangle),this.panel=document.createElement("div"),this.panel.className="hyperlink-panel",this.container.appendChild(this.panel),this.title=document.createElement("div"),this.title.className="hyperlink-panel-title",s?this.title.textContent=s:(this.title.setAttribute("data-i18n","External Link"),this.title.textContent=t.i18n.translate("External Link")),this.panel.appendChild(this.title),u?(this.thumbnail=document.createElement("img"),this.thumbnail.className="hyperlink-panel-thumbnail",h(c,u,d),this.panel.appendChild(this.thumbnail)):(this.externalLink=document.createElement("div"),this.externalLink.className="hyperlink-panel-external-link",this.externalLink.textContent=a,this.panel.appendChild(this.externalLink)),this.viewButton=document.createElement("div"),this.viewButton.className="hyperlink-panel-view-button",this.viewButton.setAttribute("data-i18n","View"),this.viewButton.textContent=t.i18n.translate("View"),this.panel.appendChild(this.viewButton),this.viewButton.addEventListener("click",function(){p.uninitialize(),i.panel=null,n.HyperlinkBack&&(n.HyperlinkBack.uninitialize(),n.HyperlinkBack=null),n.fireEvent({type:t.HYPERLINK_EVENT,data:{href:a}}),u&&(n.HyperlinkBack=new e.HyperlinkBack(i,n,l))}),this.triangle.style.bottom=this.container.clientHeight-100+"px",this.boundsCheck()});i.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},i.prototype.boundsCheck=function(){var e=this.viewer.navigation.getScreenViewport(),t=this.container.clientWidth,i=this.container.clientHeight,n=parseInt(this.container.style.left,10),o=parseInt(this.container.style.top,10),r=n,s=o;n<0&&(r=0),o<0&&(s=0),e.width<n+t&&(r=e.width-t),e.height<o+i&&(s=e.height-i);var a=this.viewer.navigation.getEyeVector().length(),l=this.viewer.impl.clientToViewport(n,o),c=this.viewer.impl.clientToViewport(r,s);l.subVectors(l,c),this.viewer.navigation.panRelative(l.x/2,l.y/2,a),this.container.style.left=r+"px",this.container.style.top=s+"px"},i.prototype.updatePosition=function(){var e=this.viewer.navigation.getCamera(),t=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(this.intersectPoint);i.project(e);var n=Math.round((i.x+1)/2*t.width),o=Math.round((1-i.y)/2*t.height);this.container.style.left=n+"px",this.container.style.top=o-70+"px"},e.HyperlinkPanel=i;var n=function(e,i,n){var o=this;this.viewer=i,this.container=document.createElement("div"),this.container.className="hyperlink-back",i.container.appendChild(this.container),this.backButton=document.createElement("div"),this.backButton.className="hyperlink-back-button",this.backButton.setAttribute("data-i18n","Back"),this.backButton.textContent=t.i18n.translate("Back"),this.container.appendChild(this.backButton),this.backButton.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null,e.panel&&(e.panel.uninitialize(),e.panel=null),i.fireEvent({type:t.HYPERLINK_EVENT,data:{href:n}})}),this.closer=document.createElement("div"),this.closer.className="hyperlink-back-closer",this.closer.innerHTML="&times;",this.container.appendChild(this.closer),this.closer.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null})};n.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},e.HyperlinkBack=n}(),function(){"use strict";function e(e){this.viewer=e,this.mappingPromise=null,this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0}}function t(e){for(var t={},i=[],n=e.length,o=0,r=0;r<n;r++){var s=e[r];1!==t[s]&&(t[s]=1,i[o++]=s)}return i}var i=AutodeskNamespace("Autodesk.Viewing.Comments"),n=Autodesk.Viewing.Private,o=e.prototype;o.destroy=function(){this.viewer=null},o.createCommentObj=function(e){var t=this.viewer.getState(this.filter);return this.injectInfo(t,e),t},o.injectInfo=function(e,t){e.body=t.message||"",e.status="open",e.jsonVersion="2.0",e.inputSource="Web",e.type="geometry";var i=this.viewer.model.getDocumentNode();if(i&&(i=i.findParentGeom2Dor3D(),e.layoutName=i.data.guid,e.layoutIndex=i.data.order),t.point3d){var n=t.point3d;n instanceof THREE.Vector3&&(n=n.toArray()),this.pushTag(e,{name:"nodeOffset",value:n})}},o.isCommentForCurrentSheet=function(e){var t=this.viewer.model.getDocumentNode();return!t||(t=t.findParentGeom2Dor3D()).data.guid===e.layoutName},o.getManifestNode=function(e){var t=this.viewer.model.getDocumentNode();return t?t.getRootNode().findByGuid(e.layoutName):null},o.pushTag=function(e,t){Array.isArray(e.tags)||(e.tags=[]),e.tags.push(t)},o.getTag=function(e,t){var i=e.tags;if(i&&Array.isArray(i))for(var n=0,o=i.length;n<o;++n)if(i[n].name===t)return i[n];return null},o.getTagValue=function(e,t,i){var n=this.getTag(e,t);return n?n.value:i||null},o.exportCommentObj=function(e){var t=this;return new Promise(function(i){t.applyGlobalOffset(e),t.getMappingPromise().then(function(n){t.mapObjectSetLmvToExternal(e,n,function(e){i(e)})})})},o.importCommentObj=function(e){var t={};for(var i in this.filter)this.filter.hasOwnProperty(i)&&e.hasOwnProperty(i)&&(t[i]=e[i]);var n=JSON.parse(JSON.stringify(t)),o=this;return new Promise(function(e){o.getMappingPromise().then(function(t){o.mapObjectSetExternalToLmv(n,t),o.removeGlobalOffset(n),e(n)})})},o.applyGlobalOffset=function(e){var t=this.viewer.model.getData().globalOffset;if(t){this.applyOffsetToCamera(e.viewport,t);var i=this.getTag(e,"nodeOffset");return i&&this.applyOffset(i.value,t),!0}return!1},o.removeGlobalOffset=function(e){var t=this.viewer.model.getData().globalOffset;if(t){var i={x:-t.x,y:-t.y,z:-t.z};this.applyOffsetToCamera(e.viewport,i);var n=this.getTag(e,"nodeOffset");return n&&this.applyOffset(n.value,i),!0}return!1},o.applyOffsetToCamera=function(e,t){e&&t&&(this.applyOffset(e.eye,t),this.applyOffset(e.target,t),this.applyOffset(e.pivotPoint,t))},o.applyOffset=function(e,t){if(e){var i=Number(e[0])+t.x,n=Number(e[1])+t.y,o=Number(e[2])+t.z;e[0]="string"==typeof e[0]?i.toString():i,e[1]="string"==typeof e[1]?n.toString():n,e[2]="string"==typeof e[2]?o.toString():o}},o.mapObjectSetLmvToExternal=function(e,i,n){i||n(e),this.viewer.model.is2d()&&n(e);var o=this.getObjectSetElementWithIdType(e.objectSet,"lmv"),r=[].concat(o.id).concat(o.hidden).concat(o.isolated);t(r),this.viewer.model.getBulkProperties(r,["externalId"],function(t){var i={};t.forEach(function(e){i[e.dbId]=e.externalId});var r=JSON.parse(JSON.stringify(o));r.idType="external";var s=function(e){return i[e]};r.id=r.id.map(s),r.hidden=r.hidden.map(s),r.isolated=r.isolated.map(s),e.objectSet.push(r),n(e)},function(){n(e)})},o.mapObjectSetExternalToLmv=function(e,t){if(t){var i=e.objectSet;if(!this.getObjectSetElementWithIdType(i,"lmv")){var n=this.getObjectSetElementWithIdType(i,"external");if(n){var o=function(e){return t[e]},r=JSON.parse(JSON.stringify(n));r.id=r.id.map(o),r.isolated=r.isolated.map(o),r.hidden=r.hidden.map(o),r.idType="lmv",i.unshift(r)}}}},o.getObjectSetElementWithIdType=function(e,t){if(!e||!Array.isArray(e))return null;for(var i=0,n=e.length;i<n;++i)if(e[i].idType===t)return e[i];return null},o.getMappingPromise=function(){if(!this.mappingPromise){var e=this;this.mappingPromise=new Promise(function(t){e.viewer.model.getExternalIdMapping(function(e){n.logger.log("[Autodesk.Comment]Successfully fetched external id mapping."),t(e)},function(){n.logger.error("[Autodesk.Comment]Failed to fetch the external id mapping."),t(null)})})}return this.mappingPromise},i.CommentFactory=e}(),function(){"use strict";function e(e,t,i){this.viewer=e,this.cache=i,this.PATH_STORAGE=null,this.fakeRequest=null,this.init(t)}function t(e,t,i,n,o,r){if(e.fakeRequest)return e.fakeRequest.createRequest(t,i,o,r);var s=e.getToken(),a=new XMLHttpRequest;return a.open(t,i,!0),n&&a.setRequestHeader("Content-Type",n),a.setRequestHeader("Access-Control-Allow-Origin","*"),a.setRequestHeader("Authorization","Bearer "+s),a.onload=o.onLoad,a.onerror=o.onError,a.ontimeout=o.onTimeout,a}function i(e,t,i){return{onLoad:function(n){200==n.currentTarget.status?e(i?n.currentTarget.response:n.currentTarget.responseText):t(n.currentTarget)},onError:function(e){t(e.currentTarget)},onTimeout:function(e){t(e.currentTarget)}}}function n(e,t){t&&t.forEach(function(t){e.setRequestHeader(t.name,t.value)})}function o(e){return window.btoa?window.btoa(e):window.Base64.encode(e)}var r=AutodeskNamespace("Autodesk.Viewing.Comments"),s=(Autodesk.Viewing.Private,e.prototype);r.ENV_TABLE={Local:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Development:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Staging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},Production:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"},AutodeskDevelopment:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},AutodeskStaging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},AutodeskProduction:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"}},s.init=function(e){e=e||{},this.env=Autodesk.Viewing.Private.env,e.fakeServer&&(this.fakeRequest=new r.FakeRequest(e)),this.token=e.token3leg;var t=r.ENV_TABLE[this.env];this.COMMENT_SERVICE_URL=t.COMMENT,this.OBJECT_STORAGE_SERVICE_URL=t.OBJECT_STORAGE;var i=e.urn;if(i)this.setPathStorage(i);else{var n=this.viewer,o=this,s=function(){var e=n.model.getDocumentNode();if(e){var t=e.urn(!0);o.setPathStorage(t)}};n.model?s():n.addEventListener(av.GEOMETRY_LOADED_EVENT,function e(){n.removeEventListener(av.GEOMETRY_LOADED_EVENT,e),s()})}},s.destroy=function(){this.viewer=null,this.fakeRequest=null},s.setPathStorage=function(e){if(e){var t=e.length%4;t>0&&(e+="=".repeat(4-t)),this.PATH_STORAGE=e}},s.listComments=function(){var e=this;return new Promise(function(n,o){var r=[e.COMMENT_SERVICE_URL,"resources/",e.PATH_STORAGE].join(""),s=i(function(t){var i=JSON.parse(t);e.cache.comments=i,n(i)},o);t(e,"GET",r,"text/plain",s).send()})},s.postComment=function(e){var n=this;return new Promise(function(o,r){var s=[n.COMMENT_SERVICE_URL,"resources/",n.PATH_STORAGE].join(""),a=i(o,r);t(n,"POST",s,"text/plain",a).send(JSON.stringify(e))})},s.postCommentReply=function(e,n){var r=this;return new Promise(function(s,a){var l=window.encodeURIComponent(o(n)),c=[r.COMMENT_SERVICE_URL,"resources/",l].join(""),u=i(s,a);t(r,"POST",c,"text/plain",u).send(JSON.stringify(e))})},s.deleteComment=function(e){var n=this;return new Promise(function(r,s){var a=o(e),l=window.encodeURIComponent(a),c=[n.COMMENT_SERVICE_URL,"resources/",l].join(""),u=i(r,s);t(n,"DELETE",c,"text/plain",u).send()})},s.fetchLocationForNewOssAttachment=function(e,i){var o=t(this,"POST",[this.COMMENT_SERVICE_URL,"resources/",this.PATH_STORAGE,"/attachment"].join(""),"application/json",i,"fetchLocationForNewOssAttachment");n(o,e),o.send()},s.getAttachment=function(e,o,r){var s=this;return new Promise(function(a,l){var c=s.extractOssBucketAndId(e),u=[s.OBJECT_STORAGE_SERVICE_URL,"buckets/",c[0],"/objects/",c[1]].join(""),h=i(a,l,o),d=t(s,"GET",u,null,h);n(d,r),o&&(d.responseType="arraybuffer"),d.send()})},s.postAttachment=function(e,i,o,r,s){var a=t(this,"PUT",[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",o,"/objects/",e].join(""),"text/plain",s);n(a,r),a.send(i)},s.deleteAttachment=function(e,i,n){t(this,"DELETE",[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",i,"/objects/",e].join(""),"text/plain",n).send()},s.extractOssBucketAndId=function(e){var t=e.split("/"),i=t[0].split(":");return t[0]=i[i.length-1],t},s.getToken=function(){return this.token||Autodesk.Viewing.Private.token.accessToken},r.CommentService=e}(),function(){"use strict";function e(e,n){Autodesk.Viewing.Extension.call(this,e,n||{});var o,r;this.load=function(){var e=this.getCache();if(o=new i.CommentFactory(this.viewer),r=new i.CommentService(this.viewer,this.options,e),e.restoreComment){var t=e.restoreComment;delete e.restoreComment;var n=this,s=function(){var e=function(){n.isCommentForCurrentSheet(t)&&n.restoreComment(t)};n.viewer.getObjectTree(e,e)};this.viewer.model?s():this.viewer.addEventListener(av.GEOMETRY_LOADED_EVENT,function e(){n.viewer.removeEventListener(av.GEOMETRY_LOADED_EVENT,e),s()})}return!0},this.unload=function(){return r&&(r.destroy(),r=null),o&&(o.destroy(),o=null),!0},this.createComment=function(e){var t=e||{};"string"==typeof e&&(t={message:e});var i=o.createCommentObj(t);return o.exportCommentObj(i)},this.isCommentForCurrentSheet=function(e){return o.isCommentForCurrentSheet(e)},this.restoreComment=function(e,t,i){if(!this.isCommentForCurrentSheet(e)){var n=o.getManifestNode(e);if(n)return this.getCache().restoreComment=e,void this.viewer.fireEvent({type:Autodesk.Viewing.LOAD_GEOMETRY_EVENT,data:{item:n.data}})}var r=this;o.importCommentObj(e).then(function(e){r.viewer.restoreState(e,t,i)})},this.setPathStorage=function(e){if(!e)throw new Error(t+": Invalid path storage");r.setPathStorage(e)},this.comments=function(){return this.getCache().comments||[]},this.getComments=function(){return r.listComments()},this.postComment=function(e){return r.postComment(e)},this.postCommentReply=function(e,t){return r.postCommentReply(e,t)},this.deleteComment=function(e){return r.deleteComment(e)}}var t="Autodesk.Comments",i=AutodeskNamespace("Autodesk.Viewing.Comments");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,Autodesk.Viewing.theExtensionManager.registerExtension(t,e),i.CommentsExtension=e}(),function(){"use strict";function e(e){this.options=e||{},this.FAKE_SERVER_DELAY=this.options.fakeSeverDelay||200,this.FAKE_NEXT_ID=11}var t=AutodeskNamespace("Autodesk.Viewing.Comments");e.prototype.createRequest=function(e,t,i,n){var o=this;return{notifyCallback:function(e){o.FAKE_SERVER_DELAY?setTimeout(function(){i.onLoad(e)},o.FAKE_SERVER_DELAY):i.onLoad(e)},replyPostComment:function(e){var t=JSON.parse(e);t.id=o.FAKE_NEXT_ID++,t.index=t.id,t.layoutName=t.layoutName||"Another Sheet",t.actor||(t.actor={name:o.options.displayName||"John Doe",id:o.options.oxygenId||"ABCDEFGHIJK"}),t.published=(new Date).toUTCString(),this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(t)}})},replyFetchLocationForNewOssAttachment:function(){var e={attachment:[{url:"urn:adsk.objects:os.object:comments/filename"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(e)}})},send:function(t){switch(e){case"GET":this.notifyCallback({currentTarget:{status:200,responseText:"[]"}});break;case"POST":switch(n){case"fetchLocationForNewOssAttachment":this.replyFetchLocationForNewOssAttachment();break;default:this.replyPostComment(t)}break;case"DELETE":this.notifyCallback({currentTarget:{status:200,responseText:"{}"}});break;case"PUT":try{JSON.parse(t),this.notifyCallback({currentTarget:{status:200,responseText:t}})}catch(e){var i={objects:[{id:"test",key:"test","content-type":"image/png",location:"http://www.autodesk.com"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(i)}})}}},setRequestHeader:function(){}}},t.FakeRequest=e}(),function(){"use strict";var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),t=Autodesk.Viewing;e.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS=5,e.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS=12,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS=15,e.isTouchDevice=function(){return!(!t.isTouchDevice||"function"!=typeof Hammer)&&t.isTouchDevice()},e.createSvgElement=function(e){return document.createElementNS("http://www.w3.org/2000/svg",e)},e.setSvgParentAttributes=function(e){return e.setAttribute("version","1.1"),e.setAttribute("baseProfile","full"),e},e.createMarkupPathSvg=function(){var t=e.createSvgElement("g");t.setAttribute("cursor","inherit"),t.setAttribute("pointer-events","none");var i=e.createSvgElement("path");i.setAttribute("id","markup");var n=e.createSvgElement("path");return n.setAttribute("id","hitarea"),n.setAttribute("fill","transparent"),n.setAttribute("stroke","transparent"),t.markup=i,t.hitarea=n,t.appendChild(i),t.appendChild(n),t},e.setAttributeToMarkupSvg=function(e,t,i){e.markup.setAttribute(t,i)},e.updateMarkupPathSvgHitarea=function(t,i){var n=t.markup,o=t.hitarea,r=i.sizeFromClientToMarkups(0,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;r+=parseFloat(n.getAttribute("stroke-width"))+r;var s=n.getAttribute("fill"),a=n.getAttribute("stroke"),l=""!==a&&"none"!==a,c=""!==s&&"none"!==s;if(o.setAttribute("d",n.getAttribute("d")),o.setAttribute("stroke-width",r),o.setAttribute("transform",n.getAttribute("transform")),!i.navigating){if(l&&c)return void t.setAttribute("pointer-events","painted");if(l)return void t.setAttribute("pointer-events","stroke");if(!c)return void t.setAttribute("pointer-events","fill")}t.setAttribute("pointer-events","none")},e.createMarkupTextSvg=function(){var t=e.createSvgElement("g");t.setAttribute("cursor","default");var i="markup-clipper-"+e.getClipPathId(),n="url(#"+i+")",o=e.createSvgElement("clipPath");o.setAttribute("id",i),o.removeAttribute("pointer-events"),o.rect=e.createSvgElement("rect"),o.appendChild(o.rect);var r=e.createSvgElement("rect");r.setAttribute("id","markup-background");var s=e.createSvgElement("text");s.setAttribute("id","markup"),r.removeAttribute("pointer-events");var a=e.createSvgElement("rect");a.setAttribute("id","hitarea"),a.setAttribute("fill","transparent"),a.setAttribute("stroke","none"),a.setAttribute("stroke-width","0");var l=e.createSvgElement("g");return l.setAttribute("clip-path",n),l.appendChild(o),l.appendChild(r),l.appendChild(s),t.appendChild(l),t.appendChild(a),t.clipper=o,t.background=r,t.markup=s,t.hitarea=a,t},e.setMarkupTextSvgTransform=function(e,t,i){e.clipper.rect.setAttribute("transform",t),e.background.setAttribute("transform",t),e.markup.setAttribute("transform",i),e.hitarea.setAttribute("transform",t)},e.updateMarkupTextSvgHitarea=function(t,i,n,o){var r=t.hitarea,s=o.sizeFromClientToMarkups(0,e.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;r.setAttribute("x",-s),r.setAttribute("y",-s),r.setAttribute("width",i+2*s),r.setAttribute("height",n+2*s),t.setAttribute("pointer-events",o.navigating?"none":"painted")},e.updateMarkupTextSvgBackground=function(e,t,i,n){var o=e.background;o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("width",t),o.setAttribute("height",i),o.setAttribute("fill",n)},e.updateMarkupTextSvgClipper=function(e,t,i){var n=e.clipper;n.rect.setAttribute("x",0),n.rect.setAttribute("y",0),n.rect.setAttribute("width",t),n.rect.setAttribute("height",i)},e.addSvgMetadata=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","metadata"),n=document.createElement("markup_document");return i.appendChild(n),n.setAttribute("data-model-version",t["data-model-version"]),e.insertBefore(i,e.firstChild),i},e.addMarkupMetadata=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","metadata"),n=document.createElement("markup_element");i.appendChild(n);for(var o in t)t.hasOwnProperty(o)&&n.setAttribute(o,t[o]);return e.insertBefore(i,e.firstChild),i},e.removeAllMetadata=function(e){if(e.getElementsByTagName)for(var t=e.getElementsByTagName("metadata"),i=0;i<t.length;++i){var n=t[i];n.parentNode&&n.parentNode.removeChild(n)}var o=e.children||e.childNodes;if(o)for(i=0;i<o.length;++i)this.removeAllMetadata(o[i])},e.transferChildNodes=function(e,t){for(var i=e.children||e.childNodes,n=[],o=0;o<i.length;++o)n.push(i[o]);n.forEach(function(e){t.appendChild(e)})},e.getClipPathId=function(){for(var e=document.getElementsByTagName("clipPath"),t=e.length,i=0,n=0;n<t;++n){var o=e[n].id;-1!==o.indexOf("markup-clipper-")&&(o=o.replace("markup-clipper-",""),i=Math.max(i,o))}return i+1},e.svgNodeToString=function(e){function t(e,i){var n=e.hitarea,o=n&&n.parentNode;o&&(i.push({hitarea:n,parent:o}),o.removeChild(n));for(var r=e.childNodes,s=r.length,a=0;a<s;++a)t(r.item(a),i)}var i;try{var n=[];t(e,n);var o=new XMLSerializer;i=o.serializeToString(e),function(e){for(var t=e.length,i=0;i<t;++i){var n=e[i];n.parent.appendChild(n.hitarea)}}(n)}catch(e){i="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return i},e.stringToSvgNode=function(e){var t=null;try{var i=(new DOMParser).parseFromString(e,"text/xml");t=i.firstChild}catch(e){t=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return t},e.addTraitEventDispatcher=function(e){e.listeners={},e.addEventListener=function(e,t){void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t)},e.hasEventListener=function(e,t){if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},e.removeEventListener=function(e,t){if(this.listeners[e]instanceof Array)for(var i=this.listeners[e],n=0,o=i.length;n<o;n++)if(i[n]===t){i.splice(n,1);break}},e.fireEvent=function(e){if("string"==typeof e&&(e={type:e}),e.target||(e.target=this),!e.type)throw new Error("event type unknown.");if(this.listeners[e.type]instanceof Array)for(var t=this.listeners[e.type].slice(),i=0;i<t.length;i++)t[i].call(this,e)}},e.removeTraitEventDispatcher=function(e){try{delete e.listeners,delete e.addEventListener,delete e.hasEventListener,delete e.removeEventListener,delete e.fireEvent}catch(e){}},e.worldToClient=function(t,i,n){var o=e.worldToViewport(t,i),r=e.viewportToClient(o.x,o.y,i);return r.z=0,n&&(r.x=Math.floor(r.x)+.5,r.y=Math.floor(r.y)+.5),r},e.clientToWorld=function(t,i,n,o){var r=e.clientToViewport(t,i,o);return r.z=n,r.unproject(o.impl.camera),r},e.clientToViewport=function(e,t,i){return i.impl.clientToViewport(e,t)},e.viewportToClient=function(e,t,i){return i.impl.viewportToClient(e,t)},e.worldToViewport=function(e,t){var i=new THREE.Vector3;return i.x=e.x,i.y=e.y,i.z=e.z,i.project(t.impl.camera),i},e.metersToModel=function(e,t){return 1/t.model.getUnitScale()*e},e.radiansToDegrees=function(e){return e*(180/Math.PI)},e.degreesToRadians=function(e){return e*(Math.PI/180)},e.sign=function(e){return e>=0?1:-1},e.areMarkupsPointsInClientRange=function(e,t,i,n){i=n.sizeFromClientToMarkups(0,i).y;var o=e.x-t.x,r=e.y-t.y;return i*i>=o*o+r*r},e.hideLmvUi=function(t){t.toolbar&&(t.setActiveNavigationTool(),e.dismissLmvHudMessage(),e.hideLmvPanels(!0,t),e.hideLmvToolsAndPanels(t))},e.restoreLmvUi=function(t){t.toolbar&&(e.dismissLmvHudMessage(),e.hideLmvPanels(!1,t),e.showLmvToolsAndPanels(t))},e.hideLmvPanels=function(e,t){var i=t.dockingPanels;if(i)for(var n=0;n<i.length;++n){var o=i[n],r=o.container;r.classList.contains("dockingPanelVisible")&&(r.style.display=e?"none":"block",o.visibilityChanged())}},e.showLmvToolsAndPanels=function(e){e&&e.model&&!e.model.is2d()&&e.displayViewCube(!0,!1);var t=document.getElementsByClassName("homeViewWrapper"),i=document.getElementsByClassName("infoButton"),n=document.getElementsByClassName("toolbar-animationSubtoolbar");if(t.length>0&&(t[0].style.display=""),i.length>0&&(i[0].style.display=""),n.length>0&&(n[0].style.display=""),e.toolbar){for(var o=e.toolbar.container,r=o.children.length,s=0;s<r;++s)o.children[s].style.display="";e.centerToolBar()}},e.hideLmvToolsAndPanels=function(e){e&&e.model&&!e.model.is2d()&&e.displayViewCube(!1,!1);var t=document.getElementsByClassName("homeViewWrapper"),i=document.getElementsByClassName("infoButton"),n=document.getElementsByClassName("toolbar-animationSubtoolbar");if(t.length>0&&(t[0].style.display="none"),i.length>0&&(i[0].style.display="none"),n.length>0){n[0].style.display="none";var o=e.impl.keyFrameAnimator;if(o&&!o.isPaused){o.pauseCameraAnimations(),o.pause();var r=e.modelTools.getControl("toolbar-animationPlay");r&&(r.setIcon("toolbar-animationPauseIcon"),r.setToolTip("Pause"))}}if(e.toolbar)for(var s=e.toolbar.container,a=s.children.length,l=0;l<a;++l)s.children[l].style.display="none"},e.dismissLmvHudMessage=function(){try{for(var e=!0;e;)e=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(e){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},e.createStyle=function(t,i){for(var n={},o=0;o<t.length;++o)n[t[o]]=null;for(var r=e.getStyleDefaultValues(n,i),o=0;o<t.length;++o){var s=t[o];n[s]=r[s].values[r[s].default].value}return n},e.copyStyle=function(e,t){for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.cloneStyle=function(e){var t={};for(var i in e)t[i]=e[i];return t},e.getStyleDefaultValues=function(t,i){function n(e,t){return t.sizeFromClientToMarkups(0,e).y}function o(e){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:e?4:0}}var r=e.cloneStyle(t),s=n(e.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,i),a=n(e.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,i);for(var l in r)switch(l){case"stroke-width":r[l]=function(e){return{values:[{name:"Thin",value:e/2},{name:"Normal",value:e},{name:"Thick",value:2*e}],default:1}}(s);break;case"stroke-linejoin":r[l]={values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0};break;case"font-size":r[l]=function(e){return{values:[{name:"Thin",value:e/2},{name:"Normal",value:e},{name:"Thick",value:2*e}],default:1}}(a);break;case"font-family":r[l]={values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0};break;case"font-style":r[l]={values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0};break;case"font-weight":r[l]={values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0};break;case"stroke-color":case"fill-color":r[l]={values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"}],default:0};break;case"stroke-opacity":c=!1;r[l]=o(c);break;case"fill-opacity":var c=!0;r[l]=o(c)}return r},e.composeRGBAString=function(e,t){return!e||!t||t<=0?"none":["rgba("+parseInt("0x"+e.substr(1,2)),",",parseInt("0x"+e.substr(3,2)),",",parseInt("0x"+e.substr(5,2)),",",t,")"].join("")},e.checkLineSegment=function(e,t,i,n,o){function r(e,t){e=Math.round(e),t=Math.round(t);for(var i=0,n=0,o=-a;o<=a;o+=2*a)n+=s(e,t+o)?o:0;for(var r=-a;r<=a;r+=2*a)i+=s(e+r,t)?r:0;return{x:Math.round(e/a+i),y:Math.round((c-t)/a-n)}}function s(e,t){if(e<0||e>=l||t<0||t>=c)return!1;var i=4*(t*l+e);return 255!==u[i]||255!==u[i+1]||255!==u[i+2]}var a=window.devicePixelRatio||1;e*=a,t*=a,i*=a,n*=a;var l=o.width,c=o.height,u=o.buffer;e=Math.round(e),i=Math.round(i),t=Math.round(c-t);var h=i-e,d=(n=Math.round(c-n))-t,p=0!==h?d/h:1,g=e,m=t;if(0!==h&&Math.abs(p)<=1){if(e<=i){for(;g<=i;++g,m+=p)if(s(g,Math.round(m)))return r(g,m)}else for(;g>=i;--g,m-=p)if(s(g,Math.round(m)))return r(g,m)}else if(p=0!==h?1/p:0,t<=n){for(;m<=n;++m,g+=p)if(s(Math.round(g),m))return r(g,m)}else for(;m>=n;--m,g-=p)if(s(Math.round(g),m))return r(g,m)},e.checkPolygon=function(e,t){function i(e,t){for(var i=0,o=0,s=-r;s<=r;s+=2*r)o+=n(e,t+s)?s:0;for(var l=-r;l<=r;l+=2*r)i+=n(e+l,t)?l:0;return{x:Math.round(e/r)+i,y:Math.round((a-t)/r-o)}}function n(e,t){if(e<0||e>=s||t<0||t>=a)return!1;var i=4*(t*s+e);return(255!==l[i]||255!==l[i+1]||255!==l[i+2])&&o(e,t)}function o(t,i){for(var n=!1,o=e.vertexCount,r=0,s=o-1;r<o;s=r++)h[r]>i!=h[s]>i&&t<(u[s]-u[r])*(i-h[r])/(h[s]-h[r])+u[r]&&(n=!n);return n}if(!e||e.verxtexCount<3||!t)return null;for(var r=window.devicePixelRatio||1,s=t.width,a=t.height,l=t.buffer,c=e.vertexCount,u=Float32Array.from(e.xVertices),h=Float32Array.from(e.yVertices),d=Number.POSITIVE_INFINITY,p=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=0;v<c;++v){var f=u[v]=u[v]*r,E=h[v]=a-h[v]*r;d=Math.min(d,f),p=Math.min(p,E),g=Math.max(g,f),m=Math.max(m,E)}if(g<0||d>s||m<0||p>a)return null;var A=Math.round(g-d),y=Math.round(m-p),T=Math.round(.5*(d+g)),w=Math.round(.5*(p+m)),b=1,C=1;do{for(var S=T+b,k=w+C;T<S;++T)if(n(T,w))return i(T,w);for(;w<k;++w)if(n(T,w))return i(T,w);for(b<A?(S=T-++b,++b):S=T-b,C<y?(k=w-++C,++C):k=w-C;T>S;--T)if(n(T,w))return i(T,w);for(;w>k;--w)if(n(T,w))return i(T,w)}while(b<A||C<y)},e.createStyleSheet=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet},e.addRuleToStyleSheet=function(e,t,i,n){"insertRule"in e?e.insertRule(t+"{"+i+"}",n):"addRule"in e&&e.addRule(t,i,n)},e.measureTextLines=function(t,i,n){var o=n.sizeFromMarkupsToClient(0,i["font-size"]).y,r=(new e.DomElementStyle).setAttribute("font-family",i["font-family"]).setAttribute("font-size",o+"px").setAttribute("font-weight",i["font-weight"]?"bold":"").setAttribute("font-style",i["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),s=document.createElement("div");s.setAttribute("style",r),n.viewer.container.appendChild(s);for(var a=[],l=t.length,c=0;c<l;++c)s.innerHTML=t[c],a.push({line:t[c],width:s.clientWidth,height:s.clientHeight});return n.viewer.container.removeChild(s),a},e.createArcTo=function(e,t,i,n,o,r){return r.push(o?"a":"A"),r.push(i),r.push(n),r.push(0),r.push(1),r.push(1),r.push(e),r.push(t),r},e.createEllipsePath=function(t,i,n,o,r,s){var a=.5*n,l=.5*o;s.push(r?"m":"M"),s.push(t),s.push(i),e.createArcTo(n,0,a,l,!0,s),e.createArcTo(-n,0,a,l,!0,s),s.push("z")},e.createRectanglePath=function(e,t,i,n,o,r){r.push(o?"m":"M"),r.push(e),r.push(t),r.push("l"),r.push(i),r.push(0),r.push("l"),r.push(0),r.push(n),r.push("l"),r.push(-i),r.push(0),r.push("z")},e.renderToCanvas=function(t,i,n,o,r){for(var s=o["stroke-width"],a=o["stroke-linejoin"],l=o["stroke-color"],c=o["stroke-opacity"],u=o["fill-color"],h=o["fill-opacity"],d=new THREE.Vector3(0,0,0),p=(new THREE.Matrix4).extractRotation(r),g=180*Math.atan2(p.elements[4],p.elements[0])/Math.PI,m=t.positionFromMarkupsToClient.bind(t),v=t.vectorFromMarkupsToClient.bind(t),f=t.sizeFromMarkupsToClient.bind(t),E=n.length,A=!1,y=0;y<E;)switch(n[y++]){case"M":case"L":d.x=n[y],d.y=n[y+1];T=m((d=d.applyMatrix4(r)).x,d.y);n[y++]=T.x,n[y++]=T.y;break;case"m":case"l":d.x=n[y],d.y=n[y+1];var T=v((d=d.applyMatrix4(p)).x,d.y);n[y++]=T.x,n[y++]=T.y;break;case"c":d.x=n[y],d.y=n[y+1];var w=v((d=d.applyMatrix4(p)).x,d.y);n[y++]=w.x,n[y++]=w.y,d.x=n[y],d.y=n[y+1];var b=v((d=d.applyMatrix4(p)).x,d.y);n[y++]=b.x,n[y++]=b.y,d.x=n[y],d.y=n[y+1];S=v((d=d.applyMatrix4(p)).x,d.y);n[y++]=S.x,n[y++]=S.y;break;case"a":var C=f(n[y],n[y+1]);n[y++]=C.x,n[y++]=C.y,n[y++]=g,n[++y]=1==n[y++]?0:1,d.x=n[y],d.y=n[y+1];var S=v((d=d.applyMatrix4(p)).x,d.y);n[y++]=S.x,n[y++]=S.y;break;case"Z":case"z":A=!0}i.strokeStyle=e.composeRGBAString(l,c),i.fillStyle=e.composeRGBAString(u,h),i.lineJoin=a,i.lineWidth=t.sizeFromMarkupsToClient(s,0).x,n=new Path2D(n.join(" ")),A&&0!==h&&i.fill(n),i.stroke(n)}}(),function(){"use strict";function e(e,t,i){this.type=t,this.editor=e,this.targetId=i,this.addToHistory=!0,this.selectOnExecution=!0}AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),Autodesk.Viewing.Extensions.Markups.Core.EditAction=e,Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.execute=function(){this.editor.actionManager.execute(this)},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.redo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.undo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.merge=function(e){return!1},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.isIdentity=function(){return!1}}(),function(){"use strict";function e(e){this.historySize=e,this.undoStack=new Array(e),this.redoStack=new Array(e),i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.EVENT_HISTORY_CHANGED="EVENT_HISTORY_CHANGED";var n=e.prototype;n.execute=function(e){var i=this.redoStack,n=this.undoStack;i.splice(0,i.length),e.redo();var o=this.getEditActionGroup();o.isOpen()?o.addAction(e):(o.open(),o.addAction(e),o.close()),n.length>this.historySize&&n.splice(0,1);var r=e.selectOnExecution?e.targetId:-1;this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:r}})},n.beginActionGroup=function(){var e=this.undoStack,t=e.length;0===t||e[t-1].isClosed()?this.getEditActionGroup().open():console.warn("Markups - Undo/Redo - Action edit group already open.")},n.closeActionGroup=function(){var e=this.undoStack,t=e.length;if(0!==t){var i=e[t-1];i.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),i.isEmpty()&&e.pop()}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},n.cancelActionGroup=function(){var e=this.undoStack,i=e.length;if(0!==i){var n=e[i-1];n.close()?(n.undo(),e.pop(),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})):console.warn("Markups - Undo/Redo - Action edit group already closed.")}else console.warn("Markups - Undo/Redo - There is no action edit group to close.")},n.undo=function(){var e=this.undoStack,i=this.redoStack;if(0!==e.length){var n=e.pop(),o=n.undo();i.push(n),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:o}})}},n.redo=function(){var e=this.undoStack,i=this.redoStack;if(0!==i.length){var n=i.pop(),o=n.redo();e.push(n),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:o}})}},n.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.fireEvent({type:t.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},n.isUndoStackEmpty=function(){return 0===this.undoStack.length},n.isRedoStackEmpty=function(){return 0===this.redoStack.length},n.getEditActionGroup=function(){var e=this.undoStack,i=this.undoStack.length,n=null;return 0===i||e[i-1].isClosed()?(n=new t.EditActionGroup,e.push(n)):n=e[i-1],n},t.EditActionManager=e}(),function(){"use strict";function e(){this.reset()}function t(e){var t=[];for(var i in e){var n=e[i];t.push(i),t.push(":"),t.push(n),t.push("; ")}return t.join("")}var i=Autodesk.Viewing.Extensions.Markups.Core.Utils,n=["-ms-","-webkit-","-moz-","-o-"],o=e.prototype;o.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},o.setAttribute=function(e,t,i){if(this.attributes[e]=t,i&&i.allBrowsers){var o=this;n.forEach(function(i){o.attributes[i+e]=t})}return this.dirty=!0,this},o.removeAttribute=function(e){Array.isArray(e)||(e=[e]);var t=this;return e.forEach(function(e){e in t.attributes&&(delete t.attributes[e],t.dirty=!0)}),this},o.getStyleString=function(){return this.dirty&&(this.styleString=t(this.attributes),this.dirty=!1),this.styleString},o.clone=function(){var e=new i.DomElementStyle,t=this.attributes;for(var n in t)e.setAttribute(n,t[n]);return e},i.DomElementStyle=e}(),function(){"use strict";function e(e,t){this.containingDiv=e,this.editor=t,this.selectionLayer=i(),this.frameMargin=10,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},c.bind(this)(),w.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.selectionLayer,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}]],inputClass:Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded)),g.bind(this)(),m.bind(this)(),f.bind(this)(),v.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),w.addTraitEventDispatcher(this)}function t(e){e.pageX=e.pointers[0].clientX,e.pageY=e.pointers[0].clientY}function i(){var e=document.createElement("div");return e.style.position="absolute",e.style.top=0,e.style.bottom=0,e.style.left=0,e.style.right=0,e.style.overflow="hidden",e.style.visibility="hidden",E(e,!1),e}function n(e,t){var i=document.createElement("div");i.style.position="absolute",i.style.height=e+"px",i.style.width=e+"px",i.style.background=C,i.style.borderColor=b,i.style.borderWidth="1px",i.style.borderStyle="solid",r(i,t),i.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+t,i.setAttribute("data-sdp-handle",t);var n=-e-2;switch(t){case"n":i.style.top=n+"px",i.style.left="calc(50% - "+e/2+"px)",i.style.position="relative",i.style.margin=0;break;case"s":i.style.top="calc(100% - "+(e+2)+"px)",i.style.left="calc(50% - "+e/2+"px)",i.style.position="relative",i.style.margin=0;break;case"w":i.style.left=n+"px",i.style.top="50%",i.style.transform="translate3d(0, -50%, 0)";break;case"e":i.style.right=n+"px",i.style.top="50%",i.style.transform="translate3d(0, -50%, 0)";break;case"nw":i.style.top=n+"px",i.style.left=n+"px";break;case"ne":i.style.top=n+"px",i.style.right=n+"px";break;case"sw":i.style.bottom=n+"px",i.style.left=n+"px";break;case"se":i.style.bottom=n+"px",i.style.right=n+"px"}return i}function o(){var e=document.createElement("div");return e.style.position="absolute",e.style.background=C,e.style.border="1px solid rgba(30, 30, 255, 0.25)",e.style.height="18px",e.style.width="18px",e.style.borderRadius="10px",e.style.boxSizing="border-box",e.classList.add("selector-rotate-point"),e.style.left="50%",e.style.transform="translate3d(-50%, 0px, 0px)",e.style.top="-70px",e.classList.add("autodesk-markups-extension-core-make-me-bigger"),e}function r(e,t){var i;switch(t){case"n":case"s":i="ns-resize";break;case"w":case"e":i="ew-resize";break;case"ne":case"sw":i="nesw-resize";break;case"nw":case"se":i="nwse-resize"}e.style.cursor=i}function s(e){["n","s","w","e","nw","ne","sw","se"].forEach(function(t){this.selection.handle[t]=n(16,t),e.appendChild(this.selection.handle[t])}.bind(this))}function a(e){return y(e,".selector-drag-point")}function l(e){return y(e,".selector-rotate-point")}function c(){var e=document.createElement("div");return e.style.position="absolute",e.style.border="1px solid "+b,e.style.zIndex=1,e.style.cursor="move",e.style.boxSizing="border-box",E(e,!0),e.classList.add("selector-box"),s.bind(this)(e),this.selection.rotationHandle=o(),e.appendChild(this.selection.rotationHandle),this.selection.element=e,this.selectionLayer.appendChild(this.selection.element),h.bind(this)(!1),e}function u(e,t){return"translate3d("+e+"px,"+t+"px,0)"}function h(e){this.selection.active=e,this.selection.element.style.display=e?"block":"none"}function d(e,t,i){this.selection.x=e,this.selection.y=t,this.selection.rotation=i;var n=this.markup.getClientSize();n.x+=2*this.frameMargin,n.y+=2*this.frameMargin,this.selection.element.style.msTransform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.msTransformOrigin=n.x/2+"px "+n.y/2+"px",this.selection.element.style.webkitTransform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.webkitTransformOrigin=n.x/2+"px "+n.y/2+"px",this.selection.element.style.transform=u(e,t)+" rotate("+i+"rad)",this.selection.element.style.transformOrigin=n.x/2+"px "+n.y/2+"px"}function p(e,t){this.selection.width=e,this.selection.height=t,this.selection.element.style.width=e+"px",this.selection.element.style.height=t+"px"}function g(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}function m(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function v(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function f(){var e=function(e){this.selection.dragging=!1;var t=this.editor.editMode;t&&t.onMouseDoubleClick(this.markup)}.bind(this);this.selectionLayer.addEventListener("dblclick",e)}function E(e,t){e.style.pointerEvents=t?"auto":"none"}function A(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function y(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)}var T=Autodesk.Viewing.Extensions.Markups.Core,w=Autodesk.Viewing.Extensions.Markups.Core.Utils;T.EVENT_EDITFRAME_EDITION_START="EVENT_EDITFRAME_EDITION_START",T.EVENT_EDITFRAME_EDITION_END="EVENT_EDITFRAME_EDITION_END";var b="rgba(30, 30, 255, 0.30)",C="gainsboro",S=e.prototype;S.setSelection=function(e,t,i,n,o){var r=this.frameMargin,s=2*r;p.bind(this)(i+s,n+s),d.bind(this)(e-r,t-r,o),h.bind(this)(!0),this.selectionLayer.style.visibility="visible"},S.setMarkup=function(e){if(this.hammer&&this.hammer.set({enable:null!==e}),this.markup=e,h.bind(this)(!1),e){var t=e.getClientSize(),i=e.getClientPosition(),n=t.x,o=t.y,r=e.getRotation();this.setSelection(i.x-n/2,i.y-o/2,n,o,r),this.enableResizeHandles(),this.enableRotationHandle()}},S.startDrag=function(e){this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(e,this.editor.getMousePosition())},S.isActive=function(){return this.isDragging()||this.isResizing()||this.isRotating()},S.isDragging=function(){return this.selection.dragging},S.isResizing=function(){return this.selection.resizing},S.isRotating=function(){return this.selection.rotating},S.onMouseMove=function(e){},S.onMouseUp=function(e){},S.onHammerDrag=function(e){function i(e,t,i){var n=t.getBoundingClientRect();e.mousePosition.x=i.pageX-n.left,e.mousePosition.y=i.pageY-n.top}switch(t(e),e.type){case"dragstart":i(this.editor.input,this.editor.svg,e),l(e.target)?this._onRotationMouseDown(e):a(e.target)?this._onResizeMouseDown(e):this.startDrag(e),e.preventDefault();break;case"dragmove":i(this.editor.input,this.editor.svg,e),this.onMouseMove(e),e.preventDefault();break;case"dragend":i(this.editor.input,this.editor.svg,e),this.onMouseUp(e),e.preventDefault()}},S.onHammerDoubleTap=function(e){t(e),function(e,t,i){var n=t.getBoundingClientRect();e.mousePosition.x=i.pageX-n.left,e.mousePosition.y=i.pageY-n.top}(this.editor.input,this.editor.svg,e),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},S.enableResizeHandles=function(){var e,t=this.markup;if(t.isHeightConstrained()||t.isWidthConstrained()){for(var i in this.selection.handle)(e=this.selection.handle[i])&&(e.style.display="none");t.isHeightConstrained()&&(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block"),t.isWidthConstrained()&&(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block")}else for(var i in this.selection.handle)(e=this.selection.handle[i])&&(e.style.display="block")},S.enableRotationHandle=function(){var e=this.markup,t=this.selection.rotationHandle,i=e.isRotationConstrained()?"none":"block";t.style.display=i};var k=!1;S._onRepositionMouseDown=function(e,t){k=!0;var i=!(e instanceof MouseEvent);if((i||!a(e.target)&&!l(e.target))&&(t=i?t:this.editor.getMousePosition(),this.initialCursor=t,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),e&&e.altKey){var n=this.editor;new T.CloneMarkup(n,n.getId(),this.markup,this.markup.position).execute()}this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START})}},S._onRepositionMouseMove=function(e){if(k)k=!1;else if(this.selection.dragging){var t=this.editor.getMousePosition(),i=this.editor.input.constrainAxis;this.areAxisConstrained!==i&&(this.areAxisConstrained=i,this.axisConstrains=i?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=t.x-this.initialCursor.x,this.initialPosition.y+=t.y-this.initialCursor.y,this.initialCursor.x=t.x,this.initialCursor.y=t.y);var n={x:t.x-this.initialCursor.x,y:t.y-this.initialCursor.y};0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(n.x)>15?(this.axisConstrains.x=1,n.x+=n.x<0?15:-15):Math.abs(n.y)>15&&(this.axisConstrains.y=1,n.y+=n.y<0?15:-15));var o=this.initialPosition.x+n.x*this.axisConstrains.x,r=this.initialPosition.y+n.y*this.axisConstrains.y;d.bind(this)(o,r,this.selection.rotation);var s=this.editor.positionFromClientToMarkups(o,r);new T.SetPosition(this.editor,this.markup,s).execute()}},S._onRepositionMouseUp=function(){this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END}))},S._onResizeMouseDown=function(e){var t=e.target;if(a(t)){this.selection.handle.resizing=t;var i=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=i+"-resize";var n=this.editor.getMousePosition(),o=this.markup.getClientPosition(),r=this.markup.getClientSize();this.initial={x:o.x,y:o.y,width:r.x,height:r.y,mouseX:n.x,mouseY:n.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START}))}},S._onResizeMouseMove=function(e){if(this.selection.resizing){var t=this.editor.getMousePosition(),i=this.initial,n={x:t.x-i.mouseX,y:t.y-i.mouseY},o=new THREE.Vector3(n.x,n.y,0),r=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);n=o.applyMatrix4(r);var s=i.x,a=i.y,l=i.width,c=i.height,u=new THREE.Vector3,h=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&-1!==["nw","ne","sw","se"].indexOf(h)){var d=new THREE.Vector3(n.x,n.y,0);switch(h){case"nw":n.set(-i.width,-i.height,0);break;case"ne":case"sw":n.set(i.width,-i.height,0);break;case"se":n.set(i.width,i.height,0)}n.normalize(),n=d.projectOnVector(n)}({n:function(){c-=n.y,u.y=n.y},s:function(){c+=n.y,u.y=n.y},w:function(){l-=n.x,u.x=n.x},e:function(){l+=n.x,u.x=n.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}})[h]();var p=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),g=u.applyMatrix4(p),m=this.editor.positionFromClientToMarkups(s+.5*g.x,a+.5*g.y),v=this.editor.sizeFromClientToMarkups(l,c);new T.SetSize(this.editor,this.markup,m,v.x,v.y).execute()}},S._onResizeMouseUp=function(e){this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.editor.closeActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}};var M,x;S._onRotationMouseDown=function(e){l(e.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,x=this.editor.getMousePosition(),M=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_START}))},S._onRotationMouseMove=function(e){if(this.selection.rotating){var t=this.editor.getMousePosition(),i=this.markup.getClientPosition(),n=A(i,t)-A(i,x)+M;if(this.editor.input.snapRotations){var o=w.degreesToRadians(22.5);n=Math.ceil(n/o)*o}d.bind(this)(this.selection.x,this.selection.y,n),new T.SetRotation(this.editor,this.markup,n).execute()}},S._onRotationMouseUp=function(e){this.selection.rotating=!1,M=null,x=null,this.editor.closeActionGroup(),this.fireEvent({type:T.EVENT_EDITFRAME_EDITION_END})},T.EditFrame=e}(),function(){"use strict";function e(e,t,n){this.id=e,this.type="",this.editor=t,this.viewer=t.viewer,this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=i.createStyle(n,this.editor),this.style=i.copyStyle(t.getDefaultStyle(),this.style),this.highlightColor="#FAFF3C",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.highlighted=!1,this.selected=!1,i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.MARKUP_TYPE_ARROW="arrow",t.MARKUP_TYPE_TEXT="label",t.MARKUP_TYPE_RECTANGLE="rectangle",t.MARKUP_TYPE_CIRCLE="ellipse",t.MARKUP_TYPE_CLOUD="cloud",t.MARKUP_TYPE_FREEHAND="freehand",t.MARKUP_TYPE_POLYLINE="polyline",t.MARKUP_TYPE_POLYCLOUD="polycloud",t.EVENT_EDITMODE_CHANGED="EVENT_EDITMODE_CHANGED",t.EVENT_EDITMODE_ENTER="EVENT_EDITMODE_ENTER",t.EVENT_EDITMODE_LEAVE="EVENT_EDITMODE_LEAVE",t.EVENT_MARKUP_SELECTED="EVENT_MARKUP_SELECTED",t.EVENT_MARKUP_DRAGGING="EVENT_MARKUP_DRAGGING",t.EVENT_MARKUP_ENTER_EDITION="EVENT_MARKUP_ENTER_EDITION",t.EVENT_MARKUP_CANCEL_EDITION="EVENT_MARKUP_CANCEL_EDITION",t.EVENT_MARKUP_DELETE_EDITION="EVENT_MARKUP_DELETE_EDITION";var n=e.prototype;t.Markup=e,n.destroy=function(){this.unselect(),this.setParent(null)},n.setParent=function(e){var t=this.shape;t.parentNode&&t.parentNode.removeChild(t),e&&e.appendChild(t)},n.clone=function(){var e=Object.create(this.__proto__),t=this.getCloneOverrides();for(var i in this)if(this.hasOwnProperty(i)){var n=this[i];t.hasOwnProperty(i)?e[i]=t[i]:n.clone instanceof Function?e[i]=n.clone():n instanceof Function?e[i]=n.bind(e):n.nodeType?e[i]=n.cloneNode(!0):n instanceof Object?e[i]=JSON.parse(JSON.stringify(n)):e[i]=n}return this.cloneShape(e),e},n.cloneShape=function(e){e.shape.markup=e.shape.childNodes.item(0),e.shape.hitarea=e.shape.childNodes.item(1),e.bindDomEvents()},n.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},n.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.fireEvent({type:t.EVENT_MARKUP_SELECTED,markup:this}))},n.unselect=function(){this.selected=!1},n.highlight=function(e){this.interactionsDisabled||(this.highlighted=e,this.updateStyle())},n.getStyle=function(){return i.cloneStyle(this.style)},n.setStyle=function(e){i.copyStyle(e,this.style),this.updateStyle()},n.updateStyle=function(){},n.edit=function(){this.fireEvent({type:t.EVENT_MARKUP_ENTER_EDITION,markup:this})},n.cancel=function(){this.fireEvent({type:t.EVENT_MARKUP_CANCEL_EDITION,markup:this})},n.deleteMarkup=function(){this.fireEvent({type:t.EVENT_MARKUP_DELETE_EDITION,markup:this})},n.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},n.getClientPosition=function(){var e=this.position;return this.editor.positionFromMarkupsToClient(e.x,e.y)},n.getClientSize=function(){var e=this.size;return this.editor.sizeFromMarkupsToClient(e.x,e.y)},n.setRotation=function(e){this.rotation=e,this.updateStyle()},n.getRotation=function(){return this.rotation},n.setPosition=function(e,t){this.position.x=e,this.position.y=t,this.updateStyle()},n.setSize=function(e,t,i){this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.isWidthConstrained=function(){return this.constraintWidth},n.isHeightConstrained=function(){return this.constraintHeight},n.isRotationConstrained=function(){return this.constraintRotation},n.disableInteractions=function(e){this.interactionsDisabled=e},n.setStrokeWidth=function(e){},n.constrainsToBounds=function(e){},n.onMouseDown=function(e){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(e))},n.generatePoint3d=function(e){function t(t,o){var r=i.checkLineSegment(t.x,t.y,o.x,o.y,e),s=r&&n.clientToWorld(r.x,r.y);return s&&s.point}var n=this.viewer,o=this.generateBoundingPolygon(),r=o.xVertices,s=o.yVertices,a=new THREE.Vector2(r[0]+r[1],s[0]+s[1]).multiplyScalar(.5),l=new THREE.Vector2(r[0]+r[3],s[0]+s[3]).multiplyScalar(.5),c=new THREE.Vector2(r[2]+r[1],s[2]+s[1]).multiplyScalar(.5),u=new THREE.Vector2(r[2]+r[3],s[2]+s[3]).multiplyScalar(.5),h=l.clone().add(c).multiplyScalar(.5);return t(h,c)||t(h,l)||t(h,a)||t(h,u)||function(t){var o=i.checkPolygon(t,e),r=o&&n.clientToWorld(o.x,o.y);return r&&r.point}(o)},n.generateBoundingBox=function(){for(var e={min:{x:0,y:0},max:{x:0,y:0}},t=this.generateBoundingPolygon(),i=t.vertexCount,n=t.xVertices,o=t.yVertices,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=0;c<i;++c){var u=n[c],h=o[c];r=Math.min(r,u),s=Math.min(s,h),a=Math.max(a,u),l=Math.max(l,h)}return e.min.x=r,e.min.y=s,e.max.x=a,e.max.y=l,e},n.generateBoundingPolygon=function(){var e=this.getClientPosition(),t=this.getClientSize();t.x*=.5,t.y*=.5;var i=new THREE.Vector3(-t.x,-t.y).add(e),n=new THREE.Vector3(t.x,-t.y).add(e),o=new THREE.Vector3(t.x,t.y).add(e),r=new THREE.Vector3(-t.x,t.y).add(e);if(0!==this.rotation){var s=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,0),a=(new THREE.Matrix4).makeRotationZ(this.rotation),l=(new THREE.Matrix4).makeTranslation(e.x,e.y,0).multiply(a).multiply(s);i.applyMatrix4(l),n.applyMatrix4(l),o.applyMatrix4(l),r.applyMatrix4(l)}return{vertexCount:4,xVertices:new Float32Array([i.x,n.x,o.x,r.x]),yVertices:new Float32Array([i.y,n.y,o.y,r.y])}},n.setMetadata=function(){return null},n.bindDomEvents=function(){i.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.shape,{recognizers:[[Hammer.Tap,{event:"singletap",pointers:1,threshold:2}]],inputClass:Hammer.TouchInput}),this.onSingleTapBinded=function(e){this.onMouseDown(e)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded)),this.shape.addEventListener("mousedown",this.onMouseDown.bind(this),!0),this.shape.addEventListener("mouseout",function(){this.highlight(!1)}.bind(this)),this.shape.addEventListener("mouseover",function(){this.highlight(!0)}.bind(this))},n.renderToCanvas=function(e){var t=(new THREE.Matrix4).makeRotationZ(-this.rotation),n=(new THREE.Matrix4).makeTranslation(this.position.x,this.position.y,0).multiply(t);i.renderToCanvas(this.editor,e,this.getPath(),this.style,n)},n.getPath=function(){},n.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",i.radiansToDegrees(-this.rotation),")"].join(" ")}}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeArrow(this.editor)},n.set=function(e,t,i,n){var o=new THREE.Vector2(e,t),r=new THREE.Vector2(i,n),s=r.clone().sub(o).normalize();this.size.x=o.distanceTo(r),this.rotation=Math.acos(s.dot(new THREE.Vector2(1,0))),this.rotation=n>t?2*Math.PI-this.rotation:this.rotation;var a=this.head,l=this.tail;a.set(i,n,0),l.set(e,t,0),this.position.x=l.x+.5*(a.x-l.x),this.position.y=l.y+.5*(a.y-l.y),this.updateStyle()},n.setRotation=function(e){this.rotation=e;var t=Math.cos(-e),i=Math.sin(-e),n=new THREE.Vector2(t,i);n.multiplyScalar(.5*this.size.x);var o=new THREE.Vector2(this.position.x,this.position.y),r=o.clone().sub(n),s=o.clone().add(n);this.head.set(s.x,s.y,0),this.tail.set(r.x,r.y,0),this.updateStyle()},n.setSize=function(e,t,i){var n=Math.cos(-this.rotation),o=Math.sin(-this.rotation),r=new THREE.Vector2(n,o);r.multiplyScalar(.5*t);var s=new THREE.Vector2(e.x,e.y),a=s.clone().sub(r),l=s.clone().add(r);this.head.set(l.x,l.y,0),this.tail.set(a.x,a.y,0),this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=e["stroke-width"],o=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),r=this.getTransform();this.size.y=3*n,this.style["fill-color"]=e["stroke-color"],this.style["fill-opacity"]=e["stroke-opacity"],i.setAttributeToMarkupSvg(t,"d",this.getPath().join(" ")),i.setAttributeToMarkupSvg(t,"stroke-width",n),i.setAttributeToMarkupSvg(t,"stroke",o),i.setAttributeToMarkupSvg(t,"fill",o),i.setAttributeToMarkupSvg(t,"transform",r),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setPosition=function(e,t){var i=this.head,n=this.tail,o=i.x-n.x,r=i.y-n.y,s=e+.5*o,a=t+.5*r;i.x=s,i.y=a,n.x=s-o,n.y=a-r,this.position.x=n.x+.5*(i.x-n.x),this.position.y=n.y+.5*(i.y-n.y),this.updateStyle()},n.generatePoint3d=function(e){var t=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),n=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),o=t.clone().sub(n).normalize(),r=i.checkLineSegment(t.x,t.y,t.x+200*o.x,t.y+200*o.y,e),s=r&&this.viewer.clientToWorld(r.x,r.y);return s&&s.point},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.head=[this.head.x,this.head.y].join(" "),e.tail=[this.tail.x,this.tail.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.size.x,t=this.size.y,i=t/3,n=this.style["stroke-width"],o=e-3*n,r=e-o,s=.3*n;return["M",.5*-e,.5*-t+i,"l",o,0,"l",-s,-i,"l",r+s,1.5*i,"l",-r-s,1.5*i,"l",s,-i,"l",-o,0,"z"]},t.MarkupArrow=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_CIRCLE,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeCircle(this.editor)},n.set=function(e,t){this.setSize(e,t.x,t.y)},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.size;if(1===e.x||1===e.y)return[""];var t=this.style["stroke-width"],n=e.x,o=n-t,r=e.y-t,s=.5*t-.5*n,a=[];return i.createEllipsePath(s,0,o,r,!1,a),a},t.MarkupCircle=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_CLOUD,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeCloud(this.editor)},n.set=function(e,t){this.setSize(e,t.x,t.y)},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){function e(e,t,i,n,o){return o.push("a"),o.push(i),o.push(n),o.push(0),o.push(1),o.push(1),o.push(e),o.push(t),o}function t(t,i,n,o,r){switch(t){case"LT":return e(i,-n,i,n,r);case"RT":return e(i,n,i,n,r);case"RB":return e(-i,n,i,n,r);case"LB":return e(-i,-n,i,n,r)}}function n(e,t,i,n){var o=2*i,r=Math.abs(t-e-n),s=Math.round(r/o),a=.05*(o+=(r-o*s)/s),l=3.5*(i=.5*o)/3;return{count:s,radius:i,diameter:o,p1:{x:a,y:-l},p2:{x:o-a,y:-l},p3:{x:o,y:0}}}var o=this.position,r=this.size,s=this.style["stroke-width"],a=2*s,l=o.x,c=o.y,u=o.x+r.x,h=o.y+r.y,d=5*a,p=[];if(r.x<d||r.y<d){var g=r.x-s,m=r.y-s,v=.5*-r.x,f=0;i.createEllipsePath(v,f,g,m,!1,p)}else{var E=n(l,u,a,s),A=n(c,h,a,s),y=E.diameter,T=A.diameter,w=E.radius,b=A.radius;E=n(l+y,u-y,a,s),A=n(c+T,h-T,a,s);var C=.5*s,v=.5*-r.x+C+w,f=.5*-r.y+C+2*b;p.push("M"),p.push(v),p.push(f),t("LT",w,b,s,p),function(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(i.p1.x),t.push(i.p1.y),t.push(i.p2.x),t.push(i.p2.y),t.push(i.p3.x),t.push(i.p3.y)}(E,p),t("RT",w,b,s,p),function(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(-i.p1.y),t.push(i.p1.x),t.push(-i.p2.y),t.push(i.p2.x),t.push(-i.p3.y),t.push(i.p3.x)}(A,p),t("RB",w,b,s,p),function(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(-i.p1.x),t.push(-i.p1.y),t.push(-i.p2.x),t.push(-i.p2.y),t.push(-i.p3.x),t.push(-i.p3.y)}(E,p),t("LB",w,b,s,p),function(e,t){for(var i=e,n=0;n<i.count;++n)t.push("c"),t.push(i.p1.y),t.push(-i.p1.x),t.push(i.p2.y),t.push(-i.p2.x),t.push(i.p3.y),t.push(-i.p3.x)}(A,p)}return p.push("z"),p},t.MarkupCloud=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_FREEHAND,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeFreehand(this.editor)},n.set=function(e,t,i){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill","none"),i.setAttributeToMarkupSvg(t,"transform",s),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=[],t=this.locations,i=t.length;if(i>1){e.push("M"),e.push(t[0].x),e.push(t[0].y);for(var n=1;n<i;++n){var o=t[n-1],r=t[n];e.push("l"),e.push(r.x-o.x),e.push(r.y-o.y)}}return e},t.MarkupFreehand=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_POLYLINE,this.shape=i.createMarkupPathSvg("path"),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModePolyline(this.editor)},n.set=function(e,t,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.closed=n,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.style["stroke-width"],o=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),r=this.closed?i.composeRGBAString(e["fill-color"],e["fill-opacity"]):"none",s=this.getTransform();i.setAttributeToMarkupSvg(t,"d",this.getPath().join(" ")),i.setAttributeToMarkupSvg(t,"stroke-width",n),i.setAttributeToMarkupSvg(t,"stroke",o),i.setAttributeToMarkupSvg(t,"fill",r),i.setAttributeToMarkupSvg(t,"transform",s),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=[],t=this.locations,i=t.length;if(0===i)return" ";e.push("M"),e.push(t[0].x),e.push(t[0].y);for(var n=1;n<i;++n){var o=t[n-1],r=t[n];e.push("l"),e.push(r.x-o.x),e.push(r.y-o.y)}return this.closed&&e.push("z"),e},t.MarkupPolyline=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModePolycloud(this.editor)},n.set=function(e,t,i,n){this.rotation=0,this.locations=i.concat(),this.size.x=0===t.x?1:t.x,this.size.y=0===t.y?1:t.y,this.closed=n,this.setSize(e,t.x,t.y),this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=this.closed?i.composeRGBAString(e["fill-color"],e["fill-opacity"]):"none",a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setSize=function(e,t,i){t=0===t?1:t,i=0===i?1:i;for(var n=this.locations,o=n.length,r=t/this.size.x,s=i/this.size.y,a=0;a<o;++a){var l=n[a];l.x*=r,l.y*=s}this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),e.locations=this.locations.map(function(e){return[e.x,e.y].join(" ")}).join(" "),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=2*this.style["stroke-width"],t=function(e){switch(e.length){case 0:case 1:return 1;case 2:var t=e[0],i=e[1];return t.y>i.y?1:-1;default:var n=e[0],o=e[1],r=e[2];return(o.x-n.x)*(o.y+n.y)+(r.x-o.x)*(r.y+o.y)<0?1:-1}}(this.locations),i=this.closed,n=[],o=function(e,t){for(var i=e.length,n=[],o=i-(t?0:1),r=0;r<o;++r){var s=e[r],a=e[(r+1)%i],l=a.x-s.x,c=a.y-s.y,u=Math.sqrt(l*l+c*c);n.push({index:r,pointA:new THREE.Vector3(s.x,s.y,0),pointB:new THREE.Vector3(a.x,a.y,0),vecAB:new THREE.Vector3(l/u,c/u,0),vecBA:new THREE.Vector3(-l/u,-c/u,0),length:u})}return n}(this.locations,i),r=function(e,t,i){for(var n=[],o=e.length,r=0;r<o;++r){var s=e[0!==r?r-1:o-1],a=e[r],l=s.vecBA.clone().cross(a.vecAB).z<0;s.length<t||a.length<t||0===r&&!i?n.push({pointA:a.pointA.clone(),pointB:a.pointA.clone(),radius:0,large:!1}):n.push({pointA:a.pointA.clone().add(s.vecBA.clone().multiplyScalar(t)),pointB:a.pointA.clone().add(a.vecAB.clone().multiplyScalar(t)),radius:t,large:l})}return n}(o,e,i),s=r.length;!function(e,t,i){for(var n=2*i,o=e.length,r=0;r<o;++r){var s=e[r],a=t[r],l=t[(r+1)%o];s.bodyA=s.vecAB.clone().multiplyScalar(a.radius).add(s.pointA),s.bodyB=s.vecBA.clone().multiplyScalar(l.radius).add(s.pointB),s.body=s.bodyB.clone().sub(s.bodyA).length(),s.bodyCount=Math.round(s.body/n),s.bodyDiameter=n+(s.body-n*s.bodyCount)/s.bodyCount,s.bodyRadius=.5*s.bodyDiameter}}(o,r,e);for(var a=0;a<s;++a)!function(e,t,i,n){t&&(n.push("M"),n.push(e.pointA.x),n.push(e.pointA.y));var o=1===i?e.large:!e.large;0!==e.radius&&(n.push("a"),n.push(e.radius),n.push(e.radius),n.push(0),n.push(o?1:0),n.push(1===i?1:0),n.push(e.pointB.x-e.pointA.x),n.push(e.pointB.y-e.pointA.y))}(r[a],0===a,t,n),function(e,t,i){var n=e.bodyRadius,o=e.bodyDiameter,r=.05*o,s=3.5*n/3,a=new THREE.Vector3(r,t*-s),l=new THREE.Vector3(o-r,t*-s),c=new THREE.Vector3(o,0),u=Math.acos(e.vecAB.x)*(e.vecAB.y<0?-1:1),h=(new THREE.Matrix4).makeRotationZ(u);a.applyMatrix4(h),l.applyMatrix4(h),c.applyMatrix4(h);for(var d=e.bodyCount,p=0;p<d;++p)i.push("c"),i.push(a.x),i.push(a.y),i.push(l.x),i.push(l.y),i.push(c.x),i.push(c.y)}(o[a],t,n);return i&&n.push("z"),n},t.MarkupPolycloud=e}(),function(){"use strict";function e(e,n){var o=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.Markup.call(this,e,n,o),this.type=t.MARKUP_TYPE_RECTANGLE,this.shape=i.createMarkupPathSvg(),this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var n=e.prototype;n.getEditMode=function(){return new t.EditModeRectangle(this.editor)},n.set=function(e,t){this.position.x=e.x,this.position.y=e.y,this.size.x=t.x,this.size.y=t.y,this.updateStyle()},n.updateStyle=function(){var e=this.style,t=this.shape,n=this.getPath().join(" "),o=this.style["stroke-width"],r=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),s=i.composeRGBAString(e["fill-color"],e["fill-opacity"]),a=this.getTransform();i.setAttributeToMarkupSvg(t,"d",n),i.setAttributeToMarkupSvg(t,"stroke-width",o),i.setAttributeToMarkupSvg(t,"stroke",r),i.setAttributeToMarkupSvg(t,"fill",s),i.setAttributeToMarkupSvg(t,"transform",a),i.updateMarkupPathSvgHitarea(t,this.editor)},n.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.rotation=String(this.rotation),i.addMarkupMetadata(this.shape,e)},n.getPath=function(){var e=this.style["stroke-width"],t=this.size.x-e,n=this.size.y-e,o=.5*-t,r=.5*-n,s=[];return i.createRectanglePath(o,r,t,n,!1,s),s},t.MarkupRectangle=e}(),function(){"use strict";function e(e,n,o){var r=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];t.Markup.call(this,e,n,r),this.type=t.MARKUP_TYPE_TEXT,this.shape=i.createMarkupTextSvg(),this.constraintRotation=!0,this.size.x=o.x,this.size.y=o.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils,n=100;e.prototype=Object.create(t.Markup.prototype),e.prototype.constructor=e;var o=e.prototype;o.getEditMode=function(){return new t.EditModeText(this.editor)},o.set=function(e,t,i,n){this.position.x=e.x,this.position.y=e.y,this.size.x=t.x,this.size.y=t.y,this.setText(i,n)},o.setSize=function(e,t,i){this.position.x=e.x,this.position.y=e.y,this.size.x=t,this.size.y=i,this.updateStyle()},o.setStyle=function(e){i.copyStyle(e,this.style),this.updateStyle()},o.setText=function(e){this.currentText=e,this.updateStyle()},o.getText=function(){return this.currentText},o.getTextLines=function(){return this.currentTextLines.concat()},o.updateStyle=function(){function e(){var e=this.style,t=this.shape,o=this.style["font-size"],r=this.style["font-family"],s=this.style["font-weight"],a=this.style["font-style"],l=this.highlighted?this.highlightColor:i.composeRGBAString(e["stroke-color"],e["stroke-opacity"]),c=i.composeRGBAString(e["fill-color"],e["fill-opacity"]);this.rebuildTextSvg(),i.setAttributeToMarkupSvg(t,"font-family",r),i.setAttributeToMarkupSvg(t,"font-size",o*n),i.setAttributeToMarkupSvg(t,"fill",l),i.setAttributeToMarkupSvg(t,"font-weight",s),i.setAttributeToMarkupSvg(t,"font-style",a);var u=this.editor,h=this.getTransform(),d=this.getTextTransform(),p=this.textSize;i.setMarkupTextSvgTransform(t,h,d),i.updateMarkupTextSvgBackground(t,p.x,p.y,c),i.updateMarkupTextSvgClipper(t,p.x,p.y),i.updateMarkupTextSvgHitarea(t,p.x,p.y,u),this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,requestAnimationFrame(e.bind(this)))},o.rebuildTextSvg=function(){var e=this.editor.editMode;if(e&&e.type===this.type){var t=i.cloneStyle(e.textInputHelper.style),o=e.textInputHelper.textArea.value;this.currentTextLines=e.textInputHelper.getTextValuesForMarkup(this).lines,e.selectedMarkup!==this&&(e.textInputHelper.textArea.value=o,e.textInputHelper.setStyle(t))}var r=i.createSvgElement("text");r.setAttribute("id","markup"),r.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(r),this.shape.markup=r;var s=0,a=this.getLineHeight()*n;this.currentTextLines.forEach(function(e){var t=i.createSvgElement("tspan");t.setAttribute("x",0),t.setAttribute("y",s),t.textContent=e,r.appendChild(t),s+=a}.bind(this));var l=this.generateBoundingPolygon(),c=this.editor.sizeFromClientToMarkups(l.xVertices[1]-l.xVertices[0],l.yVertices[2]-l.yVertices[0]);this.textSize.x=Math.min(c.x,this.size.x),this.textSize.y=Math.min(c.y,this.size.y)},o.generateBoundingPolygon=function(){var e=this.getClientPosition(),t=this.getClientSize(),n=function(e,t,n){for(var o={w:0,h:0},r=(e=i.measureTextLines(e,t,n)).length,s=0;s<r;++s){var a=e[s];o.w=Math.max(o.w,a.width),o.h=o.h+a.height}return 0!==o.h&&(o.h+=n.sizeFromMarkupsToClient(0,.25*t["font-size"]).y),o}(this.currentTextLines,this.style,this.editor),o=Math.min(t.x,n.w),r=Math.min(t.y,n.h),s=new THREE.Vector2(.5*-t.x,.5*-t.y).add(e),a=new THREE.Vector2(s.x+o,s.y),l=new THREE.Vector2(a.x,a.y+r),c=new THREE.Vector2(s.x,l.y);return{vertexCount:4,xVertices:new Float32Array([s.x,a.x,l.x,c.x]),yVertices:new Float32Array([s.y,a.y,l.y,c.y])}},o.setMetadata=function(){var e=i.cloneStyle(this.style);return e.type=this.type,e.position=[this.position.x,this.position.y].join(" "),e.size=[this.size.x,this.size.y].join(" "),e.text=String(this.currentText),i.addMarkupMetadata(this.shape,e)},o.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},o.getLineHeight=function(){return this.style["font-size"]},o.renderToCanvas=function(e){var t=this.style["font-family"],n=this.style["font-style"],o=this.style["font-weight"],r=this.style["stroke-color"],s=this.style["stroke-opacity"],a=this.getClientFontSize(),l=this.editor.positionFromMarkupsToClient(this.position.x,this.position.y),c=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y),u=this.editor.sizeFromMarkupsToClient(this.textSize.x,this.textSize.y),h=this.editor.sizeFromMarkupsToClient(0,this.getLineHeight()).y;e.save();var d=this.style["fill-color"],p=this.style["fill-opacity"];e.fillStyle=i.composeRGBAString(d,p),e.translate(l.x,l.y),0!==p&&e.fillRect(-.5*c.x,-.5*c.y,u.x,u.y),e.restore(),e.fillStyle=r,e.strokeStyle=r,e.textBaseline="Alphabetic",e.translate(l.x-.5*c.x,l.y-.5*c.y+h),e.font=n+" "+o+" "+a+"px "+t,e.globalAlpha=s,function(e,t,i,n){var o=0;t.forEach(function(t){o+i>n||(e.fillText(t,0,o),o+=i)})}(e,this.currentTextLines,h,c.y)},o.getTransform=function(){return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y,")","rotate(",i.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},o.getTextTransform=function(){var e=this.getLineHeight();return["translate(",this.position.x-.5*this.size.x,",",this.position.y+.5*this.size.y-e,")","rotate(",i.radiansToDegrees(-this.rotation),")","scale("+1/n+","+-1/n+")"].join(" ")},o.cloneShape=function(e){e.shape=i.createMarkupTextSvg(),e.bindDomEvents()},t.MarkupText=e}(),function(){"use strict";function e(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.coreExt=null,this.hotkeysEnabled=!0;var e=!1,t=!1;this.allowNavigation=function(e){this.allowNav=e},this.setCoreExtension=function(e){this.coreExt=e},this.setHotkeysEnabled=function(e){this.hotkeysEnabled=e},this.activate=function(e,t){this.panTool=t.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan")},this.deactivate=function(e){this.panTool&&this.panTool.deactivate("pan"),this.panTool=null},this.handleKeyDown=function(i,n){if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:e=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:t=!0;break;case Autodesk.Viewing.KeyCode.x:e&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:e&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:e&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:e&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!e||t||this.allowNav?e&&t&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:e&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var o=this.coreExt.getSelection();o&&this.coreExt.deleteMarkup(o);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(i,n){if(!this.hotkeysEnabled)return!0;switch(n){case Autodesk.Viewing.KeyCode.CONTROL:e=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:t=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(e,t)},this.handleDoubleClick=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(e,t)},this.handleSingleTap=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(e)},this.handleDoubleTap=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(e)},this.handleWheelInput=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleWheelInput)&&this.panTool.handleWheelInput(e)},this.handleButtonDown=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(e,t)},this.handleButtonUp=function(e,t){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(e,t)},this.handleMouseMove=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(e)},this.handleGesture=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(e)},this.handleBlur=function(e){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(e)}}Autodesk.Viewing.Extensions.Markups.Core.MarkupTool=e}(),function(){"use strict";function e(e,n){Autodesk.Viewing.Extension.call(this,e,n),this.options=this.options||{},this.markups=[],this.styles={},this.duringViewMode=!1,this.duringEditMode=!1,this.actionManager=new t.EditActionManager(50),this.actionManager.addEventListener(t.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new t.Clipboard(this),this.input=new t.InputHandler,i.addTraitEventDispatcher(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(e){var t=this;t.onViewerResize(e),requestAnimationFrame(function(){t.duringViewMode&&t.onViewerResize(e)})}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this);var o=i.createStyleSheet();i.addRuleToStyleSheet(o,".autodesk-markups-extension-core-make-me-bigger:after",'content:""; position:absolute; top:-10px; bottom:-10px; left:-10px; right:-10px;',0)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),i=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,t.MarkupsCore=e,t.EVENT_ENTER_EDIT_MODE="EVENT_MARKUP_CORE_ENTER_EDIT_MODE",t.EVENT_LEAVE_EDIT_MODE="EVENT_MARKUP_CORE_LEAVE_EDIT_MODE",t.EVENT_SELECTION_CHANGED="EVENT_MARKUP_SELECTION_CHANGED";var n=e.prototype;n.load=function(){var e=this.svg=i.createSvgElement("svg");i.setSvgParentAttributes(e);var n=new i.DomElementStyle;n.setAttribute("position","absolute"),n.setAttribute("left","0"),n.setAttribute("top","0"),n.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),n.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),e.setAttribute("style",n.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new t.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(t.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(t.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this));var o=this.options.markupToolClass||t.MarkupTool;return this.markupTool=new o,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(!this.options.markupDisableHotkeys),this.viewer.toolController.registerTool(this.markupTool),this.snapper=new Autodesk.Viewing.Extensions.Measure.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper),!0},n.unload=function(){this.hide(),this.input.detachFrom(this),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var e=this.svg;return e&&this.onMouseDownBinded&&(e.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),e.parentNode&&e.parentNode.removeChild(e),this.editModeSvgLayerNode=null,this.svg=null,!0},n.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},n.enterEditMode=function(){return!!this.duringEditMode||!(!this.duringViewMode&&!this.show())&&(this.editModeSvgLayerNode||(this.editModeSvgLayerNode=i.createSvgElement("g"),this.editModeSvgLayerNode.setAttribute("cursor","default")),this.svg.insertBefore(this.editModeSvgLayerNode,this.svg.firstChild),this.svg.setAttribute("cursor","crosshair"),this.input.enterEditMode(),this.activateTool(!0),this.allowNavigation(!1),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new t.EditModeArrow(this)),this.actionManager.clear(),this.fireEvent({type:t.EVENT_EDITMODE_ENTER}),!0)},n.leaveEditMode=function(){return!this.duringEditMode||!this.duringViewMode||!!this.viewer&&(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.snapper.clearOverlay(),this.snapper.clearSnapped(),this.svg.removeChild(this.editModeSvgLayerNode),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.fireEvent({type:t.EVENT_EDITMODE_LEAVE}),!0)},n.toggle=function(){this.duringViewMode?this.hide():this.show()},n.show=function(){var e=this.viewer;if(!e||!e.model)return!1;if(this.duringViewMode||this.duringEditMode)return!0;e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),e.container.appendChild(this.svg),this.input.enterViewMode(),i.hideLmvUi(e),this.onViewerRolloverObject=e.impl.rolloverObject,e.impl.rolloverObject=function(){},this.activateTool(!0);var t=e.impl.camera;return this.onViewerResize({width:t.clientWidth,height:t.clientHeight}),this.clear(),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},n.hide=function(){var e=this.viewer;if(!e||!this.duringViewMode)return!0;if(this.duringEditMode&&!this.leaveEditMode())return!1;e.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var t=this.svg;return t.parentNode&&t.parentNode.removeChild(t),this.unloadMarkupsAllLayers(),i.removeAllMetadata(t),this.input.leaveViewMode(),i.restoreLmvUi(e),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,!0},n.clear=function(){for(var e=this.markups;e.length>0;){var t=e[0];this.removeMarkup(t),t.destroy()}var i=this.editModeSvgLayerNode;if(i&&i.childNodes.length>0)for(;i.childNodes.length;)i.removeChild(i.childNodes[0])},n.generateData=function(){this.editMode&&this.editMode.onSave(),i.removeAllMetadata(this.svg);var e=i.createSvgElement("svg");i.transferChildNodes(this.svg,e),i.transferChildNodes(this.editModeSvgLayerNode,this.svg);var t={"data-model-version":"4"},n=[i.addSvgMetadata(this.svg,t)];this.markups.forEach(function(e){var t=e.setMetadata();t&&n.push(t)});var o=i.svgNodeToString(this.svg);return n.forEach(function(e){e.parentNode.removeChild(e)}),i.transferChildNodes(this.svg,this.editModeSvgLayerNode),i.transferChildNodes(e,this.svg),e=null,o},n.generatePoints3d=function(){var e={markups:[],main:null},n=this.markups,o=n.length;if(0===o)return e;for(var r=this.viewer.impl.renderer().readbackTargetId(),s=0;s<o;++s){var a=n[s],l=a.generatePoint3d(r)||null;e.markups.push({id:a.id,type:a.type,point:l||null})}if(1===o){var c=e.markups[0].point;return e.main=c&&c.clone(),e}for(s=0;s<o;++s){var u=e.markups[s];if(u.type===t.MARKUP_TYPE_ARROW&&null!==u.point)return e.main=u.point.clone(),e}for(var h=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=Number.NEGATIVE_INFINITY,s=0;s<o;++s){var m=n[s].generateBoundingBox();h=Math.min(h,m.min.x),d=Math.min(d,m.min.y),p=Math.max(p,m.max.x),g=Math.max(g,m.max.y)}var v={};v.vertexCount=4,v.xVertices=new Float32Array([h,p,p,h]),v.yVertices=new Float32Array([d,d,g,g]);var f=i.checkPolygon(v,r),E=f&&this.viewer.clientToWorld(f.x,f.y);return e.main=E&&E.point,e},n.renderToCanvas=function(e){this.markups.forEach(function(t){e.save(),t.renderToCanvas(e),e.restore()})},n.changeEditMode=function(e){var n=this.editMode;n&&n.destroy(),e.addEventListener(t.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),e.addEventListener(t.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),e.addEventListener(t.EVENT_MARKUP_DESELECT,function(e){this.fireEvent(e)}.bind(this)),this.editMode=e,this.styles[e.type]=i.cloneStyle(e.getStyle()),this.fireEvent({type:t.EVENT_EDITMODE_CHANGED,target:e})},n.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},n.allowNavigation=function(e){if(e&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;var t=this.editMode;this.navigating=e,e?(this.svg.setAttribute("pointer-events","none"),t&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted"),e&&(this.snapper.clearOverlay(),this.snapper.clearSnapped());for(var i=this.markups,n=i.length,o=0;o<n;++o)i[o].updateStyle();this.markupTool.allowNavigation(e),t&&t.notifyAllowNavigation(e)},n.disableMarkupInteractions=function(e){this.markups.forEach(function(t){t.disableInteractions(e)})},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.activateTool=function(e){if(e)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var t=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(t)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onToolChange=function(e){if(e.toolName===this.markupTool.getName()){if(e.active){var t=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:t,zoom:t,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(e.active)}},n.changeInputHandler=function(e){this.input.detachFrom(this),e.attachTo(this),this.input=e,this.duringEditMode&&e.enterEditMode(),this.duringViewMode&&e.enterViewMode()},n.copy=function(){this.clipboard.copy()},n.cut=function(){this.clipboard.cut()},n.paste=function(){this.clipboard.paste()},n.undo=function(){this.actionManager.undo()},n.redo=function(){this.actionManager.redo()},n.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},n.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},n.beginActionGroup=function(){this.actionManager.beginActionGroup()},n.closeActionGroup=function(){this.actionManager.closeActionGroup()},n.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},n.getId=function(){return++this.nextId},n.onEditActionHistoryChanged=function(e){var t=e.data,i=this.editMode,n=i&&i.selectedMarkup&&i.selectedMarkup.id===t.targetId;if("undo"!==t.action&&-1!==t.targetId||"undo"===t.action&&n){var o=this.getMarkup(t.targetId);this.selectMarkup(o)}this.fireEvent(e)},n.getMarkup=function(e){for(var t=this.markups,i=t.length,n=0;n<i;++n)if(t[n].id==e)return t[n];return null},n.selectMarkup=function(e){if(e)if(this.editMode.type===e.type)this.editMode.setSelection(e);else{var t=e.getEditMode();t.setSelection(null),this.changeEditMode(t),this.setStyle(e.getStyle()),this.editMode.setSelection(e)}else this.editMode.setSelection(null)},n.getSelection=function(){return this.editMode.getSelection()},n.deleteMarkup=function(e,t){e.getEditMode().deleteMarkup(e,t)},n.addMarkup=function(e){e.setParent(this.editModeSvgLayerNode),e.addEventListener(t.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),e.addEventListener(t.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),e.addEventListener(t.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),e.addEventListener(t.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.markups.push(e)},n.removeMarkup=function(e){e.setParent(null),e.removeEventListener(t.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),e.removeEventListener(t.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),e.removeEventListener(t.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),e.removeEventListener(t.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var i=this.markups,n=i.indexOf(e);-1!==n&&i.splice(n,1);var o=this.editMode;o&&o.getSelection()===e&&this.selectMarkup(null)},n.setStyle=function(e){var t=this.styles,n=this.editMode;i.copyStyle(e,t[n.type]),n.setStyle(t[n.type])},n.getStyle=function(){return i.cloneStyle(this.styles[this.editMode.type])},n.getDefaultStyle=function(){var e=["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"];return this.defaultStyle=this.defaultStyle||i.createStyle(e,this),this.defaultStyle},n.bringToFront=function(e){this.sendMarkupTo(e,this.markups.length-1)},n.sendToBack=function(e){this.sendMarkupTo(e,0)},n.bringForward=function(e){var t=this.markups.indexOf(e);this.sendMarkupTo(e,t+1)},n.bringBackward=function(e){var t=this.markups.indexOf(e);this.sendMarkupTo(e,t-1)},n.sendMarkupTo=function(e,t){var i=this.markups,n=i.indexOf(e);-1===n||t<0||t>=i.length||(i.splice(n,1),t=n>t?t-1:t,i.splice(t,0,e),e.setParent(null),e.setParent(this.editModeSvgLayerNode))},n.loadMarkups=function(e,t){var n=this,o=n.viewer,r=o.impl.camera,s=function(e,t){var o=n.viewer.impl.camera,r=i.clientToWorld(e,t,0,n.viewer),s=n.viewer.model.getData().globalOffset;return s&&r.sub(s),r.add(o.position),r.applyMatrix4(o.matrixWorldInverse),r.z=0,r},a=i.getClipPathId(),l=function(e){if("markup_element"==e.tagName&&"label"===e.getAttribute("type")){var t=e.parentNode.parentNode.childNodes[1].childNodes[0],i="markup-clipper-"+a++,n="url(#"+i+")";t.setAttribute("id",i),t.parentNode.setAttribute("clip-path",n)}else for(var o=e.childNodes,r=o.length,s=0;s<r;++s)l(o[s])};if(!this.duringViewMode)return!1;if(!t)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var c=i.stringToSvgNode(e);if(!c)return!1;var u=c.childNodes[0].childNodes[0],h=parseFloat(u.getAttribute("data-model-version")),d={x:0,y:0},p=this.viewer.model.getData().globalOffset;if(h<2&&p){var g=s(0,0).sub(function(e,t){var n=i.clientToWorld(e,t,0,o);return n.add(r.position).applyMatrix4(r.matrixWorldInverse),n.z=0,n}(0,0));d.x+=g.x,d.y+=g.y}if(h<4&&p&&!r.isPerspective){var m=this.clientToMarkups(0,0).sub(s(0,0));d.x+=m.x,d.y+=m.y}var v=null;h<4&&r.isPerspective&&(v=1e3),h>=3&&l(c),i.removeAllMetadata(c);var f=this.svgLayersMap[t];f||(f=i.createSvgElement("g"),this.svg.appendChild(f),this.svgLayersMap[t]=f);for(var E=c.childNodes;E.length;){var A=E[0];if("clipPath"!==A.localName){var y=A.getAttribute("transform")||"";0===d.x&&0===d.y||(y="translate("+d.x+", "+d.y+") "+y),v&&(y="scale("+v+", "+v+") "+y),(d||v)&&A.setAttribute("transform",y),f.appendChild(A),A.setAttribute("pointer-events","none")}}return!0},n.unloadMarkups=function(e){if(!e)return console.warn("unloadMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];return!!t&&(this.svg.removeChild(t),delete this.svgLayersMap[e],!0)},n.unloadMarkupsAllLayers=function(){for(var e in this.svgLayersMap)this.svgLayersMap.hasOwnProperty(e)&&this.svg.removeChild(this.svgLayersMap[e]);this.svgLayersMap={}},n.hideMarkups=function(e){if(!e)return console.warn("hideMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];if(!t)return!1;t.setAttribute("visibility","hidden")},n.showMarkups=function(e){if(!e)return console.warn("showMarkups failed; No layerId provided."),!1;var t=this.svgLayersMap[e];if(!t)return!1;t.setAttribute("visibility","visible")},n.positionFromClientToMarkups=function(e,t){return this.clientToMarkups(e,t)},n.positionFromMarkupsToClient=function(e,t){return this.markupsToClient(e,t)},n.vectorFromClientToMarkups=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t);return{x:n.x-i.x,y:n.y-i.y}},n.vectorFromMarkupsToClient=function(e,t){var i=this.markupsToClient(0,0),n=this.markupsToClient(e,t);return{x:n.x-i.x,y:n.y-i.y}},n.sizeFromClientToMarkups=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},n.sizeFromMarkupsToClient=function(e,t){var i=this.markupsToClient(0,0),n=this.markupsToClient(e,t);return{x:Math.abs(n.x-i.x),y:Math.abs(n.y-i.y)}},n.markupsToClient=function(e,t){var n=this.viewer.impl.camera,o=new THREE.Vector3(e,t,0);if(n.isPerspective){var r=this.viewer.impl.canvas.getBoundingClientRect();o.x=o.x/1e3*(.5*r.height)+.5*r.width,o.y=-o.y/1e3*(.5*r.height)+.5*r.height}else{o.applyMatrix4(n.matrixWorld),o.sub(n.position);var s=this.viewer.model.getData().globalOffset;s&&o.sub(s),(o=i.worldToClient(o,this.viewer,!1)).z=0}return o},n.clientToMarkups=function(e,t){var n=this.viewer.impl.camera,o=new THREE.Vector3(e,t,0);if(n.isPerspective){var r=this.viewer.impl.canvas.getBoundingClientRect();o.x=(o.x-.5*r.width)/(.5*r.height)*1e3,o.y=-(o.y-.5*r.height)/(.5*r.height)*1e3}else{o=i.clientToWorld(o.x,o.y,0,this.viewer);var s=this.viewer.model.getData().globalOffset;s&&o.add(s),o.add(n.position),o.applyMatrix4(n.matrixWorldInverse),o.z=0}return o},n.getSvgViewBox=function(e,t){var i=this.clientToMarkups(0,0),n=this.clientToMarkups(e,t),o=Math.min(i.x,n.x),r=Math.min(i.y,n.y);return[o,r,Math.max(i.x,n.x)-o,Math.max(i.y,n.y)-r].join(" ")},n.getBounds=function(){return this.bounds},n.getMousePosition=function(){return this.viewer.model.is2d()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition()},n.getSnapPosition=function(){var e,t=this.snapper.getHighlightGeometry(),i=this.snapper.getGeometry();e=t===SNAP_VERTEX?i:this.snapper.nearestPointInPointToEdge(i,this.snapper.getIntersectPoint());var n=this.project(e);return{x:n.x,y:n.y}},n.project=function(e){var t=this.viewer.navigation.getCamera(),i=this.viewer.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(e);return n.project(t),new THREE.Vector3(Math.round((n.x+1)/2*i.width),Math.round((1-n.y)/2*i.height),n.z)},n.onCameraChange=function(e){var t=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==t){this.svg.setAttribute("viewBox",t);var i=this.editMode;if(i){var n=i.getSelection();this.editFrame.setMarkup(n)}}},n.onViewerResize=function(e){this.bounds.x=0,this.bounds.y=0,this.bounds.width=e.width,this.bounds.height=e.height,this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height),this.onCameraChange()},n.onMouseMove=function(e){if(!this.navigating){if(this.editFrame.isActive()&&"mousemove"===e.type&&this.editFrame.onMouseMove(e),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var t=this.input.getMousePosition();this.snapper&&this.snapper.onMouseMove(t)}this.editMode&&this.editMode.onMouseMove(e)}};var o=0,r="";n.onMouseDown=function(e){var t=performance.now();if(!(t-o<400&&r!==e.type)){if(o=t,r=e.type,i.dismissLmvHudMessage(),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var n=this.input.getMousePosition();this.snapper&&this.snapper.onMouseDown(n)}var s=this.getBounds();(n=this.getMousePosition()).x>=s.x&&n.x<=s.x+s.width&&n.y>=s.y&&n.y<=s.y+s.height&&this.editMode.onMouseDown(e),this.editMode.creating||e.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1}};var s=0,a="";n.onMouseUp=function(e){var t=performance.now();t-s<400&&a!==e.type||(s=t,a=e.type,this.navigating||(this.editFrame.isActive()?this.editFrame.onMouseUp(e):this.ignoreNextMouseUp||this.editMode.onMouseUp(e)))},n.onMouseDoubleClick=function(e){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(e)},n.onUserCancel=function(){this.editMode&&(this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect())},n.onMarkupSelected=function(e){this.selectMarkup(e.markup),this.fireEvent(e)},n.onMarkupEnterEdition=function(e){},n.onMarkupCancelEdition=function(e){this.onUserCancel()},n.onMarkupDeleteEdition=function(e){this.removeMarkup(e.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",e)}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"CLONE-MARKUP",i),this.clone=n.clone(),this.clone.id=i,this.position={x:o.x,y:o.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor,t=this.clone,i=this.position;if(!e.getMarkup(this.targetId)){var n=t.clone();n.setPosition(i.x,i.y),e.addMarkup(n)}},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CloneMarkup=e}(),function(){"use strict";function e(e,n,o,r,s){t.EditAction.call(this,e,"CREATE-ARROW",n),this.selectOnExecution=!1,this.tail=r,this.head=o,this.style=i.cloneStyle(s)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupArrow(this.targetId,e);e.addMarkup(i),i.set(this.head.x,this.head.y,this.tail.x,this.tail.y),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateArrow=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-CIRCLE",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupCircle(this.targetId,e);e.addMarkup(i),i.setSize(this.position,this.size.x,this.size.y),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateCircle=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-CLOUD",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupCloud(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateCloud=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-FREEHAND",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupFreehand(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateFreehand=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-POLYCLOUD",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupPolycloud(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreatePolycloud=e}(),function(){"use strict";function e(e,n,o,r,s,a,l){t.EditAction.call(this,e,"CREATE-POLYLINE",n),this.selectOnExecution=!1,this.position=o,this.size=r,this.rotation=s,this.movements=a.concat(),this.style=i.cloneStyle(l)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupPolyline(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size,this.movements),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreatePolyline=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-RECTANGLE",n),this.selectOnExecution=!1,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.rotation=s,this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=new t.MarkupRectangle(this.targetId,e);e.addMarkup(i),i.set(this.position,this.size),i.setRotation(this.rotation),i.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&this.editor.removeMarkup(e)},t.CreateRectangle=e}(),function(){"use strict";function e(e,n,o,r,s,a){t.EditAction.call(this,e,"CREATE-TEXT",n),this.text=s,this.position={x:o.x,y:o.y},this.size={x:r.x,y:r.y},this.style=i.cloneStyle(a)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor,i=this.position,n=this.size,o=new t.MarkupText(this.targetId,e,n);e.addMarkup(o),o.setSize(i,n.x,n.y),o.setText(this.text),o.setStyle(this.style)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&(this.editor.removeMarkup(e),e.destroy())},t.CreateText=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-ARROW",i.id),this.createArrow=new t.CreateArrow(e,i.id,i.head,i.tail,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createArrow.undo()},i.undo=function(){this.createArrow.redo()},t.DeleteArrow=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-CIRCLE",i.id),this.createCircle=new t.CreateCircle(e,i.id,i.position,i.size,i.rotation,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createCircle.undo()},i.undo=function(){this.createCircle.redo()},t.DeleteCircle=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-CLOUD",i.id),this.createCloud=new t.CreateCloud(e,i.id,i.position,i.size,i.rotation,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createCloud.undo()},i.undo=function(){this.createCloud.redo()},t.DeleteCloud=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-FREEHAND",i.id),this.createFreehand=new t.CreateFreehand(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createFreehand.undo()},i.undo=function(){this.createFreehand.redo()},t.DeleteFreehand=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-POLYCLOUD",i.id),this.createPolycloud=new t.CreatePolyline(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createPolycloud.undo()},i.undo=function(){this.createPolycloud.redo()},t.DeletePolycloud=e}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-POLYLINE",i.id),this.createPolyline=new t.CreatePolyline(e,i.id,i.position,i.size,i.rotation,i.locations,i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createPolyline.undo()},i.undo=function(){this.createPolyline.redo()},t.DeletePolyline=e}(),function(){"use strict";var e=Autodesk.Viewing.Extensions.Markups.Core,t=function(t,i){e.EditAction.call(this,t,"DELETE-RECTANGLE",i.id),this.createRectangle=new e.CreateRectangle(t,i.id,i.position,i.size,i.rotation,i.getStyle())};(t.prototype=Object.create(e.EditAction.prototype)).constructor=t;var i=t.prototype;i.redo=function(){this.createRectangle.undo()},i.undo=function(){this.createRectangle.redo()},e.DeleteRectangle=t}(),function(){"use strict";function e(e,i){t.EditAction.call(this,e,"DELETE-TEXT",i.id);var n={x:i.position.x,y:i.position.y},o={x:i.size.x,y:i.size.y};this.createText=new t.CreateText(e,i.id,n,o,i.getText(),i.getStyle())}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.createText.undo()},i.undo=function(){this.createText.redo()},t.DeleteText=e}(),function(){"use strict";function e(){this.actions=[],this.closed=!0}var t=Autodesk.Viewing.Extensions.Markups.Core,i=e.prototype;i.open=function(){return!!this.closed&&(this.closed=!1,!0)},i.close=function(){return!this.closed&&(this.closed=!0,!0)},i.undo=function(){for(var e=this.actions,t=-1,i=e.length-1;i>=0;--i){var n=e[i];n.undo(),-1!==n.targetId&&(t=n.targetId)}return t},i.redo=function(){for(var e=this.actions,t=e.length,i=-1,n=0;n<t;++n){var o=e[n];o.redo(),-1!==o.targetId&&(i=o.targetId)}return i},i.isOpen=function(){return!this.closed},i.isClosed=function(){return this.closed},i.isEmpty=function(){return 0===this.actions.length},i.addAction=function(e){return!this.closed&&(this.actions.push(e),this.compact(),!0)},i.compact=function(){for(var e=this.actions,t=e.length,i=0;i<t;++i){var n=e[i];if(n.isIdentity())e.splice(i,1),--t,--i;else for(var o=i+1;o<t;++o){var r=e[o];if(n.type===r.type&&n.merge(r)){e.splice(o,1),--t,--i;break}}}},t.EditActionGroup=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-ARROW",i.id),this.newHead={x:n.x,y:n.y},this.newTail={x:o.x,y:o.y},this.oldHead={x:i.head.x,y:i.head.y},this.oldTail={x:i.tail.x,y:i.tail.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},i.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newHead=e.newHead,this.newTail=e.newTail,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){(Math.abs(n.head.x-t.x)>=1e-4||Math.abs(n.head.y-t.y)>=1e-4||Math.abs(n.tail.x-i.x)>=1e-4||Math.abs(n.tail.y-i.y)>=1e-4)&&n.set(t.x,t.y,i.x,i.y)}},i.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y},t.SetArrow=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-CIRCLE",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){(Math.abs(n.position.x-t.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-t.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetCircle=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-CLOUD",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){(Math.abs(n.position.x-t.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-t.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetCloud=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-FREEHAND",i.id),this.position=n,this.size=o,this.locations=r.concat()}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,!0)},i.isIdentity=function(){return!1},t.SetFreehand=e}(),function(){"use strict";function e(e,i,n,o,r,s){t.EditAction.call(this,e,"SET-POLYCLOUD",i.id),this.position=n,this.size=o,this.locations=r.concat(),this.closed=s}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations,this.closed)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,this.closed=e.closed,!0)},i.isIdentity=function(){return!1},t.SetPolycloud=e}(),function(){"use strict";function e(e,i,n,o,r,s){t.EditAction.call(this,e,"SET-POLYLINE",i.id),this.position=n,this.size=o,this.locations=r.concat(),this.closed=s}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.position,this.size,this.locations,this.closed)},i.undo=function(){},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.locations=e.locations.concat(),this.position=e.position,this.size=e.size,this.closed=e.closed,!0)},i.isIdentity=function(){return!1},t.SetPolyline=e}(),function(){"use strict";function e(e,i,n){t.EditAction.call(this,e,"SET-POSITION",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setPosition(this.newPosition.x,this.newPosition.y)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setPosition(this.oldPosition.x,this.oldPosition.y)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,!0)},i.isIdentity=function(){var e=this.newPosition,t=this.oldPosition;return e.x===t.x&&e.y===t.y},t.SetPosition=e}(),function(){"use strict";function e(e,i,n,o){t.EditAction.call(this,e,"SET-RECTANGLE",i.id),this.newPosition={x:n.x,y:n.y},this.newSize={x:o.x,y:o.y},this.oldPosition={x:i.position.x,y:i.position.y},this.oldSize={x:i.size.x,y:i.size.y}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},i.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newSize=e.newSize,!0)},i.applyState=function(e,t,i){var n=this.editor.getMarkup(e);if(n){(Math.abs(n.position.x-t.x)>1e-4||Math.abs(n.size.y-i.y)>1e-4||Math.abs(n.position.y-t.y)>1e-4||Math.abs(n.size.y-i.y)>1e-4)&&n.set(t,i)}},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},t.SetRectangle=e}(),function(){"use strict";function e(e,i,n){t.EditAction.call(this,e,"SET-ROTATION",i.id);var o=i.getRotation();this.newRotation={angle:n},this.oldRotation={angle:o}}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setRotation(this.newRotation.angle)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setRotation(this.oldRotation.angle)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newRotation=e.newRotation,!0)},i.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle},t.SetRotation=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-SIZE",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y},this.newWidth=o,this.oldWidth=i.size.x,this.newHeight=r,this.oldHeight=i.size.y}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setSize(this.newPosition,this.newWidth,this.newHeight)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},i.merge=function(e){return this.targetId===e.targetId&&this.type===e.type&&(this.newPosition=e.newPosition,this.newWidth=e.newWidth,this.newHeight=e.newHeight,!0)},i.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight},t.SetSize=e}(),function(){"use strict";function e(e,n,o){t.EditAction.call(this,e,"SET-STYLE",n.id),this.newStyle=i.cloneStyle(o),this.oldStyle=n.getStyle()}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var n=e.prototype;n.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setStyle(this.newStyle)},n.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.setStyle(this.oldStyle)},t.SetStyle=e}(),function(){"use strict";function e(e,i,n,o,r){t.EditAction.call(this,e,"SET-TEXT",i.id),this.newPosition={x:n.x,y:n.y},this.oldPosition={x:i.position.x,y:i.position.y},this.newSize={x:o.x,y:o.y},this.oldSize={x:i.size.x,y:i.size.y},this.newText=r,this.oldText=i.getText()}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditAction.prototype),e.prototype.constructor=e;var i=e.prototype;i.redo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.newPosition,this.newSize,this.newText)},i.undo=function(){var e=this.editor.getMarkup(this.targetId);e&&e.set(this.oldPosition,this.oldSize,this.oldText)},t.SetText=e}(),function(){"use strict";function e(e){this.editor=e,this.content=null,this.pastePosition={x:0,y:0},i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils,n=e.prototype;n.copy=function(){var e=this.editor.getSelection();e&&(this.content=e.clone(),this.pastePosition.x=e.position.x,this.pastePosition.y=e.position.y)},n.cut=function(){var e=this.editor.getSelection();e&&(this.copy(),this.editor.deleteMarkup(e))},n.paste=function(){var e=this.content;if(e){var i=this.editor,n=this.pastePosition,o=i.sizeFromClientToMarkups(20,20);n.x+=o.x,n.y-=o.y,new t.CloneMarkup(i,i.getId(),e,n).execute()}},t.Clipboard=e}(),function(){"use strict";function e(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.isMouseDown=!1}function t(e,t){var i=e.editor.svg.getBoundingClientRect();e.makeSameXY=t.shiftKey,e.snapRotations=t.shiftKey,e.keepAspectRatio=t.shiftKey,e.constrainAxis=t.shiftKey,e.mousePosition.x=t.clientX-i.left,e.mousePosition.y=t.clientY-i.top}function i(e){e.shiftKey=!1,e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY}var n=Autodesk.Viewing.Extensions.Markups.Core,o=Autodesk.Viewing.Extensions.Markups.Core.Utils,r=e.prototype;r.attachTo=function(e){this.editor&&this.detachFrom(this.editor),this.editor=e,o.isTouchDevice()&&(this.hammer=new Hammer.Manager(e.svg,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},r.detachFrom=function(e){this.hammer&&this.hammer.destroy(),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=e},r.enterEditMode=function(){this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded)),document.addEventListener("mousemove",this.onMouseMoveBinded,!0),document.addEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},r.leaveEditMode=function(){this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded)),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},r.enterViewMode=function(){},r.leaveViewMode=function(){},r.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},r.onWheel=function(e){e.preventDefault()},r.onMouseMove=function(e){t(this,e),this.editor.onMouseMove(e),e.preventDefault()},r.onMouseDown=function(e){t(this,e),this.isMouseDown=!0,this.editor.onMouseDown(e),e.preventDefault()},r.onMouseUp=function(e){t(this,e),this.isMouseDown=!1,this.editor.onMouseUp(e),e.preventDefault()},r.onMouseDoubleClick=function(e){t(this,e),this.editor.onMouseDoubleClick(e),e.preventDefault()},r.onTouchDrag=function(e){switch(i(e),e.type){case"dragstart":this.onMouseDown(e);break;case"dragmove":this.onMouseMove(e);break;case"dragend":this.onMouseUp(e)}e.preventDefault()},r.onSingleTap=function(e){i(e),this.onMouseDown(e),this.onMouseUp(e),e.preventDefault()},r.onDoubleTap=function(e){i(e),this.onMouseDoubleClick(e),e.preventDefault()},n.InputHandler=e}(),function(){"use strict";function e(e,t,n){this.editor=e,this.viewer=e.viewer,this.type=t,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=i.createStyle(n,this.editor),this.style=i.copyStyle(e.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,i.addTraitEventDispatcher(this)}var t=Autodesk.Viewing.Extensions.Markups.Core,i=Autodesk.Viewing.Extensions.Markups.Core.Utils;t.EVENT_EDITMODE_CREATION_BEGIN="EVENT_EDITMODE_CREATION_BEGIN",t.EVENT_EDITMODE_CREATION_END="EVENT_EDITMODE_CREATION_END",t.EVENT_MARKUP_DESELECT="EVENT_MARKUP_DESELECT";var n=e.prototype;n.destroy=function(){this.unselect(),i.removeTraitEventDispatcher(this)},n.unselect=function(){var e=!1,i=this.selectedMarkup;i&&(i.unselect(),this.selectedMarkup=null,e=!0),this.editor.editFrame.setMarkup(null),e&&this.fireEvent({type:t.EVENT_MARKUP_DESELECT})},n.creationBegin=function(){this.creating||(this.creating=!0,this.fireEvent({type:t.EVENT_EDITMODE_CREATION_BEGIN}))},n.creationEnd=function(){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?this.creationCancel():(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.unselect()))),this.creating=!1,this.fireEvent({type:t.EVENT_EDITMODE_CREATION_END}))},n.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(),this.selectedMarkup=null},n.setStyle=function(e){this.style=e;var i=this.selectedMarkup;i&&new t.SetStyle(this.editor,i,e).execute()},n.getStyle=function(){return this.style},n.setSelection=function(e){this.selectedMarkup!==e&&(this.unselect(),e&&e.select()),this.selectedMarkup=e;var t=this.editor;e&&t.bringToFront(e),this.creating||t.editFrame.setMarkup(e)},n.getSelection=function(){return this.selectedMarkup},n.deleteMarkup=function(e,t){return!1},n.isMinSizeValid=function(){if(0!==this.minSize){var e=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return e.x*e.x+e.y*e.y>=this.minSize*this.minSize}return!0},n.startDragging=function(){var e=this.selectedMarkup,t=this.editor.getMousePosition();e&&(this.dragging=!0,this.draggingAnnotationIniPosition=e.getClientPosition(),this.draggingMouseIniPosition.set(t.x,t.y))},n.finishDragging=function(){var e=this.dragging,t=this.selectedMarkup;this.dragging=!1,t&&e&&t.finishDragging()},n.getFinalMouseDraggingPosition=function(){var e=this.editor,t=e.getBounds(),n=e.getMousePosition(),o=this.initialX,r=this.initialY,s=Math.min(Math.max(t.x,n.x),t.x+t.width),a=Math.min(Math.max(t.y,n.y),t.y+t.height);if(s==o&&a==r&&(s++,a++),e.input.makeSameXY){var l=Math.abs(s-o),c=Math.abs(a-r),u=Math.max(l,c);s=o+u*i.sign(s-o),a=r+u*i.sign(a-r)}return{x:s,y:a}},n.notifyAllowNavigation=function(e){},n.onMouseMove=function(e){},n.onMouseDown=function(){},n.onMouseUp=function(e){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},n.onMouseDoubleClick=function(e){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},n.onSave=function(){this.creating&&this.creationCancel()},n.getDraggingPosition=function(){var e=this.editor.getMousePosition(),t=e.x-this.draggingMouseIniPosition.x,i=e.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+t,y:this.draggingAnnotationIniPosition.y+i}},n.isInsideBounds=function(e,t,i){return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height},t.EditMode=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_ARROW,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteArrow(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();if(this.initialX=i.x,this.initialY=i.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,e.snapper){var n=e.snapper.getHighlightGeometry();n!==SNAP_VERTEX&&n!==SNAP_EDGE||(this.lineSnapped=e.snapper.getEdge())}var o=3.5*this.style["stroke-width"],r=e.sizeFromMarkupsToClient(o,0).x,s={x:this.initialX,y:this.initialY},a={x:Math.round(s.x+Math.cos(.25*Math.PI)*r),y:Math.round(s.y+Math.sin(.25*-Math.PI)*r)};(function(e,t,i,n){this.isInsideBounds(t.x,t.y,n)||(t.y=Math.round(e.y+Math.sin(.25*Math.PI)*i),this.isInsideBounds(t.x,t.y,n)||(t.x=Math.round(e.x+Math.cos(.25*-Math.PI)*i),this.isInsideBounds(t.x,t.y,n)||(t.y=Math.round(e.y+Math.sin(.25*-Math.PI)*i))))}).bind(this)(s,a,r,e.getBounds()),e.beginActionGroup(),s=e.positionFromClientToMarkups(s.x,s.y),a=e.positionFromClientToMarkups(a.x,a.y);var l=new THREE.Vector2(a.x-s.x,a.y-s.y);l.lengthSq()<o*o&&(l=l.normalize().multiplyScalar(o),a.x=s.x+l.x,a.y=s.y+l.y);var c=e.getId();new t.CreateArrow(e,c,s,a,this.style).execute(),this.selectedMarkup=e.getMarkup(c),this.creationBegin()}},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.getFinalMouseDraggingPosition(),r=this.initialX,s=this.initialY;if(n.snapper&&!n.snapper.isSnapped()&&this.lineSnapped){var a=n.project(this.lineSnapped.vertices[0]),l=n.project(this.lineSnapped.vertices[1]),c=new THREE.Vector3(o.x,o.y,a.z),u=n.snapper.nearestPointInPointToLine(c,a,l),h=-(a.x-l.x)/(a.y-l.y),d=r+1,p=h*d+(s-h*r),g=new THREE.Vector3(d,p,a.z),m=new THREE.Vector3(r,s,a.z),v=n.snapper.nearestPointInPointToLine(c,m,g);u.distanceTo(c)<=20?(o.x=u.x,o.y=u.y):v.distanceTo(c)<=20&&(o.x=v.x,o.y=v.y)}var f=n.positionFromClientToMarkups(r,s),E=n.positionFromClientToMarkups(o.x,o.y),A=new THREE.Vector2(E.x-f.x,E.y-f.y),y=3.5*i.style["stroke-width"];A.lengthSq()<y*y&&(A=A.normalize().multiplyScalar(y),E.x=f.x+A.x,E.y=f.y+A.y),this.size=n.sizeFromClientToMarkups(o.x-r,o.y-s),new t.SetArrow(n,i,f,E).execute()}},t.EditModeArrow=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_CIRCLE,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteCircle(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.initialX,r=this.initialY,s=this.getFinalMouseDraggingPosition(),a=Math.abs(o-s.x),l=Math.abs(r-s.y),c=n.clientToMarkups(.5*(o+s.x),.5*(r+s.y)),u=this.size=n.sizeFromClientToMarkups(a,l);new t.SetCircle(n,i,c,u).execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId();new t.CreateCircle(e,r,n,o,0,this.style).execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeCircle=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_CLOUD,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteCloud(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=this.initialX,r=this.initialY,s=this.getFinalMouseDraggingPosition(),a=n.clientToMarkups((o+s.x)/2,(r+s.y)/2),l=this.size=n.sizeFromClientToMarkups(s.x-o,s.y-r);new t.SetCloud(n,i,a,l).execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId();new t.CreateCloud(e,r,n,o,0,this.style).execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeCloud=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_FREEHAND,i),this.style["stroke-opacity"]=.75}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteFreehand(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n=this.editor,o=n.getMousePosition(),r=this.movements,s=n.clientToMarkups(o.x,o.y);r.push(s);var a=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},l=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},c=a(r,"x"),u=a(r,"y"),h=l(r,"x")-c,d=l(r,"y")-u,p={x:c+.5*h,y:u+.5*d},g=this.size={x:h,y:d},m=r.map(function(e){return{x:e.x-p.x,y:e.y-p.y}});new t.SetFreehand(n,i,p,g,m).execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor;e.snapper&&e.snapper.clearSnapped();var i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY);this.movements=[n];var o=this.size=e.sizeFromClientToMarkups(1,1);e.beginActionGroup();var r=e.getId();new t.CreateFreehand(e,r,n,o,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=e.getMarkup(r),this.creationBegin()}},t.EditModeFreehand=e}(),function(){"use strict";function e(e){var t=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];i.EditMode.call(this,e,i.MARKUP_TYPE_POLYCLOUD,t),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function t(e,t){var i=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},n=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},o=t.style["stroke-width"],r=2*o+.5*o,s=i(e,"x")-r,a=i(e,"y")-r,l=n(e,"x")+r-s,c=n(e,"y")+r-a;t.size={x:l,y:c},t.position={x:s+.5*l,y:a+.5*c};var u=t.position;return e.map(function(e){return{x:e.x-u.x,y:e.y-u.y}})}var i=Autodesk.Viewing.Extensions.Markups.Core,n=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(i.EditMode.prototype),e.prototype.constructor=e;var o=e.prototype;o.deleteMarkup=function(e,t){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new i.DeletePolycloud(this.editor,e);return n.addToHistory=!t,n.execute(),!0}return!1},o.onMouseMove=function(e){i.EditMode.prototype.onMouseMove.call(this,e);var o=this.editor,r=this.selectedMarkup;if(r&&this.creating){this.dragging=!0;var s=this.movements;s.splice(s.length-1,1);var a=o.getMousePosition();a=o.clientToMarkups(a.x,a.y),s.length>=2&&n.areMarkupsPointsInClientRange(s[0],a,25,this.editor)&&(a=s[0]),s.push(a);var l=t(s,this);new i.SetPolycloud(o,r,this.position,this.size,l).execute()}},o.onMouseDown=function(){if(i.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var e=this.editor,t=e.getMousePosition();t=e.clientToMarkups(t.x,t.y);var n=this.size=e.sizeFromClientToMarkups(1,1);this.movements=[t,t],e.beginActionGroup();var o=e.getId();new i.CreatePolycloud(e,o,t,n,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=e.getMarkup(o),this.creationBegin()}},o.onMouseUp=function(e){if(i.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var o=this.editor,r=o.getMousePosition(),s=this.movements,a=!1;if(r=o.clientToMarkups(r.x,r.y),!(s.length>1&&n.areMarkupsPointsInClientRange(s[s.length-2],r,25,this.editor))){s.length>2&&n.areMarkupsPointsInClientRange(s[0],r,25,this.editor)&&(r=s[0],a=!0),s.splice(s.length-1,1),a||(s.push(r),s.push(r));var l=this.selectedMarkup,c=t(s,l);new i.SetPolycloud(o,l,l.position,l.size,c,a).execute(),a&&this.creationEnd()}}},o.onMouseDoubleClick=function(e){if(this.creating){var n=this.movements;if(n.splice(Math.max(0,n.length-1)),n.length<2)this.creationCancel();else{var o=this.selectedMarkup,r=t(n,o);new i.SetPolycloud(this.editor,o,o.position,o.size,r,!0).execute(),this.creationEnd()}}},o.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),i.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},o.creationCancel=function(){i.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},i.EditModePolycloud=e}(),function(){"use strict";function e(e){var t=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];i.EditMode.call(this,e,i.MARKUP_TYPE_POLYLINE,t),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function t(e,t){var i=function(e,t){var i=e.map(function(e){return e[t]});return Math.min.apply(null,i)},n=function(e,t){var i=e.map(function(e){return e[t]});return Math.max.apply(null,i)},o=i(e,"x"),r=i(e,"y"),s=n(e,"x")-o,a=n(e,"y")-r;t.size={x:s,y:a},t.position={x:o+.5*s,y:r+.5*a};var l=t.position;return e.map(function(e){return{x:e.x-l.x,y:e.y-l.y}})}var i=Autodesk.Viewing.Extensions.Markups.Core,n=Autodesk.Viewing.Extensions.Markups.Core.Utils;e.prototype=Object.create(i.EditMode.prototype),e.prototype.constructor=e;var o=e.prototype;o.deleteMarkup=function(e,t){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new i.DeletePolyline(this.editor,e);return n.addToHistory=!t,n.execute(),!0}return!1},o.onMouseMove=function(e){i.EditMode.prototype.onMouseMove.call(this,e);var o=this.editor,r=this.selectedMarkup;if(r&&this.creating){this.dragging=!0;var s=this.movements;s.splice(s.length-1,1);var a=o.getMousePosition();a=o.clientToMarkups(a.x,a.y),s.length>=2&&n.areMarkupsPointsInClientRange(s[0],a,25,this.editor)&&(a=s[0]),s.push(a);var l=t(s,this);new i.SetPolyline(o,r,this.position,this.size,l).execute()}},o.onMouseDown=function(e){if(i.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var t=this.editor,n=t.getMousePosition();n=t.clientToMarkups(n.x,n.y);var o=this.size=t.sizeFromClientToMarkups(1,1);this.movements=[n,n],t.beginActionGroup();var r=t.getId();new i.CreatePolyline(t,r,n,o,0,[{x:0,y:0}],this.style).execute(),this.selectedMarkup=t.getMarkup(r),this.creationBegin()}},o.onMouseUp=function(){if(i.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var e=this.editor,o=e.getMousePosition(),r=this.movements,s=!1;if(o=e.clientToMarkups(o.x,o.y),!(r.length>1&&n.areMarkupsPointsInClientRange(r[r.length-2],o,25,this.editor))){r.length>2&&n.areMarkupsPointsInClientRange(r[0],o,25,this.editor)&&(o=r[0],s=!0),r.splice(r.length-1,1),s||(r.push(o),r.push(o));var a=this.selectedMarkup,l=t(r,a);new i.SetPolyline(e,a,a.position,a.size,l,s).execute(),s&&this.creationEnd()}}},o.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),i.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},o.creationCancel=function(){i.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},o.onMouseDoubleClick=function(e){if(this.creating){var n=this.movements;if(n.splice(Math.max(0,n.length-1)),n.length<2)this.creationCancel();else{var o=this.selectedMarkup,r=t(n,o);new i.SetPolyline(this.editor,o,o.position,o.size,r,this.closed).execute(),this.creationEnd()}}},i.EditModePolyline=e}(),function(){"use strict";function e(e){var i=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];t.EditMode.call(this,e,t.MARKUP_TYPE_RECTANGLE,i)}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteRectangle(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.setStyle=function(e){t.EditMode.prototype.setStyle.call(this,e);var i=this.selectedMarkup;i&&new t.SetRectangle(this.editor,i,i.position,i.size).execute()},i.onMouseMove=function(e){t.EditMode.prototype.onMouseMove.call(this,e);var i=this.selectedMarkup;if(i&&this.creating){var n,o,r=this.editor,s=this.initialX,a=this.initialY,l=this.getFinalMouseDraggingPosition(),c=r.clientToMarkups((s+l.x)/2,(a+l.y)/2);if(r.snapper&&this.lineSnapped){var u=r.project(this.lineSnapped.vertices[0]),h=r.project(this.lineSnapped.vertices[1]),d=new THREE.Vector3(l.x,l.y,u.z),p=r.snapper.nearestPointInPointToLine(d,u,h);o=d.distanceTo(p);var g=-(u.x-h.x)/(u.y-h.y),m=s+1,v=g*m+(a-g*s),f=new THREE.Vector3(m,v,u.z),E=new THREE.Vector3(s,a,u.z),A=r.snapper.nearestPointInPointToLine(d,E,f);n=d.distanceTo(A)}else n=l.x-s,o=l.y-a;var y=this.size=r.sizeFromClientToMarkups(n,o);new t.SetRectangle(r,i,c,y).execute()}},i.onMouseDown=function(){if(t.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var e=this.editor,i=e.getMousePosition();this.initialX=i.x,this.initialY=i.y;var n=e.clientToMarkups(this.initialX,this.initialY),o=this.size=e.sizeFromClientToMarkups(1,1),r=0;if(this.lineSnapped=null,e.snapper&&e.snapper.getHighlightGeometry()===SNAP_EDGE){this.lineSnapped=e.snapper.getEdge();var s=e.project(this.lineSnapped.vertices[0]),a=e.project(this.lineSnapped.vertices[1]),l=a.x-s.x,c=a.y-s.y,u=l&&c?c/l:0;r=this.rotation=Math.atan(u)}e.beginActionGroup();var h=e.getId();new t.CreateRectangle(e,h,n,o,r,this.style).execute(),this.selectedMarkup=e.getMarkup(h),this.creationBegin()}},t.EditModeRectangle=e}(),function(){"use strict";function e(e){var i=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];t.EditMode.call(this,e,t.MARKUP_TYPE_TEXT,i);var n=new t.EditorTextInput(this.viewer.container,this.editor);n.addEventListener(n.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.textInputHelper=n,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var t=Autodesk.Viewing.Extensions.Markups.Core;e.prototype=Object.create(t.EditMode.prototype),e.prototype.constructor=e;var i=e.prototype;i.deleteMarkup=function(e,i){if((e=e||this.selectedMarkup)&&e.type==this.type){var n=new t.DeleteText(this.editor,e);return n.addToHistory=!i,n.execute(),!0}return!1},i.setStyle=function(e){this.textInputHelper&&this.textInputHelper.isActive()?this.textInputHelper.setStyle(e):t.EditMode.prototype.setStyle.call(this,e)},i.notifyAllowNavigation=function(e){e&&this.textInputHelper&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},i.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),t.EditMode.prototype.destroy.call(this)},i.onMouseDown=function(){if(this.textInputHelper&&this.textInputHelper.isActive())this.textInputHelper.acceptAndExit();else if(!this.selectedMarkup){var e=this.editor,i=e.getMousePosition(),n=e.sizeFromMarkupsToClient(0,this.style["font-size"]).y,o=15*n,r=3*n,s=this.size=e.sizeFromClientToMarkups(o,r),a=e.positionFromClientToMarkups(i.x+.5*o,i.y+.5*r);this.creationBegin(),e.beginActionGroup();var l=new t.CreateText(e,e.getId(),a,s,"",this.style);l.execute(),this.creationEnd(),this.selectedMarkup=e.getMarkup(l.targetId),this.textInputHelper&&this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},i.onMouseUp=function(e){},i.onMouseDoubleClick=function(e){e===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper&&this.textInputHelper.setActive(e,!1))},i.onHelperTextChange=function(e){var i=e.data,n=i.markup,o=i.style;if(this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===i.newText)return i.firstEdit?(this.editor.cancelActionGroup(),void this.editor.selectMarkup(null)):(new t.DeleteText(this.editor,n).execute(),void this.editor.selectMarkup(null));i.firstEdit||this.editor.beginActionGroup();var r=this.editor.positionFromClientToMarkups(i.newPos.x,i.newPos.y),s=this.editor.sizeFromClientToMarkups(i.width,i.height);new t.SetSize(this.editor,n,r,s.x,s.y).execute(),new t.SetText(this.editor,n,n.position,n.size,i.newText).execute(),new t.SetStyle(this.editor,n,o).execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},i.onHistoryChange=function(e){this.textInputHelper&&this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},i.onSave=function(){if(t.EditMode.prototype.onSave.call(this),this.textInputHelper&&this.textInputHelper.isActive()){var e=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(t.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),e&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},t.EditModeText=e}(),function(){"use strict";function e(e,t){this.parentDiv=e,this.editor=t,this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.textArea=document.createElement("textarea"),this.textArea.setAttribute("maxlength","260"),this.textArea.setAttribute("data-i18n",r),this.onKeyHandlerBinded=this.onKeyHandler.bind(this),this.textArea.addEventListener("keydown",this.onKeyHandlerBinded),this.styleTextArea=new o.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("overflow-y","hidden"),this.measureDiv=document.createElement("div"),o.addTraitEventDispatcher(this),this.onResizeBinded=this.onWindowResize.bind(this)}function t(e){if(0===e.length)return"";for(var t=e.length-1,i=t;i>=0;--i)if(" "!==e.charAt(i)){t=i;break}return e.substr(0,t+1)}function i(e){if(0===e.length)return"";for(var t=0,i=0;i<e.length;++i)if(" "!==e.charAt(i)){t=i;break}return e.substr(t)}var n=Autodesk.Viewing.Extensions.Markups.Core,o=Autodesk.Viewing.Extensions.Markups.Core.Utils,r="Write Something",s=e.prototype;s.destroy=function(){this.textArea.removeEventListener("keydown",this.onKeyHandlerBinded),this.setInactive()},s.setActive=function(e,t){if(this.textMarkup!==e){var i=Autodesk.Viewing.i18n.translate(r);if(this.textArea.setAttribute("placeholder",i),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=e,this.firstEdit=t||!1,this.initFromMarkup(),window.addEventListener("resize",this.onResizeBinded),!Autodesk.Viewing.isIOSDevice()){var n=this.textArea;window.requestAnimationFrame(function(){n.focus()})}}},s.setInactive=function(){Autodesk.Viewing.isIOSDevice()&&this.textArea.blur(),window.removeEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null},s.isActive=function(){return!!this.textMarkup},s.initFromMarkup=function(){var e=this.textMarkup,t=e.getClientPosition(),i=e.getClientSize(),n=t.x-.5*i.x,o=t.y-.5*i.y,r=e.lineHeight+"%";this.styleTextArea.setAttribute("line-height",r),this.setPosAndSize(n,o,i.x,i.y),this.setStyle(e.getStyle()),this.textArea.value=e.getText()},s.setPosAndSize=function(e,t,i,n){e+i>=this.editor.viewer.container.clientWidth&&(e=this.editor.viewer.container.clientWidth-(i+10)),t+n>=this.editor.viewer.container.clientHeight&&(t=this.editor.viewer.container.clientHeight-(n+10)),e<5&&(e=5,i=this.editor.viewer.container.clientWidth-10),this.styleTextArea.setAttribute("left",e+"px").setAttribute("top",t+"px").setAttribute("width",i+"px").setAttribute("height",n+"px")},s.setStyle=function(e){if(this.style){var t={};this.injectSizeValues(t),this.setPosAndSize(t.newPos.x-.5*t.width,t.newPos.y-.5*t.height,t.width,t.height)}var i=this.editor.sizeFromMarkupsToClient(0,e["font-size"]).y,n=this.styleTextArea.setAttribute("color",e["stroke-color"]).setAttribute("font-family",e["font-family"]).setAttribute("font-size",i+"px").setAttribute("font-weight",e["font-weight"]).setAttribute("font-style",e["font-style"]).getStyleString();this.textArea.setAttribute("style",n),this.style=o.cloneStyle(e)},s.getTextValuesForMarkup=function(e){var t=this.isActive(),i=this.textMarkup,n=this.firstEdit;this.setActive(e,!1);var o=this.getTextValues();return t?this.setActive(i,n):this.setInactive(),o},s.getTextValues=function(){var e=this.textArea.value;return e===r&&(e=""),{text:e,lines:this.generateLines()}},s.acceptAndExit=function(){var e=this.getTextValues(),t={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:e.text,newLines:e.lines};this.injectSizeValues(t),this.fireEvent({type:this.EVENT_TEXT_CHANGE,data:t}),this.setInactive()},s.injectSizeValues=function(e){var t=parseFloat(this.textArea.style.width),i=parseFloat(this.textArea.style.height),n=parseFloat(this.textArea.style.left),o=parseFloat(this.textArea.style.top);e.width=t,e.height=i,e.newPos={x:n+.5*t,y:o+.5*i}},s.onWindowResize=function(e){window.requestAnimationFrame(function(){var e=this.textArea.value;this.style=null,this.initFromMarkup(),this.textArea.value=e}.bind(this))},s.onKeyHandler=function(e){var t=e.keyCode;e.shiftKey||13!==t||(e.preventDefault(),this.acceptAndExit())},s.generateLines=function(){var e=this.textArea.value.split(/\r*\n/),i=this.styleTextArea.clone().removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",i),this.parentDiv.appendChild(this.measureDiv);for(var n=parseFloat(this.textArea.style.width),o=[],r=0,s=e.length;r<s;++r){var a=t(e[r]);this.splitLine(a,n,o)}return this.parentDiv.removeChild(this.measureDiv),o},s.splitLine=function(e,t,n){if(""!==e)for(var o="",r=!1;!r;)if(this.measureDiv.innerHTML=e,this.measureDiv.clientWidth<=t)n.push(e),this.splitLine(i(o),t,n),r=!0;else{var s=this.getShorterLine(e);1===s.length?(this.splitWord(e,o,t,n),r=!0):(e=s[0],o=s[1]+o)}},s.getShorterLine=function(e){var t=e.lastIndexOf(" ");if(-1===t)return[e];for(;" "===e.charAt(t-1);)t--;var i=e.substr(t);return[e.substr(0,t),i]},s.splitWord=function(e,t,i,n){for(var o=1;;){var r=e.substr(0,o);if(this.measureDiv.innerHTML=r,this.measureDiv.clientWidth>i){if(1===o)return n.push(r),void this.splitWord(e.substr(1),t,i,n);var s=e.substr(0,o-1);n.push(s);var a=e.substr(o-1);return void this.splitLine(a+t,i,n)}if(++o>e.length)return void n.push(e)}},n.EditorTextInput=e}(),function(){"use strict";function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.domEvents=[]}var t="Autodesk.Viewing.MarkupsCore",i=AutodeskNamespace("Autodesk.Markups.Gui"),n=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),o=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils");e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e;var r=e.prototype,s=Autodesk.Viewing,a=s.Private;r.load=function(){var e=this.viewer.getExtension(t);return e||(this.viewer.loadExtension(t),e=this.viewer.getExtension(t)),e?(this.core=e,this.viewer.toolbar?this.createToolbarUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),this.onEditModeEnterBinded=this.onEditModeEnter.bind(this),this.onEditModeLeaveBinded=this.onEditModeLeave.bind(this),this.onEditModeChangeBinded=this.onEditModeChange.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.core.addEventListener(n.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.addEventListener(n.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.addEventListener(n.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.addEventListener(n.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),!0):(a.logger.warn("Missing dependency:",t),!1)},r.unload=function(){return this.unhookAllEvents(),this.core.removeEventListener(n.EVENT_EDITMODE_ENTER,this.onEditModeEnterBinded),this.core.removeEventListener(n.EVENT_EDITMODE_LEAVE,this.onEditModeLeaveBinded),this.core.removeEventListener(n.EVENT_EDITMODE_CHANGED,this.onEditModeChangeBinded),this.core.removeEventListener(n.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),this.onEditModeEnterBinded=null,this.onEditModeLeaveBinded=null,this.onEditModeChangeBinded=null,this.onMarkupSelectedBinded=null,this.destroyToolbarUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),this.core=null,!0},r.onToolbarCreated=function(){this.viewer.removeEventListener(s.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createToolbarUI()},r.createToolbarUI=function(){var e=this,t=this.viewer.getToolbar(!0);this.markupToolButton=new Autodesk.Viewing.UI.Button("toolbar-markupTool"),this.markupToolButton.setToolTip("Markup"),this.markupToolButton.setIcon("adsk-icon-markup"),this.markupToolButton.onClick=function(){e.core.enterEditMode()};var i=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);i&&i.addControl(this.markupToolButton,{index:0})},r.destroyToolbarUI=function(){if(this.markupToolButton){var e=this.viewer.getToolbar(!1);if(e){var t=e.getControl(s.TOOLBAR.MODELTOOLSID);t&&t.removeControl(this.markupToolButton)}this.markupToolButton=null}},r.onEditModeEnter=function(){a.logger.log("ENTER edit mode"),this.showToolsUi()},r.onEditModeLeave=function(){a.logger.log("LEAVE edit mode"),this.hideToolsUi()},r.onEditModeChange=function(e){if(this.domToolSelect&&!this.ignoreChangeEvent)for(var t=this.core.editMode,i=this.domToolSelect.options,n=0,o=i.length;n<o;n++)if(i[n].value===t.type){this.domToolSelect.selectedIndex=n;break}},r.onMarkupSelected=function(e){var t=e.markup,i=this.core.editMode;this.setStylesUi(i,t)},r.showToolsUi=function(){this.createToolsUi();var e=this.core.isNavigationAllowed();this.setControlVisibility(".lmv-markup-gui-enterNavMode",e,"inline-block"),this.exitNavigationMode(),this.domContent.style.display="block",this.viewer.container.appendChild(this.domRoot)},r.hideToolsUi=function(){this.domRoot&&this.domRoot.parentNode&&this.domRoot.parentNode.removeChild(this.domRoot)},r.createToolsUi=function(){function e(e,t){return['<option value="',t,'">',e,"</option>"].join("")}if(!this.domRoot){var t=['<div class="lmv-markup-gui-toolbar-content">','<button class="lmv-markup-gui-collapse-btn">&lt;-&gt;</button>','<button class="lmv-markup-editmode-done">Exit</button>','<div class="lmv-markup-gui-collapse-content">','<div class="lmv-markup-gui-editMode">','<button class="lmv-markup-gui-enterNavMode">Navigate</button>','<button class="lmv-markup-gui-undo">&#8617;</button>','<button class="lmv-markup-gui-redo">&#8618;</button>',"<br>",'<button class="lmv-markup-gui-delete">Delete</button>','<button class="lmv-markup-gui-duplicate">Duplicate</button>',"<br>",'<button class="lmv-markup-gui-cut">Cut</button>','<button class="lmv-markup-gui-copy">Copy</button>','<button class="lmv-markup-gui-paste">Paste</button>',"<br>","<span>Markup:</span>",'<select class="lmv-markup-tool-select">',e("Arrow",n.MARKUP_TYPE_ARROW),e("Rectangle",n.MARKUP_TYPE_RECTANGLE),e("Circle",n.MARKUP_TYPE_CIRCLE),e("Text",n.MARKUP_TYPE_TEXT),e("Cloud",n.MARKUP_TYPE_CLOUD),e("PolyLine",n.MARKUP_TYPE_POLYLINE),e("Polycloud",n.MARKUP_TYPE_POLYCLOUD),e("Freehand",n.MARKUP_TYPE_FREEHAND),"</select>","<br>",'<div class="lmv-markup-gui-style-options"></div>',"</div>",'<div class="lmv-markup-gui-navMode" style="display:none;">','<button class="lmv-markup-gui-exitNavMode">Back to Markup</button>',"</div>","</div>","</div>"].join("");this.domRoot=document.createElement("div"),this.domRoot.className="lmv-markup-gui-toolbar",this.domRoot.innerHTML=t,this.domContent=this.domRoot.querySelector(".lmv-markup-gui-collapse-content"),this.domToolSelect=this.domRoot.querySelector(".lmv-markup-tool-select"),this.domStylesRoot=this.domRoot.querySelector(".lmv-markup-gui-style-options"),this.hookEvent("click",".lmv-markup-gui-collapse-btn",this.onToggleCollapse.bind(this)),this.hookEvent("click",".lmv-markup-editmode-done",this.onEditModeDone.bind(this)),this.hookEvent("click",".lmv-markup-gui-enterNavMode",this.enterNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-exitNavMode",this.exitNavigationMode.bind(this)),this.hookEvent("click",".lmv-markup-gui-undo",this.onUndoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-redo",this.onRedoClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-delete",this.onDeleteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-cut",this.onCutClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-copy",this.onCopyClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-paste",this.onPasteClick.bind(this)),this.hookEvent("click",".lmv-markup-gui-duplicate",this.onDuplicateClick.bind(this)),this.hookEvent("change",".lmv-markup-tool-select",this.onSelectEditMode.bind(this)),this.hookEvent("change",".lmv-markup-gui-style-select",this.onStyleChange.bind(this)),this.setStylesUi(this.core.editMode)}},r.getEditModeClass=function(e){var t;switch(e){case n.MARKUP_TYPE_ARROW:t="EditModeArrow";break;case n.MARKUP_TYPE_RECTANGLE:t="EditModeRectangle";break;case n.MARKUP_TYPE_CIRCLE:t="EditModeCircle";break;case n.MARKUP_TYPE_TEXT:t="EditModeText";break;case n.MARKUP_TYPE_CLOUD:t="EditModeCloud";break;case n.MARKUP_TYPE_POLYLINE:t="EditModePolyline";break;case n.MARKUP_TYPE_POLYCLOUD:t="EditModePolycloud";break;case n.MARKUP_TYPE_FREEHAND:t="EditModeFreehand"}return t?new(0,n[t])(this.core):null},r.onToggleCollapse=function(){var e=this.domContent.style.display;this.domContent.style.display="none"===e?"block":"none"},r.onEditModeDone=function(){this.core.hide()},r.enterNavigationMode=function(){this.core.allowNavigation(!0),this.setControlVisibility(".lmv-markup-gui-editMode",!1),this.setControlVisibility(".lmv-markup-gui-navMode",!0)},r.exitNavigationMode=function(){this.core.allowNavigation(!1),this.setControlVisibility(".lmv-markup-gui-editMode",!0),this.setControlVisibility(".lmv-markup-gui-navMode",!1)},r.onUndoClick=function(){this.core.undo()},r.onRedoClick=function(){this.core.redo()},r.onDeleteClick=function(){var e=this.core.getSelection();e&&this.core.deleteMarkup(e)},r.onCutClick=function(){this.core.cut()},r.onCopyClick=function(){this.core.copy()},r.onPasteClick=function(){this.core.paste()},r.onDuplicateClick=function(){this.core.getSelection()&&(this.core.copy(),this.core.paste())},r.onSelectEditMode=function(e){var t=e.target.value,i=this.getEditModeClass(t);i?(this.ignoreChangeEvent=!0,this.core.changeEditMode(i),this.ignoreChangeEvent=!1,this.setStylesUi(i),this.domToolSelect.blur()):a.error("Markup editMode not found for type: "+t)},r.onStyleChange=function(e){var t=e.target,i=t.options[t.selectedIndex],n=t.getAttribute("style-key"),o=t.getAttribute("value-type");t.blur();var r=this.core.getSelection(),s=r?r.getStyle():this.core.getStyle();s[n]=function(e,t){return"number"===t?Number(e):"boolean"===t?"true"===e:e}(i.value,o),this.core.setStyle(s)},r.setStylesUi=function(e,t){a.logger.log("set ui for "+e.type);var i=t?t.style:e.style,n=o.getStyleDefaultValues(i,this.core);this.domStylesRoot.innerHTML="";for(var r in n){var s=this.getUiForStyleKey(r,n[r],i[r]);this.domStylesRoot.appendChild(s)}},r.getUiForStyleKey=function(e,t,i){for(var n=t.default,o=[],r=t.values,s=0,a=r.length;s<a;++s){var l=['<option value="',r[s].value,'">',r[s].name,"</option>"].join("");o.push(l),this.valueEquals(r[s].value,i)&&(n=s)}var c=typeof r[0].value,u=document.createElement("div"),h=["<span>",e,"</span>",'<select class="lmv-markup-gui-style-select" style-key="',e,'" value-type="',c,'">',o.join(""),"</select>"].join("");return u.innerHTML=h,u.querySelector("select").selectedIndex=n,u},r.valueEquals=function(e,t){return e===t},r.setControlVisibility=function(e,t,i){var n=this.domRoot.querySelector(e);i||(i="block"),n.style.display=t?i:"none"},r.hookEvent=function(e,t,i){var n=function(e){this.matchesSelector(e.target,t)&&i(e)}.bind(this);this.domRoot.addEventListener(e,n),this.domEvents.push({str:e,handler:n})},r.unhookAllEvents=function(){var e=this.domRoot;this.domEvents.forEach(function(t){e.removeEventListener(t.str,t.handler)}),this.domEvents=[]},r.matchesSelector=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)},r.getStyleOptions=function(e){var t=e.getStyle();return i.getStyleDefaultValues(t,this.core)},i.MarkupsGui=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsGui",e)}(),function(){"use strict";var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"),i=function(t,i){e.Extension.call(this,t,i)};(i.prototype=Object.create(e.Extension.prototype)).constructor=i,i.prototype.load=function(){var i=this;this.tool=new t.BillboardTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.onExplodeBinded=this.onExplode.bind(this),this.onSectionBinded=this.onSection.bind(this),this.viewer.addEventListener(e.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.addEventListener(e.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.addEventListener(e.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.addEventListener(e.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.HOTKEYS_ID="Autodesk.Billboard.Hotkeys";var n=[{keycodes:[e.theHotkeyManager.KEYCODES.ENTER],onRelease:function(){if(i.tool)return i.tool.enterEditAnnotation()}}];return e.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,n),!0},i.prototype.unload=function(){return e.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.viewer.removeEventListener(e.CAMERA_CHANGE_EVENT,this.tool.onCameraChange),this.viewer.removeEventListener(e.VIEWER_RESIZE_EVENT,this.tool.handleResize),this.viewer.removeEventListener(e.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),this.viewer.removeEventListener(e.CUTPLANES_CHANGE_EVENT,this.onSectionBinded),this.clearAnnotations(),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},i.prototype.isActive=function(){return this.tool.isActive()},i.prototype.enterEditMode=function(){return this.tool.isActive()||this.viewer.toolController.activateTool("billboard"),!0},i.prototype.leaveEditMode=function(){return this.tool.isActive()&&this.viewer.toolController.deactivateTool("billboard"),!0},i.prototype.generateData=function(){return this.tool.generateData()},i.prototype.loadData=function(e){this.tool.loadData(e)},i.prototype.showAnnotations=function(){this.tool&&this.tool.showAnnotations()},i.prototype.hideAnnotations=function(){this.tool&&this.tool.hideAnnotations()},i.prototype.clearAnnotations=function(){this.tool&&this.tool.clearAnnotations()},i.prototype.showNumberMarkers=function(){this.tool&&this.tool.showNumMarkers()},i.prototype.hideNumberMarkers=function(){this.tool&&this.tool.hideNumMarkers()},i.prototype.onExplode=function(e){1*e.scale==0?this.showNumberMarkers():(this.hideAnnotations(),this.hideNumberMarkers())},i.prototype.onSection=function(e){Array.isArray(e.planes)&&e.planes.length>0?(this.hideAnnotations(),this.hideNumberMarkers()):this.showNumberMarkers()},t.BillboardExtension=i,e.theExtensionManager.registerExtension("Autodesk.Billboard",i)}(),function(){"use strict";var e=Autodesk.Viewing,t=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.Viewing.Extensions.Billboard"));e.ANNOTATION_CREATED_EVENT="annotationCreated",e.ANNOTATION_DELETED_EVENT="annotationDeleted";var i=function(t){e.ToolInterface.call(this),this.names=["billboard"];var i=this,n=!1,o=!1,r=!1,s=1,a=null,l=null,c=null,u=null,h=null;this.annotations=[],this.numMarkers=[],this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0},this.isActive=function(){return n},this.getCursor=function(){return"url(data:;base64,AAABAAEAGBgAAAEAIACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAAAkAABMLAAATCwAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJAAAAtAAAAEkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMSEhL/sbGx/wAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEwgICP99fX3//////wAAAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAdCAgI/3p6ev///////////wAAAP8AAADWAAAAqAAAAHwAAABJAAAAEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQEBAT/AAAABAAAABMSEhL/hISE/////////////////+Li4v/W1tb/qKio/319ff9KSkr/EhIS/wAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP9kZGT/AAAAdAAAABMSEhL/sbGx//////////////////r6+v//////////////////////x8fH/3R0dP8dHR3/AAAARAAAAAAAAAAAAAAAAAAAADUzMzP/ra2t///////i4uL/VlZW/wQEBP8AAAD/MzMz/7m5uf///////////4qKiv9kZGT/hISE/7W1tf/t7e3///////////+tra3/MzMz/wAAADUAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/MzMz/wAAADEAAAAAAAAAUCkpKf+5ubn//////wAAAP8AAABmAAAAgwAAALQ4ODj/ioqK/+Li4v//////nZ2d/wAAAJwAAAAAAAAAAAAAAOzv7+///////2RkZP8AAACMAAAANQAAAAAAAAAJAAAAAAAAAFApKSn/ubm5/wAAALQAAAAAAAAAAAAAAAAAAAA1AAAAjGRkZP//////7+/v/wAAAOwAAAAAAAAAAAAAAJydnZ3//////+Li4v+Kior/ODg4/wAAAP8ICAj/AAAAVwAAADUAAABQCwsL/////wD////U////1P///9T////U////AAcHB///////nZ2d/wAAAJwAAAAAAAAAAAAAADUzMzP/ra2t////////////7e3t/7W1tf+EhIT/VlZW/zMzM/8XFxf/FxcX/wAAAAAAAAD/AAAA/wAAAP8AAAD/AAAAADU1Nf+Ojo7/MzMz/wAAADUAAAAAAAAAAAAAAAAAAABEHR0d/3R0dP/Hx8f/////////////////////////////////ZWVl/wAAAAT////UAAAA/wAAAP/////UAAAAAHFxcf8dHR3/AAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHQAAAHQSEhL/SkpK/319ff+oqKj/zMzM/+jo6P/6+vr/QEBA/wAAAAb////UAAAA/wAAAP/////UAAAAAAAAAHQAAAAdAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAASQAAAHwAAACoAAAAzAAAAOwAAAD5AAAA+wAAAAL////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAAAAAAAAD////UAAAA/wAAAP/////UAAAAAAAAAAD///8AAAAAAAAAAAAAAACMAAAA9gAAAIwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////UAAAA/wAAAP/////U////1P///9T////UAAAAAAAAAAAAAAD29vb2/0hISP8AAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/3R0dOr////UAAAA/wAAAP/////UdHR06gAAAP/////UAAAAAAAAAAAAAAD///////r6+v9OTk7/AAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////UAAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP/////UAAAAAAAAAAAAAAD////////////6+vr/Tk5O/wAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD////U////1P///9T////U////1P///9T////U////1P///9T////UAAAAAAAAAAAAAAD/////////////////+vr6/wAAAPkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACcAAAA/wAAAP8AAAD/AAAA+QAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD/8f8A/+H/AP/B/wD9gA8A8AADAOAAAQDAAAAAwEAAAMChwADAAhAAwAIQAOAAEQDwABMA/AAfAP/+HwAf8AMAD/ADAAfwAwAD8AMAA///AAP//wA=), auto"},this.activate=function(){n=!0,t.clearSelection(),this.showAnnotations()},this.deactivate=function(){n=!1,this.billboard&&(this.billboard.annotationEditing?(this.billboard.dragging=!1,this.billboard.textArea.value?this.billboard.acceptButton.click():this.billboard.cancelButton.click()):this.destroyBillboard()),this.hideAnnotations()},this.onCameraChange=function(){i.updateBillboard(),i.updateAnnotations(),i.highlightAnnotation()},this.project=function(e){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),o=(new THREE.Vector3).copy(e);return o.project(i),new THREE.Vector3(Math.round((o.x+1)/2*n.width),Math.round((1-o.y)/2*n.height),o.z)},this.unproject=function(e){var i=t.navigation.getCamera(),n=t.navigation.getScreenViewport(),o=new THREE.Vector3;return o.x=e.x/n.width*2-1,o.y=-(e.y/n.height*2-1),o.z=e.z,o.unproject(i),o},this.createBillboard=function(n,o){if(!r){r=!0,this.billboard=document.createElement("div"),this.billboard.className="billboard-container",t.container.appendChild(this.billboard);var s=new THREE.Vector3(0,0,0),a=s.x-n.x,l=s.y-n.y;this.billboard.deltaX=o?o.deltaX:a,this.billboard.deltaY=o?o.deltaY:l,this.setBillboardPosition(n,o),this.moveHandler(this.billboard),this.billboard.intersectPoint=n,this.billboard.show=!0,o&&(this.billboard.annotationEditing=!0);var c=this.billboard.textArea=document.createElement("TEXTAREA");c.className="billboard-textarea",this.billboard.appendChild(c),c.setAttribute("rows","4"),c.setAttribute("maxlength","140"),c.focus(),o&&(c.value=o.childNodes[0].innerHTML);var u=document.createElement("div");u.className="billboard-control",this.billboard.appendChild(u);var h=this.billboard.acceptButton=document.createElement("div");h.className="billboard-button-accept",h.setAttribute("data-i18n","Accept"),h.textContent=e.i18n.translate("Accept"),h.addEventListener("click",function(){if(!i.billboard.dragging&&i.billboard.childNodes[0].value){var e=i.billboard.childNodes[0].value,t=i.billboard.deltaX,r=i.billboard.deltaY;o?i.createAnnotation(n,e,t,r,o.id):i.createAnnotation(n,e,t,r),i.destroyBillboard()}},!1),u.appendChild(h),o||h.classList.add("billboard-button-accept-greyout"),c.addEventListener("input",function(){c.value?h.classList.remove("billboard-button-accept-greyout"):h.classList.add("billboard-button-accept-greyout")});var d=this.billboard.cancelButton=document.createElement("div");d.className="billboard-button-cancel";var p;p=o?"Delete":"Cancel",d.setAttribute("data-i18n",p),d.textContent=e.i18n.translate(p),d.addEventListener("click",function(){i.billboard.dragging||(i.destroyBillboard(),o&&(i.destroyNumMarker(o.id),t.fireEvent({type:e.ANNOTATION_DELETED_EVENT,data:o.commObj})))},!1),u.appendChild(d),this.drawLeadLine(n,this.billboard),this.drawLeadPoint(n,this.billboard),t.utilities.setPivotPoint(n,!0,!0)}},this.destroyBillboard=function(){r=!1,t.impl.removeMultipleOverlays("billboard-line",this.billboard.line),t.impl.removeMultipleOverlays("billboard-point",this.billboard.point),t.container.removeChild(this.billboard),this.billboard=null},this.setBillboardPosition=function(e,t){var i;t?i=(new THREE.Vector3).copy(t.position):((i=(new THREE.Vector3).copy(e)).x+=this.billboard.deltaX,i.y+=this.billboard.deltaY),this.billboard.position=i;var n=this.project(i);this.borderCheck(this.billboard,n),this.billboard.style.left=n.x+"px",this.billboard.style.top=n.y+"px"},this.updateBillboardPosition=function(){var e=this.project(this.billboard.position);this.borderCheck(this.billboard,e),this.billboard.style.left=e.x+"px",this.billboard.style.top=e.y+"px"},this.borderCheck=function(e,i){var n=t.navigation.getScreenViewport(),o=e.clientWidth,r=e.clientHeight;i.x<5&&(i.x=0),i.y<5&&(i.y=0),n.width-5<i.x+o&&(i.x=n.width-o),n.height-5<i.y+r&&(i.y=n.height-r)},this.createAnnotation=function(n,o,r,a,l){function c(){function e(){u.dragging?i.highlightAnnotation():u.classList.contains("billboard-annotation-highlight")?i.editAnnotation(n,u):i.highlightAnnotation(u)}var t,o=0;return function(){1==++o?t=setTimeout(function(){e(),o=0},250):(clearTimeout(t),o=0)}}var u=document.createElement("div");u.className="billboard-annotation",t.container.appendChild(u);var h=new THREE.Vector3(0,0,0);r=r||h.x-n.x,a=a||h.y-n.y,u.deltaX=r,u.deltaY=a,this.setAnnotationPosition(u,n),this.moveHandler(u),u.intersectPoint=n,u.show=!0,l?(u.id=l,this.annotations[l-1]=u):(u.id=s++,this.annotations.push(u),this.createNumMarker(u));var d=document.createElement("div");d.innerHTML=o,u.appendChild(d),this.drawLeadLine(n,u);var p={message:o,point3d:n},g=t.getExtension("Autodesk.Comments");(u.cPromise=g.createComment(p)).then(function(o){function r(){u.classList.contains("billboard-annotation-highlight")?i.editAnnotation(n,u):g.restoreComment(o,i.filter,!1)}u.commObj=o,u.addEventListener("click",c(),!1),u.addEventListener("dblclick",r,!1),e.isTouchDevice()&&Hammer(u).on("doubletap",r),t.fireEvent({type:e.ANNOTATION_CREATED_EVENT,data:o})},function(e){console.log("Create comments failed:"+e)})},this.destroyAnnotation=function(e){t.impl.removeMultipleOverlays("billboard-line",e.line),t.container.removeChild(e),this.annotations[e.id-1]=void 0},this.editAnnotation=function(e,t){r||(this.destroyAnnotation(t),this.createBillboard(e,t))},this.highlightAnnotation=function(e){for(var t=document.getElementsByClassName("billboard-annotation-highlight"),i=0;i<t.length;i++)t[i].classList.remove("billboard-annotation-highlight");e&&e.classList.add("billboard-annotation-highlight")},this.enterEditAnnotation=function(){for(var e=0;e<this.annotations.length;e++){var t=this.annotations[e];if(t&&t.classList.contains("billboard-annotation-highlight")){this.editAnnotation(t.intersectPoint,t);break}}},this.setAnnotationPosition=function(e,t){var i;r?i=(new THREE.Vector3).copy(this.billboard.position):((i=(new THREE.Vector3).copy(t)).x+=e.deltaX,i.y+=e.deltaY),e.position=i;var n=this.project(i);e.style.left=n.x+"px",e.style.top=n.y+"px"},this.updateAnnotationPosition=function(e){var t=this.project(e.position);e.style.left=t.x+"px",e.style.top=t.y+"px"},this.drawLeadLine=function(e,t){t.line=[];var i=parseInt(t.style.left,10),n=parseInt(t.style.top,10)+t.childNodes[0].clientHeight,o=this.unproject(new THREE.Vector3(i,n,0));t.line.push(this.drawLine(e,o,2)),t.id?t.line.push(this.drawLine(e,o,1)):t.line.push(this.drawLine(e,o))},this.drawLine=function(e,i,n){a||(a=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1,depthWrite:!1}),l=new THREE.LineBasicMaterial({color:34181,linewidth:2,depthTest:!1,depthWrite:!1}),c=new THREE.LineBasicMaterial({color:16777215,linewidth:4,depthTest:!1,depthWrite:!1}),t.impl.createOverlayScene("billboard-line"));var o=new THREE.Geometry;o.vertices.push(e),o.vertices.push(i);var r;r=1==n?l:2==n?c:a;var s=new THREE.Line(o,r);return t.impl.addOverlay("billboard-line",s),s},this.drawLeadPoint=function(e,t){t.point=[],t.point.push(this.drawPoint(e,0)),t.point.push(this.drawPoint(e,1))},this.drawPoint=function(e,i){u||(u=new THREE.MeshBasicMaterial({color:0,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),h=new THREE.MeshBasicMaterial({color:16777215,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),t.impl.createOverlayScene("billboard-point"));var n=new THREE.Mesh(new THREE.SphereGeometry(1),i?u:h);return n.position.set(e.x,e.y,e.z),this.setPointScale(n,i?4:5),t.impl.addOverlay("billboard-point",n),n},this.setPointScale=function(e,t){var i=this.setScale(e,t);e.scale.x=i,e.scale.y=i,e.scale.z=i},this.setScale=function(e,i){var n=t.navigation,o=n.getCamera(),r=n.getEyeVector(),s=n.getPosition(),a=e.position.clone(),l=o.isPerspective?a.sub(s).dot(r.normalize()):n.getEyeVector().length(),c=n.getVerticalFov(),u=2*l*Math.tan(THREE.Math.degToRad(.5*c)),h=n.getScreenViewport(),d=window.devicePixelRatio||1;return i*u/(h.height*d)},this.createNumMarker=function(e){var n=document.createElement("div");n.className="billboard-marker",this.numMarkers.push(n),n.innerHTML=e.id,t.container.appendChild(n),n.position=e.intersectPoint,this.setNumMarkerPosition(n),n.id=e.id,n.addEventListener("click",function(){var e=i.annotations[this.id-1];e.show?i.hideAnnotation(e):i.showAnnotation(e)})},this.destroyNumMarker=function(e){t.container.removeChild(this.numMarkers[e-1]),this.numMarkers[e-1]=void 0},this.setNumMarkerPosition=function(e){var t=this.project(e.position);e.style.left=t.x-e.offsetWidth/2+"px",e.style.top=t.y-e.offsetHeight/2+"px"},this.updateBillboard=function(){this.billboard&&(this.updateBillboardPosition(),this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.updateAnnotations=function(){for(e=0;e<this.annotations.length;e++)this.annotations[e]&&(this.updateAnnotationPosition(this.annotations[e]),this.updateLine(this.annotations[e]));for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&this.setNumMarkerPosition(this.numMarkers[e])},this.updateLine=function(e){var i=e.line;if(t.impl.removeMultipleOverlays("billboard-line",i),!0===e.show){var n=e.intersectPoint;this.drawLeadLine(n,e)}},this.updatePoint=function(e){var i=e.point;t.impl.removeMultipleOverlays("billboard-point",i),!0===e.show&&this.drawLeadPoint(e.intersectPoint,e)},this.showBillboard=function(){this.billboard&&(this.billboard.show=!0,this.billboard.style.display="block",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.hideBillboard=function(){this.billboard&&(this.billboard.show=!1,this.billboard.style.display="none",this.updateLine(this.billboard),this.updatePoint(this.billboard))},this.showAnnotation=function(e){e.show=!0,e.style.display="block",this.updateLine(e)},this.showAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&this.showAnnotation(this.annotations[e])},this.hideAnnotation=function(e){e.show=!1,e.style.display="none",this.updateLine(e)},this.hideAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&this.hideAnnotation(this.annotations[e])},this.clearAnnotations=function(){for(var e=0;e<this.annotations.length;e++)this.annotations[e]&&(this.destroyNumMarker(this.annotations[e].id),this.destroyAnnotation(this.annotations[e]));s=1},this.generateData=function(){for(var e=[],i=t.getExtension("Autodesk.Comments"),n=0;n<this.annotations.length;n++)if(this.annotations[n]){var o=this.annotations[n].commObj,r=[this.annotations[n].deltaX,this.annotations[n].deltaY];i.factory.pushTag(o,{name:"textOffset",value:r}),e.push(o)}return e},this.loadData=function(e){for(var i=t.getExtension("Autodesk.Comments"),n=0;n<e.length;n++){i.factory.removeGlobalOffset(e[n]);var o=i.factory.getTagValue(e[n],"nodeOffset"),r=new THREE.Vector3(o[0],o[1],o[2]),s=i.factory.getTagValue(e[n],"textOffset");s?this.createAnnotation(r,e[n].body,s[0],s[1]):this.createAnnotation(r,e[n].body)}},this.showNumMarkers=function(){for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&(this.numMarkers[e].style.visibility="visible")},this.hideNumMarkers=function(){for(var e=0;e<this.numMarkers.length;e++)this.numMarkers[e]&&(this.numMarkers[e].style.visibility="hidden")},this.moveHandler=function(e){function i(i){"touchmove"===i.type&&(i.screenX=i.touches[0].screenX,i.screenY=i.touches[0].screenY),h+=i.screenX-a,d+=i.screenY-l,r=c+h,s=u+d;var n=t.navigation.getScreenViewport(),o=e.clientWidth,g=e.clientHeight;r<5&&(r=0),s<5&&(s=0),n.width-5<r+o&&(r=n.width-o),n.height-5<s+g&&(s=n.height-g),e.style.left=r+"px",e.style.top=s+"px",p.updateLine(e),a=i.screenX,l=i.screenY,e.dragging=!0}function n(t){var o=p.project(e.intersectPoint),a=p.unproject(new THREE.Vector3(r,s,o.z));e.deltaX=a.x-e.intersectPoint.x,e.deltaY=a.y-e.intersectPoint.y,e.position.copy(a),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",n),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",n)}function o(t){"textarea"!==t.target.tagName.toLowerCase()&&("touchstart"===t.type&&(t.screenX=t.touches[0].screenX,t.screenY=t.touches[0].screenY),a=t.screenX,l=t.screenY,h=0,d=0,r=c=e.offsetLeft,s=u=e.offsetTop,e.dragging=!1,window.addEventListener("mousemove",i),window.addEventListener("mouseup",n),window.addEventListener("touchmove",i),window.addEventListener("touchend",n))}var r,s,a,l,c,u,h,d,p=this;e.addEventListener("mousedown",o),e.addEventListener("touchstart",o)},this.handleButtonDown=function(e,t){return o=!0,!1},this.handleButtonUp=function(e,t){return o=!1,!1},this.handleMouseMove=function(e){return!1},this.handleSingleClick=function(e,i){var n=t.impl.hitTest(e.canvasX,e.canvasY,!1);return n&&this.createBillboard(n.intersectPoint),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return this.handleSingleClick(e)},this.handleDoubleTap=function(e){return!0},this.handleResize=function(){i.updateBillboard(),i.updateAnnotations(),i.highlightAnnotation()}};t.BillboardTool=i}(),function(){"use strict";var e=Autodesk.Viewing,t=e.UI,i=AutodeskNamespace("Autodesk.Viewing.Extensions.BillboardGui"),n=function(t,i){e.Extension.call(this,t,i)};n.populateDefaultOptions=function(e){e.experimental.push("--billboards")},(n.prototype=Object.create(e.Extension.prototype)).constructor=n,n.prototype.load=function(){var e=this.viewer.getExtension("Autodesk.Billboard");return e||(this.viewer.loadExtension("Autodesk.Billboard"),e=this.viewer.getExtension("Autodesk.Billboard")),e?(this.core=e,this.viewer.toolbar?this.createToolbarUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0):(avp.logger.warn("Missing dependency:","Autodesk.Billboard"),!1)},n.prototype.unload=function(){return this.destroyToolbarUI(),this.core=null,!0},n.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(e.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createToolbarUI()},n.prototype.createToolbarUI=function(){var i=this,n=this.viewer.getToolbar(!0);this.billboardToolButton=new t.Button("toolbar-billboardTool"),this.billboardToolButton.setToolTip("Billboard"),this.billboardToolButton.setIcon("adsk-icon-billboard"),this.billboardToolButton.onClick=function(e){var n=i.billboardToolButton.getState();n===t.Button.State.INACTIVE?(i.core.enterEditMode(),i.billboardToolButton.setState(t.Button.State.ACTIVE)):n===t.Button.State.ACTIVE&&(i.core.leaveEditMode(),i.billboardToolButton.setState(t.Button.State.INACTIVE))};var o=n.getControl(e.TOOLBAR.MODELTOOLSID);o&&o.addControl(this.billboardToolButton,{index:0})},n.prototype.destroyToolbarUI=function(){if(this.billboardToolButton){var t=this.viewer.getToolbar(!1);if(t){var i=t.getControl(e.TOOLBAR.MODELTOOLSID);i&&i.removeControl(this.billboardToolButton)}this.billboardToolButton=null}},i.BillboardGui=n,e.theExtensionManager.registerExtension("Autodesk.BillboardGui",n)}();var AutodeskNamespace=AutodeskNamespace||function(e){"use strict";var t="undefined"!=typeof window&&null!==window?window:self;return e.split(".").forEach(function(e){t[e]=t[e]||{},t=t[e]}),t};!function(){"use strict";function e(e){return e&&0!==e.length?e.replace(/^#?\?/,"").split("&").map(function(e){return e.split("=").map(function(e){return decodeURIComponent(e)})}):null}function t(e){return"object"!=typeof e||null===e?e:(Object.getOwnPropertyNames&&Object.getOwnPropertyNames(e).forEach(function(i){var n=e[i];"object"!=typeof n||Object.isFrozen(n)||t(n)}),Object.freeze(e))}function i(e,t,i,n){function o(e,t){return function(){var t,n=null,o=null;4===r.readyState&&(t=r.status||e||-1,o=!r.response||"application/json"!==r.getResponseHeader("Content-Type")&&"json"!==r.responseType?r.response:JSON.parse(r.response),s[t]||(s[t]=!0,200!==t&&(n=r.status||e||"unknown error"),n?i(n,null):i(null,o)))}}if(i=i||function(){},!e||!t)return console.error("Invalid URL or Request Headers for the Query Service REST API"),void setTimeout(function(){i("Invalid URL or Request Headers for the Query Service REST API",null)},0);var r=new XMLHttpRequest;r.open("GET",e),Object.keys(t).forEach(function(e){void 0!==t[e]&&null!==t[e]&&r.setRequestHeader(e,t[e])});var s=[];r.onreadystatechange=o(),r.onload=o(),r.onerror=o(null,"Error"),r.ontimeout=o(null,"TimeOut"),r.onabort=o(null,"Abort"),r.timeout=n||B,r.send()}function n(){var e,t=+new Date;x&&R&&(e=t-G,G=t,document.hidden?y(x,R,"documentNotVisible",{documentVisibleDuration:e,totalDocumentVisibleDuration:W+=e,totalDocumentNotVisibleDuration:j}):y(x,R,"documentVisible",{documentNotVisibleDuration:e,totalDocumentVisibleDuration:W,totalDocumentNotVisibleDuration:j+=e}))}function o(){var e,t=+new Date;x&&R&&(e=t-G,G=t,document.hidden?j+=e:W+=e,y(x,R,"documentUnloaded",{totalDocumentVisibleDuration:W,totalDocumentNotVisibleDuration:j}))}function r(e,t){x=e,R=t}function s(e){var t={};return t[Y.TOKEN_HEADER_NAME]=e.token,t[Y.AUTHORIZATION_HEADER_NAME]=e.oauth2Token?"Bearer "+e.oauth2Token:void 0,t[Y.ANON_SESSION_HEADER_NAME]=e.token||e.oauth2Token?"false":"true",t[Y.CLIENT_ID_HEADER_NAME]=e.clientId,t[Y.CLIENT_FEATURE_ID_HEADER_NAME]=e.clientFeatureId,t[Y.SESSION_ID_HEADER_NAME]=e.sessionId,t[Y.EXTRA_USER_ID_HEADER_NAME]=e.userId,t[Y.DEBUG_HEADER_NAME]=V,t[Y.CONTENT_TYPE_HEADER_NAME]="application/json",t[Y.ACCEPT_HEADER_NAME]="application/json",t}function a(e){var t=null;return e[Y.AUTHORIZATION_HEADER_NAME]&&"apidev"!==_&&"apistg"!==_&&"apiprod"!==_&&(t="'"+Y.AUTHORIZATION_HEADER_NAME+"' header for OAUTH2 not valid for "+_+" endpoint. Use one of apidev/apistg/apiprod endpoints."),!e[Y.TOKEN_HEADER_NAME]||"apidev"!==_&&"apistg"!==_&&"apiprod"!==_||(t="'"+Y.AUTHORIZATION_HEADER_NAME+"' header for OAUTH1 not valid for "+_+" endpoint."),e[Y.TOKEN_HEADER_NAME]&&e[Y.AUTHORIZATION_HEADER_NAME]&&(t="'"+Y.AUTHORIZATION_HEADER_NAME+"' and '"+Y.AUTHORIZATION_HEADER_NAME+"' headers can not coexist."),e[Y.EXTRA_USER_ID_HEADER_NAME]&&!e[Y.AUTHORIZATION_HEADER_NAME]&&(t="'"+Y.AUTHORIZATION_HEADER_NAME+"' OAUTH2 header must be used w/ '"+Y.EXTRA_USER_ID_HEADER_NAME+"' header."),e[Y.CLIENT_ID_HEADER_NAME]||(t="'"+Y.CLIENT_ID_HEADER_NAME+"' header is required for all requests."),e[Y.CLIENT_FEATURE_ID_HEADER_NAME]||(t="'"+Y.CLIENT_FEATURE_ID_HEADER_NAME+"'header is required for all requests."),"application/json"!==e[Y.CONTENT_TYPE_HEADER_NAME]&&(t="'"+Y.CONTENT_TYPE_HEADER_NAME+"' header must be application/json for all requests."),e[Y.TOKEN_HEADER_NAME]||e[Y.AUTHORIZATION_HEADER_NAME]||e[Y.SESSION_ID_HEADER_NAME]&&e[Y.ANON_SESSION_HEADER_NAME]||(t="'"+Y.TOKEN_HEADER_NAME+"' or '"+Y.AUTHORIZATION_HEADER_NAME+"' header needs to be a valid value or both '"+Y.SESSION_ID_HEADER_NAME+"' and '"+Y.ANON_SESSION_HEADER_NAME+"' header need to be specified."),t}function l(e){var t=null,i=null;return e||(t="queryParams: needs to be specified."),e.pid||0===e.pid||(t="queryParams.pid: needs to be a valid Profile Id."),e.pid.length<=0&&(t="queryParams.pid: Profile Id needs to be a string with length greater than zero."),e.query||(i="queryParams.query empty."),e.page&&(e.pageOffset||e.pageSize)&&(i="either queryParams.page or queryParams.pageOffset and queryParams.pageSize must be set."),e.page||e.pageOffset||e.pageSize||(i="queryParams.page, queryParams.pageOffset, queryParams.pageSize empty."),(e.page<0||e.page>100)&&(i="queryParams.page should be a positive integer between 1 and 100"),e.pageOffset<0&&(i="queryParams.pageOffset should be a positive integer greater than 1"),(e.pageSize<0||e.pageSize>100)&&(i="queryParams.pageSize should be a positive integer between 1 and 100"),void 0!==e.language&&""!==e.language&&"string"!=typeof e.language&&(i="queryParams.language should be a language identifier"),{err:t,warn:i}}function c(e,t){var i=e;return t.pid&&(i+="?pid="+t.pid),t.query&&(i+="&query="+encodeURIComponent(t.query)),t.language&&(i+="&language="+encodeURIComponent(t.language)),t.modifier&&(i+="&modifier="+encodeURIComponent(t.modifier)),t.filters&&(i+="&filters="+encodeURIComponent(t.filters)),t.sort&&"relevance"!==t.sort&&(i+="&sort="+encodeURIComponent(t.sort)),t.page&&1!==t.page&&(i+="&page="+encodeURIComponent(""+t.page)),t.pageOffset&&0!==t.pageOffset&&(i+="&offset="+encodeURIComponent(""+t.pageOffset)),t.pageSize&&0!==t.pageSize&&(i+="&pagesize="+encodeURIComponent(""+t.pageSize)),_!==L&&(i+="&env="+encodeURIComponent(_)),i=i.replace(/^\?&/,"?")}function u(e,t,i){return-1===e.indexOf(q.escapeCharacter)?e:e.split(t).join(i)}function h(e){return e=e||"",e=u(e,q.escapeCharacter,X.escapeCharacterEscSeq),e=u(e,q.arrayListItemDelimiter,X.arrayListItemDelimiterEscSeq),e=u(e,q.arrayListValueDelimiter,X.arrayListValueDelimiterEscSeq)}function d(e){return e.map(function(e){for(var t=e[0],i=1;i<e.length;i++)t+=q.arrayListValueDelimiter+e[i];return t}).join(q.arrayListItemDelimiter)}function p(e){return e.map(function(e){if(-1!==q.reservedArrayListFilterNames.indexOf(e[0])&&Array.isArray(e[1])){var t=d(e[1]);return h(e[0])+q.nameValueDelimiter+t}return h(e[0])+q.nameValueDelimiter+h(e[1])}).join(q.listItemDelimiter)}function g(e,t,i){if(!e||!t||!i)return[];for(var n=[],o="",r="",s=!1,a=0;a<e.length;a++)(o=e[a])===i?(s=!s,r+=o):o!==t||s?(r+=o,s=!1):(n.push(r),r="",s=!1);return r.length&&n.push(r),n}function m(e){return g(e,q.arrayListItemDelimiter,q.escapeCharacter).map(function(e){return g(e,q.arrayListValueDelimiter,q.escapeCharacter)})}function v(e){var t=[];return e.map(function(e){return-1!==q.reservedArrayListFilterNames.indexOf(e[0])?(t=m(e[1]),[e[0],t]):e})}function f(e){return e.map(function(e){return g(e,q.nameValueDelimiter,q.escapeCharacter)})}function E(e){return g(e,q.listItemDelimiter,q.escapeCharacter)}function A(e){return e&&e.length?v(f(E(e))):[]}function y(e,t,n,o,r){if(r&&"function"!=typeof r)throw new Error("Callback was not a function");r=r||function(){};var s=H+z.Log+"?queryId="+e+"&type="+encodeURIComponent(n)+"&sessionId="+(t.sessionId||"")+"&userId="+(t.userId||"")+"&clientId="+(t.clientId||"")+"&clientFeatureId="+(t.clientFeatureId||"")+"&body="+encodeURIComponent(JSON.stringify(o))+"&_n="+Math.floor(1e5*Math.random()),a=function(e,t){e&&console.debug("Logged(err:"+(e||"noerr")+" info:"+(t||"-")+"): "+s),r(e)},l={};l[Y.CONTENT_TYPE_HEADER_NAME]="text/plain",i(s,l,a)}function T(e,t){var i,n;i={url:document&&document.location&&document.location.href,userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,maxTouchPoints:navigator.maxTouchPoints,versionInfo:D,performance:null},N||(window&&window.performance?((n=w()).searchSDKTimings={fetchStartToSearchSDKLoaded:U-n.timing.fetchStart,fetchStartToSearchSDKInstantiated:I-n.timing.fetchStart,fetchStartToNow:+new Date-n.timing.fetchStart},n.timingDelta={},n.timing&&(n.timingDelta.navigationStartToDomInteractive=n.timing.domInteractive-n.timing.navigationStart,n.timingDelta.dns=n.timing.domainLookupEnd-n.timing.domainLookupStart,n.timingDelta.htmlDownloadTime=n.timing.responseEnd-n.timing.responseStart,n.timingDelta.tcpConnectionSetup=n.timing.connectEnd-n.timing.connectStart,n.timing.secureConnectionStart&&(n.timingDelta.secureConnectionSetup=n.timing.connectEnd-n.timing.secureConnectionStart),Object.keys(n.timing).forEach(function(e){0!==n.timing[e]&&(n.timingDelta["fetchStartTo"+e[0].toUpperCase()+e.slice(1)]=n.timing[e]-n.timing.fetchStart)})),delete n.timing,i.performance=n):(i.performance={},i.noPerformance=!0),y(e,t,"performance",i)),N=!0}function w(){if(!window||!window.performance)return{};var e=function(e){return window.performance[e]?Object.keys(Object.getPrototypeOf(window.performance[e])).reduce(function(t,i){return window.performance[e][i]>=0&&(t[i]=window.performance[e][i]),t},{}):null};return Object.keys(Object.getPrototypeOf(window.performance)).reduce(function(t,i){return 0!==i.indexOf("onwebkit")&&window.performance[i]&&"object"==typeof window.performance[i]&&(t[i]=e(i)),t},{})}function b(e,t,i){i&&[].concat(i.queryResults||[],i.federatedResults||[]).forEach(function(i,n){k(i,n+1,e,t,"SERP","")})}function C(e,t,i){i&&((i.suggestionGroups||[]).forEach(function(i){var n=i.name;i.suggestions.forEach(function(i,o){k(i,o+1,e,t,"suggestions",n)})}),(i.textSuggestions||[]).forEach(function(i,n){S(i,n,e,t,"suggestions","")}))}function S(e,t,i,n,o,r){e.logClick=function(){var s={position:t,url:"",querySource:o,subQuerySource:r};e.suggestion&&(s.title=e.suggestion),y(i,n,"click",s)}}function k(e,t,i,n,o,r){e.logClick=function(){var s={position:t,url:"",querySource:o,subQuerySource:r};e.searchResultId&&(s.id=e.searchResultId.id,s.sourceSystem=e.searchResultId.sourceSystem),e.url&&(s.url=e.url),y(i,n,"click",s)}}function M(n){_=n&&O.hasOwnProperty(n)?n:L,H=O[_];var o=this;this.getApiVersion=function(){return D.version},this.getServerMinRestApiVersion=function(){return D.minRestApiVersion},this.getBuildDate=function(){return D.buildDate},this.getBuildNumber=function(){return D.buildNumber},this.getServiceEnvironments=function(){return Object.keys(O)},this.getFilterConfig=function(){return q},this.filterStringToFilterArray=function(e){return A(e)},this.filterArrayToFilterString=function(e){return p(e)},this.getLanguageFromBcp47Code=function(e){return K[e]||"ENU"},this.sanitizeAndHighlightString=function(e,t,i){var n,o,r=!1;return e?(t=t||"<em class='highlight'>",i=i||"</em>",o=document.createElement("div"),o.textContent=e,n=o.innerHTML,n=n.replace(/[\uE000\uE001]/g,function(n,o,s){return""!==n||r?""===n&&r?(r=!1,i):void console.warn("Warning: Incorrect number of highlight tokens in string: "+e):(r=!0,t)}),r&&(n+=i,console.warn("Warning: Incorrect number of highlight tokens in string: "+e)),n):""},this.removeHighlightTokens=function(e){return e?e=e.replace(/[\uE000\uE001]/g,""):""},this.query=function(e,n,o){var u,h=l(e);if(h&&h.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+h),void setTimeout(function(){o("Invalid Query Parameters for the Query Service REST API - "+h.err,null)},0);h&&h.warn&&console.warn("Query Parameters for the Query Service REST API - "+h.warn),u=c(H+z.Query,e);var d=s(n),p=a(d);if(p)return console.error("Invalid Request Headers for the Query Service REST API - "+p),void setTimeout(function(){o("Invalid Request Headers for the Query Service REST API - "+p,null)},0);i(u,d,function(e,i){!e&&i&&(b(i.queryId,n,i),t(i),T(i.queryId,n),r(i.queryId,n)),o(e,i)})},this.findCategories=function(e,t,n){var o,r=l(e);if(r&&r.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+r),void setTimeout(function(){n("Invalid Query Parameters for the Query Service REST API - "+r.err,null)},0);r&&r.warn&&console.warn("Query Parameters for the Query Service REST API - "+r.warn),o=c(H+z.Categories,e);var u=s(t),h=a(u);if(h)return console.error("Invalid Request Headers for the Query Service REST API - "+h),void setTimeout(function(){n("Invalid Query Parameters for the Query Service REST API - "+h,null)},0);i(o,u,n)},this.suggestionTimeoutId=null,this.lastSentSuggestionNum=-1,this.lastDisplayedSuggestionNum=-1,this.suggest=function(e,t,n){var u=function(e,t,n){var u,h,d=l(e);if(d&&d.err)return console.error("Invalid Query Parameters for the Query Service REST API - "+d),void setTimeout(function(){n("Invalid Query Parameters for the Query Service REST API - "+d.err,null)},0);d&&d.warn&&console.warn("Query Parameters for the Query Service REST API - "+d.warn),h=o.lastSentSuggestionNum+1,o.lastSentSuggestionNum=h,u=c(H+z.Suggestions,e);var p=s(t),g=a(p);if(g)return console.error("Invalid Request Headers for the Query Service REST API - "+g),void setTimeout(function(){n("Invalid Request Headers for the Query Service REST API - "+g,null)},0);i(u,p,function(e,i){if(h>o.lastDisplayedSuggestionNum)return o.lastDisplayedSuggestionNum=h,e||(C(i.queryId,t,i),T(i.queryId,t),r(i.queryId,t)),void n(e,i)})};clearTimeout(o.suggestionTimeoutId),o.suggestionTimeoutId=setTimeout(function(){u(e,t,n)},F)},this.logEvent=y,this.queryServiceInfo=function(e,t){var n=H+z.Health,o=s(e),r=a(o);if(r)return console.error("Invalid Request Headers for the Query Service REST API - "+r),void setTimeout(function(){t("Invalid Request Headers for the Query Service REST API - "+r,null)},0);i(n,o,function(e,i){var n,o,r=0,s=!1;if(n=D.minRestApiVersion.split(".").map(function(e){return parseFloat(e)}),!e&&i.versionInfo&&i.versionInfo.version){for(o=i.versionInfo.version.split(".").map(function(e){return parseFloat(e)});r<o.length||r<n.length;)s=s||(n[r]||0)>(o[r]||0),r+=1;s&&console.error("Error: Remote API version ("+i.versionInfo.version+") is older than required ("+D.minRestApiVersion+")")}t(e,i)})},this.queryParamsToUrl=function(e,t,i,n){var o;if(!t||!i||!i.pushState)return console.error("queryParamsToUrl() requres a History object in the urlLocation parameter such as window.history."),!1;(o=new URL(t)).search=new URL(c(H+z.Query,e)).search;try{i.pushState(null,"",o)}catch(e){document.location.hash=o.search}return!0},this.urlParametersToQueryParams=function(t){var i={pid:void 0,query:null,modifier:null,filters:"",sort:"",page:1,language:"",oauth2Token:null,env:null},n={pid:1},o={access_token:"oauth2Token",expires_in:"oauth2TokenExpiresIn"},r=new URL(t);return e((r.search||"").slice(1)+"&"+(r.hash||"").slice(1)).forEach(function(e){void 0===typeof i[e[0]]||n[e[0]]||(i[o[e[0]]||e[0]]=e[1])}),i}}var x,R,P=new AutodeskNamespace("Autodesk.Search"),V=V||!1,I=+new Date,N=!1,D=Object.freeze({version:"3.0.0-0",buildDate:"2016-08-02T16:22:43",buildNumber:"190",minRestApiVersion:"1.38.0"}),L="prod",O=Object.freeze({localdev:"http://search-localdev.api.autodesk.com:8080/qs",dev:"https://dev.search.api.autodesk.com/qs","dev-dr":"https://dev.search-dr.api.autodesk.com/qs",stg:"https://search-staging.api.autodesk.com/qs","stg-dr":"https://search-staging-dr.api.autodesk.com/qs",prod:"https://search.api.autodesk.com/qs","prod-dr":"https://search-dr.api.autodesk.com/qs",apidev:"https://developer-dev.api.autodesk.com/search",apistg:"https://developer-stg.api.autodesk.com/search",apiprod:"https://developer.api.autodesk.com/search"}),_=L,H=O[_],B=null,F=250,z=Object.freeze({Query:"/v3/search",Categories:"/v3/categories",Suggestions:"/v3/suggestions",Log:"/v2/log",Health:"/v2/health"}),U=+new Date,G=+new Date,W=0,j=0;document.addEventListener&&document.addEventListener("visibilitychange",n,!1),window.addEventListener&&window.addEventListener("beforeunload",o,!1);var Y=Object.freeze({TOKEN_HEADER_NAME:"x-ads-token",ANON_SESSION_HEADER_NAME:"x-ads-anon-session",CLIENT_ID_HEADER_NAME:"x-ads-client-id",CLIENT_FEATURE_ID_HEADER_NAME:"x-ads-client-feature-id",SESSION_ID_HEADER_NAME:"x-ads-session-id",DEBUG_HEADER_NAME:"x-ads-debug",EXTRA_USER_ID_HEADER_NAME:"x-ads-ex-user-id",CONTENT_TYPE_HEADER_NAME:"Content-Type",ACCEPT_HEADER_NAME:"Accept",AUTHORIZATION_HEADER_NAME:"Authorization"}),q=t({arrayListItemDelimiter:"'",arrayListValueDelimiter:"*",escapeCharacter:"\\",reservedArrayListFilterNames:["resourceIds"]}),X=t({arrayListItemDelimiterEscSeq:q.escapeCharacter+q.arrayListItemDelimiter,arrayListValueDelimiterEscSeq:q.escapeCharacter+q.arrayListValueDelimiter,escapeCharacterEscSeq:q.escapeCharacter+q.escapeCharacter}),K=t({"pt-BR":"PTB",cs:"CSY",en:"ENU","en-us":"ENU",fr:"FRA",de:"DEU",hu:"HUN",it:"ITA",ja:"JPN",ko:"KOR",pl:"PLK",ru:"RUS","zh-CN":"CHS",es:"ESP","es-ES":"ESP","zh-TW":"CHT"});M.prototype.constructor=M,P.SearchQueryAPI=M}(),function(){"use strict";var e=Autodesk.Viewing.Private,t=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),i=e.ENABLE_INLINE_WORKER||!1,n=e.LMV_WORKER_URL,o=function(){var e=n.indexOf(".min.js")>0;this.propertyWorkerUrl=e?"searchworker.min.js":"searchworker.js",this.propertyWorkerFetchingScript=!1,this.propertyWorkerDataUrl=null,this.propertyWorkerFetchingCbs=[]},r=o.prototype;r.initPropertyWorkerScript=function(t,n){var o=this;if(i&&!this.propertyWorkerDataUrl){if(this.propertyWorkerFetchingCbs.push({successCB:t}),this.propertyWorkerFetchingScript)return;var r=new XMLHttpRequest,s=this.propertyWorkerUrl,a=e.getResourceUrl(this.propertyWorkerUrl);a&&(s=a),r.open("GET",s,!0),r.withCredentials=!1,r.onload=function(){o.propertyWorkerFetchingScript=!1;var e;window.URL=window.URL||window.webkitURL;try{e=new Blob([r.responseText],{type:"application/javascript"})}catch(t){(e=new BlobBuilder).append(r.responseText),e=e.getBlob()}o.propertyWorkerDataUrl=URL.createObjectURL(e);var t=o.propertyWorkerFetchingCbs.concat();o.propertyWorkerFetchingCbs=[];for(var i=0;i<t.length;++i)t[i].successCB&&t[i].successCB()},o.propertyWorkerFetchingScript=!0,r.send()}else t&&t()},r.initInViewerSearchWorkersScripts=function(e,t){this.initPropertyWorkerScript(e,t)},r.createPropertyWorker=function(){return i?new Worker(this.propertyWorkerDataUrl):new Worker(e.getResourceUrl(this.propertyWorkerUrl))},t.WorkerUtils=new o}(),function(){"use strict";function e(e,t,i){var n,o=e.viewer.model.is2d(),r=function(t,i){return e.isNodeVisible(t,i)};e.inViewerSearchThisView&&(n=function(t,i,n,o){e.highlightNodeInViewer(t,i,n,o,A)},e.inViewerSearchThisView.initialize(e.qsApiService,e.viewerProperties,t,o,e.thisViewDom||v,n,r,i),e.options.uiEnabled&&e.thisViewDom&&e.thisViewDom.addEventListener("click",function(t){var i=t.target.getAttribute("class");i&&i.includes("item-result")&&e.updateRecentSearches(e.inViewerSearchThisView.searchString)})),e.inViewerSearchThisItem&&!e.inViewerSearchThisItem.initialized&&(n=function(t,i,n,o){e.highlightNodeInViewer(t,i,n,o,y)},e.inViewerSearchThisItem.initialize(e.qsApiService,e.viewerProperties,t,e.thisItemDom||f,n,r,i,function(t){e.changeToThisViewTabAndSelectNode(t)}),e.options.uiEnabled&&e.thisItemDom&&e.thisItemDom.addEventListener("click",function(t){var i=t.target.getAttribute("class");i&&(i.includes("item-result")||i.includes("geometry-name"))&&e.updateRecentSearches(e.inViewerSearchThisItem.searchString)})),e.inViewerSearchThisProject&&(e.inViewerSearchThisProject.initialize(e.qsApiService,e.thisProjectDom||E),e.options.uiEnabled&&e.thisProjectDom&&e.thisProjectDom.addEventListener("click",function(t){var i=t.target.getAttribute("class");i&&(i.includes("item-result")||i.includes("category-name"))&&e.updateRecentSearches(e.inViewerSearchThisProject.searchString)}))}function t(e){var t=null;try{t=JSON.parse(e)}catch(e){console.error("JSON parse error: "+e)}return t}function i(e,t,i){var n=t.model.getDocumentNode()?t.model.getDocumentNode().parent:null;n?setTimeout(function(){i(n)},0):(e.noBubbleData=!0,e.inViewerSearchThisItem&&(delete e.inViewerSearchThisItem,e.inViewerSearchThisItem=null),g.logger.warn("InViewerSearch Extension: no ViewingApplication is being used so relatedItemsTab will not be visible"),setTimeout(function(){i(null)},0))}function n(e){var t;e.options.uiEnabled&&e.searchToolButton&&e.inViewerSearchPanel&&(t=e.inViewerSearchPanel.isVisible(),e.searchToolButton.setState(t?p.Button.State.ACTIVE:p.Button.State.INACTIVE),e.searchToolButton.setToolTip(d.i18n.translate("Search")))}function o(t,o){var r=t.viewer,s=g.env,a=t.getCurrentGeometry(),l=d.getViewingUrl(),c=t.cacheObj.searchInfoThisItem;t.showingTabs=!1;var u=function(){(!t.inViewerSearchThisView||t.inViewerSearchThisView.initialized)&&(!t.inViewerSearchThisItem||t.inViewerSearchThisItem.initialized)?(t.initialized=!0,t.options.uiEnabled&&t.viewer&&t.viewer.getPropertyPanel&&(t.extensionViewer=t.viewer.getPropertyPanel(!0)),c||n(t),o(!0)):t.inViewerSearchThisView.initialized&&(c||n(t))},h=function(i){var n,o=[],r="";if(i&&(o=i.getRootNode().search({type:"geometry"}),r=i.findPropertyDbPath()),t.flatGUIDS=o,g.logger.debug("InViewerSearchExtension - has sharedPropertyDBPath: "+r),t.qsApiService){var c={count:{}};n=0,o.forEach(function(e){e.data&&(n+=e.data.size?e.data.size:0,e.data.role&&(c.count[e.data.role]=c.count[e.data.role]+1||1))}),c.size=n;var h=d.getGlobal(),p=h.LMV_VIEWER_VERSION+"."+h.LMV_VIEWER_PATCH;t.qsApiService.initialize(p,s,t.options.clientId,t.options.sessionId),t.qsApiService.logInitEvent(t.viewer.model.myData.urn,c,t.options,"")}t.viewerProperties&&!t.viewerProperties.initialized&&t.viewerProperties.initialize(t.viewer,t.noBubbleData,l,t.flatGUIDS,a,t.options.thresholdSearchMaxNodes,t.qsApiService,r),t.options.uiEnabled&&!t.initialized&&t.createTabs(),e(t,a,u)};i(t,r,h)}function r(e,t,i){var n=e.searchBarElem;t&&(n.value=t,e.uiSearch(i),e.updateRecentSearches(t))}function s(e,t){var i=document.createElement("li");return i.className="recent-item",i.appendChild(document.createTextNode(t)),i.addEventListener("click",function(){r(e,this.innerText)},!1),i}function a(e,t){var i,n,o,r;(i=document.createElement("label")).className="recent-label",i.appendChild(document.createTextNode(d.i18n.translate("Recent Searches"))),(n=document.createElement("ul")).className="recent-searches-list dockingPanelScroll",(o=e.getRecentSearches()).forEach(function(t){n.appendChild(s(e,t))}),o.length<1&&((r=document.createElement("li")).className="recent-item empty-list",r.appendChild(document.createTextNode(d.i18n.translate("Recent Searches Empty"))),n.appendChild(r)),t.appendChild(i),t.appendChild(n)}function l(e,t){var i,n,o,r,s,a=[].slice.call(t.parentElement.children);if(e.enabled){a.forEach(function(e){e.classList.remove("selected")});var l=t.getAttribute("tabId");s=l===y?f:l===A?v:E,t.classList.add("selected"),e.selectedTab=t,e.qsApiService.logTabClickEvent(l),i=t.parentElement.parentElement.children[1],n=[].slice.call(i.children),s===v?(r=e.inViewerSearchThisView,e.highlightNodeInViewer(r.clicked,r.controller.searchResultIds,r.clicked,!1)):s===f&&(o=e.inViewerSearchThisItem,e.highlightNodeInViewer(o.selectedNodeId,o.currentGeoSearchedIds,o.selectedNodeId,!1)),n.forEach(function(e){e.id===s?e.classList.remove("hidden"):e.classList.add("hidden")})}}function c(e,t,i,n,o){var r,s;return r=document.createElement("div"),r.className="tab-item "+i,r.setAttribute("tabId",o),r.addEventListener("click",function(){l(e,this)},!1),(s=document.createElement("label")).appendChild(document.createTextNode(n)),r.appendChild(s),r}function u(e,t){var i,n,o,r,s,a;a=0,i=document.createElement("div"),(n=document.createElement("div")).className="tab-content",t.options.loadedModelTab.enabled&&t.inViewerSearchThisView&&(a++,i.appendChild(c(t,v,"this-view",t.options.loadedModelTab.displayName,A)),(o=document.createElement("div")).id=v,o.className="tab-content-this-view hidden",t.thisViewDom=o,n.appendChild(o)),t.options.relatedItemsTab.enabled&&t.inViewerSearchThisItem&&(a++,i.appendChild(c(t,f,"this-item",t.options.relatedItemsTab.displayName,y)),(r=document.createElement("div")).className="tab-content-this-item hidden",r.id=f,t.thisItemDom=r,n.appendChild(r)),t.options.serverSearchTab.enabled&&(a++,i.appendChild(c(t,E,"this-project",t.options.serverSearchTab.displayName,T)),(s=document.createElement("div")).className="tab-content-this-project hidden",s.id=E,t.thisProjectDom=s,n.appendChild(s)),i.className="tab-items tabs-count-"+a,i.childNodes[0].classList.add("selected"),t.selectedTab=i.childNodes[0],n.childNodes[0].classList.remove("hidden"),e.appendChild(i),e.appendChild(n),t.tabContent=n}function h(e){var t=e.getCurrentGeometry(),i=e.viewer.model.is2d();e.options.uiEnabled&&e.viewer&&e.viewer.getPropertyPanel&&(e.extensionViewer=e.viewer.getPropertyPanel(!0)),e.viewerProperties.updateCurrentGeometry(t,function(n,o){var r=e.cacheObj.searchInfoThisItem.node;e.inViewerSearchThisView&&e.inViewerSearchThisView.updateCurrentGeometry(t,o,n,i,r,e.viewer),e.inViewerSearchThisItem&&e.inViewerSearchThisItem.updateCurrentGeometry(t,e.viewer),e.disabledPanel(!0)}),e.addToolbarUI(!0)}var d=Autodesk.Viewing,p=Autodesk.Viewing.UI,g=Autodesk.Viewing.Private,m=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),v="in-viewer-search-this-view",f="in-viewer-search-this-item",E="in-viewer-search-this-project",A="this-view-tab",y="this-item-tab",T="this-project-tab",w=null,b=null,C=Object.freeze({BACKSPACE:8,SPACE:32,ENTER:13});m.InViewerSearchMain=function(e,t,i){this.viewer=e,this.cacheObj=i,this.options=t,this.is2DMode=null,this.initialized=!1,this.toolbarTools=null,this.qsApiService=new m.QsApiService,this.viewerProperties=new m.ViewerPropertiesService(e),this.noBubbleData=!1,this.inViewerSearchPanel=null,this.inViewerSearchThisView=null,this.inViewerSearchThisItem=null,this.inViewerSearchThisProject=null,this.geometryLoadedCallback=null,this.tabsElem=null,this.searchBarElem=null,this.recentSearchesElem=null,this.saveLastQuery=null,this.recentSearches=null,this.flatGUIDS={},this.container=null,this.searchToolButton=null,this.showingTabs=!1,this.initCb=null,this.closeCallback=null,this.workersScriptsInitialized=!1,this.initWorkersScripts=null,this.thisProjectDom=null,this.thisItemDom=null,this.thisViewDom=null,this.extensionViewer=null,this.enabled=!0},m.InViewerSearchMain.prototype.constructor=m.InViewerSearchMain,m.InViewerSearchMain.prototype.load=function(){var e=this,t=this.viewer;if(!(!!(this.options&&this.options.loadedModelTab&&this.options.relatedItemsTab&&this.options.serverSearchTab)&&(this.options.loadedModelTab.enabled||this.options.relatedItemsTab.enabled||this.options.serverSearchTab.enabled)))return g.logger.log("InViewerSearch Extension - all search types disabled, nothing to do."),!1;m.WorkerUtils.initInViewerSearchWorkersScripts(function(){e.workersScriptsInitialized=!0,e.initWorkersScripts&&e.initWorkersScripts(),g.logger.info("InViewerSearch Extension: workers fetched.")},function(){g.logger.warn("InViewerSearch Extension: error fetching workers.")}),this.options.loadedModelTab.enabled&&!this.inViewerSearchThisView&&(this.inViewerSearchThisView=new m.InViewerSearchThisView(t,this.options)),this.options.relatedItemsTab.enabled&&!this.inViewerSearchThisItem&&(this.inViewerSearchThisItem=new m.InViewerSearchThisItem(t,this.options,this.cacheObj)),this.options.serverSearchTab.enabled&&!this.inViewerSearchThisProject&&(this.inViewerSearchThisProject=new m.InViewerSearchThisProject(this.options)),this.options.uiEnabled&&!this.inViewerSearchPanel&&(this.inViewerSearchPanel=new m.InViewerSearchPanel(t,"in-viewer-search","Search",this.options,this.qsApiService),this.container=this.inViewerSearchPanel.container,this.inViewerSearchPanel.addEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.options.uiEnabled&&!e.searchToolButton&&this.addToolbarUI(),this.onInitialized=function(t){t&&(e.initialized=!0,n(e),e.initCb&&e.initCb())},this.geometryLoadedCallback=function(){e.workersScriptsInitialized?o(e,e.onInitialized):e.initWorkersScripts=function(){o(e,e.onInitialized)}};var i=function(){t.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i),t.getObjectTree(function(){e.geometryLoadedCallback()},function(){g.logger.warn("InViewerSearch Extension - failed getObjectTree"),e.geometryLoadedCallback()})};return t.getObjectTree(function(){e.geometryLoadedCallback()},function(){if(t.model&&t.model.getData){var n=t.model.getData();n&&n.hasOwnProperty("hasObjectProperties")&&e.geometryLoadedCallback()}else t.addEventListener(d.GEOMETRY_LOADED_EVENT,i)}),!0},m.InViewerSearchMain.prototype.update=function(e,t,i){this.viewer=e,this.cacheObj=i,this.options=t;var n=this;this.container.classList.remove("hidden");var o=function(){n.viewer.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,r),h(n),n.cacheObj.inViewerSearch=null},r=function(){e.getObjectTree(function(){o()},function(){g.logger.warn("InViewerSearch Extension - failed getObjectTree"),o()})};return this.viewer.getObjectTree(function(){r()},function(){if(n.viewer.model&&n.viewer.model.getData){var e=n.viewer.model.getData();e&&e.hasOwnProperty("hasObjectProperties")&&r()}else n.viewer.addEventListener(d.GEOMETRY_LOADED_EVENT,r)}),!0},m.InViewerSearchMain.prototype.disabledPanel=function(e){this.container.classList.add("disabled"),e&&this.container.classList.remove("disabled"),this.enabled=e},m.InViewerSearchMain.prototype.addToolbarUI=function(e){var t,i=this,n=this.viewer;if(n.getToolbar){var o=n.getToolbar(!1);this.toolbarTools=o.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),(t=new p.Button("toolbar-in-viewer-search")).setToolTip(d.i18n.translate("Search")),t.setIcon("adsk-button-icon-search"),e||(t.setToolTip(d.i18n.translate("Loading Search")),t.setState(p.Button.State.DISABLED)),t.addEventListener("click",function(){if(i.inViewerSearchPanel){var e=i.inViewerSearchPanel.isVisible();i.qsApiService.logGeneralEvent(e?"searchWindowClose":"searchWindowOpen"),i.inViewerSearchPanel.setVisible(!e),i.searchBarElem.focus()}},!1),t.addClass("in-viewer-search-button"),i.inViewerSearchPanel&&i.inViewerSearchPanel.addVisibilityListener(function(e){t.setState(e?p.Button.State.ACTIVE:p.Button.State.INACTIVE)}),i.searchToolButton=t,i.toolbarTools.addControl(t)}},m.InViewerSearchMain.prototype.unload=function(){if(this.cacheObj.searchInfoThisItem){this.cacheObj.inViewerSearch=this,this.viewer.getPropertyPanel()&&this.viewer.getPropertyPanel().setVisible(!1);var e=this.viewer.config.extensions;e&&e.indexOf("Autodesk.InViewerSearch")<0&&this.container.classList.add("hidden")}else this.initialized=!1,this.options.uiEnabled&&(this.closeSearch(),this.toolbarTools&&this.toolbarTools.removeControl(this.searchToolButton)),this.geometryLoadedCallback&&this.viewer.removeEventListener(d.GEOMETRY_LOADED_EVENT,this.geometryLoadedCallback),this.inViewerSearchThisView&&this.inViewerSearchThisView.initialized&&this.inViewerSearchThisView.uninitialize(),this.inViewerSearchThisItem&&this.inViewerSearchThisItem.initialized&&this.inViewerSearchThisItem.uninitialize(),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.initialized&&this.inViewerSearchThisProject.uninitialize(),this.inViewerSearchPanel&&this.inViewerSearchPanel.uninitialize(),this.viewerProperties.uninitialize(),delete this.searchToolButton,delete this.inViewerSearchThisView,delete this.inViewerSearchThisItem,delete this.inViewerSearchThisProject,delete this.inViewerSearchPanel,delete this.qsApiService,delete this.viewerProperties;return!0},m.InViewerSearchMain.prototype.getRecentSearches=function(){return this.recentSearches||(this.recentSearches=t(window.localStorage.recentSearches||"[]")),this.recentSearches},m.InViewerSearchMain.prototype.updateRecentSearches=function(e){var t,i,n,o;e&&(t=this,this.recentSearches||this.getRecentSearches(),0!==(i=this.recentSearches.indexOf(e))&&(o=this.recentSearchesElem.children[1],i>0&&(this.recentSearches.splice(i,1),o.removeChild(o.childNodes[i]),i=-1),i<0&&(this.recentSearches=[e].concat(this.recentSearches.slice(0,20)),window.localStorage.recentSearches=JSON.stringify(this.recentSearches),t.options.uiEnabled&&((n=o.children[0]).className.indexOf("empty-list")>=0&&n.parentNode.removeChild(n),o.insertBefore(s(t,e),o.childNodes[0])))))},m.InViewerSearchMain.prototype.highlightNodeInViewer=function(e,t,i,n,o){var r=this.selectedTab.getAttribute("tabId");if(!o||o===r){this.viewer.model.is2d();this.viewer.navigation.setRequestHomeView(!0),e?(this.viewer.isolate(e),this.viewer.select(e),i&&this.extensionViewer&&this.extensionViewer.container?this.extensionViewer.setVisible(!0):i||this.extensionViewer.setVisible(!1)):(t||(r===A?t=this.inViewerSearchThisView.controller.searchResultIds:r===y&&(t=this.inViewerSearchThisItem.currentGeoSearchedIds)),this.viewer.clearSelection(),this.viewer.isolate(t),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1)),n&&this.viewer.fitToView()}},m.InViewerSearchMain.prototype.closeSearch=function(){var e=this;e.hideTabs(),e.inViewerSearchThisView&&e.inViewerSearchThisView.clearSearch(),e.inViewerSearchThisItem&&e.inViewerSearchThisItem.clearSearch(),e.inViewerSearchThisProject&&e.inViewerSearchThisProject.clearSearch(),this.searchBarElem&&(this.searchBarElem.value=""),l(this,this.tabsElem.firstChild.firstChild)},m.InViewerSearchMain.prototype.createTabs=function(){if(this.inViewerSearchPanel&&this.inViewerSearchPanel.scrollContainer){var e,t,i,n=this,o=this.inViewerSearchPanel?this.inViewerSearchPanel.scrollContainer:null,r="onsearch"in document.documentElement;this.searchBarElem||((t=document.createElement("input")).className="in-viewer-search-bar",t.id="in-viewer-search-bar",t.type="search",this.options.searchDefaultText&&(t.placeholder=this.options.searchDefaultText),t.addEventListener("keyup",function(e){var i=e.target.value.trim(),o=e.which||e.keyCode;r||o!==C.ENTER?i&&i.length>=3?(o===C.BACKSPACE||o===C.SPACE||o>40&&o<128||o>185&&o<193||o>218&&o<223)&&(clearTimeout(b),b=setTimeout(function(){n.saveLastQuery=!1,n.uiSearch()},200)):n.hideTabs():t.onsearch(e)}),t.onsearch=function(e){var t=e.target.value.trim();clearTimeout(b),t?b=setTimeout(function(){n.saveLastQuery=!0,n.uiSearch()},200):n.hideTabs()},this.searchBarElem=t,(e=document.createElement("div")).className="recent-searches",a(n,e),this.recentSearchesElem=e,(i=document.createElement("div")).className="tabs-wrapper hidden",u(i,n),this.tabsElem=i,o&&(o.appendChild(t),this.searchBarElem.focus(),o.appendChild(e),o.appendChild(i)))}},m.InViewerSearchMain.prototype.search=function(e,t,i,n,o){var r=e.trim();r&&(this.qsApiService.generateQueryId(),this.inViewerSearchThisView&&(o||t)&&this.inViewerSearchThisView.search(r,w,t),this.inViewerSearchThisItem&&(o||i)&&this.inViewerSearchThisItem.search(r,i),this.inViewerSearchThisProject&&(o||n)&&this.inViewerSearchThisProject.search(r,n),this.saveLastQuery&&this.updateRecentSearches(r))},m.InViewerSearchMain.prototype.uiSearch=function(e){var t=this.searchBarElem.value.toLocaleLowerCase();w=e,t?(this.showTabs(),this.search(t,null,null,null,!0)):this.hideTabs()},m.InViewerSearchMain.prototype.showTabs=function(){this.showingTabs||(this.tabsElem.classList.remove("hidden"),this.recentSearchesElem.classList.add("hidden"),this.showingTabs=!0)},m.InViewerSearchMain.prototype.changeToThisViewTabAndSelectNode=function(e){this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(l(this,this.tabsElem.firstChild.firstChild),this.inViewerSearchThisView.selectNode(null,e,!0))},m.InViewerSearchMain.prototype.hideTabs=function(){this.showingTabs&&(this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!1),this.viewer.showAll(),this.viewer.clearSelection(),this.recentSearchesElem.classList.remove("hidden"),this.tabsElem.classList.add("hidden"),this.showingTabs=!1,this.searchBarElem.focus())},m.InViewerSearchMain.prototype.isNodeVisible=function(e,t){if(this.viewer.model&&this.viewer.model.getData()){var i=this.viewer.model.getData();if(this.viewer.model.is2d()){var n=i.fragments.dbId2fragId[e];this.viewer.model.isFragVisible(n)&&t()}else i&&i.instanceTree&&i.instanceTree.nodeAccess.enumNodeFragments(e,function(){t()})}},m.InViewerSearchMain.prototype.getCurrentGeometry=function(){return g.docItemId}}(),function(){"use strict";function e(e,t){var i=0,n=t.length;if(!e)return{message:"params object is missing, it should be an object with the fields categoryName, categoryModifier and page specify."};for(;i<n;){if(!e.hasOwnProperty(t[i]))return{message:t[i]+" is missing in params object."};i++}return null}var t=Autodesk.Viewing,i=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),n={searchDefaultText:"",uiEnabled:!0,clientId:"adsk.viewer.defaultClientId",sessionId:"adsk.viewer.defaultSessionId",thresholdSearchMaxNodes:5e4,loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},serverSearchTab:{enabled:!1,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20}},o=function(e,i){var o;t.Extension.call(this,e,i),this.initialized=!1,this.viewer=e,this.toolbarTools=null,i||(i={}),i.inViewerSearchConfig=i.inViewerSearchConfig||n,this.options=i.inViewerSearchConfig,this.options.thresholdSearchMaxNodes=this.options.thresholdSearchMaxNodes||n.thresholdSearchMaxNodes,o=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,this.options.uiEnabled=o&&(void 0===this.options.uiEnabled?n.uiEnabled:this.options.uiEnabled),this.options.serverSearchTab=this.options.serverSearchTab||n.serverSearchTab,this.options.relatedItemsTab=this.options.relatedItemsTab||n.relatedItemsTab,this.options.loadedModelTab=this.options.loadedModelTab||n.loadedModelTab,this.options.serverSearchTab.displayName=this.options.serverSearchTab.displayName||n.serverSearchTab.displayName,this.options.relatedItemsTab.displayName=this.options.relatedItemsTab.displayName||n.relatedItemsTab.displayName,this.options.loadedModelTab.displayName=this.options.loadedModelTab.displayName||n.loadedModelTab.displayName};o.populateDefaultOptions=function(e){e.inViewerSearchConfig={uiEnabled:!0,clientId:void 0,sessionId:void 0,serverSearchTab:{enabled:!0,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50}}},(o.prototype=Object.create(Autodesk.Viewing.Extension.prototype)).constructor=i.InViewerSearchExtension,o.prototype.load=function(){return this.cache=this.getCache(),this.cache&&this.cache.inViewerSearch?this.inViewerSearchMain=this.cache.inViewerSearch:this.inViewerSearchMain=new i.InViewerSearchMain(this.viewer,this.options,this.getCache()),this.inViewerSearchMain&&this.cache&&this.cache.inViewerSearch?(this.cache.inViewerSearch=null,this.inViewerSearchMain.update(this.viewer,this.options,this.cache)):this.inViewerSearchMain.load(),!0},o.prototype.unload=function(){return this.inViewerSearchMain.unload(),this.cache&&this.cache.searchInfoThisItem?this.inViewerSearchMain.disabledPanel():(delete this.inViewerSearchMain,this.inViewerSearchMain=null,this.options.initialized=!1,this.options.inViewerSearchMain=null),!0},o.prototype.addInitListener=function(e){this.inViewerSearchMain&&this.inViewerSearchMain.initialized?setTimeout(function(){e()},0):this.inViewerSearchMain.initCb=e},o.prototype.searchModel=function(e,t,i){var n=e.trim(),o=this.inViewerSearchMain,r=null;t&&t.page&&(r=t.page),n?o.inViewerSearchThisView?r&&1!==r?n!==o.inViewerSearchThisView.searchString?this.search(n,function(){o.inViewerSearchThisView.getPage(r,i)}):o.inViewerSearchThisView.getPage(r,i):o.inViewerSearchThisView.search(n,null,i):i({message:"Search model is not enabled."}):i({message:"Nothing to search."})},o.prototype.searchDocument=function(e,t,i){var n,o,r=e.trim(),s=this.inViewerSearchMain,a=s.inViewerSearchThisItem;t&&(n=t.page,o=t.geometryId),r?a?n&&1!==n?s.inViewerSearchThisItem.getPage(o,n,i):a.search(r,i):i({message:"Search document is not enabled."}):i({message:"Nothing to search"})},o.prototype.queryService=function(t,i,n){var o,r=t.trim(),s=this.inViewerSearchMain;if(r)if(s.inViewerSearchThisProject)if(i&&Object.keys(i).length){var a=e(i,["categoryName","categoryModifier","page"]);if(a)return void n(a);if((o=i.page)<0)return void n({page:o,message:"Invalid page number, it must be a positive number."});s.inViewerSearchThisProject.getPage({name:i.categoryName,modifier:i.categoryModifier},o,n)}else s.inViewerSearchThisProject.search(r,n);else n({message:"Server search is not enabled."});else n({message:"Nothing to search"})},i.InViewerSearchExtension=o,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.InViewerSearch",o)}(),function(){"use strict";var e=Autodesk.Viewing.UI,t=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");t.InViewerSearchPanel=function(t,i,n,o,r){var s=this;this.viewer=t,this.qsApiService=r,e.DockingPanel.call(this,t.container,i,n,o),this.container.classList.add("inViewerSearchPanel"),(o=o||{}).heightAdjustment||(o.heightAdjustment=40),o.marginTop||(o.marginTop=0),o.left=!0,this.createScrollContainer(o),this.options=o,this.selectedNodes=[],this.uiCreated=!1,this.addVisibilityListener(function(e){e&&(s.uiCreated||s.createUI(),s.resizeToContent())})},t.InViewerSearchPanel.prototype=Object.create(e.DockingPanel.prototype),t.InViewerSearchPanel.prototype.constructor=t.InViewerSearchPanel,t.InViewerSearchPanel.prototype.createUI=function(){},t.InViewerSearchPanel.prototype.addClass=function(e,t){return null!==this.tree&&this.tree.addClass(e,t)},t.InViewerSearchPanel.prototype.removeClass=function(e,t){return null!==this.tree&&this.tree.removeClass(e,t)},t.InViewerSearchPanel.prototype.initializeCloseHandler=function(e){var t=this;e.setAttribute("id","in-viewer-search-close"),t.addEventListener(e,"click",function(){t.setVisible(!1),t.qsApiService.logGeneralEvent("searchWindowClose")},!1)},e.InViewerSearchPanel=t.InViewerSearchPanel}(),function(){"use strict";function e(e){var t=[],i=[],n=0,o=e.controller;return o.resultCollection.getResultSetArray().forEach(function(r,s){var a=[],l=[];n=0,r.forEach(function(t){var i={dbId:t.dbId,fieldName:t.fieldName,fieldValue:t.fieldValue,nodeName:t.nodeName};a.push(i),n<e.limit&&(l.push(i),n++)});var c=o.resultCollection.getMetaInfo(s);t.push({id:c.guid,name:c.name,results:a,moreResults:r.length>e.limit}),i.push({id:c.guid,name:c.name,results:l,moreResults:a.length>e.limit})}),e.resultsCopy=t,{page:1,results:i,resultCount:o.resultCollection.getResultCount()}}function t(e,t,i,n){var o,r,s;if(t.displayName)o=t.displayName;else{if(!(r=t.nodeName)&&e.currentGeometry===n){var a=e.viewer.model.getData();a&&a.instanceTree&&(r=a.instanceTree.getNodeName(t.dbId))}r||(r=i.viewerProperties.defaultNodeName()),r.indexOf(i.searchedString)>=0||t.hasOwnProperty("fieldName")&&"Name"===t.fieldName?o=i.viewerProperties.highlightText(r,i.searchedString):(s="[object Number]"===Object.prototype.toString.call(t.fieldValue)?String(t.fieldValue):t.fieldValue,o=i.viewerProperties.highlightText(r)+" ("+i.viewerProperties.highlightText(t.fieldName)+": "+i.viewerProperties.highlightText(s,i.searchedString)+")")}return o}function i(e,i,n,o,r){var s,a=document.createElement("li");s=t(e,n,e.controller,r),e.currentGeometry===r&&n.dbId===e.selectedNodeId&&(e.selectedNode=a),a.className="item-result dbId_"+n.dbId,a.innerHTML=s,a.setAttribute("adskSearchGeoGuid",r),a.setAttribute("adskSearchDbId",n.dbId),a.setAttribute("adskSearchIndex",o),i.appendChild(a)}function n(e,t,i){var n;t&&t.children.length&&(t.lastChild.className.contains("more-items")||((n=document.createElement("li")).className="item-result more-items",n.textContent=g.i18n.translate("Load More"),n.addEventListener("click",function(t){e.qsApi.logLoadMoreClickEvent(i,"thisItem"),e.loadMoreItems(i,t)},!1),t.appendChild(n)))}function o(e,t,n){var o,r,s=0,a=0,l=e.geoPages;if(o=document.createElement("ul"),o.className="geometry-result-list",r=Math.min(t.length,e.limit),l[n]=r,n===e.currentGeometry){var c=0,u={};a=t.length,t.forEach(function(t){e.isNodeVisible(t.dbId,function(){u.hasOwnProperty(t.dbId)||(u[t.dbId]=1,s++,e.currentGeomResults.push(t),c<r&&(e.currentGeoSearchedIds.push(t.dbId),i(e,o,t,c,n),l[n]=c+1),c++)})})}else t.slice(0,r).forEach(function(t,r){n===e.currentGeometry&&e.currentGeoSearchedIds.push(t.dbId),i(e,o,t,r,n)});return{resultListDom:o,countInvisible:a-s}}function r(e,t,i){var n;return n=document.createElement("label"),n.className="geometry-name",n.setAttribute("adskGeomId",t.guid),n.setAttribute("adskGeomIndex",i),n.addEventListener("click",function(t){var i=t.currentTarget.getAttribute("adskGeomId"),n=parseInt(t.currentTarget.getAttribute("adskGeomIndex"),10);e.qsApi.logResultGeomClickEvent(n+1,i,e.currentGeometry===i,"thisItem"),e.toggleGeometry(t)},!1),n.textContent=t.name,n}function s(e,t,i){var n;return n=document.createElement("div"),n.className="geometry-results geometry_"+t.guid,n.className=n.className+(i>3?" collapsed":""),t.guid===e.currentGeometry&&(n.classList.add("hidden"),n.setAttribute("adskCheckedForVisibleNodes",!0)),n}function a(e,t,i,n,a,l){var c,u,h,d,p=e.controller,g=n.guid;return h=o(e,i,g),d=h.resultListDom,u=r(e,n,a),c=s(e,n,p.geometriesCount),g===e.currentGeometry&&d.children.length>0&&c.className.indexOf("hidden")>=0&&c.classList.remove("hidden"),p.bruteSearch&&a<p.geometriesCount-1?t.insertBefore(c,t.childNodes[a]):t.appendChild(c),c.appendChild(u),c.appendChild(d),e.geometriesContainer[g]=c,l-=h.countInvisible}function l(e,t){var i,n,o;t&&(i=t.getAttribute("term"),n=t.getAttribute("ctx"),o=(o=(o=(o=g.i18n.translate("Results Count")).split("{0}").join(e)).split("{1}").join(i)).split("{2}").join(n),t.textContent=o)}function c(e,t,i,o,r,s,c,u){var h,d,p,m,v=r.guid;t.textContent="",(p=document.createElement("div")).id="result-count-this-item-wrapper",p.className="result-count",d=g.i18n.translate("Results Count").split("{0}").join(s).split("{1}").join(i).split("{2}").join(e.options.relatedItemsTab.displayName),(h=document.createElement("span")).id="result-count-this-item",h.setAttribute("term",i),h.setAttribute("ctx",e.options.relatedItemsTab.displayName),h.textContent=d,e.resultCountDom=h,p.appendChild(h),t.appendChild(p),(m=document.createElement("div")).className="geometries-results-container dockingPanelScroll",c||(m.className=m.className+" too-many-geometries"),t.appendChild(m);var f;s=a(e,m,o,r,u,s),e.geoPages[v]>=e.limit&&(f=e.geometriesContainer[v],o.length>e.geoPages[v]&&n(e,f.children[1],v)),e.controller.resultCollection.setResultCount(s),l(s,e.resultCountDom)}function u(e,t,o,r,s,c){var u,h,d,p,g,m=e.controller,v=r.guid;if(o&&o.length){if(e.geometriesContainer.hasOwnProperty(v)){if(e.geoPages[v]<e.limit)if(g=e.geometriesContainer[v],u=g.children[1],h=o.length,d=e.geoPages[v],p=0,d>0&&(p=d),h>e.limit?(e.geoPages[v]=e.limit,h=e.limit):e.geoPages[v]=e.geoPages[v]+(h-d),v===e.currentGeometry){var f=0,E={};o.forEach(function(t){s--,e.isNodeVisible(t.dbId,function(){E.hasOwnProperty(t.dbId)||(g.className.indexOf("hidden")>=0&&g.classList.remove("hidden"),E[t.dbId]=1,s++,e.currentGeomResults.push(t),p<=f&&f<h&&(e.currentGeoSearchedIds.push(t.dbId),i(e,u,t,f,v),e.geoPages[v]=f),f++)})})}else o.slice(p,h).forEach(function(t,n){i(e,u,t,n,v)})}else s=a(e,t,o,r,c,s);e.geoPages[v]>=e.limit&&m.resultCollection.getResultSetLength(v)>e.geoPages[v]&&(g=e.geometriesContainer[v],n(e,g.children[1],v))}e.controller.resultCollection.setResultCount(s),l(s,e.resultCountDom)}function h(e,t,i){e.innerHTML="";var n=document.createElement("p");n.className="no-results-this-item",n.textContent=g.i18n.translate("No Results").split("{0}").join(t).split("{1}").join(i),e.appendChild(n)}function d(e,t,i){function n(){var e=(new Date).getTime()-s;m.logger.log("Execution time INIT: "+e),t.logTimeEvent("initTime",e,"thisItem"),r.initialized=!0}function o(e,i){a=(new Date).getTime();var n=r.viewerProperties.areAllGeometriesLoaded();r.viewerProperties.bruteSearch(e,function(e,s,l,c){var u,h,d,p;r.lastSearchedString===e&&(r.resultCollection.setResultSetArray(s),r.searchInItemEnded=l,r.searchedString=e,r.geometriesCount++,r.bruteSearch=!0,d=new ResultCollection,o&&l&&(t.logSearchResponseTime("bruteSearchTime",e,(new Date).getTime()-a,"thisItem"),t.logSearchResults(r.resultCollection.getResultCount(),e,"bruteSearch","thisItem")),c?(p=s.getResultSetIndex(c),u=s.getResultSet(p),h=s.getMetaInfo(p),u&&d.setResultSet(h,u),i(d,n,l,c)):i(s,n,l,c))})}var r=this,s=null,a=null;r.initialized=!1,r.searchInItemEnded=!1,r.isBigModel=!1,r.bigAmountGeometries=!1,r.viewerProperties=e,r.searchedString="",r.lastSearchedString="",r.geometriesCount=0,r.bruteSearch=!1,r.resultCollection=new ResultCollection,r.initializeAttributes=function(e,t){r.initialized=!1,r.isBigModel?(m.logger.log("Using Brute Force in This Item"),n(),t()):(m.logger.log("Using Fullproof in This Item"),r.viewerProperties.getGeometriesAttributes(function(){n(),t()}))},r.initialize=function(e){s=(new Date).getTime();var t=function(t,i,o){if(r.loadingGeom=t,r.bigAmountGeometries=o,r.isBigModel=r.viewerProperties.hasTooManyNodes(),1===r.viewerProperties.getTotalCountGeometries())return n(),void e();i&&r.initializeAttributes(t,function(){o||e()}),o&&e()};r.viewerProperties.initPropertyDatabases(!i,t)},r.doSearch=function(e,i){if(r.resultCollection.resetResultCollection(),r.searchInItemEnded=!1,r.lastSearchedString=e,r.geometriesCount=0,r.bruteSearch=!1,r.isBigModel=r.viewerProperties.hasTooManyNodes(),r.isBigModel||!r.initialized)m.logger.log("Using Brute Force in This Item"),o(e,i);else{m.logger.log("Using Fullproof in This Item");var n=+new Date,s=r.viewerProperties.areAllGeometriesLoaded();r.viewerProperties.doSearch(e,function(e,o,a){r.lastSearchedString===e&&(r.resultCollection.copyResultCollection(o),r.searchInItemEnded=a,r.searchedString=e,r.geometriesCount=o.getResultSetArrayLength(),a&&(t.logSearchResponseTime("searchTime",e,new Date-n,"thisItem"),t.logSearchResults(r.resultCollection.getResultCount(),e,"fullproof-StringSearch","thisItem")),i(o,s,a))})}}}var p,g=Autodesk.Viewing,m=Autodesk.Viewing.Private,v=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");v.InViewerSearchThisItem=function(e,t,i){p=this,this.viewer=e,this.options=t,this.container=null,this.initialized=!1,this.controller=null,this.qsApi=null,this.searchString=null,this.geoPages={},this.currentGeometry=null,this.limit=t.relatedItemsTab.pageSize,this.clicked=null,this.cacheObj=i,this.loading=null,this.stillLoadingAlertElemId="this-item-loading-alert",this.stillLoadingAlertElem=null,this.geometriesContainer={},this.resultCountDom=null,this.currentGeoSearchedIds=[],this.selectedNode=null,this.selectedNodeId=null,this.highlightNodeInViewer=null,this.enabled=!0,this.isNodeVisible=null,this.currentGeomResults=[],this.listeners=[]},v.InViewerSearchThisItem.prototype.constructor=v.InViewerSearchThisItem,v.InViewerSearchThisItem.prototype.initialize=function(e,t,i,n,o,r,s){var a=this;this.qsApi=e,this.highlightNodeInViewer=o,this.currentGeometry=i,this.isNodeVisible=r,this.options.uiEnabled&&(this.container=n,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler)),this.controller=new d(t,e,this.options.loadedModelTab.enabled),this.controller.initialize(function(){a.initialized=!0,s(),a.listeners&&a.listeners.length&&(a.listeners.forEach(function(e){e()}),a.listeners=[])})},v.InViewerSearchThisItem.prototype.uninitialize=function(){this.options.uiEnabled&&this.container.removeEventListener("click",this.clickHandler),this.controller&&(this.controller=null)};var f=function(e){var t,i,n,o=e.target,r=!1;if(p.enabled){for(;o&&this.container!==o&&!r;)(r=o.hasAttribute("adskSearchDbId"))||(o=o.parentNode);r&&(t=o.getAttribute("adskSearchGeoGuid"),i=parseInt(o.getAttribute("adskSearchDbId"),10),n=parseInt(o.getAttribute("adskSearchIndex"),10),"click"===e.type?p.currentGeometry===t?setTimeout(function(){p.qsApi.logResultClickEvent(n+1,i,!0,"thisItem"),p.selectNode(o,i)},0):p.loadGeometryInViewer(t,i,n,o):"dblclick"===e.type?p.currentGeometry===t&&setTimeout(function(){p.selectNode(o,i),p.viewer.fitToView()},0):e.type)}};v.InViewerSearchThisItem.prototype.clickHandler=function(e){e&&(p.mouseClickTimeout&&(clearTimeout(p.mouseClickTimeout),p.mouseClickTimeout=null),p.mouseClickTimeout=setTimeout(function(){f.call(p,e)},200))},v.InViewerSearchThisItem.prototype.selectNode=function(e,t){this.selectedNode&&(this.selectedNode.classList.remove("selected"),this.selectedNode=null),this.selectedNodeId===t?(this.selectedNodeId=null,this.selectedNode=null):(this.selectedNodeId=t,this.selectedNode=e,e.classList.add("selected")),this.highlightNodeInViewer(this.selectedNodeId,this.currentGeoSearchedIds,this.selectedNodeId,!1)},v.InViewerSearchThisItem.prototype.toggleLoadingMessage=function(e){var t,i=this.loading;e&&!i?((i=document.createElement("div")).className="loading this-item-loading",(t=document.createElement("span")).textContent=g.i18n.translate("Loading"),i.appendChild(t),this.container.appendChild(i),this.loading=i):!e&&i&&(i.parentNode&&i.parentNode.removeChild(i),this.loading=null)},v.InViewerSearchThisItem.prototype.search=function(t,i){var n=this,o=(n.controller,t.trim());if(!this.initialized){var r=function(){n.search(t,i)};return void this.listeners.push(r)}this.clearSearch(),o&&(this.searchString=o,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.doSearch(o,function(t,r,s,a){if(n.options.uiEnabled)n.showResults(o,t,r,a);else if(s){var l=e(n);i(l)}}))},v.InViewerSearchThisItem.prototype.loadGeometryInViewer=function(e,t,i,n){var o=this.cacheObj,r=this.controller.viewerProperties.getGeometry(e),s=r?r.data:{guid:e};this.selectedNode&&this.selectedNode.classList.remove("selected"),this.selectedNode=n,this.selectedNodeId=t,this.viewer.getPropertyPanel().setVisible(!1),this.qsApi.logResultClickEvent(i+1,t,!1,"thisItem"),o.searchInfoThisItem={node:t,str:this.searchString};var a=function(){m.logger.error("Error loading geometry")},l=function(){m.logger.log("success loading geometry")};this.enabled=!1,this.viewer.fireEvent({type:g.LOAD_GEOMETRY_EVENT,data:{item:s,onSuccessCb:l,onErrorCb:a}})},v.InViewerSearchThisItem.prototype.toggleGeometry=function(e){-1===e.target.parentElement.className.indexOf("collapsed")?e.target.parentElement.classList.add("collapsed"):e.target.parentElement.classList.remove("collapsed")},v.InViewerSearchThisItem.prototype.showResults=function(e,t,i,n){var o,r,s,a,l=this.controller,d=this,p=d.container,m=p.children.length>1,v=this.stillLoadingAlertElem,f=null;t&&t.getResultSetArrayLength()?(s=l.viewerProperties.getSortedGeometries(),l.viewerProperties.prepHighlighter(e),d.toggleLoadingMessage(!1),s.forEach(function(n){(o=t.getResultSetIndex(n.guid))>=0&&(r=l.resultCollection.getResultCount(),a=t.getResultSet(o),m?(f=p.children[1],u(d,f,a,n,r,o,l.bruteSearch)):(c(d,p,e,a,n,r,i,o,l.bruteSearch),m=!0))})):l.searchInItemEnded&&(d.toggleLoadingMessage(!1),h(p,e,d.options.relatedItemsTab.displayName)),i||!l.searchInItemEnded||v||((v=document.createElement("div")).id=d.stillLoadingAlertElemId,v.className="alert-geometries-loading",v.textContent=g.i18n.translate("Geometries Loading"),this.stillLoadingAlertElem=v,p.appendChild(v))},v.InViewerSearchThisItem.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.innerHTML="",this.geometriesContainer={},this.stillLoadingAlertElem=null,this.resultCountDom=null,this.currentGeoSearchedIds=[]),this.geoPages={},this.currentGeomResults=[],this.toggleLoadingMessage(!1)},v.InViewerSearchThisItem.prototype.getPage=function(e,t,i){var n,o,r,s,a,l,c=this.controller,u=this;if(!this.initialized){var h=function(){u.getPage(e,t,i)};return void this.listeners.push(h)}if(t<1)return a={message:"Invalid page number, it must be a positive number."},void i(a);var d=u.limit*(t-1);if(s={id:"",name:"",results:[],moreResults:!1},e){if(!(n=u.resultsCopy[c.resultCollection.getResultSetIndex(e)]))return a={page:t,results:[],message:"The geometry "+e+" doesn't exists."},void i(a);r=(o=n.results).slice(d,d+u.limit),s={id:n.guid,name:n.name,results:r,moreResults:o.length>d+u.limit},a={page:t,results:[s],resultCount:c.resultCollection.getResultCount()}}else l=u.resultsCopy.map(function(e){return{id:e.id,name:e.name,results:e.results.slice(d,d+u.limit),moreResults:e.results.length>d+u.limit}}),a={page:t,results:l,resultCount:c.resultCollection.getResultCount()};i(a)},v.InViewerSearchThisItem.prototype.loadMoreItems=function(e,t){var o,r,s,a,l,c=this.controller,u=this,h=u.geoPages[e],d=h;o=c.resultCollection.getResultSet(e),e===this.currentGeometry&&(o=u.currentGeomResults),r=o.slice(h,h+u.limit),u.geoPages[e]=u.geoPages[e]+u.limit,s=this.geometriesContainer[e],a=s.children[1],t.target.parentNode.removeChild(t.target),l=o.length>u.geoPages[e],r.forEach(function(t){u.currentGeoSearchedIds.push(t.dbId),i(u,a,t,d,e),d++}),l&&n(u,a,e),r.length&&u.highlightNodeInViewer(u.selectedNodeId,u.currentGeoSearchedIds,u.selectedNodeId,!1)},v.InViewerSearchThisItem.prototype.updateCurrentGeometry=function(e){var t=this.controller,o=this;this.currentGeometry=e;var r=this.selectedNodeId;this.geoPages[this.currentGeometry]=0;var s=t.resultCollection.getResultSet(this.currentGeometry),a=t.resultCollection.getResultCount();this.currentGeomResults=[],this.currentGeoSearchedIds=[];var c={},u=0,h=this.geometriesContainer[this.currentGeometry],d=!h.hasAttribute("adskCheckedForVisibleNodes");if(h&&d){var p=h.children[1];p.innerHTML="",s&&s.length&&s.forEach(function(e){a--,o.isNodeVisible(e.dbId,function(){c.hasOwnProperty(e.dbId)||(c[e.dbId]=1,a++,o.currentGeomResults.push(e),u<o.limit&&(o.currentGeoSearchedIds.push(e.dbId),i(o,p,e,u,o.currentGeometry),o.geoPages[o.currentGeometry]=u),u++)})}),o.currentGeomResults.length||h.classList.add("hidden"),h.setAttribute("adskCheckedForVisibleNodes",!0),console.log("count "+a),t.resultCollection.setResultCount(a),l(a,o.resultCountDom),o.currentGeomResults.length>o.limit&&n(o,p,this.currentGeometry),this.selectedNodeId=null,this.selectNode(this.selectedNode,r),this.enabled=!0}else this.selectedNodeId=null,this.selectNode(this.selectedNode,r),this.enabled=!0;this.cacheObj.searchInfoThisItem=null}}(),function(){"use strict";function e(e,t,i,n){var o=e,r=/^https?:\/\//i;try{n?o=n(i):i.url&&(0===i.url.search(r)?o=i.url:(o=t+"/"+i.url,o=o.replace(/([^:]\/)\/+/g,"$1")))}catch(e){o=null}return o||e}function t(e,t,i){var o,r;e.textContent="",(r=document.createElement("p")).className="no-results-this-project",o=(o=(o=n.i18n.translate("No Results")).split("{0}").join(t)).split("{1}").join(i),r.textContent=o,e.appendChild(r)}function i(e){function t(t,i){var n=[];t&&(t.forEach(function(t){var i;t.suggestionCount>0&&(i={modifier:t.modifier,name:t.displayName,categoryResults:[],moreItems:t.suggestionCount>3},t.suggestions.forEach(function(t){var n={name:e.sanitizeAndHighlightString(t.title,"<b>","</b>"),logClick:t.logClick,url:t.url,resultData:t};i.categoryResults.push(n)}),o.count=o.count+t.suggestionCount,n.push(i),o.categoriesIndex[i.name]=n.length-1)}),o.categories=n),i(o.categories)}function i(i,n,o){i?(e.logErrorEvent("Error getting suggestions: "+i,"in_viewer_search_this_project","handleResult","thisProject"),o([])):n&&n.suggestionGroups&&t(n.suggestionGroups,o)}function n(t,i,n){var r,a,l;t?(e.logErrorEvent("Error getting more item results: "+t,"in_viewer_search_this_project","loadMoreResults","thisProject"),n(t,null,null)):i&&i.queryResults&&(r=[],l=o.categories[o.categoriesIndex[s]].categoryResults,i.queryResults.forEach(function(t){var i={name:e.sanitizeAndHighlightString(t.title,"<b>","</b>"),logClick:t.logClick,url:t.url,resultData:t};r.push(i),l.push(i)}),a=i.queryResultCount>l.length,n(null,r,a))}var o=this,r={},s="",a={};o.categories=null,o.categoriesIndex={},o.count=0,o.projectResults=null,o.search=function(t,n,s,l,c,u){1===c&&(o.categories=null,o.count=0,a={}),r={query:n,sort:s,filters:l};var h=+new Date;e.search(t,n,s,l,c,function(t,o){e.logSearchResponseTime("searchTime",n,new Date-h,"thisProject"),i(t,o,u)},"thisProject")},o.uninitialize=function(){},o.getMoreResults=function(t,i,o,l,c){var u=2;s=i,i&&a.hasOwnProperty(i.name)&&(u=a[i.name]),c&&(u=c),e.getMoreResults(t,o,r.query,r.sort,r.filters,u,function(e,t){n(e,t,l)}),c||(a[i.name]=u+1)}}var n=Autodesk.Viewing,o=Autodesk.Viewing.Private,r=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");r.InViewerSearchThisProject=function(e){this.options=e,this.initialized=!1,this.controller=null,this.qsApi=null,this.container=null,this.contextMenu=null,this.urlCb=null,this.loadingId="this-project-loading",this.listeners=[],this.searchParams=null,e&&e.serverSearchTab&&e.serverSearchTab.parameters&&(this.searchParams=e.serverSearchTab.parameters),this.loadingElementDom=null,self.categoriesContainerDom=null},r.InViewerSearchThisProject.prototype.constructor=r.InViewerSearchThisProject,r.InViewerSearchThisProject.prototype.initialize=function(e,t){var n=this,r=+new Date;this.qsApi=e,n.options&&n.options.serverSearchTab&&n.searchParams?(this.urlCb=n.searchParams.urlCallback,this.baseURL=n.searchParams.baseURL?n.searchParams.baseURL.replace(/\/$/g,""):"",this.fallbackURL=n.searchParams.fallbackURL,this.controller=new i(e),this.options.uiEnabled&&(this.container=t,window.addEventListener("click",function(){n.contextMenu&&n.contextMenu.classList.add("hidden")},!1)),e.logTimeEvent("initTime",new Date-r,"thisProject"),this.initialized=!0,this.listeners&&this.listeners.length&&(this.listeners.forEach(function(e){e()}),this.listeners=[])):o.logger.warn("Error initializing server search tab: missing options.")},r.InViewerSearchThisProject.prototype.uninitialize=function(){this.controller&&this.controller.uninitialize()},r.InViewerSearchThisProject.prototype.openMenu=function(t,i){var r,s,a,l=this.contextMenu,c=e(this.fallbackURL,this.baseURL,i,this.urlCb),u=this.container.getBoundingClientRect();i.logClick(),t.stopPropagation(),l.textContent="",c?((r=document.createElement("div")).className="menu-item open-another-window",r.innerHTML="<a href='"+c+"' target='_blank'>"+n.i18n.translate("Open Another Window")+"</a>",(s=document.createElement("div")).className="menu-item open-this-window",s.innerHTML="<a href='"+c+"' target='_self'>"+n.i18n.translate("Open This Window")+"</a>",l.appendChild(r),l.appendChild(s),(a=t.pageX-u.left+t.currentTarget.offsetLeft-10)>195&&(a-=145),l.style.top=t.pageY-7+"px",l.style.left=a+"px",l.className=l.className.replace(" hidden","")):o.logger.warn("The url for "+i.name+" is empty")},r.InViewerSearchThisProject.prototype.toggleCategory=function(e){-1===e.target.parentElement.className.indexOf("collapsed")?e.target.parentElement.classList.add("collapsed"):e.target.parentElement.classList.remove("collapsed")},r.InViewerSearchThisProject.prototype.toggleLoadingMessage=function(e){var t=this.loadingElementDom;e&&!t?((t=document.createElement("div")).id=this.loadingId,t.className="loading",t.innerHTML="<span>"+n.i18n.translate("Loading")+"</span>",this.loadingElementDom=t,this.container.appendChild(t)):!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),this.loadingElementDom=null)},r.InViewerSearchThisProject.prototype.loadMoreItems=function(e,t){var i=this,n=this.controller,o=e.target.parentElement;this.toggleLoadingMessage(!0),n.getMoreResults(this.searchParams.pid,t.name,t.modifier,function(t,n,r){var s;r||e.target.parentNode.removeChild(e.target),i.toggleLoadingMessage(!1),t||(n.forEach(function(e){var t=document.createElement("li");t.innerHTML=e.name,t.className="item-result",t.addEventListener("click",function(t){i.openMenu(t,e)},!1),r?o.insertBefore(t,o.childNodes[o.childElementCount-1]):o.appendChild(t)}),(s=this.categoriesContainerDom).scrollTop=s.scrollTop+70)})},r.InViewerSearchThisProject.prototype.getPage=function(e,t,i){var n=this;if(!this.initialized){var o=function(){n.getPage(e,t,i)};return void this.listeners.push(o)}var r=this.controller;this.options.uiEnabled&&this.toggleLoadingMessage(!0),r.getMoreResults(this.searchParams.pid,e.name,e.modifier,function(e,n,o){var s={page:t,results:n,resultsCount:r.count,moreItems:o,message:e};i(s)},t)},r.InViewerSearchThisProject.prototype.showResults=function(e,i){var o,r,s,a,l=this,c=this.container,u=this.controller;this.toggleLoadingMessage(!1),c.textContent="",l.qsApi.logSearchResults(u.count,e,"elasticsearch","thisProject"),u.count>0?((o=document.createElement("div")).className="result-count",r=(r=(r=(r=n.i18n.translate("Results Count")).split("{0}").join(u.count)).split("{1}").join(e)).split("{2}").join(l.options.serverSearchTab.displayName),(s=document.createElement("span")).id="result-count-this-project",s.textContent=r,o.appendChild(s),c.appendChild(o),(a=document.createElement("div")).className="categories-results-container dockingPanelScroll",c.appendChild(a),l.categoriesContainerDom=a,l.contextMenu=document.createElement("div"),l.contextMenu.className="context-menu hidden",c.appendChild(l.contextMenu),i.forEach(function(e,t){var i,o,r,s;(i=document.createElement("div")).id="category_"+e.name,i.className="category-results",(o=document.createElement("label")).className="category-name",o.setAttribute("adskCatId",e.name),o.setAttribute("adskCatIndex",t.toString()),o.addEventListener("click",function(e){var t=e.currentTarget.getAttribute("adskCatId"),i=parseInt(e.currentTarget.getAttribute("adskCatIndex"),10);l.qsApi.logResultGeomClickEvent(i+1,t,!1,"thisProject"),l.toggleCategory(e)},!1),o.innerText=e.name,i.appendChild(o),(r=document.createElement("ul")).className="category-result-list",[].slice.call(e.categoryResults).forEach(function(e,t){var i=document.createElement("li");i.className="item-result",i.innerHTML=e.name,i.setAttribute("adskItemId",e.url),i.setAttribute("adskItemIndex",t.toString()),i.addEventListener("click",function(t){var i=t.currentTarget.getAttribute("adskItemId"),n=parseInt(t.currentTarget.getAttribute("adskItemIndex"),10);l.qsApi.logResultClickEvent(n+1,i,!1,"thisProject"),l.openMenu(t,e)},!1),r.appendChild(i)}),e.moreItems&&((s=document.createElement("li")).className="more-items item-result",s.textContent=n.i18n.translate("Load More"),s.addEventListener("click",function(t){l.qsApi.logLoadMoreClickEvent(e.name,"thisProject"),l.loadMoreItems(t,e)},!1),r.appendChild(s)),i.appendChild(r),a.appendChild(i)})):t(c,e,l.options.serverSearchTab.displayName)},r.InViewerSearchThisProject.prototype.search=function(e,t){var i=this;if(!this.initialized){var n=function(){i.search(e,t)};return void this.listeners.push(n)}var o=this.controller,r=e.trim();this.clearSearch(),this.searchParams.pid&&this.searchParams.filters?r&&(this.searchString=r,this.options.uiEnabled&&this.toggleLoadingMessage(!0),this.controller.search(this.searchParams.pid,r,"dateModifiedDescending",this.searchParams.filters,1,function(e){i.options.uiEnabled?i.showResults(r,e):t({page:1,results:e,resultCount:o.count})})):i.displayMessage("This feature has not been configured.")},r.InViewerSearchThisProject.prototype.displayMessage=function(e){var t,i;this.container&&this.options.uiEnabled&&(t=this.container,this.toggleLoadingMessage(!1),t.textContent="",(i=document.createElement("p")).className="display-message",i.textContent=e,t.appendChild(i))},r.InViewerSearchThisProject.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.textContent="",this.toggleLoadingMessage(!1))}}(),function(){"use strict";function e(e){e.nodeNotVisibleAlert&&(e.viewer.container.removeChild(e.nodeNotVisibleAlert),e.nodeNotVisibleAlert=null,clearTimeout(e.nodeNotVisibleAlertTimer))}function t(e){e.noVisibleNodesAlert&&(e.viewer.container.removeChild(e.noVisibleNodesAlert),e.noVisibleNodesAlert=null,clearTimeout(e.noVisibleNodesAlertTimer))}function i(e,t,i,n){var o=document.createElement("li");o.innerHTML=t.displayNameSanitized,o.setAttribute("adskSearchDbId",t.dbId),o.setAttribute("adskSearchIndex",n),o.className="item-result dbId_"+t.dbId,e.highlightNode===t.dbId&&(e.selectedNode=o,o.className+=" selected",e.selectNode(o,t.dbId,!0)),e.resultsDom=o,i.appendChild(o)}function n(e,t,i){var n,o;e.textContent="",o=c.i18n.translate("No Results").split("{0}").join(t).split("{1}").join(i),(n=document.createElement("p")).className="no-results-this-view",n.textContent=o,e.appendChild(n)}function o(e,t,i,n){var o,r,s;if(!(r=t.nodeName)){var a=e.viewer.model.getData();r=a&&a.instanceTree?a.instanceTree.getNodeName(t.dbId):i.viewerProperties.defaultNodeName(),t.nodeName=r}return r&&r.indexOf(n)>=0||t.hasOwnProperty("fieldName")&&"Name"===t.fieldName?s=i.viewerProperties.highlightText(r,n):t.hasOwnProperty("fieldName")&&t.hasOwnProperty("fieldValue")?(o="[object Number]"===Object.prototype.toString.call(t.fieldValue)?String(t.fieldValue):t.fieldValue,s=i.viewerProperties.highlightText(r)+" ("+i.viewerProperties.highlightText(t.fieldName)+": "+i.viewerProperties.highlightText(o,n)+")"):s=i.viewerProperties.highlightText(r),s}function r(e,t){var i,n,o,r;(r=t.resultCountDOM)&&(i=r.getAttribute("term"),n=r.getAttribute("ctx"),o=(o=(o=(o=c.i18n.translate("Results Count")).split("{0}").join(e)).split("{1}").join(i)).split("{2}").join(n),r.textContent=o)}function s(e,t,n){var s,a,l,u,h,d=e.container,p=e.controller,g=n?n.length:0,m=e.limit,v=e.offset,f=v+m;g<m&&(f=v+g),g&&(e.options.uiEnabled&&(e.toggleLoadingMessage(!1),e.resultList||(d.textContent="",(s=document.createElement("div")).className="result-count",(a=document.createElement("span")).id="result-count-this-view",a.setAttribute("term",t),a.setAttribute("ctx",e.options.loadedModelTab.displayName),l=c.i18n.translate("Results Count"),a.textContent=l.split("{0}").join(g).split("{1}").join(t).split("{2}").join(e.options.loadedModelTab.displayName),e.resultCountDOM=a,s.appendChild(a),d.appendChild(s),e.resultList=document.createElement("ul"),e.resultList.className="search-result-list dockingPanelScroll",e.resultList.addEventListener("scroll",function(){this.scrollTop>e.scrollOffset&&(e.loadMoreResults(),e.scrollOffset=e.scrollOffset+e.limitScroll)}),d.appendChild(e.resultList))),p.viewerProperties.prepHighlighter(t),n.slice(v,g).forEach(function(n,r){n.hasOwnProperty("dbId")||(n={fieldName:n.name,fieldValue:n.value,dbId:n.id,nodeName:n.nodeName}),e.isNodeVisible(n.dbId,function(){p.searchedIds.hasOwnProperty(n.dbId)||(u=o(e,n,p,t),h={displayNameSanitized:u,dbId:n.dbId,fieldName:n.fieldName,fieldValue:n.fieldValue,nodeName:n.nodeName},p.resultSetArray.push(h),p.searchResultIds.push(n.dbId),p.searchedIds[n.dbId]=1,p.resultCount++,e.options.uiEnabled&&p.resultCount<=m&&v<f&&(i(e,h,e.resultList,r),v+=1))})}),e.offset=v,e.options.uiEnabled&&r(p.resultCount,e))}function a(e,t,i){function n(){var t=(new Date).getTime()-s;u.logger.log("Execution time INIT: "+t),e.logTimeEvent("initTime",t,"thisView"),r.initialized=!0}function o(t,i){var n=(new Date).getTime(),o=function(o){r.searchEnded=!0,e.logSearchResponseTime("bruteSearchTime",t,(new Date).getTime()-n,"thisView"),e.logSearchResults(o.length,t,"bruteSearch","thisView"),i(t,o,!0)},s=function(){r.searchEnded=!0,e.logErrorEvent("LMV search bruteForceSearch failed","in_viewer_search_this_view","bruteSearch","thisView"),i(t,null,!0)};r.viewerProperties.bruteSearchCurrent(t,o,s)}var r=this,s=null;r.initialized=!1,r.searchResultIds=[],r.searchedIds={},r.resultCount=0,r.resultSetArray=[],r.searchEnded=null,r.viewerProperties=t,r.isBigModel=!1,r.isSharedPropertyDb=!1,r.currentGeometry=i,r.initializeAllAttributes=function(e){s=(new Date).getTime(),r.isBigModel=r.viewerProperties.hasTooManyNodes(!0),r.currentGeometry||(r.isBigModel=!0),r.isBigModel?(u.logger.log("Using Brute Force in This View"),n(),e()):(u.logger.log("Using Fullproof in This View"),r.viewerProperties.getCurrentGeometryAttributes(function(){n(),e()}))},r.doSearch=function(t,i){var n;r.searchResultIds=[],r.searchedIds={},r.resultCount=0,r.resultSetArray=[],r.searchEnded=!1,r.isBigModel?o(t,i):(n=(new Date).getTime(),r.viewerProperties.doSearch(t,function(t,o,s){var a=[];o.getResultCount()&&o.hasResultSet(r.currentGeometry)&&(a=o.getResultSet(r.currentGeometry)),i(t,a,s),s&&(e.logSearchResponseTime("searchTime",t,(new Date).getTime()-n,"thisView"),e.logSearchResults(r.resultCount.length,t,"fullproof-StringSearch","thisView"))}))}}var l,c=Autodesk.Viewing,u=Autodesk.Viewing.Private,h=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");h.InViewerSearchThisView=function(e,t){l=this,this.options=t,this.viewer=e,this.container=null,this.initialized=!1,this.controller=null,this.resultList=null,this.clicked=null,this.is2DMode=null,this.qsApi=null,this.searchString=null,this.highlightNode=null,this.scrollOffset=500,this.limitScroll=200,this.limit=t.loadedModelTab.pageSize,this.offset=0,this.mouseClickTimeout=null,this.loadingId="this-view-loading",this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.highlightNodeInViewer=null,this.fittedToView=!1,this.isNodeVisible=null,this.listeners=[]},h.InViewerSearchThisView.prototype.constructor=h.InViewerSearchThisView,h.InViewerSearchThisView.prototype.initialize=function(i,n,o,r,s,l,c,u){var h=this;this.qsApi=i,this.highlightNodeInViewer=l,this.is2DMode=r,this.isNodeVisible=c,this.options.uiEnabled&&(this.container=s,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler),this.container.addEventListener("hover",this.clickHandler),window.addEventListener("click",function(){e(h),t(h)},!1)),this.controller=new a(i,n,o),this.controller.initializeAllAttributes(function(){h.initialized=!0,u(),h.listeners&&h.listeners.length&&(h.listeners.forEach(function(e){e()}),h.listeners=[])})},h.InViewerSearchThisView.prototype.uninitialize=function(){this.options.uiEnabled&&(this.container.removeEventListener("click",this.clickHandler),this.container.removeEventListener("dblclick",this.clickHandler),this.container.removeEventListener("hover",this.clickHandler)),this.controller&&(this.controller=null)};var d=function(e){for(var t,i,n=e.target,o=!1;n&&this.container!==n&&!o;)(o=n.hasAttribute("adskSearchDbId"))||(n=n.parentNode);o&&(t=parseInt(n.getAttribute("adskSearchDbId"),10),i=parseInt(n.getAttribute("adskSearchIndex"),10),"click"===e.type?setTimeout(function(){l.showNodeProperties(e,t,i)},0):"dblclick"===e.type?setTimeout(function(){l.showNodeProperties(e,t,i,!0),l.viewer.fitToView()},0):"hover"===e.type&&l.viewer.impl.rolloverObjectNode(t))};h.InViewerSearchThisView.prototype.clickHandler=function(e){e&&(clearTimeout(l.mouseClickTimeout),l.mouseClickTimeout=setTimeout(function(){d.call(l,e)},200))},h.InViewerSearchThisView.prototype.search=function(e,t,i){var n=this;if(!this.initialized){var o=function(){n.search(e,t,i)};return void this.listeners.push(o)}var r=this.controller,a=e.trim();this.clearSearch(),a&&(this.searchString=a,n.resultList=null,this.options.uiEnabled&&(this.toggleLoadingMessage(!0),this.highlightNode=t),this.controller.doSearch(a,function(e,t,o){if(n.options.uiEnabled)n.showResults(e,t,o);else if(s(n,e,t),o){var a={page:1,results:r.resultSetArray.slice(0,n.limit),resultCount:r.resultCount,moreResults:r.resultCount>n.limit};i(a)}}))};var p=function(e,t){var i;(i=e.selectedNode)&&i.classList.remove("selected"),t&&(e.selectedNode=t,t&&t.classList.add("selected"))};h.InViewerSearchThisView.prototype.showNodeProperties=function(e,t,i,n){var o=this;this.qsApi.logResultClickEvent(i+1,t,!0,"thisView"),this.clicked===t?(this.clicked=null,this.highlightNodeInViewer(null,this.controller.searchResultIds,!!n,!1),n?p(o,e.target):p(o,null)):this.selectNode(e.target,t,!1)},h.InViewerSearchThisView.prototype.selectNode=function(e,t,i){var n,o,r,s=this,a=!1,l=this.controller;if(this.clicked=t,!e&&this.container.children.length>1)for(o=this.container.children[1].children,length=o.length,n=0,r="/\bdbId_"+t+"\b/";!a&&n<length;)o[n].className.match(r)&&(a=!0,e=o[n]),n++;this.highlightNodeInViewer(this.clicked,this.controller.searchResultIds,!0,!1),p(s,e),i&&e&&e.parentNode&&(e.parentNode.scrollTop=e.offsetTop),e||(l.searchResultIds.length?l.searchResultIds.indexOf(t)<0&&(this.clicked=null,this.showAlertNodeNotVisible()):(this.clicked=null,this.showAlertNoVisibleNodes()))},h.InViewerSearchThisView.prototype.clearSearch=function(){this.offset=0,this.scrollOffset=500,this.limitScroll=200,this.clicked=null,this.selectedNode=null,this.highlightNode=null,this.options.uiEnabled&&(this.container&&(this.container.textContent=""),this.controller&&this.controller.searchResultIds&&this.controller.searchResultIds.length>0&&(this.toggleLoadingMessage(!1),this.controller.searchResultIds=[],this.controller.resultSetArray=[],this.controller.resultCount=0,this.resultList=null),this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null,this.resultList=null)},h.InViewerSearchThisView.prototype.toggleLoadingMessage=function(e){var t=this.loadingDom;e&&!t?((t=document.createElement("div")).id=this.loadingId,t.className="loading",t.textContent=c.i18n.translate("Loading"),this.loadingDom=t,this.container.appendChild(t)):t&&(t.parentNode&&t.parentNode.removeChild(t),this.loadingDom=null)},h.InViewerSearchThisView.prototype.loadMoreResults=function(){var e,t,n=this.controller,o=this,r=this.offset,s=n.resultCount;if(s>r){for(e=r+o.limit,t=r;t<e;t++)s>t&&i(o,n.resultSetArray[t],o.resultList,t);o.offset=r+o.limit}},h.InViewerSearchThisView.prototype.getPage=function(e,t){var i=this;if(!this.initialized){var n=function(){i.getPage(e,t)};return void this.listeners.push(n)}var o,r,s=this.controller;if(e<1)return r={page:e,message:"Invalid page number, it must be a positive number.",moreResults:!1},void t(r);var a=i.limit*(e-1);if(s.resultCount<a)return r={page:e,results:[],resultCount:s.resultCount,moreResults:!1,message:"That page doesn't exists."},void t(r);o=s.resultSetArray.slice(a,a+i.limit),r={page:e,results:o,resultCount:s.resultCount,moreResults:s.resultCount>a+i.limit},t(r)},h.InViewerSearchThisView.prototype.showAlertNodeNotVisible=function(){var t=this;this.nodeNotVisibleAlert=document.createElement("div"),this.nodeNotVisibleAlert.className="alert-node-not-visible",this.nodeNotVisibleAlert.textContent=c.i18n.translate("Selected Node Result Not Visible"),this.viewer.container.appendChild(this.nodeNotVisibleAlert),this.nodeNotVisibleAlertTimer=setTimeout(function(){e(t)},7e3)},h.InViewerSearchThisView.prototype.showAlertNoVisibleNodes=function(){var e=this;this.noVisibleNodesAlert=document.createElement("div"),this.noVisibleNodesAlert.className="alert-no-visible-nodes",this.noVisibleNodesAlert.textContent=c.i18n.translate("No Visible Node Results For Geometry"),this.viewer.container.appendChild(this.noVisibleNodesAlert),this.noVisibleNodesAlertTimer=setTimeout(function(){t(e)},7e3)},h.InViewerSearchThisView.prototype.showResults=function(e,t,i){var o=this,r=this.controller,a=o.container;s(o,e,t),i&&(r.resultCount<1||!o.resultList.childNodes.length)&&(o.toggleLoadingMessage(!1),n(a,e,o.options.loadedModelTab.displayName)),i&&o.highlightNode&&(r.searchedIds.hasOwnProperty(o.highlightNode)||this.selectNode(null,o.highlightNode,!1)),r.searchResultIds&&r.searchResultIds.length&&this.highlightNodeInViewer(o.highlightNode,null,o.highlightNode,!1),i&&(r.searchedIds={}),r.searchEnded=i},h.InViewerSearchThisView.prototype.updateCurrentGeometry=function(e,t,i,n,o){var r=this.controller;this.clearSearch(),this.is2DMode=n,this.highlightNode=o;var s=r.viewerProperties.hasTooManyNodes(!0);r.isBigModel&&!s&&(r.initialized=!1,r.viewerProperties.getCurrentGeometryAttributes(function(){r.initialized=!0})),r.currentGeometry=e,r.searchResultIds=[],r.searchedIds={},r.resultCount=0,r.resultSetArray=[];var a=[];t&&t.hasResultSet(e)&&(a=t.getResultSet(e)),this.showResults(i,a,!0)}}(),function(){"use strict";function e(e){return h?(h.indexOf("autodesk")>=0?(l.token=null,l.oauth2Token=n.token.accessToken):(l.token=n.token.getAccessToken?n.token.getAccessToken():null,l.oauth2Token=null),e&&(l.clientFeatureId=r+(e?"."+e:"")),l):l}function t(e){e&&n.logger.log("InViewerSearch Extension: recieved "+e)}function i(){var e=!!window.chrome&&!!window.chrome.webstore;if(e)return"Chrome";var t=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(t)return"Opera";if("undefined"!=typeof InstallTrigger)return"Firefox";if(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0)return"Safari";var i=!!document.documentMode;return i?"Internet Explorer":i||!window.StyleMedia?(e||t)&&!!window.CSS?"Blink":"Unknown":"Edge"}var n=Autodesk.Viewing.Private,o=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),r="adsk.viewer";o.QsApiService=function(){this.qsAPI=null};var s=o.QsApiService.prototype,a={pid:"",query:"",sort:"",page:1,filters:"",language:"ENU",modifier:null},l={},c=null,u=null,h=null,d=null,p=Object.freeze({development:"apidev",staging:"apistg",production:"apiprod",autodeskstaging:"apistg",autodeskdevelopment:"apidev",autodeskproduction:"apiprod"});s.initialize=function(e,t,i,n){l={token:null,oauth2Token:null,clientId:i,sessionId:n,clientFeatureId:""},d=e,h=t.toLowerCase(),this.qsAPI=new Autodesk.Search.SearchQueryAPI(p[h])},s.generateQueryId=function(){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),u="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)})},s.search=function(t,i,o,r,s,l,u){this.qsAPI||n.logger.log("InViewerSearch Extension: QsApi not initialized"),c=i,a.pid=t,a.page=s,a.query=i,a.sort=o,a.filters=r;var h=e(u);this.qsAPI.suggest(a,h,l)},s.getMoreResults=function(t,i,o,r,s,l,u){this.qsAPI||n.logger.log("InViewerSearch Extension: QsApi not initialized"),c=o,a.pid=t,a.page=l,a.query=o,a.sort=r,a.filters=s,a.modifier=i;var h=e();this.qsAPI.query(a,h,u)},s.logEvent=function(e,i,n){this.qsAPI&&this.qsAPI.logEvent(u,i,e,n,t)},s.logInitEvent=function(t,n,o,r){var s={viewerVersion:d,id:t,modelInfo:n,url:window.location.href,browser:i(),userAgent:window.navigator.userAgent,options:o},a=e(r);this.logEvent("inViewer.initialization",a,s)},s.logGeneralEvent=function(t,i){var n="inViewer."+t,o=e(i);this.logEvent(n,o,"")},s.logTimeEvent=function(t,i,n){var o="inViewer."+t,r={};r[t+"DurationMs"]=i;var s=e(n);this.logEvent(o,s,r)},s.logSearchResponseTime=function(t,i,n,o){var r="inViewer."+t,s={queryString:i};s[t+"DurationMs"]=n;var a=e(o);this.logEvent(r,a,s)},s.logSearchResults=function(t,i,n,o){var r={resultCount:t,queryString:i,algorithm:n},s=e(o);this.logEvent("inViewer.searchResults",s,r)},s.logTabClickEvent=function(t){var i=e(t);this.logEvent("inViewer.tabClick",i,null)},s.logResultClickEvent=function(e,t,i,n){this.logResultComponentClickEvent("inViewer.resultClick",e,t,i,n)},s.logResultGeomClickEvent=function(e,t,i,n){this.logResultComponentClickEvent("inViewer.resultGeomClick",e,t,i,n)},s.logResultComponentClickEvent=function(t,i,n,o,r){var s={position:i,nodeId:n,clickedCurrentGeometry:o},a=e(r);this.logEvent(t,a,s)},s.logLoadMoreClickEvent=function(t,i){var n={id:t},o=e(i);this.logEvent("inViewer.loadMoreClick",o,n)},s.logErrorEvent=function(t,i,n,o){var r={file:i,method:n,querySource:"inViewer",message:t},s=e(o);this.logEvent("inViewer.error",s,r)},s.sanitizeAndHighlightString=function(e,t,i){return this.qsAPI.sanitizeAndHighlightString(e,t,i)}}(),function(){"use strict";function e(e){var t=null;return e?([].slice.call(e).forEach(function(e){t||(t=e.urn())&&(t=t.substr(0,t.lastIndexOf("/")+1)).indexOf("output/Resource")>0&&(t=t.substr(0,t.lastIndexOf("Resource")+9))}),t||a.logger.warn("InViewerSearch Extension: No URN found for geometry")):a.logger.warn("InViewerSearch Extension: No URN to retrieve from in getUrnFromChildren()"),t}function t(e,t){var i=e.name.toUpperCase(),n=t.name.toUpperCase();return i<n?-1:i>n?1:0}function i(e){if(!e.model)return 0;var t=e.model.getData();return t.instanceTree&&t.instanceTree.objectCount?t.instanceTree.objectCount:t.instanceTree&&t.instanceTree.children?t.instanceTree.children.length:0}function n(e){return e.replace(M,"\\$&")}function o(e,t,i){var n,o=new Uint16Array(e),r=o.length,s=[];if(r){var a="",l=Math.pow(2,16)-1;for(n=0;n<r;n+=l)n+l>r&&(l=r-n),a+=String.fromCharCode.apply(null,o.subarray(n,n+l));(s=JSON.parse(a))?t&&t(s):i&&i("buffer was invalid")}return s}function r(e){var t,i=new ResultCollection,n=e.meta?e.meta:null,r=e.resultSetIndex,s=e.results?e.results:null;return n&&Object.keys(n),Object.keys(r).forEach(function(e){t=r[e],i.setResultSet({guid:n[t].guid,name:n[t].name},o(s[t]))}),i}var s=Autodesk.Viewing,a=Autodesk.Viewing.Private,l=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");l.ViewerPropertiesService=function(){this.worker=void 0,this.viewerpropertiesworker=void 0,this.initialized=!1,this.viewer=null,this.isGeometry=!1,this.isSearchInProgress=!1,this.isSearchInProgressTimer=null,this.searchingString="",this.cbSecond=null};var c,u,h,d=l.ViewerPropertiesService.prototype,p={},g=null,m=null,v=null,f=0,E=null,A=0,y=null,T=!1,w={},b=!1,C=null,S=null,k=[],M=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,x=0;d.uninitialize=function(){void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,self.viewerpropertiesworker=void 0),this.initialized=!1},d.initialize=function(e,t,i,n,o,r,u,h){if(this.viewer=e,E=u,t)void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,this.viewerpropertiesworker=void 0);else{p={};var d=this.viewer.model.myData.acmSessionId;g=o,(m=n).forEach(function(e){e.data.guid===g&&(v=e)}),A=0,T=!!(y=h),f=n.length,a.logger.info("Number of geometries: "+f);var b=s.isNodeJS?null:"domain="+encodeURIComponent(window.location.origin);w={url:"",itemUrl:s.getItemApi(),headers:{},basePath:e.model.myData.basePath,auth:!0,viewing_url:i,queryParams:b+(d&&b?"&":"")+(d?"acmsession="+d:"")},c=r,void 0===this.viewerpropertiesworker?(this.worker=l.WorkerUtils.createPropertyWorker(),this.viewerpropertiesworker=this.worker):this.worker=this.viewerpropertiesworker,this.worker.postMessage({operation:"SET_DEBUG",enable:a.ENABLE_DEBUG,level:a.logger.level})}this.initialized=!0},d.getSortedGeometries=function(){if(k&&k.length)return k;var e=[];return m.forEach(function(t){e.push(t.data)}),k=e.sort(t)},d.initPropertyDatabases=function(t,i){var n,o=this,r=[],s=0;(h=t)||(s=1);var l=function(e){var t=e.data;if(!t.assetRequest)switch(t.operation){case"PROP_DB_CREATED":a.logger.log("Received PROP_DB_CREATED for "+t.guid+" containing "+t.objCount+" nodes"),(h||t.guid!==g)&&(A++,p[t.guid].objCount=t.objCount,A===x&&o.worker.removeEventListener("message",l),i(p,A===x,!1));break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":a.logger.info("Indexing is still on going and brute force search is in progress");break;case"GEOMETRIES_ATTR_ERR":case"GEOMETRY_ATTR_ERR":case"GEOMETRIES_ATTR_OK":case"GEOMETRY_ATTR_OK":a.logger.info("Indexing is still on going");break;default:a.logger.warn("Received unexpected event, "+t.operation+", for "+t.str)}};y?(m.forEach(function(e){n=e.data.guid,A<300&&(p.hasOwnProperty(n)||(p[n]={geometry:e.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),A++,x++)}),i(p,f>1,!1)):(m.forEach(function(t){var i,n=t.data.guid;(h||n!==g)&&s<300&&(p.hasOwnProperty(n)||(p[n]={geometry:t.data},i=e(t.children),r.push({urn:i,geo:t.data}),s++))}),(x=r.length)?(o.worker.addEventListener("message",l),o.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:r,context:w})):i(p,!0,!1))},d.initSharedPropertyDatabase=function(e){var t=this,i="_sharedPropertyDatabase_",n=function(o){var r=o.data;if(!r.assetRequest)switch(r.operation){case"PROP_DB_CREATED":a.logger.log("Received PROP_DB_CREATED for "+r.guid+" containing "+r.objCount),r.guid===i&&(p[i].objCount=r.objCount,p[i].loading=!1,t.worker.removeEventListener("message",n),p[i].sharedDbInit&&p[i].sharedDbInit(),e());break;default:a.logger.warn("Received unexpected event, "+r.operation+", for "+r.str)}};p.hasOwnProperty(i)?p[i].loading?p[i].sharedDbInit=e:e():(p[i]={isShared:!0,loading:!0},p[g]={isShared:!0,geometry:v.data},t.worker.addEventListener("message",n),t.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:y,geo:{guid:i}}],context:w}))},d.initCurrentPropertyDatabase=function(t,i){var n,o,r=this;if(y)this.initSharedPropertyDatabase(function(){var e=v;p.hasOwnProperty(t)||(p[t]={geometry:e.data,hasSharedProperties:!0,objCount:0,propdb_loaded:!0}),i()});else{var s=function(e){var t=e.data;if(!t.assetRequest)switch(t.operation){case"PROP_DB_CREATED":p[t.guid].objCount=t.objCount,t.guid===g&&(A++,x++,r.worker.removeEventListener("message",s),i());break;default:a.logger.warn("An unexpected message was received: "+t.operation)}};p.hasOwnProperty(t)?i():(n=v||{},p[g]={geometry:n.data,propdb_loaded:!0},o=e(n.children),r.worker.addEventListener("message",s),r.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:o,geo:n.data}],context:w}))}},d.getCurrentGeometryAttributes=function(e){var t=this;p.hasOwnProperty(g)&&p[g].propdb_loaded||this.initCurrentPropertyDatabase(g,function(){t.getGeometryAttributes(g,function(){e()})})},d.getGeometryAttributes=function(e,t){var i=this,n=function(o){var r=o.data;switch(r.operation){case"GEOMETRY_ATTR_OK":i.worker.removeEventListener("message",n),t();break;case"GEOMETRY_ATTR_ERR":i.worker.removeEventListener("message",n),a.logger.warn("InViewerSearch Extension: No attributes found for: "+e),t();break;default:a.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(r.operation||"")+" Error: "+(r.error||"")+" Place: "+(r.place||"")+" Method: "+(r.method||""))}};this.worker.addEventListener("message",n),this.worker.postMessage({operation:"GEOMETRY_ATTR",guid:e,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:T})},d.getGeometriesAttributes=function(e){var t=this,i=function(n){var o=n.data;switch(o.operation){case"GEOMETRIES_ATTR_OK":e(),t.worker.removeEventListener("message",i);break;case"GEOMETRIES_ATTR_ERR":a.logger.info("InViewerSearch Extension: No attributes found for: "+o.geometry.guid),o.ended&&(e(),t.worker.removeEventListener("message",i));break;default:a.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(o.operation||"")+" Error: "+(o.error||"")+" Place: "+(o.place||"")+" Method: "+(o.method||""))}};!h&&T?e({},T,!0):(this.worker.addEventListener("message",i),this.worker.postMessage({operation:"GEOMETRIES_ATTR",sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:T,loadAll:h}))},d.getGeometry=function(e){var t=null;return m.forEach(function(i){i.data.guid===e&&(t=i)}),t},d.orderGeometriesByName=function(e){var t=[];return this.getSortedGeometries().forEach(function(i){e.hasResultSet(i.guid)&&t.push(e.getResultSetArray(i.guid))}),t},d.getTotalCountGeometries=function(){return f>300?300:f},d.areMoreGeometriesToLoad=function(){return f>300},d.areAllGeometriesLoaded=function(){return A===x},d.updateCurrentGeometry=function(e,t){g=e;var i=this,n=function(e){var o,s=e.data;switch(s.operation){case"UPDATE_CURRENT_OK":i.worker.removeEventListener("message",n),o=r(s),t(s.str,o,s.ended);break;default:a.logger.warn("Received unexpected event, "+s.operation+", for "+s.str)}};this.worker.addEventListener("message",n),this.worker.postMessage({operation:"UPDATE_CURRENT",current:g})},d.hasTooManyNodes=function(e){var t=i(this.viewer);if(!T&&!e){if(this.getTotalCountGeometries()>100)return!0;Object.keys(p).forEach(function(e){e!==g&&p[e].objCount&&(t+=p[e].objCount)})}return a.logger.log("Total number of nodes in model: "+t),c<t},d.bruteSearchCurrent=function(e,t,i){var n=function(e){b=!1,t(e),C&&(C(e),C=null)},o=function(){b=!1,a.logger.warn("A call to viewer native search failed for query string: "+e),i(),S&&S()};if(g&&!p.hasOwnProperty(g)){A++,x++;var r=v||{};p[g]={geometry:r.data}}b?(C=t,S=i):(b=!0,this.viewer.search(e,n,o,[],!0))},d.bruteSearch=function(e,t){var i=this,n=this.getSortedGeometries(),o=function(e){var n,s=e.data;switch(s.operation){case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":n=r(s),i.cbSecond&&i.cbSecond(s.str,n,s.ended),t(s.str,n,s.ended,s.geometry),s.ended&&(i.worker.removeEventListener("message",o),i.cbSecond=null,i.isSearchInProgress=!1,i.searchingString=null,a.logger.debug("The last "+s.operation+" messgage received for query '"+s.str+"' Ready for another search"));break;case"PROP_DB_CREATED":a.logger.log("Property DB is created. Passing the message through.");break;default:a.logger.warn("Received unexpected event, "+s.operation+", for "+s.str)}},s=function(t){var o={geometry:g,results:t};i.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:e,results:o,sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:T,geometries:n})},l=function(){i.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:e,results:{geometry:g,results:[]},sharedPropDbKey:"_sharedPropertyDatabase_",isSharedPropertyDb:T,geometries:n})};this.worker.addEventListener("message",o),this.bruteSearchCurrent(e,s,l),T||this.worker.postMessage({operation:"BRUTE_SEARCH",str:e,currentGeo:g,geometries:n})},d.highlightText=function(e,t){return"[object String]"!==Object.prototype.toString.call(e)&&a.logger.warn("Error: Non-string sent to highlightText(). Check type, and if correct, convert to String() first."),t?e.replace(u,'<span class="bolder">$1</span>'):e},d.prepHighlighter=function(e){u=new RegExp("("+n(e)+")","gi")},d.doSearch=function(e,t){var i,n=this,o=function(e){var i,s=e.data;switch(s.operation){case"SEARCH_RESULT":i=r(s),n.cbSecond&&n.cbSecond(s.str,i,s.ended),t(s.str,i,s.ended),s.ended&&(n.worker.removeEventListener("message",o),n.cbSecond=null,n.isSearchInProgress=!1,n.searchingString=null,a.logger.debug("The last "+s.operation+" messgage received for query '"+s.str+"' Ready for another search"));break;case"OLD_SEARCH_RESULT":n.worker.removeEventListener("message",o),n.isSearchInProgress=!1;break;case"PROCESS_BRUTE_SEARCH_OK":case"BRUTE_SEARCH_OK":a.logger.info("Indexing is still building and brute force search is in progress");break;default:a.logger.warn("Received unexpected event, "+s.operation+", for "+s.str)}};clearTimeout(n.isSearchInProgressTimer),!0===n.isSearchInProgress?e===n.searchingString?n.cbSecond=t:n.isSearchInProgressTimer=setTimeout(function(){n.doSearch(e,t)},100):(T&&(i={},Object.keys(p).forEach(function(e){"_sharedPropertyDatabase_"!==e&&(i[e]={guid:p[e].geometry.guid,name:p[e].geometry.name})})),a.logger.debug("Submitting a new search request for query '"+e+"'"),n.isSearchInProgress=!0,n.searchingString=e,n.worker.addEventListener("message",o),n.worker.postMessage({operation:"SEARCH",str:e,isSharedPropertyDb:T,geometries:i}))},d.defaultNodeName=function(){return"Untitled Node"}}(),ResultCollection.prototype.resetResultCollection=function(){this.partialResults=[],this.resultIDArray={},this.resultSetArray=[],this.resultArrayBufferArray=[],this.metaInfoArray=[],this.resultSetIndex={},this.resultCount=0},ResultCollection.prototype.getResultCount=function(){return this.resultCount},ResultCollection.prototype.setResultCount=function(e){this.resultCount=e},ResultCollection.prototype.getResultSetArray=function(){return this.resultSetArray},ResultCollection.prototype.recalcResultCount=function(){var e,t;for(this.resultCount=0,t=this.resultSetArray.length,e=0;e<t;e++)this.resultCount+=this.resultSetArray[e].length},ResultCollection.prototype.getResultSetIndex=function(e){return this.resultSetIndex.hasOwnProperty(e)?this.resultSetIndex[e]:-1},ResultCollection.prototype.hasResult=function(e,t){return!(!this.resultIDArray.hasOwnProperty(e)||this.resultIDArray[e].indexOf(t)<0)},ResultCollection.prototype.trackResult=function(e,t){return this.resultIDArray.hasOwnProperty(e)?!(this.resultIDArray[e].indexOf(t)>=0)&&(this.resultIDArray[e].push(t),!0):(this.resultIDArray[e]=[],this.resultIDArray[e].push(t),!0)},ResultCollection.prototype.getResultSetIndexArray=function(){return this.resultSetIndex},ResultCollection.prototype.addResult=function(e,t,i){return!!this.trackResult(e.guid,t)&&(this.resultSetIndex.hasOwnProperty(e.guid)?(this.resultSetArray[this.resultSetIndex[e.guid]].push(i),this.resultCount++):this.setResultSet({guid:e.guid,name:e.name},[i]),!0)},ResultCollection.prototype.setResultSet=function(e,t){e&&e.guid&&(this.resultSetIndex.hasOwnProperty(e.guid)?this.resultSetArray[this.resultSetIndex(e.guid)]=t:(this.metaInfoArray.push(e),this.resultSetArray.push(t),this.resultSetIndex[e.guid]=this.resultSetArray.length-1),this.recalcResultCount())},ResultCollection.prototype.replaceResultSet=function(e,t){return!(this.resultSetArray.length<=e||!t)&&(this.resultSetArray[e]=t,this.recalcResultCount(),!0)},ResultCollection.prototype.getResultSet=function(e){if("number"==typeof e){if(!this.resultSetArray||this.resultSetArray.length<=e)return null}else{if("string"!=typeof e)return null;if((e=this.getResultSetIndex(e))<0)return null}return this.resultSetArray[e]},ResultCollection.prototype.hasResultSet=function(e){if("number"==typeof e){if(!this.resultSetArray||this.resultSetArray.length<=e)return!1}else{if("string"!=typeof e)return!1;if((e=this.getResultSetIndex(e))<0)return!1}return!0},ResultCollection.prototype.setResultSetArray=function(e){this.resultSetArray=e.resultSetArray,this.resultSetIndex=e.resultSetIndex,this.resultCount=e.resultCount,this.partialResults=[],this.resultIDArray={},this.resultArrayBufferArray=[],this.metaInfoArray=[]},ResultCollection.prototype.getMetaInfo=function(e){return this.metaInfoArray.length<=e?null:this.metaInfoArray[e]},ResultCollection.prototype.getMetaInfo=function(e){return"number"!=typeof e?null:!this.metaInfoArray||this.metaInfoArray.length<=e?null:this.metaInfoArray[e]},ResultCollection.prototype.getMetaInfoArray=function(){return this.metaInfoArray},ResultCollection.prototype.getResultArrayBuffer=function(e){return this.resultArrayBufferArray.length<=e?null:this.resultArrayBufferArray[e]},ResultCollection.prototype.addResultArrayBuffer=function(e){return this.resultArrayBufferArray.push(e)},ResultCollection.prototype.getResultArrayBufferArray=function(){return this.resultArrayBufferArray},ResultCollection.prototype.getResultSetLength=function(e){if("number"==typeof e){if(!this.resultSetArray||this.resultSetArray.length<=e)return-1}else{if("string"!=typeof e)return-1;if((e=this.getResultSetIndex(e))<0)return-1}return this.resultSetArray[e].length},ResultCollection.prototype.getResultSetArrayLength=function(){return this.resultSetArray?this.resultSetArray.length:0},ResultCollection.prototype.getMetaInfoArrayLength=function(){return this.metaInfoArray?this.metaInfoArray.length:0},ResultCollection.prototype.getResultArrayBufferArrayLength=function(){return this.resultArrayBufferArray?this.resultArrayBufferArray.length:0},ResultCollection.prototype.copyResultCollection=function(e,t,i){var n,o,r;if(void 0!==i&&null!==i||(i=!0),this.resultCount=e.resultCount,this.resultSetArray=e.resultSetArray,this.resultSetIndex=e.resultSetIndex,this.metaInfoArray=e.metaInfoArray,this.resultIDArray=e.resultIDArray,t)for(this.resultArrayBufferArray=[],e.resultArrayBufferArray=[],n=e.getResultSetArrayLength(),o=0;o<n;o++)r=this.arrayToArrayBuffer(this.resultSetArray[o],!0),e.addResultArrayBuffer(r.arrayBuffer),this.addResultArrayBuffer(r.arrayBufferStore);if(!t&&i)for(this.resultArrayBufferArray=[],n=this.getResultSetArrayLength(),o=0;o<n;o++)this.resultArrayBufferArray.push(this.arrayToArrayBuffer(this.resultSetArray[o]))},ResultCollection.prototype.arrayToArrayBuffer=function(e,t){var i,n,o,r=JSON.stringify(e),s=r.length,a=new ArrayBuffer(2*s),l=new Uint16Array(a);for(t&&(i=new ArrayBuffer(2*s),n=new Uint16Array(i)),o=0;o<s;o++)l[o]=r.charCodeAt(o),t&&(n[o]=r.charCodeAt(o));return t?{arrayBuffer:a,arrayBufferStore:i}:a},ResultCollection.prototype.copyArrayBuffer=function(e){var t,i,n,o,r;if(this.resultArrayBufferArray.length<=e)return null;for(t=this.resultArrayBufferArray[e].byteLength,i=new ArrayBuffer(t),n=new Uint16Array(this.resultArrayBufferArray[e]),o=new Uint16Array(i),r=0;r<t;r++)o[r]=n[r];return i},ResultCollection.prototype.generateArrayBufferArray=function(){var e,t,i=[];if(this.resultCount)for(e=this.getResultArrayBufferArrayLength(),t=0;t<e;t++)i.push(this.copyArrayBuffer(t));return i},ResultCollection.prototype.loadResultCollectionFromObject=function(e){this.partialResults=e.partialResults,this.resultIDArray=e.resultIDArray,this.resultSetArray=e.resultSetArray,this.resultArrayBufferArray=e.resultArrayBufferArray,this.metaInfoArray=e.metaInfoArray,this.resultSetIndex=e.resultSetIndex,this.resultCount=e.resultCount},void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(e,t,i,n,o,r,s,a){this.save(),this.translate(e,t),this.rotate(o),this.scale(i,n),this.arc(0,0,1,r,s,a),this.restore()}),"function"!=typeof Path2D&&function(){function e(e){if(this.ops_=[],void 0!=e)if("string"==typeof e)try{this.ops_=parser.parse(e)}catch(e){}else{if(!e.hasOwnProperty("ops_"))throw"Error: "+typeof e+"is not a valid argument to Path";this.ops_=e.ops_.slice(0)}}parser=function(){function e(e,t,i,n,o,r){this.message=e,this.expected=t,this.found=i,this.offset=n,this.line=o,this.column=r,this.name="SyntaxError"}function t(t){function i(e){return yt!==e&&(yt>e&&(yt=0,Tt={line:1,column:1,seenCR:!1}),function(e,i,n){var o,r;for(o=i;o<n;o++)"\n"===(r=t.charAt(o))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(Tt,yt,e),yt=e),Tt}function n(e){Et<wt||(Et>wt&&(wt=Et,bt=[]),bt.push(e))}function o(n,o,r){var s=i(r),a=r<t.length?t.charAt(r):null;return null!==o&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(o),new e(null!==n?n:function(e,t){var i,n,o,r=new Array(e.length);for(o=0;o<e.length;o++)r[o]=e[o].description;return i=e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0],n=t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input","Expected "+i+" but "+n+" found."}(o,a),o,a,r,s.line,s.column)}function r(){var e,t,i,n,o;for(e=Et,t=[],i=W();i!==he;)t.push(i),i=W();if(t!==he)if((i=s())===he&&(i=me),i!==he){for(n=[],o=W();o!==he;)n.push(o),o=W();n!==he?(At=e,e=t=ve(i)):(Et=e,e=ge)}else Et=e,e=ge;else Et=e,e=ge;return e}function s(){var e,t,i,n,o;if(e=Et,(t=a())!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he&&(o=s())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?e=t=[t,i]:(Et=e,e=ge)}else Et=e,e=ge;return e}function a(){var e,t,i,n,o;if(e=Et,(t=u())!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he&&(o=l())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?e=t=[t,i]:(Et=e,e=ge)}else Et=e,e=ge;return e}function l(){var e,t,i,n,o;if(e=Et,(t=c())!==he){for(i=Et,n=[],o=W();o!==he;)n.push(o),o=W();n!==he&&(o=l())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?e=t=[t,i]:(Et=e,e=ge)}else Et=e,e=ge;return e}function c(){var e;return(e=d())===he&&(e=p())===he&&(e=m())===he&&(e=f())===he&&(e=E())===he&&(e=T())===he&&(e=C())===he&&(e=M())===he&&(e=R()),e}function u(){var e,i,o,r;if(e=Et,fe.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(Ee)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=h())!==he?(At=e,e=i=Ae(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function h(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=g())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function d(){var e,i;return e=Et,Te.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(we)),i!==he&&(At=e,i=be()),e=i}function p(){var e,i,o,r;if(e=Et,Ce.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(Se)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=g())!==he?(At=e,e=i=ke(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function g(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=g())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function m(){var e,i,o,r;if(e=Et,Me.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(xe)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=v())!==he?(At=e,e=i=Re(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function v(){var e,t,i,n,o;return e=Et,t=N(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=v())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function f(){var e,i,o,r;if(e=Et,Pe.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(Ve)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=v())!==he?(At=e,e=i=Ie(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function E(){var e,i,o,r;if(e=Et,Ne.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(De)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=A())!==he?(At=e,e=i=Le(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function A(){var e,t,i,n,o;return e=Et,t=y(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=A())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function y(){var e,t,i,n,o,r;return e=Et,t=I(),t!==he?((i=_())===he&&(i=me),i!==he&&(n=I())!==he?((o=_())===he&&(o=me),o!==he&&(r=I())!==he?(At=e,e=t=Oe(t,n,r)):(Et=e,e=ge)):(Et=e,e=ge)):(Et=e,e=ge),e}function T(){var e,i,o,r;if(e=Et,_e.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(He)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=w())!==he?(At=e,e=i=Be(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function w(){var e,t,i,n,o;return e=Et,t=b(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=w())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function b(){var e,t,i,n;return e=Et,t=I(),t!==he?((i=_())===he&&(i=me),i!==he&&(n=I())!==he?(At=e,e=t=Fe(t,n)):(Et=e,e=ge)):(Et=e,e=ge),e}function C(){var e,i,o,r;if(e=Et,ze.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(Ue)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=S())!==he?(At=e,e=i=Ge(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function S(){var e,t,i,n,o;return e=Et,t=k(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=S())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function k(){var e,t,i,n;return e=Et,t=I(),t!==he?((i=_())===he&&(i=me),i!==he&&(n=I())!==he?(At=e,e=t=Fe(t,n)):(Et=e,e=ge)):(Et=e,e=ge),e}function M(){var e,i,o,r;if(e=Et,We.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(je)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=x())!==he?(At=e,e=i=Ye(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function x(){var e,t,i,n,o;return e=Et,t=I(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=x())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function R(){var e,i,o,r;if(e=Et,qe.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(Xe)),i!==he){for(o=[],r=W();r!==he;)o.push(r),r=W();o!==he&&(r=P())!==he?(At=e,e=i=Ke(i,r)):(Et=e,e=ge)}else Et=e,e=ge;return e}function P(){var e,t,i,n,o;return e=Et,t=V(),t!==he?(i=Et,(n=_())===he&&(n=me),n!==he&&(o=P())!==he?i=n=[n,o]:(Et=i,i=ge),i===he&&(i=me),i!==he?(At=e,e=t=ye(t,i)):(Et=e,e=ge)):(Et=e,e=ge),e}function V(){var e,t,i,n,o,r,s,a,l,c,u;return e=Et,t=D(),t!==he?((i=_())===he&&(i=me),i!==he&&(n=D())!==he?((o=_())===he&&(o=me),o!==he&&(r=L())!==he&&_()!==he&&(s=O())!==he?((a=_())===he&&(a=me),a!==he&&(l=O())!==he?((c=_())===he&&(c=me),c!==he&&(u=I())!==he?(At=e,e=t=Qe(t,n,r,s,l,u)):(Et=e,e=ge)):(Et=e,e=ge)):(Et=e,e=ge)):(Et=e,e=ge)):(Et=e,e=ge),e}function I(){var e,t,i,n;return e=Et,t=N(),t!==he?((i=_())===he&&(i=me),i!==he&&(n=N())!==he?(At=e,e=t=Ze(t,n)):(Et=e,e=ge)):(Et=e,e=ge),e}function N(){var e,t;return e=Et,(t=L())!==he&&(At=e,t=Je(t)),e=t}function D(){var e;return(e=B())===he&&(e=G()),e}function L(){var e,t,i;return e=Et,(t=U())===he&&(t=me),t!==he&&(i=B())!==he?e=t=[t,i]:(Et=e,e=ge),e===he&&(e=Et,(t=U())===he&&(t=me),t!==he&&(i=G())!==he?e=t=[t,i]:(Et=e,e=ge)),e}function O(){var e;return 48===t.charCodeAt(Et)?(e=$e,Et++):(e=he,0===Ct&&n(et)),e===he&&(49===t.charCodeAt(Et)?(e=tt,Et++):(e=he,0===Ct&&n(it))),e}function _(){var e,t,i,n,o;if(e=Et,t=[],(i=W())!==he)for(;i!==he;)t.push(i),i=W();else t=ge;if(t!==he)if((i=H())===he&&(i=me),i!==he){for(n=[],o=W();o!==he;)n.push(o),o=W();n!==he?e=t=[t,i,n]:(Et=e,e=ge)}else Et=e,e=ge;else Et=e,e=ge;if(e===he)if(e=Et,(t=H())!==he){for(i=[],n=W();n!==he;)i.push(n),n=W();i!==he?e=t=[t,i]:(Et=e,e=ge)}else Et=e,e=ge;return e}function H(){var e;return 44===t.charCodeAt(Et)?(e=nt,Et++):(e=he,0===Ct&&n(ot)),e}function B(){var e,t,i;return e=Et,t=F(),t!==he?((i=z())===he&&(i=me),i!==he?e=t=[t,i]:(Et=e,e=ge)):(Et=e,e=ge),e===he&&(e=Et,(t=G())!==he&&(i=z())!==he?e=t=[t,i]:(Et=e,e=ge)),e}function F(){var e,i,o,r;return e=Et,(i=G())===he&&(i=me),i!==he?(46===t.charCodeAt(Et)?(o=rt,Et++):(o=he,0===Ct&&n(st)),o!==he&&(r=G())!==he?e=i=[i,o,r]:(Et=e,e=ge)):(Et=e,e=ge),e===he&&(e=Et,(i=G())!==he?(46===t.charCodeAt(Et)?(o=rt,Et++):(o=he,0===Ct&&n(st)),o!==he?e=i=[i,o]:(Et=e,e=ge)):(Et=e,e=ge)),e}function z(){var e,i,o,r;return e=Et,at.test(t.charAt(Et))?(i=t.charAt(Et),Et++):(i=he,0===Ct&&n(lt)),i!==he?((o=U())===he&&(o=me),o!==he&&(r=G())!==he?e=i=[i,o,r]:(Et=e,e=ge)):(Et=e,e=ge),e}function U(){var e;return 43===t.charCodeAt(Et)?(e=ct,Et++):(e=he,0===Ct&&n(ut)),e===he&&(45===t.charCodeAt(Et)?(e=ht,Et++):(e=he,0===Ct&&n(dt))),e}function G(){var e,i,o;if(e=Et,i=[],pt.test(t.charAt(Et))?(o=t.charAt(Et),Et++):(o=he,0===Ct&&n(gt)),o!==he)for(;o!==he;)i.push(o),pt.test(t.charAt(Et))?(o=t.charAt(Et),Et++):(o=he,0===Ct&&n(gt));else i=ge;return i!==he&&(At=e,i=mt(i)),e=i}function W(){var e;return vt.test(t.charAt(Et))?(e=t.charAt(Et),Et++):(e=he,0===Ct&&n(ft)),e}function j(e,t){return-1==="mlazhvcsqt".indexOf(e)?St=t:(St[0]+=t[0],St[1]+=t[1]),Rt=e,St.slice(0)}function Y(e,t){for(var i=[],n=St.slice(0),o=0;o<t.length;o+=2){St=n.slice(0);var r=j(e,t.slice(o,o+2));i=i.concat(r),o==t.length-4&&(kt=r.slice(0))}return i}function q(){-1=="CcSsQqTt".indexOf(Rt)&&(kt=St.slice(0));var e=[0,0];return e[0]=2*St[0]-kt[0],e[1]=2*St[1]-kt[1],e}function X(e,t){var i=[t,0];return"H"==e&&(i[1]=St[1]),j(e,i)}function K(e,t){var i=[0,t];return"V"==e&&(i[0]=St[0]),j(e,i)}function Q(e,t){var i=[e];if(t&&t.length>1)for(var n=t[1],o=0;o<n.length;o++)i.push(n[o]);return i}function Z(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function J(e,t){return e[0]*t[0]+e[1]*t[1]}function $(e,t){return J(e,t)/(Z(e)*Z(t))}function ee(e,t){var i=1;return e[0]*t[1]-e[1]*t[0]<0&&(i=-1),i*Math.acos($(e,t))}function te(e,t){var i=Math.cos(t),n=Math.sin(t);return[i*e[0]+n*e[1],-1*n*e[0]+i*e[1]]}function ie(e,t){var i=Math.cos(t),n=Math.sin(t);return[i*e[0]-n*e[1],n*e[0]+i*e[1]]}function ne(e,t){return[(e[0]-t[0])/2,(e[1]-t[1])/2]}function oe(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function re(e,t){return[e[0]*t[0],e[1]*t[1]]}function se(e,t){return[e*t[0],e*t[1]]}function ae(e,t){return[e[0]+t[0],e[1]+t[1]]}function le(e,t,i,n,o,r,s){if(0!=t&&0!=i){var n=n*(Math.PI/180);t=Math.abs(t),i=Math.abs(i);var a=te(ne(e,s),n),l=re(a,a),c=Math.pow(t,2),u=Math.pow(i,2),h=Math.sqrt(l[0]/c+l[1]/u);h>1&&(t*=h,i*=h,c=Math.pow(t,2),u=Math.pow(i,2));var d=Math.sqrt((c*u-c*l[1]-u*l[0])/(c*l[1]+u*l[0]));o==r&&(d*=-1);var p=se(d,[t*a[1]/i,-i*a[0]/t]),g=ae(ie(p,n),oe(e,s)),m=[(a[0]-p[0])/t,(a[1]-p[1])/i],v=[(-1*a[0]-p[0])/t,(-1*a[1]-p[1])/i],f=ee([1,0],m),E=f,A=f+ee(m,v);Mt.push({type:"save",args:[]},{type:"translate",args:[g[0],g[1]]},{type:"rotate",args:[n]},{type:"scale",args:[t,i]},{type:"arc",args:[0,0,1,E,A,1-r]},{type:"restore",args:[]})}else Mt.push({type:"lineTo",args:s})}var ce,ue=arguments.length>1?arguments[1]:{},he={},de={svg_path:r},pe=r,ge=he,me=null,ve=function(e){return Mt},fe=/^[Mm]/,Ee={type:"class",value:"[Mm]",description:"[Mm]"},Ae=function(e,t){var i=e;xt&&(i="M",xt=!1),Mt.push({type:"moveTo",args:j(i,t[0])});for(var n=1;n<t.length;n++)Mt.push({type:"lineTo",args:j(e,t[n])})},ye=function(e,t){return Q(e,t)},Te=/^[Zz]/,we={type:"class",value:"[Zz]",description:"[Zz]"},be=function(){Mt.push({type:"closePath",args:[]})},Ce=/^[Ll]/,Se={type:"class",value:"[Ll]",description:"[Ll]"},ke=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"lineTo",args:j(e,t[i])})},Me=/^[Hh]/,xe={type:"class",value:"[Hh]",description:"[Hh]"},Re=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"lineTo",args:X(e,t[i])})},Pe=/^[Vv]/,Ve={type:"class",value:"[Vv]",description:"[Vv]"},Ie=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"lineTo",args:K(e,t[i])})},Ne=/^[Cc]/,De={type:"class",value:"[Cc]",description:"[Cc]"},Le=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"bezierCurveTo",args:Y(e,t[i])})},Oe=function(e,t,i){return e.concat(t,i)},_e=/^[Ss]/,He={type:"class",value:"[Ss]",description:"[Ss]"},Be=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"bezierCurveTo",args:q().concat(Y(e,t[i]))})},Fe=function(e,t){return e.concat(t)},ze=/^[Qq]/,Ue={type:"class",value:"[Qq]",description:"[Qq]"},Ge=function(e,t){for(var i=0;i<t.length;i++)Mt.push({type:"quadraticCurveTo",args:Y(e,t[i])})},We=/^[Tt]/,je={type:"class",value:"[Tt]",description:"[Tt]"},Ye=function(e,t){for(var i=0;i<t.length;i++){var n=q();Mt.push({type:"quadraticCurveTo",args:n.concat(Y(e,t[i]))}),kt=n.slice(0)}},qe=/^[Aa]/,Xe={type:"class",value:"[Aa]",description:"[Aa]"},Ke=function(e,t){for(var i=0;i<t.length;i++){var n=[St.slice()],o=[j(e,t[i].slice(-2))];absArgs=n.concat(t[i].slice(0,-2),o),le.apply(this,absArgs)}},Qe=function(e,t,i,n,o,r){return[parseFloat(e),parseFloat(t),parseFloat(i.join("")),parseInt(n),parseInt(o),r[0],r[1]]},Ze=function(e,t){return[e,t]},Je=function(e){return parseFloat(e.join(""))},$e="0",et={type:"literal",value:"0",description:'"0"'},tt="1",it={type:"literal",value:"1",description:'"1"'},nt=",",ot={type:"literal",value:",",description:'","'},rt=".",st={type:"literal",value:".",description:'"."'},at=/^[eE]/,lt={type:"class",value:"[eE]",description:"[eE]"},ct="+",ut={type:"literal",value:"+",description:'"+"'},ht="-",dt={type:"literal",value:"-",description:'"-"'},pt=/^[0-9]/,gt={type:"class",value:"[0-9]",description:"[0-9]"},mt=function(e){return e.join("")},vt=/^[ \t\n\r]/,ft={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},Et=0,At=0,yt=0,Tt={line:1,column:1,seenCR:!1},wt=0,bt=[],Ct=0;if("startRule"in ue){if(!(ue.startRule in de))throw new Error("Can't start parsing from rule \""+ue.startRule+'".');pe=de[ue.startRule]}var St=[0,0],kt=[0,0],Mt=[],xt=!0,Rt="";if((ce=pe())!==he&&Et===t.length)return ce;throw ce!==he&&Et<t.length&&n({type:"end",description:"end of input"}),o(null,bt,wt)}return function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(e,Error),{SyntaxError:e,parse:t}}();for(var t=["closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","rect","arc","arcTo","ellipse","isPointInPath","isPointInStroke"],i=0;i<t.length;i++){var n=t[i];e.prototype[n]=function(e){return function(){this.ops_.push({type:e,args:Array.prototype.slice.call(arguments,0)})}}(n)}e.prototype.addPath=function(e,t){var i=!1;t&&t.hasOwnProperty("a")&&t.hasOwnProperty("b")&&t.hasOwnProperty("c")&&t.hasOwnProperty("d")&&t.hasOwnProperty("e")&&t.hasOwnProperty("f")&&(i=!0,this.ops_.push({type:"save",args:[]}),this.ops_.push({type:"transform",args:[t.a,t.b,t.c,t.d,t.e,t.f]})),this.ops_=this.ops_.concat(e.ops_),i&&this.ops_.push({type:"restore",args:[]})},original_fill=CanvasRenderingContext2D.prototype.fill,original_stroke=CanvasRenderingContext2D.prototype.stroke,original_clip=CanvasRenderingContext2D.prototype.clip,original_is_point_in_path=CanvasRenderingContext2D.prototype.isPointInPath,original_is_point_in_stroke=CanvasRenderingContext2D.prototype.isPointInStroke,CanvasRenderingContext2D.prototype.fill=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_fill.apply(this,Array.prototype.slice.call(arguments,1))}else original_fill.apply(this,arguments)},CanvasRenderingContext2D.prototype.stroke=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_stroke.call(this)}else original_stroke.call(this)},CanvasRenderingContext2D.prototype.clip=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}original_clip.apply(this,Array.prototype.slice.call(arguments,1))}else original_clip.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInPath=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}return original_is_point_in_path.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_path.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInStroke=function(t){if(t instanceof e){this.beginPath();for(var i=0,n=t.ops_.length;i<n;i++){var o=t.ops_[i];CanvasRenderingContext2D.prototype[o.type].apply(this,o.args)}return original_is_point_in_stroke.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_stroke.apply(this,arguments)},Path2D=e}(),function(e,t){"use strict";var i,n=e.document;i=function(){var t,i,o,r,s,a,l,c,u,h,d,p,g,m={},v={},f=!1,E={ENTER:13,ESC:27,SPACE:32},A=[];return v={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},g=function(){var e,t,i=!1,o=n.createElement("fakeelement"),r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in r)if(void 0!==o.style[e]){t=r[e],i=!0;break}return{type:t,supported:i}},t=function(e){return n.getElementById(e)},m={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:void 0,addListeners:function(e){var t,a,l,c,u,h=void 0!==o,d=void 0!==i,g=void 0!==p,m="",v=this;t=function(t){return void 0!==t.preventDefault&&t.preventDefault(),l(t),void 0!==p&&(m=p.value),"function"==typeof e&&(void 0!==p?e(!0,m):e(!0)),!1},a=function(t){return void 0!==t.preventDefault&&t.preventDefault(),l(t),"function"==typeof e&&e(!1),!1},l=function(e){v.hide(),v.unbind(n.body,"keyup",c),v.unbind(r,"focus",u),h&&v.unbind(o,"click",t),d&&v.unbind(i,"click",a)},c=function(e){var i=e.keyCode;(i===E.SPACE&&!g||g&&i===E.ENTER)&&t(e),i===E.ESC&&d&&a(e)},u=function(e){g?p.focus():!d||v.buttonReverse?o.focus():i.focus()},this.bind(r,"focus",u),this.bind(s,"focus",u),h&&this.bind(o,"click",t),d&&this.bind(i,"click",a),this.bind(n.body,"keyup",c),this.transition.supported||this.setFocus()},bind:function(e,t,i){"function"==typeof e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},handleErrors:function(){if(void 0!==e.onerror){var t=this;return e.onerror=function(e,i,n){t.error("["+e+" on line "+n+" of "+i+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",i=e.type,n=e.message,o=e.cssClass||"";switch(t+='<div class="alertify-dialog">',t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===m.buttonFocus&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===i&&(t+='<div id="alertify-form">'),t+='<article class="alertify-inner">',t+=v.message.replace("{{message}}",n),"prompt"===i&&(t+=v.input),t+=v.buttons.holder,t+="</article>","prompt"===i&&(t+="</div>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>",i){case"confirm":t=(t=t.replace("{{buttons}}",this.appendButtons(v.buttons.cancel,v.buttons.ok))).replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":t=(t=t.replace("{{buttons}}",this.appendButtons(v.buttons.cancel,v.buttons.submit))).replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":t=(t=t.replace("{{buttons}}",v.buttons.ok)).replace("{{ok}}",this.labels.ok)}return u.className="alertify alertify-"+i+" "+o,c.className="alertify-cover",t},close:function(e,t){var i,n,o=t&&!isNaN(t)?+t:this.delay,r=this;this.bind(e,"click",function(){i(e)}),n=function(e){e.stopPropagation(),r.unbind(this,r.transition.type,n),h.removeChild(this),h.hasChildNodes()||(h.className+=" alertify-logs-hidden")},i=function(e){void 0!==e&&e.parentNode===h&&(r.transition.supported?(r.bind(e,r.transition.type,n),e.className+=" alertify-log-hide"):(h.removeChild(e),h.hasChildNodes()||(h.className+=" alertify-logs-hidden")))},0!==t&&setTimeout(function(){i(e)},o)},dialog:function(e,t,i,o,r){l=n.activeElement;var s=function(){h&&null!==h.scrollTop&&c&&null!==c.scrollTop||s()};if("string"!=typeof e)throw new Error("message must be a string");if("string"!=typeof t)throw new Error("type must be a string");if(void 0!==i&&"function"!=typeof i)throw new Error("fn must be a function");return this.init(),s(),A.push({type:t,message:e,callback:i,placeholder:o,cssClass:r}),f||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter");return function(t,i){return this.log(t,e,i),this}},hide:function(){var e,t=this;A.splice(0,1),A.length>0?this.setup(!0):(f=!1,e=function(i){i.stopPropagation(),t.unbind(u,t.transition.type,e)},this.transition.supported?(this.bind(u,this.transition.type,e),u.className="alertify alertify-hide alertify-hidden"):u.className="alertify alertify-hide alertify-hidden alertify-isHidden",c.className="alertify-cover alertify-cover-hidden",l.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),null==t("alertify-cover")&&((c=n.createElement("div")).setAttribute("id","alertify-cover"),c.className="alertify-cover alertify-cover-hidden",n.body.appendChild(c)),null==t("alertify")&&(f=!1,A=[],(u=n.createElement("section")).setAttribute("id","alertify"),u.setAttribute("style","z-index : 999999999"),u.className="alertify alertify-hidden",n.body.appendChild(u)),null==t("alertify-logs")&&((h=n.createElement("section")).setAttribute("id","alertify-logs"),h.className="alertify-logs alertify-logs-hidden",n.body.appendChild(h)),n.body.setAttribute("tabindex","0"),this.transition=g()},log:function(e,t,i){var n=function(){h&&null!==h.scrollTop||n()};return this.init(),n(),h.className="alertify-logs",this.notify(e,t,i),this},notify:function(e,t,i){var o=n.createElement("article");o.className="alertify-log"+("string"==typeof t&&""!==t?" alertify-log-"+t:""),o.innerHTML=e,h.appendChild(o),setTimeout(function(){o.className=o.className+" alertify-log-show"},50),this.close(o,i)},set:function(e){var t;if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object");for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){p?(p.focus(),p.select()):a.focus()},setup:function(e){var n,l=A[0],c=this;f=!0,n=function(e){e.stopPropagation(),c.setFocus(),c.unbind(u,c.transition.type,n)},this.transition.supported&&!e&&this.bind(u,this.transition.type,n),u.innerHTML=this.build(l),r=t("alertify-resetFocus"),s=t("alertify-resetFocusBack"),o=t("alertify-ok")||void 0,i=t("alertify-cancel")||void 0,a="cancel"===m.buttonFocus?i:"none"===m.buttonFocus?t("alertify-noneFocus"):o,p=t("alertify-text")||void 0,d=t("alertify-form")||void 0,"string"==typeof l.placeholder&&""!==l.placeholder&&(p.value=l.placeholder),e&&this.setFocus(),this.addListeners(l.callback)},unbind:function(e,t,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)}},{alert:function(e,t,i){return m.dialog(e,"alert",t,"",i),this},confirm:function(e,t,i){return m.dialog(e,"confirm",t,"",i),this},extend:m.extend,init:m.init,log:function(e,t,i){return m.log(e,t,i),this},prompt:function(e,t,i,n){return m.dialog(e,"prompt",t,i,n),this},success:function(e,t){return m.log(e,"success",t),this},error:function(e,t){return m.log(e,"error",t),this},set:function(e){m.set(e)},hide:function(e){m.hide(e)},labels:m.labels,debug:m.handleErrors}},void 0===e.alertify&&(e.alertify=new i)}(this),function(){var e=Autodesk.Viewing,t=(e.Private,""),i=!1,n=!1,o=!0;e.HTTP_REQUEST_HEADERS={},e.getApiEndpoint=function(){return t},e.setApiEndpoint=function(e,i,r){t=e,n=i,(o=r)||(n=!1)},e.getViewingUrl=function(e){return o?(e||t)+"/viewingservice/v1":(e||t)+"/derivativeservice/v2"},e.getUseCredentials=function(){return i},e.setUseCredentials=function(e){i=e},e.getManifestApi=function(t){var i=e.getViewingUrl(t);return n?i+"/bubbles/":o?i+"/":i+"/manifest/"},e.getItemApi=function(t){return o?e.getViewingUrl(t)+"/items/":e.getViewingUrl(t)+"/derivatives/"},e.getThumbnailApi=function(t){return e.getViewingUrl(t)+"/thumbnails/"},e.makeOssPath=function(e,i,n){return(e||t)+"/oss/v2/buckets/"+i+"/objects/"+encodeURIComponent(decodeURIComponent(n))}}(),function(){var e=Autodesk.Viewing,t=e.Private,i=e.getGlobal();i.PROTEIN_ROOT=null,i.PRISM_ROOT=null,i.LOCALIZATION_REL_PATH="",i.LMV_VIEWER_VERSION="2.13",i.LMV_VIEWER_PATCH="6",i.LMV_BUILD_TYPE="Production",i.LMV_RESOURCE_VERSION=null,i.LMV_RESOURCE_ROOT="",i.LMV_THIRD_PARTY_COOKIE=void 0,"v"===LMV_VIEWER_VERSION.charAt(0)&&(LMV_VIEWER_VERSION=LMV_VIEWER_VERSION.substr(1)),i.stderr=function(){console.warn('"stderr" is deprecated; please use "Autodesk.Viewing.Private.logger" instead')},t.env=null,t.docItemId=null,t.token={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},t.memoryOptimizedSvfLoading=!1,t.forceMemoryOptimizedModeOnSvfLoading=!1,t.assets=[],t.offline=!1,t.offlineResourcePrefix=null;var n={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},o={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},r={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},s={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}};t.EnvironmentConfigurations={Local:{ROOT:"",LMV:n.local},Development:{ROOT:o.dev,LMV:n.dev,bubbleManifest:!0},Staging:{ROOT:o.stg,LMV:n.stg,bubbleManifest:!0},Production:{ROOT:o.prod,LMV:n.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:r.dev,LMV:n.dev},AutodeskStaging:{ROOT:r.stg,LMV:n.stg},AutodeskProduction:{ROOT:r.prod,LMV:n.prod}},t.initializeEnvironmentVariable=function(e){var i;if(e&&e.env&&(i=e.env),i||(i=t.getParameterByName("env")),e&&e.offlineResourcePrefix&&(t.offlineResourcePrefix=e.offlineResourcePrefix),e&&e.offline&&"true"===e.offline&&(t.offline=!0),!i)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":i="Development";break;case"viewing-staging.api.autodesk.com":i="Staging";break;case"viewing.api.autodesk.com":i="Production";break;case"developer-dev.api.autodesk.com":i="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":i="AutodeskStaging";break;case"developer.api.autodesk.com":i="AutodeskProduction";break;case"localhost.autodesk.com":case"":case"127.0.0.1":i="Local";break;default:i="AutodeskProduction"}t.ENABLE_TRACE&&("undefined"!=typeof window&&console.log("Host name : "+window.location.hostname),console.log("Environment initialized as : "+i)),t.env=i},t.initializeServiceEndPoints=function(i){var n=i.endpoint,o=i.bubbleManifest,r=!i.useDerivativeServiceV2;if(!n){var s=t.EnvironmentConfigurations[t.env];n=s.ROOT,o=s.bubbleManifest&&r}if(e.setApiEndpoint(n,o,r),!e.isNodeJS){var a=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"];i&&i.hasOwnProperty("libraryName")&&a.push(i.libraryName);for(var l,c,u=0;u<a.length;u++){var h=t.getScript(a[u]),d=(c=h?h.src:"").indexOf(a[u]);if(d>=0){l=c.substr(0,d);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;var p=t.getParameterByNameFromPath("v",c);p&&p.length&&p!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+p+" vs. "+LMV_RESOURCE_VERSION+". Using "+p),LMV_RESOURCE_VERSION=p):p&&p.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT=l||LMV_RESOURCE_ROOT}},t.initLoadContext=function(t){(t=t||{}).auth=e.getUseCredentials(),t.endpoint=e.getApiEndpoint(),t.headers||(t.headers={});for(var i in e.HTTP_REQUEST_HEADERS)t.headers[i]=e.HTTP_REQUEST_HEADERS[i];return t},t.refreshCookie=function(i,n,o){var r=new XMLHttpRequest;if(r.onload=n,r.onerror=o,r.ontimeout=o,0===t.env.indexOf("Autodesk")){var s=t.EnvironmentConfigurations[t.env].ROOT;r.open("POST",s+"/utility/v1/settoken",!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.withCredentials=!0,r.send("access-token="+i),e.isIE11&&(t.accessToken=i)}else{var i={oauth:{token:i}};r.open("POST",e.getViewingUrl()+"/token",!0),r.setRequestHeader("Content-Type","application/json"),r.withCredentials=!0,r.send(JSON.stringify(i))}},t.refreshRequestHeader=function(t){e.HTTP_REQUEST_HEADERS.Authorization="Bearer "+t},t.refreshToken=function(e,i,n){t.token.accessToken=e,void 0===LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,n):function(){LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,n):(t.refreshRequestHeader(e),i())}()},t.initializeAuth=function(i,n){function o(e,r){s=e,t.refreshToken(s,t.token.tokenRefreshInterval?null:i);var a=r-60;a<=0&&(a=r),t.token.tokenRefreshInterval=1e3*a,setTimeout(function(){n.getAccessToken(o)},t.token.tokenRefreshInterval)}var r=n?n.shouldInitializeAuth:void 0;if(void 0===r&&(r="false"!==t.getParameterByName("auth").toLowerCase()),"Local"==t.env||!r)return setTimeout(i,0),e.setUseCredentials(void 0!==n.useCredentials&&n.useCredentials),e.getUseCredentials();e.isNodeJS&&(LMV_THIRD_PARTY_COOKIE=!1),e.setUseCredentials(void 0===n.useCredentials||n.useCredentials);var s;return n&&n.getAccessToken?(t.token.getAccessToken=n.getAccessToken,"string"==typeof(s=n.getAccessToken(o))&&s&&t.refreshToken(s,i)):n&&n.accessToken?(s=n.accessToken,t.refreshToken(s,i)):((s=t.getParameterByName("accessToken"))||(s="9AMaRKBoPCIBy61JmQ8OLLLyRblS",t.logger.warn("Warning : no access token is provided. Use built in token : "+s)),t.refreshToken(s,i)),e.getUseCredentials()},t.initializeLogger=function(i){var n={eventCallback:i?i.eventCallback:void 0};if(t.logger.initialize(n),!(i&&i.hasOwnProperty("useADP")&&0==i.useADP||e.isNodeJS)){var o="https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",r=function(){if("undefined"!=typeof Adp){var e;switch(LMV_BUILD_TYPE){case"Production":e=s.prod;break;default:e=s.stg}var i={product:{name:"LMV",line_name:"LMV",key:e.CLIENT_ID,id:e.CLIENT_KEY,id_provider:"appkey",build_id:LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH,build_tag:LMV_BUILD_TYPE}},n={server:e.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0};t.logger.adp=new Adp(i,n)}else t.logger.warn("Autodesk Data Platform SDK not found")};"undefined"!=typeof requirejs?requirejs([o],function(e){window.Adp=e,r()}):t.loadDependency("Adp",o,r)}},t.initializeProtein=function(){if((!t.ENABLE_DEBUG||"Local"!=t.env||e.getUseCredentials())&&!t.offline){var i=new XMLHttpRequest;i.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),i.responseType="json",i.onload=function(e){var n=i.response.url;n&&n.length&&(n=n.replace("http://","https://"),PROTEIN_ROOT=n+"/",t.logger.info("Protein root is: "+PROTEIN_ROOT))},i.send();var n=new XMLHttpRequest;n.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),n.responseType="json",n.onload=function(e){var i=n.response.url;i&&i.length&&(i=i.replace("http://","https://"),PRISM_ROOT=i+"/",t.logger.info("Prism root is: "+PRISM_ROOT))},n.send()}},t.getParameterByName=function(e){return"undefined"==typeof window?"":t.getParameterByNameFromPath(e,window.location.href)},t.getParameterByNameFromPath=function(e,t){var i="[\\?&]"+(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"))+"=([^&#]*)",n=new RegExp(i).exec(t);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.urlIsApiViewingOrDev=function(e){return-1!==e.indexOf("developer.api.autodesk.com")||-1!==e.indexOf("developer-stg.api.autodesk.com")||-1!==e.indexOf("developer-dev.api.autodesk.com")||-1!==e.indexOf("viewing.api.autodesk.com")||-1!==e.indexOf("viewing-staging.api.autodesk.com")||-1!==e.indexOf("viewing-dev.api.autodesk.com")},t.getDemoDocumentURN=function(){var e;switch(t.env){case"Development":e="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case"Staging":e="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case"Production":e="FIXME";break;default:e="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return e},t.setLanguage=function(e,t){var i={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.init(i,function(e){Autodesk.Viewing.i18n.clearDebugLocString(),t&&t()})},t.initializeLocalization=function(e){var i=e&&e.language||navigator.language,n=i.split("-");i=n.length>1?n[0].toLowerCase()+"-"+n[1].toUpperCase():n[0].toLowerCase();var o=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];-1===o.indexOf(i)&&(i=i.indexOf("zh-CN")>-1?"zh-HANS":i.indexOf("zh-TW")>-1?"zh-HANT":n.length>1&&o.indexOf(n[0])>-1?n[0]:"en"),t.setLanguage(i)},t.initializeUserInfo=function(e){e&&e.userInfo&&(t.setUserName(e.userInfo.name),e.comment2Token&&(t.comment2Token=e.comment2Token))},t.getScript=function(e){e=e.toLowerCase();var t=document.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i=0;i<t.length;++i)if(t[i].src&&-1!==t[i].src.toLowerCase().indexOf(e))return t[i];return null},t.getResourceUrl=function(e){var t=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+e+(t?"?v="+t:"")},t.loadDependency=function(e,i,n){if(void 0===window[e]){var o=document.createElement("SCRIPT");o.src=i.indexOf("://")>0?i:t.getResourceUrl(i),document.head.appendChild(o),n&&(o.onload=n)}else n&&n()},Autodesk.Viewing.createInitializerOptions=function(){return{env:"AutodeskProduction",getAccessToken:void 0,language:void 0,webGLHelpLink:null}},Autodesk.Viewing.createViewerConfig=function(){var i={extensions:[],sharedPropertyDbPath:void 0,canvasConfig:void 0,startOnInitialize:!0,experimental:[]};return Autodesk.Viewing.theExtensionManager.popuplateOptions(i),e.Viewer3D&&e.Viewer3D.populateConfigOptions(i),t.GuiViewer3D&&t.GuiViewer3D.populateConfigOptions(i),i},t.isExperimentalFlagEnabled=function(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)},Autodesk.Viewing.Initializer=function(i,n){function o(){t.initializeLegacyNamespaces(!1),THREE.warn=t.logger.warn.bind(t.logger),init_three_dds_loader(),init_three_pvr_loader(),t.initializeAuth(n,i),t.initializeLocalization(i),t.initializeUserInfo(i)}e.isNodeJS?(t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeAuth(n,i)):(t.WEBGL_HELP_LINK=i?i.webGLHelpLink:null,t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeProtein(),t.initWorkerScript(),t.loadDependency("THREE","three.min.js",function(){t.loadDependency("WGS","wgs.js",o)}))}}();