webpackJsonp([0,8],{1378:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(2425),a=i(n);t.default=a.default;(function(){"undefined"==typeof __REACT_HOT_LOADER__})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2394:function(e,t,r){function i(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var l=null==r?0:o(r);return l<0&&(l=s(i+l,0)),n(e,a(t,3),l)}var n=r(1374),a=r(50),o=r(162),s=Math.max;e.exports=i},2397:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={colors:{board:"#103410",boardDark:"#0a1f0a",boardLight:"#133b13"}},i=r;t.default=i;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(r,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/constants/webGerberConstants.js"),__REACT_HOT_LOADER__.register(i,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/constants/webGerberConstants.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2406:function(e,t){function r(e,t){for(var r=null==e?0:e.length;r--&&t(e[r],r,e)!==!1;);return e}e.exports=r},2407:function(e,t,r){var i=r(2408),n=r(1375),a=n(i,!0);e.exports=a},2408:function(e,t,r){function i(e,t){return e&&n(e,t,a)}var n=r(2409),a=r(67);e.exports=i},2409:function(e,t,r){var i=r(1376),n=i(!0);e.exports=n},2410:function(e,t){function r(e,t,r,i,n){return n(e,function(e,n,a){r=i?(i=!1,e):t(r,e,n,a)}),r}e.exports=r},2411:function(e,t,r){function i(e){return function(t,r,i){var s=Object(t);if(!a(t)){var l=n(r,3);t=o(t),r=function(e){return l(s[e],e,s)}}var h=e(t,r,i);return h>-1?s[l?t[h]:h]:void 0}}var n=r(50),a=r(161),o=r(67);e.exports=i},2412:function(e,t,r){var i=r(108),n=r(278),a=r(123),o=n(function(e,t){i(t,a(t),e)});e.exports=o},2413:function(e,t,r){e.exports=r(2412)},2414:function(e,t,r){var i=r(2411),n=r(2394),a=i(n);e.exports=a},2415:function(e,t,r){function i(e,t){var r=s(e)?n:a;return r(e,o(t))}var n=r(2406),a=r(2407),o=r(356),s=r(17);e.exports=i},2416:function(e,t,r){function i(e,t,r){var i=l(e)?n:s,h=arguments.length<3;return i(e,o(t,4),r,h,a)}var n=r(1036),a=r(107),o=r(50),s=r(2410),l=r(17);e.exports=i},2422:function(e,t){e.exports={canvas:"PreviewPcb_canvas-38idw"}},2425:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(6),a=i(n),o=r(4),s=i(o),l=r(5),h=i(l),c=r(8),u=i(c),d=r(7),f=i(d),p=r(0),m=i(p),g=r(2427),v=i(g),y=r(19),x=i(y),b=function(e){function t(){var e,r,i,n;(0,s.default)(this,t);for(var o=arguments.length,l=Array(o),h=0;h<o;h++)l[h]=arguments[h];return r=i=(0,u.default)(this,(e=t.__proto__||(0,a.default)(t)).call.apply(e,[this].concat(l))),i.onMount=function(){var e;return(e=i).__onMount__REACT_HOT_LOADER__.apply(e,arguments)},n=r,(0,u.default)(i,n)}return(0,f.default)(t,e),(0,h.default)(t,[{key:"componentDidMount",value:function(){this.onMount(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.onMount(e,this.props)}},{key:"__onMount__REACT_HOT_LOADER__",value:function(e,t){e.fileData||e.downloadFn({projectId:e.fileMeta.project._id,fileId:e.fileMeta.fileId,revisionId:e.fileMeta.revisionId,provider:e.fileMeta.provider})}},{key:"render",value:function(){var e=this.props,t=e.fileData,r=e.fileMeta,i=!(t&&t.data);return m.default.createElement("div",{className:"rel-box flex layout-column"},m.default.createElement(x.default,{show:i}),!i&&m.default.createElement(v.default,{data:t.data,name:r.name}))}}]),t}(p.Component);t.default=b;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(b,"PreviewPcb","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcb.jsx")})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2426:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.deregister=t.register=t.activeInstances=void 0;var n=r(2394),a=i(n),o=r(122),s=i(o),l=r(2437),h=i(l),c=t.activeInstances=[],u=t.register=function(){var e=(0,s.default)(),t=(0,h.default)();return t.id=e,c.push(t),t},d=t.deregister=function(e){e&&(e.destroy(),c.splice((0,a.default)(c,"id",e.id),1))};(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(c,"activeInstances","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcb.utils.js"),__REACT_HOT_LOADER__.register(u,"register","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcb.utils.js"),__REACT_HOT_LOADER__.register(d,"deregister","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcb.utils.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2427:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e){(0,y.default)(e,function(t,r){t.error?(toast(t.error),e.splice(r,1)):t.isGerber&&0===t.cmds.length&&(toast("Could not parse file."),e.splice(r,1))})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(6),o=i(a),s=r(4),l=i(s),h=r(5),c=i(h),u=r(8),d=i(u),f=r(7),p=i(f),m=r(2414),g=i(m),v=r(2415),y=i(v),x=r(355),b=i(x),_=r(0),w=i(_),S=r(2426),M=r(2422),T=i(M),A=function(e){function t(){var e,r,i,n;(0,l.default)(this,t);for(var a=arguments.length,s=Array(a),h=0;h<a;h++)s[h]=arguments[h];return r=i=(0,d.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(s))),i.state={flipped:null},i.viewerInstance=null,i.onMount=function(){var e;return(e=i).__onMount__REACT_HOT_LOADER__.apply(e,arguments)},i.init=function(){var e;return(e=i).__init__REACT_HOT_LOADER__.apply(e,arguments)},i.flip=function(){var e;return(e=i).__flip__REACT_HOT_LOADER__.apply(e,arguments)},n=r,(0,d.default)(i,n)}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){this.onMount(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.onMount(e,this.props)}},{key:"__onMount__REACT_HOT_LOADER__",value:function(e,t){(!t||e.data!=t.data&&e.name!=t.name)&&setTimeout(this.init(e),1)}},{key:"componentWillUnmount",value:function(){(0,S.deregister)(this.viewerInstance)}},{key:"__init__REACT_HOT_LOADER__",value:function(e){var t=e.data,r=e.name;this.viewerInstance&&(0,S.deregister)(this.viewerInstance);var i={name:r,data:t};this.viewerInstance=(0,S.register)();var a=[i].map(this.viewerInstance.parse);if(n(a),a.length>0){if(!a[0].isGerber){a[0].side=2;var o=(0,b.default)(a[0],!0);o.boardFlipped=!0,o.side=1,a.push(o)}this.viewerInstance.init(a,this.refs.canvas,S.activeInstances),(0,g.default)(a,"side",2)||this.flip(!0)}else previewer.type="other"}},{key:"__flip__REACT_HOT_LOADER__",value:function(e){var t=e?e:!this.state.flipped;this.setState({flipped:t}),S.activeInstances.forEach(function(e){e.flip(t)})}},{key:"render",value:function(){return w.default.createElement("div",{ref:"canvas",className:T.default.canvas+" layout-column flex"})}}]),t}(_.Component);t.default=A;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(A,"PreviewPcbViewer","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcbViewer.jsx"),__REACT_HOT_LOADER__.register(n,"errorMessages","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/PreviewPcbViewer.jsx"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2428:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,r){function i(e){c.enabled&&c.mouseState===u.NONE&&(e.keyCode!==c.keys[u.ROTATE]||c.noRotate?e.keyCode!==c.keys[u.ZOOM]||c.noZoom?e.keyCode!==c.keys[u.PAN]||c.noPan||(c.mouseState=u.PAN):c.mouseState=u.ZOOM:c.mouseState=u.ROTATE,c.mouseState!==u.NONE&&(d=!0))}function n(e){c.enabled&&c.mouseState!==u.NONE&&(c.mouseState=u.NONE)}function a(e){c.enabled&&(e.preventDefault(),e.stopPropagation(),c.mouseState===u.NONE&&((0,o.default)(r,function(t){t.boardControls.mouseState=e.button}),c.mouseState=e.button,c.mouseState!==u.ROTATE||c.noRotate?c.mouseState!==u.ZOOM||c.noZoom?c.noPan||(v=y=c.getMouseOnScreen(e.clientX,e.clientY)):m=g=c.getMouseOnScreen(e.clientX,e.clientY):f=p=c.getMouseProjectionOnBall(e.clientX,e.clientY)))}function s(e){c.enabled&&(d&&(f=p=c.getMouseProjectionOnBall(e.clientX,e.clientY),m=g=c.getMouseOnScreen(e.clientX,e.clientY),v=y=c.getMouseOnScreen(e.clientX,e.clientY),d=!1),c.mouseState!==u.NONE&&(c.mouseState!==u.ROTATE||c.noRotate?c.mouseState!==u.ZOOM||c.noZoom?c.mouseState!==u.PAN||c.noPan||(y=c.getMouseOnScreen(e.clientX,e.clientY)):g=c.getMouseOnScreen(e.clientX,e.clientY):p=c.getMouseProjectionOnBall(e.clientX,e.clientY)))}function l(e){c.enabled&&((0,o.default)(r,function(e){e.boardControls.mouseState=u.NONE}),e.preventDefault(),e.stopPropagation(),c.mouseState=u.NONE)}function h(e){var t=5,i="undefined"!=typeof e.wheelDelta?-e.wheelDelta:e.detail;i=t*(i>0?-1:1);var n=c.object.position.y+i<-1?c.object.position.y+i:-1;(0,o.default)(r,function(e){e.boardControls.object.position.y=n})}THR51.EventTarget.call(this);var c=this,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseState=u.NONE;var d=(new THR51.Vector3,!1),f=new THR51.Vector3,p=new THR51.Vector3,m=new THR51.Vector2,g=new THR51.Vector2,v=new THR51.Vector2,y=new THR51.Vector2;this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new THR51.Vector2((e-c.screen.offsetLeft)/c.radius*.5,(t-c.screen.offsetTop)/c.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new THR51.Vector3((e-.5*c.screen.width-c.screen.offsetLeft)/c.radius,(.5*c.screen.height+c.screen.offsetTop-t)/c.radius,0),i=r.length();i>1?r.normalize():r.z=Math.sqrt(1-i*i);var n=c.camera.up.clone().setLength(r.y);return n.addSelf(c.camera.up.clone().crossSelf(c.eye).setLength(r.x)),n.addSelf(c.eye.clone().setLength(r.z)),n},this.rotateCamera=function(){var e=Math.acos(f.dot(p)/f.length()/p.length());if(e){var t=(new THR51.Vector3).cross(f,p).normalize();e*=c.rotateSpeed,c.staticMoving?f=p:f.multiplyScalar(1-c.dynamicDampingFactor).addSelf(p.clone().multiplyScalar(c.dynamicDampingFactor)),c.object.useQuaternion=!0,c.object.quaternion.clone().inverse().multiplyVector3(t),c.object.quaternion.multiplySelf((new THR51.Quaternion).setFromAxisAngle(t,e)),(0,o.default)(r,function(e){e.boardControls.object.useQuaternion=!0,e.boardControls.object.quaternion=c.object.quaternion})}},this.zoomCamera=function(){var e=1+(g.y-m.y)*c.zoomSpeed;1!==e&&e>0&&((0,o.default)(r,function(t){t.boardControls.object.position.y*=e}),c.staticMoving?m=g:m.y+=(g.y-m.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=y.clone().subSelf(v);if(e.x||e.y){e.multiplyScalar(Math.abs(c.object.position.y)*c.panSpeed);var t=c.eye.clone().crossSelf(c.camera.up).setLength(e.x);t.addSelf(c.camera.up.clone().setLength(e.y));var i=c.object.position.subSelf(t);(0,o.default)(r,function(e){e.boardControls.object.position=i}),c.staticMoving?v=y:v.addSelf(e.sub(y,v).multiplyScalar(c.dynamicDampingFactor))}},this.update=function(){c.noRotate||c.rotateCamera(),c.noZoom||c.zoomCamera(),c.noPan||c.panCamera()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",s,!1),this.domElement.addEventListener("mousedown",a,!1),this.domElement.addEventListener("mouseup",l,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("mousewheel",h,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",n,!1)}Object.defineProperty(t,"__esModule",{value:!0});var a=r(353),o=i(a),s=n,l=s;t.default=l;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(n,"ObjectControls","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/ObjectControls.js"),__REACT_HOT_LOADER__.register(s,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/ObjectControls.js"),__REACT_HOT_LOADER__.register(l,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/ObjectControls.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2429:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n,a=r(352);i(a);!function(i,a){n=function(){return a()}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(void 0,function(){function e(e){this.board=e}function t(e,t,r,i,n){var a=r-e,o=i-t;if(180===Math.abs(n)){var s=e+a/2,l=t+o/2,h=Math.atan2(t-l,s-e),c=Math.atan2(i-l,s-r);return[s,l,h,Math.sqrt(a*a/4+o*o/4)]}var u=Math.sqrt(a*a+o*o),d=Math.abs(u/2/Math.sin(n/180/2*Math.PI)),f=d,p=d;if(u>f+p)return void console.log("no solution. circles do not intersect",u,f,p);if(u<Math.abs(f-p))return void console.log("no solution. one circle is contained in the other",u,f,p);var m=(f*f-p*p+u*u)/(2*u),g=e+a*m/u,v=t+o*m/u,y=Math.sqrt(f*f-m*m),x=-o*(y/u),b=a*(y/u),_=g+x,w=v+b,S=g-x,M=v-b,T=Math.atan2(t-w,_-e),A=Math.atan2(i-w,_-r),C=Math.atan2(t-M,S-e),E=Math.atan2(i-M,S-r),h=(T-A)/Math.PI*180,c=(C-E)/Math.PI*180,L=(n-h)%360,R=(n-c)%360;return-1e-7<L&&L<1e-7?[_,w,T,d]:-1e-7<R&&R<1e-7?[S,M,C,d]:(console.log("something wrong: angle:",n,"angle1:",h,"dangle1",-1e-7<L||L<1e-7,"angle2:",c,"dangle2:",-1e-7<R||R<1e-7),[S,M,C,d])}e.supports=function(e){if(e.match(/\<\?xml/)&&e.match(/\<eagle/))return!0};var r={Front:"Top",Back:"Bottom","B.Adhes":"bGlue","F.Adhes":"tGlue","B.Paste":"bCream","F.Paste":"tCream","B.SilkS":"bNames","F.SilkS":"tNames","B.Mask":"bStop","F.Mask":"tStop","Dwgs.User":"tValues","Edge.Cuts":"Dimension"},i={Top:{name:"Top",number:1,color:4},Inner1:{name:"Inner1",number:2,color:16},Inner2:{name:"Inner2",number:3,color:16},Inner3:{name:"Inner3",number:4,color:16},Inner4:{name:"Inner4",number:5,color:16},Inner5:{name:"Inner5",number:6,color:16},Inner6:{name:"Inner6",number:7,color:16},Inner7:{name:"Inner7",number:8,color:16},Inner8:{name:"Inner8",number:9,color:16},Inner9:{name:"Inner9",number:10,color:16},Inner10:{name:"Inner10",number:11,color:16},Inner11:{name:"Inner11",number:12,color:16},Inner12:{name:"Inner12",number:13,color:16},Inner13:{name:"Inner13",number:14,color:16},Inner14:{name:"Inner14",number:15,color:16},Bottom:{name:"Bottom",number:16,color:1},Pads:{name:"Pads",number:17,color:2},Vias:{name:"Vias",number:18,color:2},Unrouted:{name:"Unrouted",number:19,color:6},Dimension:{name:"Dimension",number:20,color:15},tPlace:{name:"tPlace",number:21,color:7},bPlace:{name:"bPlace",number:22,color:7},tOrigins:{name:"tOrigins",number:23,color:15},bOrigins:{name:"bOrigins",number:24,color:15},tNames:{name:"tNames",number:25,color:7},bNames:{name:"bNames",number:26,color:7},tValues:{name:"tValues",number:27,color:7},bValues:{name:"bValues",number:28,color:7},tStop:{name:"tStop",number:29,color:7},bStop:{name:"bStop",number:30,color:7},tCream:{name:"tCream",number:31,color:7},bCream:{name:"bCream",number:32,color:7},tFinish:{name:"tFinish",number:33,color:6},bFinish:{name:"bFinish",number:34,color:6},tGlue:{name:"tGlue",number:35,color:7},bGlue:{name:"bGlue",number:36,color:7},tTest:{name:"tTest",number:37,color:7},bTest:{name:"bTest",number:38,color:7},tKeepout:{name:"tKeepout",number:39,color:4},bKeepout:{name:"bKeepout",number:40,color:1},tRestrict:{name:"tRestrict",number:41,color:4},bRestrict:{name:"bRestrict",number:42,color:1},vRestrict:{name:"vRestrict",number:43,color:2},Drills:{name:"Drills",number:44,color:7},Holes:{name:"Holes",number:45,color:7},Milling:{name:"Milling",number:46,color:3},Measures:{name:"Measures",number:47,color:7},Document:{name:"Document",number:48,color:7},Reference:{name:"Reference",number:49,color:7},dxf:{name:"dxf",number:50,color:7},tDocu:{name:"tDocu",number:51,color:7},bDocu:{name:"bDocu",number:52,color:7},tGND_GNDA:{name:"tGND_GNDA",number:53,color:7},bGND_GNDA:{name:"bGND_GNDA",number:54,color:1},wert:{name:"wert",number:56,color:7},Nets:{name:"Nets",number:91,color:2},Busses:{name:"Busses",number:92,color:1},Pins:{name:"Pins",number:93,color:2},Symbols:{name:"Symbols",number:94,color:4},Names:{name:"Names",number:95,color:7},Values:{name:"Values",number:96,color:7},Info:{name:"Info",number:97,color:7},Guide:{name:"Guide",number:98,color:6},Muster:{name:"Muster",number:100,color:7},Patch_Top:{name:"Patch_Top",number:101,color:12},Vscore:{name:"Vscore",number:102,color:7},fp3:{name:"fp3",number:103,color:7},Name:{name:"Name",number:104,color:7},Beschreib:{name:"Beschreib",number:105,color:9},"BGA-Top":{name:"BGA-Top",number:106,color:4},"BD-Top":{name:"BD-Top",number:107,color:5},fp8:{name:"fp8",number:108,color:7},fp9:{name:"fp9",number:109,color:7},fp0:{name:"fp0",number:110,color:7},Patch_BOT:{name:"Patch_BOT",number:116,color:9},_tsilk:{name:"_tsilk",number:121,color:7},_bsilk:{name:"_bsilk",number:122,color:7},tTestmark:{name:"tTestmark",number:123,color:7},bTestmark:{name:"bTestmark",number:124,color:7},tAdjust:{name:"tAdjust",number:131,color:7},bAdjust:{name:"bAdjust",number:132,color:7},HeatSink:{name:"HeatSink",number:151,color:7},"200bmp":{name:"200bmp",number:200,color:1},"201bmp":{name:"201bmp",number:201,color:2},"202bmp":{name:"202bmp",number:202,color:3},"203bmp":{name:"203bmp",number:203,color:4},"204bmp":{name:"204bmp",number:204,color:5},"205bmp":{name:"205bmp",number:205,color:6},"206bmp":{name:"206bmp",number:206,color:7},"207bmp":{name:"207bmp",number:207,color:8},"208bmp":{name:"208bmp",number:208,color:9},"209bmp":{name:"209bmp",number:209,color:7},"210bmp":{name:"210bmp",number:210,color:7},Descript:{name:"Descript",number:250,color:3},SMDround:{name:"SMDround",number:251,color:12},cooling:{name:"cooling",number:254,color:7}};return e.prototype.eagleLayer=function(e){if("*.Cu"===e&&(e="Front"),"*.Mask"===e&&(e="F.Mask"),r[e])return i[r[e]]},e.prototype.parse=function(e){var t=new DOMParser,r=t.parseFromString(e,"text/xml");this.parseDOM(r)},e.prototype.parseDOM=function(e){var t=this.board;t.eagleLayersByName={},t.layersByNumber={};for(var r=e.getElementsByTagName("layer"),i=0;i<r.length;i++){var n=this.parseLayer(r[i]);t.eagleLayersByName[n.name]=n,t.layersByNumber[n.number]=n}t.elements={};for(var a=e.getElementsByTagName("element"),o=0;o<a.length;o++){var s=this.parseElement(a[o]);t.elements[s.name]=s}t.designRules={};for(var l=e.getElementsByTagName("designrules"),h=0;h<l.length;h++)for(var c=l[h],u=c.getElementsByTagName("param"),d=0;d<u.length;d++){var f,p=u[d],m=p.getAttribute("value");(f=m.match(/^([\d\.]+)mil$/))&&(m=.0254*parseFloat(f[1])),t.designRules[p.getAttribute("name")]=m}t.signalItems={};for(var g=e.getElementsByTagName("signal"),v=0;v<g.length;v++){var y=g[v],x=y.getAttribute("name"),b={};t.signalItems[x]=b;for(var _=y.getElementsByTagName("wire"),w=0;w<_.length;w++){var S=this.parseWire(_[w]),M=S.layer;b[M]||(b[M]={});var T=b[M];T.wires||(T.wires=[]);var A=T.wires;A.push(S)}for(var C=y.getElementsByTagName("via"),E=0;E<C.length;E++){var L=this.parseVia(C[E]),r=L.layers;b[r]||(b[r]={});var T=b[r];T.vias||(T.vias=[]);var R=T.vias;R.push(L)}for(var P=y.getElementsByTagName("contactref"),F=0;F<P.length;F++){var D=P[F],U=D.getAttribute("element"),N=D.getAttribute("pad"),O=t.elements[U];O&&(O.padSignals[N]=x)}}t.packagesByName={};for(var B=e.getElementsByTagName("package"),V=0;V<B.length;V++){var I=B[V],z=I.getAttribute("name"),k=I.getElementsByTagName("description");if(k&&k.length)var W=k[0].textContent;for(var G=[],H=I.getElementsByTagName("smd"),j=0;j<H.length;j++){var X=H[j];G.push(this.parseSmd(X))}for(var Y=[],q=I.getElementsByTagName("rectangle"),K=0;K<q.length;K++){var Z=q[K];Y.push(this.parseRect(Z))}for(var Q=[],J=I.getElementsByTagName("pad"),$=0;$<J.length;$++){var ee=J[$];Q.push(this.parsePad(ee))}for(var te=[],re=I.getElementsByTagName("polygon"),ie=0;ie<re.length;ie++){var ne=re[ie];te.push(this.parsePoly(ne))}for(var ae=[],_=I.getElementsByTagName("wire"),w=0;w<_.length;w++){var oe=_[w],S=this.parseWire(oe);ae.push(S)}for(var _=I.getElementsByTagName("circle"),w=0;w<_.length;w++){var oe=_[w],S=this.parseCircle(oe);ae.push(S)}for(var se=[],le=I.getElementsByTagName("hole"),he=0;he<le.length;he++){var ce=le[he],ue=this.parseHole(ce);se.push(ue)}for(var de=this.board.calcBBox(ae),fe=[],pe=I.getElementsByTagName("text"),me=0;me<pe.length;me++){var ge=pe[me];fe.push(this.parseText(ge))}var ve={smds:G,wires:ae,texts:fe,bbox:de,pads:Q,polys:te,holes:se,rects:Y,description:W};t.packagesByName[z]=ve}t.plainWires={},t.plainTexts={},t.plainHoles=[];for(var ye=e.getElementsByTagName("plain"),xe=0;xe<ye.length;xe++){for(var be=ye[xe],_=be.getElementsByTagName("wire"),pe=be.getElementsByTagName("text"),le=be.getElementsByTagName("hole"),w=0;w<_.length;w++){var oe=_[w],S=this.parseWire(oe),M=S.layer;t.plainWires[M]||(t.plainWires[M]=[]),t.plainWires[M].push(S)}for(var me=0;me<pe.length;me++){var ge=pe[me],_e=this.parseText(ge),M=_e.layer;t.plainTexts[M]||(t.plainTexts[M]=[]),t.plainTexts[M].push(_e)}for(var he=0;he<le.length;he++){var ce=le[he],ue=this.parseHole(ce);t.plainHoles.push(ue)}}},e.prototype.parseSmd=function(e){var t=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),i=parseFloat(e.getAttribute("dx")),n=parseFloat(e.getAttribute("dy")),a=e.getAttribute("rot")||"R0",o=parseInt(e.getAttribute("roundness"));return{x1:t-.5*i,y1:r-.5*n,x2:t+.5*i,y2:r+.5*n,rot:a,roundness:o,name:e.getAttribute("name"),layer:e.getAttribute("layer")}},e.prototype.parseRect=function(e){return{x1:parseFloat(e.getAttribute("x1")),y1:parseFloat(e.getAttribute("y1")),x2:parseFloat(e.getAttribute("x2")),y2:parseFloat(e.getAttribute("y2")),layer:e.getAttribute("layer")}},e.prototype.parsePoly=function(e){var t=parseFloat(e.getAttribute("width")),r=[];return[].slice.apply(e.getElementsByTagName("vertex")).forEach(function(e){r.push({x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y"))})}),{vertexes:r,layer:e.getAttribute("layer"),width:t}},e.prototype.parsePad=function(e){var t=parseFloat(e.getAttribute("drill")),r=parseFloat(e.getAttribute("diameter"));isNaN(r)&&(r=1.5*t);var i=e.getAttribute("rot")||"R0";return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),drill:t,name:e.getAttribute("name"),shape:e.getAttribute("shape"),diameter:r,rot:i}},e.prototype.parseVia=function(e){var t=parseFloat(e.getAttribute("drill")),r="Outer",i=this.board.designRules,n=parseFloat(i["rvVia"+r]),a=parseFloat(i["rlMaxVia"+r]),o=parseFloat(i["rlMinVia"+r]),s=t*n;return s<o?s=o:s>a&&(s=a),{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),drill:t,diameter:t+2*s,layers:e.getAttribute("extent"),shape:e.getAttribute("shape")}},e.prototype.parseHole=function(e){return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),drill:parseFloat(e.getAttribute("drill"))}},e.prototype.parseWire=function(e){var r=parseFloat(e.getAttribute("width"));r<=0&&(r=this.minLineWidth);var i=parseInt(e.getAttribute("layer")),n=parseFloat(e.getAttribute("x1")),a=parseFloat(e.getAttribute("y1")),o=parseFloat(e.getAttribute("x2")),s=parseFloat(e.getAttribute("y2")),l=e.getAttribute("style"),h=parseInt(e.getAttribute("curve"));if(h){var c=t(n,a,o,s,h),u=Math.PI*(h/180);return u<0&&(c[2]+=-u,u=-u),{x:c[0],y:c[1],radius:c[3],start:Math.PI-c[2],angle:u,curve:h,width:r,layer:i,style:l,cap:e.getAttribute("cap"),rot:e.getAttribute("rot")||"R0"}}return{x1:n,y1:a,x2:o,y2:s,style:l,width:r,layer:i}},e.prototype.parseCircle=function(e){var t=parseFloat(e.getAttribute("width"));t<=0&&(t=this.minLineWidth);var r=parseInt(e.getAttribute("layer"));e.tagName;return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),radius:parseFloat(e.getAttribute("radius")),start:0,angle:2*Math.PI,curve:360,width:t,layer:r}},e.prototype.parseText=function(e){var t=e.textContent;t||(t="");var r,i,n=e.getAttribute("rot")||"R0",a=e.getAttribute("align")||"",o=this.board.angleForRot(n);return"center"===a?(r="center",i="middle"):(a.match(/\-right$/)?r="right":a.match(/\-left$/)?r="left":a.match(/\-center$/)&&(r="center"),a.match(/^top\-/)?i="top":a.match(/^bottom\-/)?i="bottom":a.match(/^center\-/)&&(i="middle")),{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),size:parseFloat(e.getAttribute("size")),layer:parseInt(e.getAttribute("layer")),ratio:parseInt(e.getAttribute("ratio")),interlinear:parseInt(e.getAttribute("distance"))||50,align:r,valign:i,rot:n,flipText:o.degrees>90&&o.degrees<=270,font:e.getAttribute("font"),content:t}},e.prototype.parseElement=function(e){for(var t=e.getAttribute("rot")||"R0",r=this.board.matrixForRot(t),i={},n=this.board.angleForRot(t),a=n.degrees>=90&&n.degrees<=270,o=e.getElementsByTagName("attribute"),s=0;s<o.length;s++){var l=o[s],h={},c=l.getAttribute("name");if(c){h.name=c,l.getAttribute("x")&&(h.x=parseFloat(l.getAttribute("x"))),l.getAttribute("y")&&(h.y=parseFloat(l.getAttribute("y"))),l.getAttribute("size")&&(h.size=parseFloat(l.getAttribute("size"))),l.getAttribute("layer")&&(h.layer=parseInt(l.getAttribute("layer"))),h.font=l.getAttribute("font");var u=l.getAttribute("rot");u||(u="R0");var d=this.board.angleForRot(u);h.flipText=d.degrees>=90&&d.degrees<=270,h.rot=u,h.display=l.getAttribute("display"),i[c]=h}}return{pkg:e.getAttribute("package"),name:e.getAttribute("name"),value:e.getAttribute("value"),x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y")),rot:t,matrix:r,mirror:0==t.indexOf("M"),flipText:a,smashed:e.getAttribute("smashed")&&"YES"==e.getAttribute("smashed").toUpperCase(),attributes:i,padSignals:{}}},e.prototype.parseLayer=function(e){return{name:e.getAttribute("name"),number:parseInt(e.getAttribute("number")),color:parseInt(e.getAttribute("color"))}},e});(function(){"undefined"==typeof __REACT_HOT_LOADER__})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2430:function(e,t){"use strict";function r(e){return e=e.toLowerCase(),e.match(/\.drl|\.drd|\.txt/)?[h.BOTTOM|h.TOP,h.BOARD]:e.match(/\.out|outline/)?[h.BOTTOM|h.TOP,h.OUTLINE]:e.match(/\.gbl|\.sol/)||e.match(/bot/)&&e.match(/copper|signal/)?[h.BOTTOM,h.COPPER]:e.match(/\.gbs|\.sts/)||e.match(/bot/)&&e.match(/s(?:old(?:er|)|)ma?(?:sk|ks)/)?[h.BOTTOM,h.SOLDER]:e.match(/\.gbp|\.crs/)||e.match(/bot/)&&e.match(/pas/)?[h.BOTTOM,h.PASTE]:e.match(/\.gbo|\.pls/)||e.match(/bot/)&&e.match(/si?lk/)?[h.BOTTOM,h.SILK]:e.match(/\.gtl|\.cmp/)||e.match(/top/)&&e.match(/copper|signal/)?[h.TOP,h.COPPER]:e.match(/\.gts|\.stc/)||e.match(/top/)&&e.match(/s(?:old(?:er|)|)ma?(?:sk|ks)/)?[h.TOP,h.SOLDER]:e.match(/\.gtp|\.crc/)||e.match(/top/)&&e.match(/pas/)?[h.TOP,h.PASTE]:e.match(/\.gto|\.plc/)||e.match(/top/)&&e.match(/si?lk/)?[h.TOP,h.SILK]:void 0}function i(e,t){var i;i=e.match(/^[\s%]*M48/)?a(e,o):o(e,o);var s=r(t);return i.side=s[0],i.type=s[1],i.layerType=c[i.side+""+i.type],i.name=t,i.isGerber=!0,i.bounds=n(i),i}function n(e,t){t={minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)};var r=e.scale;t.minX/=r,t.minY/=r,t.maxX/=r,t.maxY/=r;for(var i=0;i<e.cmds.length;i++){var n=e.shapes[e.cmds[i][1]];if(n){var a=e.cmds[i][2],o=e.cmds[i][3],s=0,l=0;if("C"==n[0])s=l=n[1]/2;else{if("R"!=n[0])continue;s=n[1]/2,l=n[2]/2}a-s<t.minX&&(t.minX=a-s),o-l<t.minY&&(t.minY=o-l),a+s>t.maxX&&(t.maxX=a+s),o+l>t.maxY&&(t.maxY=o+l)}}return t.minX*=r,t.minY*=r,t.maxX*=r,t.maxY*=r,t}function a(e){function t(e){if("+"==e[0])return t(e.slice(1));if("-"==e[0])return-t(e.slice(1));if("0"==e)return 0;if(n.omitLead)for(;e.length<n.num;)e="0"+e;else for(;e.length<n.num;)e+="0";return parseFloat(e.slice(0,n.int)+"."+e.slice(n.int),10)}e=e.replace(/^[\s%]*M48/,""),e=e.replace(/[^\S\n]+/g,"");for(var r,i=e.split("\n"),n={offA:0,offB:0,shapes:[],cmds:[],scale:1},a=!1,o=0,s=0,l=0;l<i.length;l++){var h=i[l];if(a){var c=function(e){var r=/^[-+\d]*/.exec(h=h.slice(e));return h=h.slice(r[0].length),t(r[0])};if("T"==h[0])r=parseInt(h.slice(1),10);else if("R"==h[0]){var u=/^\d+/.exec(h=h.slice(1)),d=parseInt(u[0],10),f=0,p=0;h=h.slice(u[0].length),"X"==h[0]&&(f=c(1)),"Y"==h[0]&&(p=c(1));for(var m=o,g=s,v=0;v<d;v++)m+=f,g+=p,n.cmds.push([7,r,m,g]);o=m,s=g}else{var m=o,g=s,y=!1;"X"==h[0]&&(m=c(1),y=!0),"Y"==h[0]&&(g=c(1),y=!0),y&&(n.cmds.push([7,r,m,g]),o=m,s=g)}}else if("T"==h[0]){var u=/^T(\d+)[^C]*C([\d.]+)/.exec(h);n.shapes[parseInt(u[1],10)]=["C",+u[2]]}else"METRIC,LZ"==h?(n.scale=1,n.omitLead=!1,n.int=3,n.dec=3,n.num=6):"METRIC,TZ"==h||"M71"==h?(n.scale=1,n.omitLead=!0,n.int=3,n.dec=3,n.num=6):"INCH,LZ"==h?(n.scale=25.4,n.omitLead=!1,n.int=2,n.dec=4,n.num=6):"INCH,TZ"==h||"M72"==h?(n.scale=25.4,n.omitLead=!0,n.int=2,n.dec=4,n.num=6):"%"==h&&(a=!0)}return n}function o(e,t){function r(e){if("+"==e[0])return r(e.slice(1));if("-"==e[0])return-r(e.slice(1));if("0"==e)return 0;if(n.omitLead)for(;e.length<n.num;)e="0"+e;else for(;e.length<n.num;)e+="0";return parseFloat(e.slice(0,n.int)+"."+e.slice(n.int),10)}e=e.replace(/\s+/g,"");for(var i=e.split("%"),n={offA:0,offB:0,shapes:[],cmds:[],scale:1},a=0,o={},s=1,l=!1,h=0,c=0,u=0;u<i.length;u++)if(i[u].length){"*"==i[u][i[u].length-1]&&(i[u]=i[u].slice(0,-1)),i[u]=i[u].split("*");for(var d=0;d<i[u].length;d++){var f=i[u][d];if(u%2)if("F"==f[0]&&"S"==f[1]){var p=/^([LT]?)([AI])X(\d)(\d)Y(\d)(\d)$/.exec(f.slice(2));if(n.omitLead=!p[1]||"L"==p[1],n.abs="A"==p[2],!n.abs)throw new Error("Need absolute values");n.int=+p[3],n.dec=+p[4],n.num=n.int+n.dec}else if("O"==f[0]&&"F"==f[1]){var p=/^(?:A([-+\d.]+)|)(?:B([-+\d.]+)|)$/.exec(f.slice(2));n.offA=parseInt(p[1],10),n.offB=parseInt(p[2],10)}else{if("IPNEG"==f)throw new Error("Negative image polarity");if("L"==f[0]&&"P"==f[1])l&&"D"==f[2]?n.cmds.push([64,l=!1]):l||"C"!=f[2]||n.cmds.push([64,l=!0]);else if("A"==f[0]&&"M"==f[1]){var m=[];for(d++;d<i[u].length;d++)m.push(i[u][d]);o[f.slice(2)]=m}else if("A"==f[0]&&"D"==f[1]&&"D"==f[2]){var p=/^(\d+)([^,]+)(?:,(.+)|)$/.exec(f.slice(3)),d=p[1]-10,g=[];if(p[3]&&(g=p[3].split("X")),o[p[2]]){for(var v=function(e){for(e=e.replace(/\$(\d+)/g,function(e,t){return+g[t-1]||0}).toLowerCase(),repl=!0;1==repl;)repl=!1,e=e.replace(/([\d.]+)x([\d.]+)/g,function(e,t,r){return repl=!0,t*r});for(repl=!0;1==repl;)repl=!1,e=e.replace(/([\d.]+)\/([\d.]+)/g,function(e,t,r){return repl=!0,t/r});for(repl=!0;1==repl;)repl=!1,e=e.replace(/([\d.]+)\+([\d.]+)/g,function(e,t,r){return repl=!0,t+r});for(repl=!0;1==repl;)repl=!1,e=e.replace(/([\d.]+)-([\d.]+)/g,function(e,t,r){return repl=!0,t-r});return e},y=o[p[2]],x=[],b=0;b<y.length;b++){var _=/^\$(\d+)=(.+)$/.exec(y[b]);_?g[_[1]-1]=+v(_[2]):x.push(v(y[b]).split(",").map(function(e){return+e}))}n.shapes[d]=["M",x]}else n.shapes[d]=[p[2]].concat(g.map(function(e){return+e}));d<a&&(a=d)}else"MOIN"==f?n.scale=25.4:"MOMM"==f&&(n.scale=1)}else{var w=function(e){var t=/^[-+\d]*/.exec(f=f.slice(e));return f=f.slice(t[0].length),r(t[0])};if("G"==f[0]&&"0"==f[1]&&"4"==f[2]||"M"==f[0])continue;if("G"==f[0]&&"5"==f[1]&&"4"==f[2]&&(f=f.slice(3)),"G70"==f){n.scale=25.4;
continue}if("G74"==f){s&=-5;continue}if("G75"==f){s|=4;continue}if("G36"==f){8&s||n.cmds.push([32,!0]),s|=8;continue}if("G37"==f){8&s&&n.cmds.push([32,!1]),s&=-9;continue}var S=0;if("G"==f[0]&&f.length>4){var p=/^\d*/.exec(f=f.slice(1));s=12&s|(S=parseInt(p[0],10)),f=f.slice(p[0].length)}var M=h,T=c,A=0,C=0,E=!1,L=!1;"X"==f[0]&&(M=w(1),E=!0),"Y"==f[0]&&(T=w(1),L=!0),"I"==f[0]&&(A=w(1),!(2&s)&&(M+=A,E=!0)),"J"==f[0]&&(C=w(1),!(2&s)&&(T+=C,L=!0)),"D"==f[0]?"0"==f[1]?n.cmds.push([s<<2|f[2],a,M,T,A,C]):a=f.slice(1)-10:E&&M!=h||L&&T!=c?n.cmds.push([s<<2|1,a,M,T,A,C]):(h=M,c=T)}}}return n}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return{parse:i,getBounds:n}},l=s;t.default=l;var h={BOTTOM:1,TOP:2,BOARD:0,COPPER:1,SOLDER:2,PASTE:3,SILK:4,OUTLINE:5},c={};c[""]="No layer",c[h.BOTTOM+""+h.COPPER]="Bottom copper",c[h.BOTTOM+""+h.SOLDER]="Bottom solder mask",c[h.BOTTOM+""+h.PASTE]="Bottom solder paste",c[h.BOTTOM+""+h.SILK]="Bottom silk-screen",c[h.TOP+""+h.COPPER]="Top copper",c[h.TOP+""+h.SOLDER]="Top solder mask",c[h.TOP+""+h.PASTE]="Top solder paste",c[h.TOP+""+h.SILK]="Top silk-screen",c[(h.TOP|h.BOTTOM)+""+h.BOARD]="Drill",c[(h.TOP|h.BOTTOM)+""+h.OUTLINE]="Outline";(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(h,"index","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(c,"layerNames","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(r,"guessLayer","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(i,"parse","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(n,"getBounds","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(a,"parseDrill","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(o,"parseStandard","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(s,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"),__REACT_HOT_LOADER__.register(l,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/parse/gerber.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2431:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n,a=r(47),o=i(a),s=r(352);i(s);!function(i,a){n=function(){return a()}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(void 0,function(){function e(e){e=e||{},this.context=[],this.chunk="",this.cmd=null,this.context=[],this.args=!1,this.stringContext=!1,this.token="",this.netByNumber={},this.netByName={},this.netClass={},e.eagleLayersByName={},e.layersByNumber={},e.elements={},e.signalItems={},e.packagesByName={},e.plainWires={},e.plainTexts={},e.coordYFlip=!0,this.board=e}e.supports=function(e){if(e.match(/\(kicad_pcb/))return!0};var t={Front:"Top",Back:"Bottom","F.Cu":"Top","B.Cu":"Bottom","B.Adhes":"bGlue","F.Adhes":"tGlue","B.Paste":"bCream","F.Paste":"tCream","B.SilkS":"bNames","F.SilkS":"tNames","B.Mask":"bStop","F.Mask":"tStop","F.CrtYd":"tKeepout","B.CrtYd":"bKeepout","F.Fab":"tPlace","B.Fab":"bPlace","Dwgs.User":"tValues","Edge.Cuts":"Dimension"},r={Top:{name:"Top",number:1,color:4},Inner1:{name:"Inner1",number:2,color:16},Inner2:{name:"Inner2",number:3,color:16},Inner3:{name:"Inner3",number:4,color:16},Inner4:{name:"Inner4",number:5,color:16},Inner5:{name:"Inner5",number:6,color:16},Inner6:{name:"Inner6",number:7,color:16},Inner7:{name:"Inner7",number:8,color:16},Inner8:{name:"Inner8",number:9,color:16},Inner9:{name:"Inner9",number:10,color:16},Inner10:{name:"Inner10",number:11,color:16},Inner11:{name:"Inner11",number:12,color:16},Inner12:{name:"Inner12",number:13,color:16},Inner13:{name:"Inner13",number:14,color:16},Inner14:{name:"Inner14",number:15,color:16},Bottom:{name:"Bottom",number:16,color:1},Pads:{name:"Pads",number:17,color:2},Vias:{name:"Vias",number:18,color:2},Unrouted:{name:"Unrouted",number:19,color:6},Dimension:{name:"Dimension",number:20,color:15},tPlace:{name:"tPlace",number:21,color:7},bPlace:{name:"bPlace",number:22,color:7},tOrigins:{name:"tOrigins",number:23,color:15},bOrigins:{name:"bOrigins",number:24,color:15},tNames:{name:"tNames",number:25,color:7},bNames:{name:"bNames",number:26,color:7},tValues:{name:"tValues",number:27,color:7},bValues:{name:"bValues",number:28,color:7},tStop:{name:"tStop",number:29,color:7},bStop:{name:"bStop",number:30,color:7},tCream:{name:"tCream",number:31,color:7},bCream:{name:"bCream",number:32,color:7},tFinish:{name:"tFinish",number:33,color:6},bFinish:{name:"bFinish",number:34,color:6},tGlue:{name:"tGlue",number:35,color:7},bGlue:{name:"bGlue",number:36,color:7},tTest:{name:"tTest",number:37,color:7},bTest:{name:"bTest",number:38,color:7},tKeepout:{name:"tKeepout",number:39,color:4},bKeepout:{name:"bKeepout",number:40,color:1},tRestrict:{name:"tRestrict",number:41,color:4},bRestrict:{name:"bRestrict",number:42,color:1},vRestrict:{name:"vRestrict",number:43,color:2},Drills:{name:"Drills",number:44,color:7},Holes:{name:"Holes",number:45,color:7},Milling:{name:"Milling",number:46,color:3},Measures:{name:"Measures",number:47,color:7},Document:{name:"Document",number:48,color:7},Reference:{name:"Reference",number:49,color:7},dxf:{name:"dxf",number:50,color:7},tDocu:{name:"tDocu",number:51,color:7},bDocu:{name:"bDocu",number:52,color:7},tGND_GNDA:{name:"tGND_GNDA",number:53,color:7},bGND_GNDA:{name:"bGND_GNDA",number:54,color:1},wert:{name:"wert",number:56,color:7},Nets:{name:"Nets",number:91,color:2},Busses:{name:"Busses",number:92,color:1},Pins:{name:"Pins",number:93,color:2},Symbols:{name:"Symbols",number:94,color:4},Names:{name:"Names",number:95,color:7},Values:{name:"Values",number:96,color:7},Info:{name:"Info",number:97,color:7},Guide:{name:"Guide",number:98,color:6},Muster:{name:"Muster",number:100,color:7},Patch_Top:{name:"Patch_Top",number:101,color:12},Vscore:{name:"Vscore",number:102,color:7},fp3:{name:"fp3",number:103,color:7},Name:{name:"Name",number:104,color:7},Beschreib:{name:"Beschreib",number:105,color:9},"BGA-Top":{name:"BGA-Top",number:106,color:4},"BD-Top":{name:"BD-Top",number:107,color:5},fp8:{name:"fp8",number:108,color:7},fp9:{name:"fp9",number:109,color:7},fp0:{name:"fp0",number:110,color:7},Patch_BOT:{name:"Patch_BOT",number:116,color:9},_tsilk:{name:"_tsilk",number:121,color:7},_bsilk:{name:"_bsilk",number:122,color:7},tTestmark:{name:"tTestmark",number:123,color:7},bTestmark:{name:"bTestmark",number:124,color:7},tAdjust:{name:"tAdjust",number:131,color:7},bAdjust:{name:"bAdjust",number:132,color:7},HeatSink:{name:"HeatSink",number:151,color:7},"200bmp":{name:"200bmp",number:200,color:1},"201bmp":{name:"201bmp",number:201,color:2},"202bmp":{name:"202bmp",number:202,color:3},"203bmp":{name:"203bmp",number:203,color:4},"204bmp":{name:"204bmp",number:204,color:5},"205bmp":{name:"205bmp",number:205,color:6},"206bmp":{name:"206bmp",number:206,color:7},"207bmp":{name:"207bmp",number:207,color:8},"208bmp":{name:"208bmp",number:208,color:9},"209bmp":{name:"209bmp",number:209,color:7},"210bmp":{name:"210bmp",number:210,color:7},Descript:{name:"Descript",number:250,color:3},SMDround:{name:"SMDround",number:251,color:12},cooling:{name:"cooling",number:254,color:7}};e.prototype.eagleLayer=function(e){return"*.Cu"===e&&(e="Front"),"*.Mask"===e&&(e="F.Mask"),t[e]?r[t[e]]:(console.warn("Unknown layer %s, skipping",e),{})},e.prototype.parse=function(e){e=e.toString(),e.split(/[\r\n]+/g).forEach(this.parseChunk,this),this.cmdCb=function(e,t){}},e.prototype.parseChunk=function(e){this.chunk+=e,this.chunk.split(/[\s]/).forEach(function(e){},this)},e.prototype.parseChunk=function(e){for(var t=e.toString(),r=t.length,i=0;i<r;i++){var n=t[i];if('"'!==n)if(this.stringContext)this.token+=n;else if("("===n){if(this.args=!1,this.cmd){var a={name:"",args:[]};this.cmd.args.push(a),this.cmd=a}else this.cmd={name:"",args:[]};this.context.push(this.cmd)}else if(")"===n){if(this.handleToken(),1===this.context.length)return;this.context.pop(),this.cmdDone(this.cmd),this.cmd=this.context[this.context.length-1]}else" "===n?this.handleToken():this.token+=n;else this.stringContext=!this.stringContext}},e.prototype.handleToken=function(){var e=this.token.trim();this.args?e&&this.cmd.args.push(e):(this.args=!0,this.cmd.name=this.token),this.token=""};var i="fp_text fp_circle fp_line pad".split(" ");return e.prototype.extractAttrs=function(e){var t={},r={};return e.forEach(function(e){e.name&&(e.name in t?1===r[e.name]?(t[e.name]=[t[e.name],e.args],r[e.name]=2):t[e.name].push(e.args):i.indexOf(e.name)>-1?(t[e.name]=[e.args],r[e.name]=2):(t[e.name]=e.args,r[e.name]=1))},this),t},e.prototype.spliceArgs=function(e){var t=[];return e.forEach(function(e){e.name||t.push(e)},this),t},e.prototype.parseLine=function(e){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var t={x1:parseFloat(e.attrs.start[0]),y1:parseFloat(e.attrs.start[1]),x2:parseFloat(e.attrs.end[0]),y2:parseFloat(e.attrs.end[1]),width:parseFloat(e.attrs.width[0]),layer:e.attrs.layer[0]};if("gr_arc"===e.name){var r=parseFloat(e.attrs.angle[0])/180*Math.PI,i=t.x1-t.x2,n=t.y1-t.y2,a={x:t.x1,y:t.y1,width:t.width,layer:t.layer,curve:r,angle:r,radius:Math.sqrt(i*i+n*n),start:Math.PI+Math.atan2(n,i)};return a}return t},e.prototype.parseText=function(e,t){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var r=e.attrs.effects;e.attrs.effects={},r.forEach(function(t){"font"===t.name?e.attrs.effects[t.name]=this.extractAttrs(t.args):e.attrs.effects[t.name]=t.args},this);var i={x:parseFloat(e.attrs.at[0]),y:parseFloat(e.attrs.at[1]),font:"vector",layer:e.attrs.layer[0],content:"gr_text"===e.name?e.args[0]:e.args[1]};i.content=i.content.replace(/\\n/g,"\n"),i.size=1,e.attrs.effects.font&&e.attrs.effects.font.size&&(i.size=parseFloat(e.attrs.effects.font.size[0]));var n=parseFloat(e.attrs.at[2])||0;i.rot="R"+n,n>=90&&n<=270&&(i.flipText=!0),e.args.indexOf("hide")>-1&&(i.display="off");var a={};return(e.attrs.effects.justify||[]).forEach(function(e){a[e]=!0}),a.mirror&&(i.rot="M"+i.rot),a.right?i.align="right":a.left?i.align="left":i.align="center",i.valign="middle",i},e.prototype.parseVia=function(e){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var t=e.attrs.net[0],r=this.netClass[this.netByNumber[t].className].via_drill,i={x:parseFloat(e.attrs.at[0]),y:parseFloat(e.attrs.at[1]),drill:r,layers:e.attrs.layers};return i},e.prototype.parseCircle=function(e){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var t=parseFloat(e.attrs.center[0]),r=parseFloat(e.attrs.center[1]),i=parseFloat(e.attrs.end[0]),n=parseFloat(e.attrs.end[1]),a=i-t,o=n-r,s=Math.sqrt(a*a+o*o),l={x:t,y:r,radius:s,start:0,angle:2*Math.PI,curve:360,width:e.attrs.width[0],layer:e.attrs.layer[0]};return l},e.prototype.parsePad=function(e,t){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var r;e.attrs.net&&(r=e.attrs.net[0]);var i=parseFloat(e.attrs.at[0]),n=parseFloat(e.attrs.at[1]),a="R"+((parseFloat(e.attrs.at[2])||0)-(t||0)),o=parseFloat(e.attrs.size[0]),s=parseFloat(e.attrs.size[1]),l=e.args[0],h=e.args[1],c=e.args[2];return"np_thru_hole"!==l&&"smd"!==l||(c=e.args[1],h=e.args[0],l=void 0),"smd"===h?{x1:i-o/2,y1:n-s/2,x2:i+o/2,y2:n+s/2,rot:a,name:l,type:h,shape:c,layers:e.attrs.layers,net:r}:"thru_hole"===h||"np_thru_hole"===h?{x:i,y:n,name:l,type:h,shape:"rect"===c?"square":c,layers:e.attrs.layers,net:r,drill:e.attrs.drill?parseFloat(e.attrs.drill[0])||parseFloat(e.attrs.drill[1]):o,diameter:o,drillLength:e.attrs.drill?parseFloat(e.attrs.drill[2]):null}:(console.warn("pad type %s is not supported",h,e),{})},e.prototype.parseModule=function(e){e.attrs=this.extractAttrs(e.args),e.args=this.spliceArgs(e.args);var t={smds:[],wires:[],texts:[],pads:[],polys:[],holes:[]},r={x:parseFloat(e.attrs.at[0]),y:parseFloat(e.attrs.at[1]),pkg:t,smashed:!0,absText:!1,attributes:{},padSignals:{}};"descr"in e.attrs&&(t.description=e.attrs.descr[0]);var i=parseFloat(e.attrs.at[2])||0;r.rot="R"+-i,e.attrs.fp_text.forEach(function(e){var t=this.parseText({name:"fp_text",args:e},i);t.type=e[0],t.layer=this.eagleLayer(t.layer).number,"reference"===t.type?(t.name="NAME",r.name=t.content,r.attributes.name=t,t.font="vector"):"value"===t.type?(t.name="VALUE",r.value=t.content,r.attributes.value=t,t.font="vector"):console.warn("text type '%s' not processed:",t.type,t)},this),e.attrs.fp_line&&e.attrs.fp_line.forEach(function(e){var r=this.parseLine({name:"fp_line",args:e});r.layer=this.eagleLayer(r.layer).number,t.wires.push(r)},this);var n=this.board.calcBBox(t.wires);return t.bbox=n,e.attrs.fp_circle&&e.attrs.fp_circle.forEach(function(e){var r=this.parseCircle({name:"fp_circle",args:e});r.layer=this.eagleLayer(r.layer).number,t.wires.push(r)},this),e.attrs.pad&&e.attrs.pad.forEach(function(r){var n=this.parsePad({name:"pad",args:r},i);n.layer=this.eagleLayer(n.layers?n.layers[0]:e.attrs.layer[0]).number,"smd"===n.type?t.smds.push(n):"thru_hole"===n.type?t.pads.push(n):"np_thru_hole"===n.type?t.pads.push(n):console.warn("pad not processed:",n)},this),"Back"===e.attrs.layer[0]||"B.Cu"===e.attrs.layer[0],r.matrix=this.board.matrixForRot(r.rot),r},e.prototype.cmdDone=function(){var e=this.context.map(function(e){return e.name}).join(">");if("kicad_pcb"===e){if("layers"===this.cmd.name){var r=[];this.cmd.args.forEach(function(e){var t=parseInt(e.name);"signal"===e.args[1]&&(r[t]=!0)});var i=r.length-1;this.cmd.args.forEach(function(e){var r=parseInt(e.name),n=e.args[0],a=(e.args[1],"hide"!==e.args[2],this.eagleLayer(n));!a&&r>=0&&r<=31&&(0===r?(t[n]="Top",a=this.eagleLayer("Front")):r===i?(t[n]="Bottom",a=this.eagleLayer("Back")):r>0&&r<i?(t[n]="Inner"+(r+1),a=this.eagleLayer("Inner"+(r+1))):a||console.warn("(Maybe unknown layer) We currently not supporting parsing files with more than 16 signal layers, but found layer with id = %d",r,e.args[0])),a&&(this.board.eagleLayersByName[a.name]=a,this.board.layersByNumber[a.number]=a)},this)}if("net"===this.cmd.name){var n={number:this.cmd.args[0],name:this.cmd.args[1]};this.netByName[n.name]=this.netByNumber[n.number]={name:n.name}}if("net_class"===this.cmd.name){for(var a=this.cmd.args[0],s=this.cmd.args[1],l={className:a,classDesc:s},h=2;h<this.cmd.args.length;h++){var c=this.cmd.args[h];c.name.match(/u?via_(?:dia|drill)/)?l[c.name]=parseFloat(c.args[0]):"add_net"===c.name&&(this.netByName[c.args[0]].className=a)}this.netClass[a]=l}if("gr_line"===this.cmd.name||"gr_arc"===this.cmd.name){var u=this.parseLine(this.cmd),d=this.eagleLayer(u.layer).number;this.board.plainWires[d]||(this.board.plainWires[d]=[]),this.board.plainWires[d].push(u)}if("segment"===this.cmd.name||"via"===this.cmd.name){var f,p;"segment"===this.cmd.name?(f=this.parseLine(this.cmd),p="wires"):(f=this.parseVia(this.cmd),p="vias");var m=this.cmd.attrs.net,g=this.netByNumber[m].name;this.board.signalItems[g]||(this.board.signalItems[g]={});var d,v=this.board.signalItems[g];d=f.layers?f.layers.map(function(e){return this.eagleLayer(e).number},this).join("-"):this.eagleLayer(f.layer).number,m?(v[d]||(v[d]={wires:[],vias:[]}),v[d][p].push(f)):(this.board.plainWires[d]||(this.board.plainWires[d]=[]),this.board.plainWires[d].push(f))}if("gr_circle"===this.cmd.name){var y=this.parseCircle(this.cmd),d=this.eagleLayer(y.layer).number;this.board.plainWires[d]||(this.board.plainWires[d]=[]),this.board.plainWires[d].push(y)}if("gr_text"===this.cmd.name){var x=this.parseText(this.cmd),d=this.eagleLayer(x.layer).number;this.board.plainTexts[d]||(this.board.plainTexts[d]=[]),this.board.plainTexts[d].push(x)}if("module"===this.cmd.name){var b=this.parseModule(this.cmd);this.board.elements[(0,o.default)(this.board.elements).length]=b}}},e});(function(){"undefined"==typeof __REACT_HOT_LOADER__})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2432:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function n(e,t,r){var i=e.getContext("2d"),n="black";i.globalCompositeOperation="source-over",i.fillStyle=n,i.strokeStyle=n;var a=e.width/(r.maxX-r.minX)*t.scale,l=e.height/(r.maxY-r.minY)*t.scale,h=Math.max(a,l);i.setTransform(a,0,0,l,0,0);var c=0,u=0,d=r.minX/t.scale,f=r.minY/t.scale;(0,o.default)(t.cmds,function(e){var r=e[0]>>2,a=3&e[0];16==r&&(i.globalCompositeOperation=e[1]?"destination-out":"source-over");var o=e[2]-d,l=e[3]-f;if(8&r){if(r&=-9,0==a&&(e[1]?(i.beginPath(),i.moveTo(c,u)):i.fill()),2==a)i.fill(),i.beginPath(),i.moveTo(o,l);else if(1==a)if(1==r||5==r)i.lineTo(o,l);else if(2==r||3==r)console.log("(FILL) Failed to single quadrant "+(3==r?"CCW":"CW"),e,y);else if(6==r||7==r){var p=e[4],m=e[5],g=c+p,v=u+m;i.arc(g,v,Math.sqrt(p*p+m*m),Math.atan2(-m,-p),Math.atan2(l-v,o-g),6==r)}else console.log(r);else console.log(r,a);c=o,u=l}var y=t.shapes[e[1]];if(y||console.log(e,y),2!=a)if(3==a)if("C"==y[0])i.beginPath(),i.arc(o,l,y[1]/2,0,2*Math.PI),i.fill();else if("R"==y[0])i.beginPath(),i.rect(o-y[1]/2,l-y[2]/2,y[1],y[2]),i.fill();else if("O"==y[0])i.beginPath(),i.moveTo(o,l-y[2]/2),i.bezierCurveTo(o+y[1]/2,l-y[2]/2,o+y[1]/2,l+y[2]/2,o,l+y[2]/2),i.bezierCurveTo(o-y[1]/2,l+y[2]/2,o-y[1]/2,l-y[2]/2,o,l-y[2]/2),i.fill();else if("M"==y[0])for(var x=0;x<y[1].length;x++){var b=y[1][x];if(2!=b[0]&&20!=b[0]||!b[1])if(21==b[0]&&b[1])i.beginPath(),i.rect(o+b[4]-b[2]/2,l+b[5]-b[3]/2,b[2],b[3]),i.fill();else if(4==b[0]&&b[1]){i.beginPath(),i.moveTo(b[3],b[4]);for(var _=1;_<b[2];_++)i.lineTo(b[3+2*_],b[4+2*_]);i.fill()}else if(5==b[0]&&b[1]){var w=b[2],g=o+b[3],v=l+b[4],S=b[5]/2;i.beginPath();var M=2*Math.PI/w,T=b[6]*Math.PI/180;i.moveTo(g+S*Math.cos(T),v+S*Math.sin(T));for(var _=0;_<w;_++)T+=M,i.lineTo(g+S*Math.cos(T),v+S*Math.sin(T));i.fill()}else console.log("Failed to macro",b,e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;else i.lineWidth=b[2],i.lineCap="square",i.beginPath(),i.moveTo(o+b[3],l+b[4]),i.lineTo(o+b[5],l+b[6]),i.stroke()}else console.log("Failed to expose",e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;else if(1==a)if("C"==y[0])if(y[1]||(c=o,u=l),t.type==s.index.COPPER?i.lineWidth=Math.ceil(y[1]*h/3+.01)/h*3:i.lineWidth=y[1],i.lineCap="round",1==r||5==r)i.beginPath(),i.moveTo(c,u),i.lineTo(o,l),i.stroke();else if(2==r||3==r)console.log("Failed to single quadrant "+(3==r?"CCW":"CW"),e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;else if(6==r||7==r){var p=e[4],m=e[5],g=c+p,v=u+m;i.beginPath(),i.arc(g,v,Math.sqrt(p*p+m*m),Math.atan2(-m,-p),Math.atan2(l-v,o-g),6==r),i.stroke()}else console.log("Failed to draw with circle",e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;else console.log("Failed to draw",e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;else console.log("Failed to "+r+" "+type,e,y),i.fillStyle="rgba(255, 0, 0, 1)",i.beginPath(),i.arc(o,l,.5,0,2*Math.PI),i.fill(),i.fillStyle="rgba(255, 0, 0, .2)",i.beginPath(),i.arc(o,l,1.5,0,2*Math.PI),i.fill(),i.fillStyle=n;c=o,u=l}),i.fillStyle=t.type?s.colors[t.type]:"black",i.globalCompositeOperation=t.type==s.index.SOLDER?"source-out":"source-in",i.setTransform(1,0,0,1,0,0),i.fillRect(0,0,e.width,e.height)}Object.defineProperty(t,"__esModule",{value:!0});var a=r(353),o=i(a),s={};s.renderLayer=n,s.index={BOTTOM:1,TOP:2,BOARD:0,COPPER:1,SOLDER:2,PASTE:3,SILK:4,OUTLINE:5},s.colors=[],s.colors[s.index.BOARD]="#0e2c0e",s.colors[s.index.COPPER]="#b87333",s.colors[s.index.SOLDER]="rgba(94, 152, 6, .5)",s.colors[s.index.PASTE]="#e6e8fa",s.colors[s.index.SILK]="#ffffff";var l=s,h=l;t.default=h;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(s,"RenderGerber","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/render/gerber.js"),__REACT_HOT_LOADER__.register(n,"renderLayer","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/render/gerber.js"),__REACT_HOT_LOADER__.register(l,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/render/gerber.js"),__REACT_HOT_LOADER__.register(h,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/render/gerber.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2433:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n,a=r(47),o=i(a),s=r(1373),l=i(s),h=r(352),c=(i(h),r(353)),u=i(c),d=r(2434),f=i(d),p=r(2397),m=i(p);!function(i,a){n=function(){return a()}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(void 0,function(){function e(e){var t=e.canvas;t.getContext("2d");this.canvas=t,this.board=e,this.warnings=[],this.cacheDrawingOperations=!0}return e.prototype=(0,l.default)(f.default.prototype),e.prototype.getScope=function(e,t){return e},e.prototype.scaleCanvas=function(){var e=this.canvas,t=e.getContext("2d"),r=this.board;t.fillStyle=m.default.colors.board,t.fillRect(0,0,e.width,e.height),t.transform(r.scale*r.baseScale*r.ratio,0,0,r.scale*r.baseScale*r.ratio,0,0),t.fillStyle=m.default.colors.board,t.fillRect(1,1,1,1)},e.prototype.drawPlainHoles=function(e,t){if(e){var r=(this.getScope(t,{name:e.name}),this.board),i=r.plainHoles||[];(0,u.default)(i,function(e){t.globalCompositeOperation="xor",t.beginPath(),t.arc(e.x,e.y,e.drill/2,0,2*Math.PI,!1),t.fillStyle="red",t.fill(),t.globalCompositeOperation="source-over"})}},e.prototype.draw=function(){var e=this.canvas,t=e.getContext("2d"),r=this.board;if(this.cacheDrawingOperations){this.scaleCanvas(),this._currentLayerDrawRoutines=[],this.layerDrawRoutines={};var i=r.boardFlipped?r.reverseRenderLayerOrder:r.renderLayerOrder;for(var n in i){var a=i[n];r.layerRenderFunctions[a](this,r,t),this.layerDrawRoutines[a]=this._currentLayerDrawRoutines,this._currentLayerDrawRoutines.forEach(function(e){var r=e[0];this[r].apply(this,e.slice(1).concat([t]))},this),this._currentLayerDrawRoutines=[]}}},e.prototype.redraw=function(){},e.prototype._drawSingleWire=function(e,t){t.save(),t.beginPath();var r;"longdash"===e.style?r=[3]:"shortdash"===e.style?r=[1]:"dashdot"===e.style&&(r=[3,1,1,1]),e.cap&&"flat"===e.cap?t.lineCap="butt":t.lineCap="round",r&&t.setLineDash(r),this._drawWire(e,t),t.lineWidth=e.width,t.strokeStyle=e.strokeStyle,t.stroke(),t.fill(),t.restore()},e.prototype._drawWire=function(e,t){if(t.save(),e.curve){var r,i,n=this.board.angleForRot(e.rot),a=n.degrees/180*Math.PI;n.flipped;r=i=e.radius,e.radius.constructor===Array&&(r=e.radius[0],i=e.radius[1]),t.translate(e.x,e.y),t.scale(r,i),t.arc(0,0,1,a+e.start,a+e.start+e.angle)}else t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2);t.restore()},e.prototype._drawShapeFromWires=function(e,t){if(e){var r=(this.getScope(t,{name:e.name}),this.board.plainWires[e.number]||[]);t.beginPath(),(0,u.default)(r,function(e){e.radius?t.arc(e.x,e.y,e.radius,e.start,e.start+e.curve/180*Math.PI):t.lineTo(e.x2,e.y2)}),t.setLineDash([.1,.1]),t.closePath(),t.strokeStyle="white",t.lineWidth=.05,t.stroke(),t.setLineDash([0])}},e.prototype._drawHole=function(e,t){this.board;e.shape=e.shape||"circle";var r=e.drill/2,i=e.diameter/2||r+e.strokeWidth/2;t.beginPath();var n;if("square"===e.shape)n={points:[{x:e.x+i,y:e.y+i},{x:e.x-i,y:e.y+i},{x:e.x-i,y:e.y-i},{x:e.x+i,y:e.y-i}]},t.fillStyle=e.strokeStyle,this._drawRawPoly(n,t);else if("octagon"===e.shape){var a=.4;n={points:[{x:e.x+i,y:e.y+i*a},{x:e.x+i*a,y:e.y+i},{x:e.x-i*a,y:e.y+i},{x:e.x-i,y:e.y+i*a},{x:e.x-i,y:e.y-i*a},{x:e.x-i*a,y:e.y-i},{x:e.x+i*a,y:e.y-i},{x:e.x+i,y:e.y-i*a}]},t.fillStyle=e.strokeStyle,this._drawRawPoly(n,t)}else{"circle"!==e.shape&&(this.warnings["pad_shape_"+e.shape]||(this.warnings["pad_shape_"+e.shape]=!0,console.warn("pad shape '%s' is not supported yet",e.shape))),t.strokeStyle=e.strokeStyle;var o=(e.diameter-e.drill)/2||e.strokeWidth;t.lineWidth=o,r=(e.drill+o)/2||e.drill/2+e.strokeWidth/2}t.lineCap="round",t.arc(e.x,e.y,r,2*Math.PI,0,!0),n||e.strokeFill?(t.fillStyle=e.strokeStyle,t.fill()):t.stroke()},e.prototype._drawRawPoly=function(e,t){e.points.forEach(function(e,r){0===r?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)},this),t.lineJoin="round",t.closePath()},e.prototype._drawFilledPoly=function(e,t){t.beginPath(),t.lineWidth=e.strokeWidth,this._drawRawPoly(e,t),t.strokeStyle=e.strokeStyle,e.strokeStyle&&t.stroke(),t.fillStyle=e.fillStyle,t.fill()},e.prototype._drawFilledCircle=function(e,t){t.fillStyle=e.fillStyle,t.lineJoin="round",t.lineWidth=e.radius,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),t.closePath(),t.fill()},e.prototype._drawText=function(e,t,r){var i=e.x||t.x,n=e.y||t.y,a=e.rot||t.rot||"R0",o=.9*t.size,s=void 0!==e.flipText?e.flipText:t.flipText,l=this.board,h=e.content||t.content,c=e.color,u=l.angleForRot(a),d=(u.degrees,l.matrixForRot(a)),f=10,p=""+f+"px Conv_OCRAStd",m=h.split(/\r?\n/),g=(t.interlinear||1)*f/100;this.getScope(r,{name:"text"});r.save(),r.fillStyle=c,r.font=p,r.translate(i,n),r.transform(d[0],d[2],d[1],d[3],0,0);var v=(m.length-1)*(g+f),y=0;m.forEach(function(e,t){y=Math.max(y,r.measureText(e).width)},this);var x=o/f;r.scale(1.35*x,(l.coordYFlip?1:-1)*x);var b=0;if(s){var _={center:0,left:1,right:1},w={middle:0,bottom:-1,top:1};r.translate(_[t.align||"left"]*y,w[t.valign||"bottom"]*(v+f)),u.spin||r.scale(-1,-1)}t.align&&(r.textAlign=t.align),t.valign&&(r.textBaseline=t.valign),m.forEach(function(e,i){var n=i*(g+f);"middle"===t.valign?n-=v/2:"bottom"===t.valign&&(n-=v),r.fillText(e,b,n)},this),r.restore()},e.prototype._dimCanvas=function(e,t){t.save(),t.fillStyle=m.default.colors.board,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()},(0,o.default)(e.prototype).forEach(function(t){"_"===t.charAt(0)&&e.prototype.hasOwnProperty(t)&&(e.prototype[t.substring(1)]=function(){if(!this.cacheDrawingOperations)return void this[t].apply(this,arguments);var e=[t].concat([].slice.call(arguments).filter(function(e){return!(e instanceof CanvasRenderingContext2D)}));this._currentLayerDrawRoutines.push(e)})}),e})},2434:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n,a=r(46),o=i(a),s=r(352);i(s);!function(i,a){n=function(){return a()}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(void 0,function(){function e(e){var t=e.canvas;t.getContext("2d");this.canvas=t,this.board=e,this.warnings=[]}return e.prototype.getScope=function(e,t){throw"not implemented"},e.prototype.drawPlainWires=function(e,t){if(e){var r=this.board,i=this.getScope(t,{name:e.name}),n=r.plainWires[e.number]||[];n.forEach(function(t){this.drawSingleWire((0,o.default)({},t,{cap:"round",strokeStyle:r.layerColor(e.color),width:t.width||r.minLineWidth}),i)},this)}},e.prototype.drawSignalWires=function(e,t){if(e){var r=(e.number,this.getScope(t,{name:e.name})),i=this.board;for(var n in i.signalItems){var a=this.getScope(r,{name:n}),s=i.highlightedItem&&"signal"==i.highlightedItem.type&&i.highlightedItem.name==n,l=s?i.highlightColor(e.color):i.layerColor(e.color),h=i.signalItems[n],c=h[e.number];if(c){var u=c.wires||[];u.forEach(function(e){this.drawSingleWire((0,o.default)({},e,{cap:"round",strokeStyle:l}),a)},this)}}}},e.prototype.drawSignalVias=function(e,t,r){if(e){var i=this.getScope(t,{name:"via"}),n=this.board;for(var a in n.signalItems){var s=n.signalItems[a],l=s[e];if(l){var h=l.vias||[];h.forEach(function(e){this.drawHole((0,o.default)({},e,{strokeStyle:r,diameter:e.diameter||1.5*e.drill}),i)},this)}}}},e.prototype.drawPlainTexts=function(e,t){if(e){var r=this.getScope(t,{name:e.name}),i=this.board,n=i.plainTexts[e.number]||[],a=i.layerColor(e.color);n.forEach(function(e){var t=e.content,i={color:a,content:t};this.drawText(i,e,r)},this)}},e.prototype.drawElements=function(e,t){if(e){var r=this.getScope(t,{name:e.name}),i=this.board;for(var n in i.elements){var a=i.elements[n],s=this.getScope(r,{name:n}),l=i.highlightedItem&&"element"==i.highlightedItem.type&&i.highlightedItem.name==a.name,h=l?i.highlightColor(e.color):i.layerColor(e.color),c="string"==typeof a.pkg?i.packagesByName[a.pkg]:a.pkg,u=a.matrix;c.smds.forEach(function(t){var r=t.layer;if(a.mirror&&(r=i.mirrorLayer(r)),e.number==r){var n=t.x2-t.x1,l=t.y2-t.y1,c=t.x1+n/2,d=t.y1+l/2,f=n/Math.abs(n),p=l/Math.abs(l),m=t.x1,g=t.x2,v=t.y1,y=t.y2,x=Math.min(Math.abs(n),Math.abs(l))/2;if(t.roundness){x*=t.roundness/100,m+=1*f*x,g-=1*f*x,v+=1*p*x,y-=1*p*x;var b=100===t.roundness&&Math.abs(n)===Math.abs(l)}var _=i.matrixForRot(t.rot),w=c+_[0]*(c-m)+_[1]*(d-v),S=d+_[2]*(c-m)+_[3]*(d-v),M=c+_[0]*(c-g)+_[1]*(d-y),T=d+_[2]*(c-g)+_[3]*(d-y),A=a.x+u[0]*w+u[1]*S,C=a.y+u[2]*w+u[3]*S,E=a.x+u[0]*M+u[1]*S,L=a.y+u[2]*M+u[3]*S,R=a.x+u[0]*M+u[1]*T,P=a.y+u[2]*M+u[3]*T,F=a.x+u[0]*w+u[1]*T,D=a.y+u[2]*w+u[3]*T,U=t.name,N=a.padSignals[U];i.highlightedItem&&"signal"==i.highlightedItem.type&&i.highlightedItem.name==N;if(b)this.drawFilledCircle((0,o.default)({},t,{x:A-(E-A)/2,y:C-(L-C)/2,radius:x,fillStyle:h,strokeWidth:2*x,strokeStyle:t.roundness?h:null}),s);else{var O=[{x:A,y:C},{x:E,y:L},{x:R,y:P},{x:F,y:D}];this.drawFilledPoly((0,o.default)({},t,{points:O,fillStyle:h,strokeWidth:2*x,strokeStyle:t.roundness?h:null}),s)}}},this),c.rects&&c.rects.forEach(function(t){var r=t.layer;if(a.mirror&&(r=i.mirrorLayer(r)),e.number==r){var n=a.x+u[0]*t.x1+u[1]*t.y1,l=a.y+u[2]*t.x1+u[3]*t.y1,c=a.x+u[0]*t.x2+u[1]*t.y1,d=a.y+u[2]*t.x2+u[3]*t.y1,f=a.x+u[0]*t.x2+u[1]*t.y2,p=a.y+u[2]*t.x2+u[3]*t.y2,m=a.x+u[0]*t.x1+u[1]*t.y2,g=a.y+u[2]*t.x1+u[3]*t.y2,v=t.name,y=a.padSignals[v],x=i.highlightedItem&&"signal"==i.highlightedItem.type&&i.highlightedItem.name==y,b=[{x:n,y:l},{x:c,y:d},{x:f,y:p},{x:m,y:g}];this.drawFilledPoly((0,o.default)({},t,{points:b,fillStyle:x?i.highlightColor(e.color):h}),s)}},this),c.polys.forEach(function(t){var r=t.layer;if(a.mirror&&(r=i.mirrorLayer(r)),e.number==r){for(var n=[],l=0;l<t.vertexes.length;l++){var c=t.vertexes[l],d=a.x+u[0]*c.x+u[1]*c.y,f=a.y+u[2]*c.x+u[3]*c.y;n.push({x:d,y:f})}this.drawFilledPoly((0,o.default)({},t,{points:n,fillStyle:h}),s)}},this),c.wires.forEach(function(t){var r=t.layer;if(a.mirror&&(r=i.mirrorLayer(r)),e.number==r){var n=a.x+u[0]*t.x+u[1]*t.y,o=a.y+u[2]*t.x+u[3]*t.y,l=a.x+u[0]*t.x1+u[1]*t.y1,c=a.y+u[2]*t.x1+u[3]*t.y1,d=a.x+u[0]*t.x2+u[1]*t.y2,f=a.y+u[2]*t.x2+u[3]*t.y2;this.drawSingleWire({cap:t.cap,width:t.width,curve:t.curve,rot:a.rot,x1:l,y1:c,x2:d,y2:f,x:n,y:o,radius:t.radius,angle:t.angle,start:t.start,strokeStyle:h},s)}},this),c.pads.forEach(function(e){var t=(e.layer,
a.x+u[0]*e.x+u[1]*e.y),r=a.y+u[2]*e.x+u[3]*e.y,n=(e.diameter-e.drill)/2;n<=0&&(n=i.minLineWidth),this.drawHole((0,o.default)({},e,{x:t,y:r,strokeWidth:n,strokeStyle:i.viaPadColor()}),s)},this),c.holes.forEach(function(e){var t=(e.layer,a.x+u[0]*e.x+u[1]*e.y),r=a.y+u[2]*e.x+u[3]*e.y;this.drawHole((0,o.default)({},e,{x:t,y:r,strokeWidth:i.minLineWidth,strokeStyle:i.layerColor(15)}),s)},this);var d=a.smashed,f=void 0===a.absText?a.smashed:a.absText,p=d?a.attributes:c.texts;for(var m in p)if(p.hasOwnProperty(m)){var g=p[m];if(!d||"off"!==g.display&&g.font){var v=g.layer;if(!a.smashed&&a.mirror&&(v=i.mirrorLayer(v)),e.number==v){var y=d?null:g.content,x=d?g.name:0==g.content.indexOf(">")?g.content.substring(1):null;if("NAME"==x&&(y=a.name),"VALUE"==x&&(y=a.value),y){var b=f?g.x:a.x+u[0]*g.x+u[1]*g.y,_=f?g.y:a.y+u[2]*g.x+u[3]*g.y,w=d?g.rot:a.rot,S=d?g.flipText:a.flipText;g.size;g.size&&this.drawText({x:b,y:_,content:y,color:h,rot:w,flipText:S},g,s)}}}}}}},e.prototype.dimCanvas=function(e,t){e.save(),e.setTransform(1,0,0,1,0,0),e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0,0,0,"+t+")",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore()},e});(function(){"undefined"==typeof __REACT_HOT_LOADER__})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2435:function(e,t){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=require("babel-runtime/core-js/object/create"),n=r(i),a=a||{REVISION:"51"};void 0===self.console&&(self.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}}),void 0===self.Int32Array&&(self.Int32Array=Array,self.Float32Array=Array),void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e){return this.slice(0,e.length)===e}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){var e=String(e),t=this.lastIndexOf(e);return t>=0&&t===this.length-e.length}),void 0===!String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e)),n=window.setTimeout(function(){t(r+i)},i);return e=r+i,n}),void 0===window.cancelAnimationFrame&&(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),a.FrontSide=0,a.BackSide=1,a.DoubleSide=2,a.NoShading=0,a.FlatShading=1,a.SmoothShading=2,a.NoColors=0,a.FaceColors=1,a.VertexColors=2,a.NoBlending=0,a.NormalBlending=1,a.AdditiveBlending=2,a.SubtractiveBlending=3,a.MultiplyBlending=4,a.CustomBlending=5,a.AddEquation=100,a.SubtractEquation=101,a.ReverseSubtractEquation=102,a.ZeroFactor=200,a.OneFactor=201,a.SrcColorFactor=202,a.OneMinusSrcColorFactor=203,a.SrcAlphaFactor=204,a.OneMinusSrcAlphaFactor=205,a.DstAlphaFactor=206,a.OneMinusDstAlphaFactor=207,a.DstColorFactor=208,a.OneMinusDstColorFactor=209,a.SrcAlphaSaturateFactor=210,a.MultiplyOperation=0,a.MixOperation=1,a.UVMapping=function(){},a.CubeReflectionMapping=function(){},a.CubeRefractionMapping=function(){},a.SphericalReflectionMapping=function(){},a.SphericalRefractionMapping=function(){},a.RepeatWrapping=1e3,a.ClampToEdgeWrapping=1001,a.MirroredRepeatWrapping=1002,a.NearestFilter=1003,a.NearestMipMapNearestFilter=1004,a.NearestMipMapLinearFilter=1005,a.LinearFilter=1006,a.LinearMipMapNearestFilter=1007,a.LinearMipMapLinearFilter=1008,a.UnsignedByteType=1009,a.ByteType=1010,a.ShortType=1011,a.UnsignedShortType=1012,a.IntType=1013,a.UnsignedIntType=1014,a.FloatType=1015,a.UnsignedShort4444Type=1016,a.UnsignedShort5551Type=1017,a.UnsignedShort565Type=1018,a.AlphaFormat=1019,a.RGBFormat=1020,a.RGBAFormat=1021,a.LuminanceFormat=1022,a.LuminanceAlphaFormat=1023,a.RGB_S3TC_DXT1_Format=2001,a.RGBA_S3TC_DXT1_Format=2002,a.RGBA_S3TC_DXT3_Format=2003,a.RGBA_S3TC_DXT5_Format=2004,a.Clock=function(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},a.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now(),this.running=!0},a.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},a.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()},a.Clock.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime=this.elapsedTime+e}return e},a.Color=function(e){return void 0!==e&&this.setHex(e),this},a.Color.prototype={constructor:a.Color,r:1,g:1,b:1,copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSV:function(e,t,r){var i,n,a;return 0===r?this.r=this.g=this.b=0:(i=Math.floor(6*e),n=6*e-i,e=r*(1-t),a=r*(1-t*n),t=r*(1-t*(1-n)),0===i?(this.r=r,this.g=t,this.b=e):1===i?(this.r=a,this.g=r,this.b=e):2===i?(this.r=e,this.g=r,this.b=t):3===i?(this.r=e,this.g=a,this.b=r):4===i?(this.r=t,this.g=e,this.b=r):5===i&&(this.r=r,this.g=e,this.b=a)),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},lerpSelf:function(e,t){return this.r=this.r+(e.r-this.r)*t,this.g=this.g+(e.g-this.g)*t,this.b=this.b+(e.b-this.b)*t,this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getContextStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},clone:function(){return(new a.Color).setRGB(this.r,this.g,this.b)}},a.Vector2=function(e,t){this.x=e||0,this.y=t||0},a.Vector2.prototype={constructor:a.Vector2,set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new a.Vector2(this.x,this.y)}},a.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},a.Vector3.prototype={constructor:a.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this},addScalar:function(e){return this.x=this.x+e,this.y=this.y+e,this.z=this.z+e,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this},multiply:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},multiplySelf:function(e){return this.x=this.x*e.x,this.y=this.y*e.y,this.z=this.z*e.z,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this},divideSelf:function(e){return this.x=this.x/e.x,this.y=this.y/e.y,this.z=this.z/e.z,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e):this.z=this.y=this.x=0,this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this},cross:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},crossSelf:function(e){var t=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-t*e.z,this.z=t*e.y-r*e.x,this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new a.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,n=i[0],a=i[4],o=i[8],s=i[1],l=i[5],h=i[9],c=i[2],u=i[6],i=i[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(-h,i),this.z=Math.atan2(-a,n)):(this.x=Math.atan2(u,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-r(h)),Math.abs(h)<.99999?(this.y=Math.atan2(o,i),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,n),this.z=0)):"ZXY"===t?(this.x=Math.asin(r(u)),Math.abs(u)<.99999?(this.y=Math.atan2(-c,i),this.z=Math.atan2(-a,l)):(this.y=0,this.z=Math.atan2(s,n))):"ZYX"===t?(this.y=Math.asin(-r(c)),Math.abs(c)<.99999?(this.x=Math.atan2(u,i),this.z=Math.atan2(s,n)):(this.x=0,this.z=Math.atan2(-a,l))):"YZX"===t?(this.z=Math.asin(r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-h,l),this.y=Math.atan2(-c,n)):(this.x=0,this.y=Math.atan2(o,i))):"XZY"===t&&(this.z=Math.asin(-r(a)),Math.abs(a)<.99999?(this.x=Math.atan2(u,l),this.y=Math.atan2(o,n)):(this.x=Math.atan2(-h,i),this.y=0)),this},setEulerFromQuaternion:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,n=e.y*e.y,a=e.z*e.z,o=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),o-i-n+a),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o+i-n-a)):"YXZ"===t?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o-i-n+a),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o-i+n-a)):"ZXY"===t?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),o-i-n+a),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),o-i+n-a)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),o-i-n+a),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),o+i-n-a)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),o-i+n-a),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),o+i-n-a),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),o-i+n-a),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),o+i-n-a),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=e,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new a.Vector3(this.x,this.y,this.z)}},a.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},a.Vector4.prototype={constructor:a.Vector4,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addSelf:function(e){return this.x=this.x+e.x,this.y=this.y+e.y,this.z=this.z+e.z,this.w=this.w+e.w,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},subSelf:function(e){return this.x=this.x-e.x,this.y=this.y-e.y,this.z=this.z-e.z,this.w=this.w-e.w,this},multiplyScalar:function(e){return this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e,this},divideScalar:function(e){return e?(this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this.w=this.w/e):(this.z=this.y=this.x=0,this.w=1),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this.z=this.z+(e.z-this.z)*t,this.w=this.w+(e.w-this.w)*t,this},clone:function(){return new a.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,e=e.elements,n=e[0];i=e[4];var a=e[8],o=e[1],s=e[5],l=e[9];r=e[2],t=e[6];var h=e[10];return Math.abs(i-o)<.01&&Math.abs(a-r)<.01&&Math.abs(l-t)<.01?Math.abs(i+o)<.1&&Math.abs(a+r)<.1&&Math.abs(l+t)<.1&&Math.abs(n+s+h-3)<.1?(this.set(1,0,0,0),this):(e=Math.PI,n=(n+1)/2,s=(s+1)/2,h=(h+1)/2,i=(i+o)/4,a=(a+r)/4,l=(l+t)/4,n>s&&n>h?n<.01?(t=0,i=r=.707106781):(t=Math.sqrt(n),r=i/t,i=a/t):s>h?s<.01?(t=.707106781,r=0,i=.707106781):(r=Math.sqrt(s),t=i/r,i=l/r):h<.01?(r=t=.707106781,i=0):(i=Math.sqrt(h),t=a/i,r=l/i),this.set(t,r,i,e),this):(e=Math.sqrt((t-l)*(t-l)+(a-r)*(a-r)+(o-i)*(o-i)),Math.abs(e)<.001&&(e=1),this.x=(t-l)/e,this.y=(a-r)/e,this.z=(o-i)/e,this.w=Math.acos((n+s+h-1)/2),this)}},a.Matrix3=function(){this.elements=new Float32Array(9)},a.Matrix3.prototype={constructor:a.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],r=-t[10]*t[1]+t[2]*t[9],i=t[6]*t[1]-t[2]*t[5],n=-t[10]*t[4]+t[6]*t[8],a=t[10]*t[0]-t[2]*t[8],o=-t[6]*t[0]+t[2]*t[4],s=t[9]*t[4]-t[5]*t[8],l=-t[9]*t[0]+t[1]*t[8],h=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*n+t[2]*s;0===t&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,c=this.elements;return c[0]=t*e,c[1]=t*r,c[2]=t*i,c[3]=t*n,c[4]=t*a,c[5]=t*o,c[6]=t*s,c[7]=t*l,c[8]=t*h,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},a.Matrix4=function(e,t,r,i,n,a,o,s,l,h,c,u,d,f,p,m){this.elements=new Float32Array(16),this.set(void 0!==e?e:1,t||0,r||0,i||0,n||0,void 0!==a?a:1,o||0,s||0,l||0,h||0,void 0!==c?c:1,u||0,d||0,f||0,p||0,void 0!==m?m:1)},a.Matrix4.prototype={constructor:a.Matrix4,set:function(e,t,r,i,n,a,o,s,l,h,c,u,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},lookAt:function(e,t,r){var i=this.elements,n=a.Matrix4.__v1,o=a.Matrix4.__v2,s=a.Matrix4.__v3;return s.sub(e,t).normalize(),0===s.length()&&(s.z=1),n.cross(r,s).normalize(),0===n.length()&&(s.x=s.x+1e-4,n.cross(r,s).normalize()),o.cross(s,n),i[0]=n.x,i[4]=o.x,i[8]=s.x,i[1]=n.y,i[5]=o.y,i[9]=s.y,i[2]=n.z,i[6]=o.z,i[10]=s.z,this},multiply:function(e,t){var r=e.elements,i=t.elements,n=this.elements,a=r[0],o=r[4],s=r[8],l=r[12],h=r[1],c=r[5],u=r[9],d=r[13],f=r[2],p=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],r=r[15],b=i[0],_=i[4],w=i[8],S=i[12],M=i[1],T=i[5],A=i[9],C=i[13],E=i[2],L=i[6],R=i[10],P=i[14],F=i[3],D=i[7],U=i[11],i=i[15];return n[0]=a*b+o*M+s*E+l*F,n[4]=a*_+o*T+s*L+l*D,n[8]=a*w+o*A+s*R+l*U,n[12]=a*S+o*C+s*P+l*i,n[1]=h*b+c*M+u*E+d*F,n[5]=h*_+c*T+u*L+d*D,n[9]=h*w+c*A+u*R+d*U,n[13]=h*S+c*C+u*P+d*i,n[2]=f*b+p*M+m*E+g*F,n[6]=f*_+p*T+m*L+g*D,n[10]=f*w+p*A+m*R+g*U,n[14]=f*S+p*C+m*P+g*i,n[3]=v*b+y*M+x*E+r*F,n[7]=v*_+y*T+x*L+r*D,n[11]=v*w+y*A+x*R+r*U,n[15]=v*S+y*C+x*P+r*i,this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiply(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]=t[0]*e,t[4]=t[4]*e,t[8]=t[8]*e,t[12]=t[12]*e,t[1]=t[1]*e,t[5]=t[5]*e,t[9]=t[9]*e,t[13]=t[13]*e,t[2]=t[2]*e,t[6]=t[6]*e,t[10]=t[10]*e,t[14]=t[14]*e,t[3]=t[3]*e,t[7]=t[7]*e,t[11]=t[11]*e,t[15]=t[15]*e,this},multiplyVector3:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=1/(t[3]*r+t[7]*i+t[11]*n+t[15]);return e.x=(t[0]*r+t[4]*i+t[8]*n+t[12])*a,e.y=(t[1]*r+t[5]*i+t[9]*n+t[13])*a,e.z=(t[2]*r+t[6]*i+t[10]*n+t[14])*a,e},multiplyVector4:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=e.w;return e.x=t[0]*r+t[4]*i+t[8]*n+t[12]*a,e.y=t[1]*r+t[5]*i+t[9]*n+t[13]*a,e.z=t[2]*r+t[6]*i+t[10]*n+t[14]*a,e.w=t[3]*r+t[7]*i+t[11]*n+t[15]*a,e},multiplyVector3Array:function(e){for(var t=a.Matrix4.__v1,r=0,i=e.length;r<i;r+=3)t.x=e[r],t.y=e[r+1],t.z=e[r+2],this.multiplyVector3(t),e[r]=t.x,e[r+1]=t.y,e[r+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return e.x=r*t[0]+i*t[4]+n*t[8],e.y=r*t[1]+i*t[5]+n*t[9],e.z=r*t[2]+i*t[6]+n*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,r=new a.Vector4;return r.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,r.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,r.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,r.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,r},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],o=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14],f=e[3],p=e[7],m=e[11],e=e[15];return n*s*c*f-i*l*c*f-n*o*u*f+r*l*u*f+i*o*d*f-r*s*d*f-n*s*h*p+i*l*h*p+n*a*u*p-t*l*u*p-i*a*d*p+t*s*d*p+n*o*h*m-r*l*h*m-n*a*c*m+t*l*c*m+r*a*d*m-t*o*d*m-i*o*h*e+r*s*h*e+i*a*c*e-t*s*c*e-r*a*u*e+t*o*u*e},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=this.elements;return a.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return a.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return a.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return a.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,r=e.elements,i=r[0],n=r[4],a=r[8],o=r[12],s=r[1],l=r[5],h=r[9],c=r[13],u=r[2],d=r[6],f=r[10],p=r[14],m=r[3],g=r[7],v=r[11],r=r[15];return t[0]=h*p*g-c*f*g+c*d*v-l*p*v-h*d*r+l*f*r,t[4]=o*f*g-a*p*g-o*d*v+n*p*v+a*d*r-n*f*r,t[8]=a*c*g-o*h*g+o*l*v-n*c*v-a*l*r+n*h*r,t[12]=o*h*d-a*c*d-o*l*f+n*c*f+a*l*p-n*h*p,t[1]=c*f*m-h*p*m-c*u*v+s*p*v+h*u*r-s*f*r,t[5]=a*p*m-o*f*m+o*u*v-i*p*v-a*u*r+i*f*r,t[9]=o*h*m-a*c*m-o*s*v+i*c*v+a*s*r-i*h*r,t[13]=a*c*u-o*h*u+o*s*f-i*c*f-a*s*p+i*h*p,t[2]=l*p*m-c*d*m+c*u*g-s*p*g-l*u*r+s*d*r,t[6]=o*d*m-n*p*m-o*u*g+i*p*g+n*u*r-i*d*r,t[10]=n*c*m-o*l*m+o*s*g-i*c*g-n*s*r+i*l*r,t[14]=o*l*u-n*c*u-o*s*d+i*c*d+n*s*p-i*l*p,t[3]=h*d*m-l*f*m-h*u*g+s*f*g+l*u*v-s*d*v,t[7]=n*f*m-a*d*m+a*u*g-i*f*g-n*u*v+i*d*v,t[11]=a*l*m-n*h*m-a*s*g+i*h*g+n*s*v-i*l*v,t[15]=n*h*u-a*l*u+a*s*d-i*h*d-n*s*f+i*l*f,this.multiplyScalar(1/e.determinant()),this},setRotationFromEuler:function(e,t){var r=this.elements,i=e.x,n=e.y,a=e.z,o=Math.cos(i),i=Math.sin(i),s=Math.cos(n),n=Math.sin(n),l=Math.cos(a),a=Math.sin(a);if(void 0===t||"XYZ"===t){var h=o*l,c=o*a,u=i*l,d=i*a;r[0]=s*l,r[4]=-s*a,r[8]=n,r[1]=c+u*n,r[5]=h-d*n,r[9]=-i*s,r[2]=d-h*n,r[6]=u+c*n,r[10]=o*s}else"YXZ"===t?(h=s*l,c=s*a,u=n*l,d=n*a,r[0]=h+d*i,r[4]=u*i-c,r[8]=o*n,r[1]=o*a,r[5]=o*l,r[9]=-i,r[2]=c*i-u,r[6]=d+h*i,r[10]=o*s):"ZXY"===t?(h=s*l,c=s*a,u=n*l,d=n*a,r[0]=h-d*i,r[4]=-o*a,r[8]=u+c*i,r[1]=c+u*i,r[5]=o*l,r[9]=d-h*i,r[2]=-o*n,r[6]=i,r[10]=o*s):"ZYX"===t?(h=o*l,c=o*a,u=i*l,d=i*a,r[0]=s*l,r[4]=u*n-c,r[8]=h*n+d,r[1]=s*a,r[5]=d*n+h,r[9]=c*n-u,r[2]=-n,r[6]=i*s,r[10]=o*s):"YZX"===t?(h=o*s,c=o*n,u=i*s,d=i*n,r[0]=s*l,r[4]=d-h*a,r[8]=u*a+c,r[1]=a,r[5]=o*l,r[9]=-i*l,r[2]=-n*l,r[6]=c*a+u,r[10]=h-d*a):"XZY"===t&&(h=o*s,c=o*n,u=i*s,d=i*n,r[0]=s*l,r[4]=-a,r[8]=n*l,r[1]=h*a+d,r[5]=o*l,r[9]=c*a-u,r[2]=u*a-c,r[6]=i*l,r[10]=d*a+h);return this},setRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,a=e.w,o=r+r,s=i+i,l=n+n,e=r*o,h=r*s,r=r*l,c=i*s,i=i*l,n=n*l,o=a*o,s=a*s,a=a*l;return t[0]=1-(c+n),t[4]=h-a,t[8]=r+s,t[1]=h+a,t[5]=1-(e+n),t[9]=i-o,t[2]=r-s,t[6]=i+o,t[10]=1-(e+c),this},compose:function(e,t,r){var i=this.elements,n=a.Matrix4.__m1,o=a.Matrix4.__m2;return n.identity(),n.setRotationFromQuaternion(t),o.makeScale(r.x,r.y,r.z),this.multiply(n,o),i[12]=e.x,i[13]=e.y,i[14]=e.z,this},decompose:function(e,t,r){var i=this.elements,n=a.Matrix4.__v1,o=a.Matrix4.__v2,s=a.Matrix4.__v3;return n.set(i[0],i[1],i[2]),o.set(i[4],i[5],i[6]),s.set(i[8],i[9],i[10]),e=e instanceof a.Vector3?e:new a.Vector3,t=t instanceof a.Quaternion?t:new a.Quaternion,r=r instanceof a.Vector3?r:new a.Vector3,r.x=n.length(),r.y=o.length(),r.z=s.length(),e.x=i[12],e.y=i[13],e.z=i[14],i=a.Matrix4.__m1,i.copy(this),i.elements[0]=i.elements[0]/r.x,i.elements[1]=i.elements[1]/r.x,i.elements[2]=i.elements[2]/r.x,i.elements[4]=i.elements[4]/r.y,i.elements[5]=i.elements[5]/r.y,i.elements[6]=i.elements[6]/r.y,i.elements[8]=i.elements[8]/r.z,i.elements[9]=i.elements[9]/r.z,i.elements[10]=i.elements[10]/r.z,t.setFromRotationMatrix(i),[e,t,r]},extractPosition:function(e){var t=this.elements,e=e.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(e){var t=this.elements,e=e.elements,r=a.Matrix4.__v1,i=1/r.set(e[0],e[1],e[2]).length(),n=1/r.set(e[4],e[5],e[6]).length(),r=1/r.set(e[8],e[9],e[10]).length();return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,this},translate:function(e){var t=this.elements,r=e.x,i=e.y,e=e.z;return t[12]=t[0]*r+t[4]*i+t[8]*e+t[12],t[13]=t[1]*r+t[5]*i+t[9]*e+t[13],t[14]=t[2]*r+t[6]*i+t[10]*e+t[14],t[15]=t[3]*r+t[7]*i+t[11]*e+t[15],this},rotateX:function(e){var t=this.elements,r=t[4],i=t[5],n=t[6],a=t[7],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);return t[4]=c*r+e*o,t[5]=c*i+e*s,t[6]=c*n+e*l,t[7]=c*a+e*h,t[8]=c*o-e*r,t[9]=c*s-e*i,t[10]=c*l-e*n,t[11]=c*h-e*a,this},rotateY:function(e){var t=this.elements,r=t[0],i=t[1],n=t[2],a=t[3],o=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);return t[0]=c*r-e*o,t[1]=c*i-e*s,t[2]=c*n-e*l,t[3]=c*a-e*h,t[8]=c*o+e*r,t[9]=c*s+e*i,t[10]=c*l+e*n,t[11]=c*h+e*a,this},rotateZ:function(e){var t=this.elements,r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),e=Math.sin(e);return t[0]=c*r+e*o,t[1]=c*i+e*s,t[2]=c*n+e*l,t[3]=c*a+e*h,t[4]=c*o-e*r,t[5]=c*s-e*i,t[6]=c*l-e*n,t[7]=c*h-e*a,this},rotateByAxis:function(e,t){var r=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var i=e.x,n=e.y,a=e.z,o=Math.sqrt(i*i+n*n+a*a),i=i/o,n=n/o,a=a/o,o=i*i,s=n*n,l=a*a,h=Math.cos(t),c=Math.sin(t),u=1-h,d=i*n*u,f=i*a*u,u=n*a*u,i=i*c,p=n*c,c=a*c,a=o+(1-o)*h,o=d+c,n=f-p,d=d-c,s=s+(1-s)*h,c=u+i,f=f+p,u=u-i,l=l+(1-l)*h,h=r[0],i=r[1],p=r[2],m=r[3],g=r[4],v=r[5],y=r[6],x=r[7],b=r[8],_=r[9],w=r[10],S=r[11];return r[0]=a*h+o*g+n*b,r[1]=a*i+o*v+n*_,r[2]=a*p+o*y+n*w,r[3]=a*m+o*x+n*S,r[4]=d*h+s*g+c*b,r[5]=d*i+s*v+c*_,r[6]=d*p+s*y+c*w,r[7]=d*m+s*x+c*S,r[8]=f*h+u*g+l*b,r[9]=f*i+u*v+l*_,r[10]=f*p+u*y+l*w,r[11]=f*m+u*x+l*S,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,e=e.z;return t[0]=t[0]*r,t[4]=t[4]*i,t[8]=t[8]*e,t[1]=t[1]*r,t[5]=t[5]*i,t[9]=t[9]*e,t[2]=t[2]*r,t[6]=t[6]*i,t[10]=t[10]*e,t[3]=t[3]*r,t[7]=t[7]*i,t[11]=t[11]*e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,o=e.y,s=e.z,l=n*a,h=n*o;return this.set(l*a+r,l*o-i*s,l*s+i*o,0,l*o+i*s,h*o+r,h*s-i*a,0,l*s-i*o,h*s+i*a,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeFrustum:function(e,t,r,i,n,a){var o=this.elements;return o[0]=2*n/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*n/(i-r),o[9]=(i+r)/(i-r),o[13]=0,o[2]=0,o[6]=0,o[10]=-(a+n)/(a-n),o[14]=-2*a*n/(a-n),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,r,i){var e=r*Math.tan(e*Math.PI/360),n=-e;return this.makeFrustum(n*t,e*t,n,e,r,i)},makeOrthographic:function(e,t,r,i,n,a){var o=this.elements,s=t-e,l=r-i,h=a-n;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-((t+e)/s),o[1]=0,o[5]=2/l,o[9]=0,o[13]=-((r+i)/l),o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-((a+n)/h),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},clone:function(){var e=this.elements;return new a.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},a.Matrix4.__v1=new a.Vector3,a.Matrix4.__v2=new a.Vector3,a.Matrix4.__v3=new a.Vector3,a.Matrix4.__m1=new a.Matrix4,a.Matrix4.__m2=new a.Matrix4,a.EventTarget=function(){var e={};this.addEventListener=function(t,r){void 0===e[t]&&(e[t]=[]),e[t].indexOf(r)===-1&&e[t].push(r)},this.dispatchEvent=function(t){for(var r in e[t.type])e[t.type][r](t)},this.removeEventListener=function(t,r){var i=e[t].indexOf(r);i!==-1&&e[t].splice(i,1)}},a.Frustum=function(){this.planes=[new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4,new a.Vector4]},a.Frustum.prototype.setFromMatrix=function(e){var t=this.planes,r=e.elements,e=r[0],i=r[1],n=r[2],a=r[3],o=r[4],s=r[5],l=r[6],h=r[7],c=r[8],u=r[9],d=r[10],f=r[11],p=r[12],m=r[13],g=r[14],r=r[15];for(t[0].set(a-e,h-o,f-c,r-p),t[1].set(a+e,h+o,f+c,r+p),t[2].set(a+i,h+s,f+u,r+m),t[3].set(a-i,h-s,f-u,r-m),t[4].set(a-n,h-l,f-d,r-g),t[5].set(a+n,h+l,f+d,r+g),i=0;i<6;i++)e=t[i],e.divideScalar(Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z))},a.Frustum.prototype.contains=function(e){for(var t=0,r=this.planes,t=e.matrixWorld,i=t.elements,e=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis(),n=0;n<6;n++)if(t=r[n].x*i[12]+r[n].y*i[13]+r[n].z*i[14]+r[n].w,t<=e)return!1;return!0},a.Frustum.__v1=new a.Vector3,function(e){e.Ray=function(t,r,i,n){this.origin=t||new e.Vector3,this.direction=r||new e.Vector3,this.near=i||0,this.far=n||1/0};var t=new e.Vector3,r=new e.Vector3,i=new e.Vector3,n=new e.Vector3,a=new e.Vector3,o=new e.Vector3,s=new e.Matrix4,l=function(e,t){return e.distance-t.distance},h=new e.Vector3,c=new e.Vector3,u=new e.Vector3,d=function(e,t,r){h.sub(r,e);var i=h.dot(t),e=c.add(e,u.copy(t).multiplyScalar(i));return r.distanceTo(e)},f=function(e,t,r,i){h.sub(i,t),c.sub(r,t),u.sub(e,t);var e=h.dot(h),t=h.dot(c),r=h.dot(u),n=c.dot(c),i=c.dot(u),a=1/(e*n-t*t),n=(n*r-t*i)*a,e=(e*i-t*r)*a;return n>=0&&e>=0&&n+e<1},p=function g(l,h,c){var u,p;if(l instanceof e.Particle){if(u=d(h.origin,h.direction,l.matrixWorld.getPosition()),u>l.scale.x)return c;p={distance:u,point:l.position,face:null,object:l},c.push(p)}else if(l instanceof e.Mesh){var g=l.geometry.boundingSphere.radius*l.matrixWorld.getMaxScaleOnAxis();if(u=d(h.origin,h.direction,l.matrixWorld.getPosition()),u>g)return c;var m,v,y,x,b,_=l.geometry,w=_.vertices;y=l.geometry.materials,x=l.material instanceof e.MeshFaceMaterial;var S,M=h.precision;for(l.matrixRotationWorld.extractRotation(l.matrixWorld),t.copy(h.origin),s.getInverse(l.matrixWorld),r.copy(t),s.multiplyVector3(r),i.copy(h.direction),s.rotateAxis(i).normalize(),g=0,m=_.faces.length;g<m;g++)p=_.faces[g],u=x===!0?y[p.materialIndex]:l.material,void 0!==u&&(b=u.side,n.sub(p.centroid,r),a=p.normal,u=i.dot(a),Math.abs(u)<M||(v=a.dot(n)/u,v<0||b!==e.DoubleSide&&!(b===e.FrontSide?u<0:u>0)||(o.add(r,i.multiplyScalar(v)),p instanceof e.Face3?(u=w[p.a],v=w[p.b],b=w[p.c],f(o,u,v,b)&&(v=l.matrixWorld.multiplyVector3(o.clone()),u=t.distanceTo(v),u<h.near||u>h.far||(p={distance:u,point:v,face:p,faceIndex:g,object:l},c.push(p)))):p instanceof e.Face4&&(u=w[p.a],v=w[p.b],b=w[p.c],S=w[p.d],(f(o,u,v,S)||f(o,v,b,S))&&(v=l.matrixWorld.multiplyVector3(o.clone()),u=t.distanceTo(v),u<h.near||u>h.far||(p={distance:u,point:v,face:p,faceIndex:g,object:l},c.push(p)))))))}},m=function(e,t,r){for(var e=e.getDescendants(),i=0,n=e.length;i<n;i++)p(e[i],t,r)};e.Ray.prototype.precision=1e-4,e.Ray.prototype.set=function(e,t){this.origin=e,this.direction=t},e.Ray.prototype.intersectObject=function(e,t){var r=[];return t===!0&&m(e,this,r),p(e,this,r),r.sort(l),r},e.Ray.prototype.intersectObjects=function(e,t){for(var r=[],i=0,n=e.length;i<n;i++)p(e[i],this,r),t===!0&&m(e[i],this,r);return r.sort(l),r}}(a),a.Rectangle=function(){function e(){a=i-t,o=n-r}var t=0,r=0,i=0,n=0,a=0,o=0,s=!0;this.getX=function(){return t},this.getY=function(){return r},this.getWidth=function(){return a},this.getHeight=function(){return o},this.getLeft=function(){return t},this.getTop=function(){return r},this.getRight=function(){return i},this.getBottom=function(){return n},this.set=function(a,o,l,h){s=!1,t=a,r=o,i=l,n=h,e()},this.addPoint=function(a,o){s===!0?(s=!1,t=a,r=o,i=a,n=o):(t=t<a?t:a,r=r<o?r:o,i=i>a?i:a,n=n>o?n:o),e()},this.add3Points=function(a,o,l,h,c,u){s===!0?(s=!1,t=a<l?a<c?a:c:l<c?l:c,r=o<h?o<u?o:u:h<u?h:u,i=a>l?a>c?a:c:l>c?l:c,n=o>h?o>u?o:u:h>u?h:u):(t=a<l?a<c?a<t?a:t:c<t?c:t:l<c?l<t?l:t:c<t?c:t,r=o<h?o<u?o<r?o:r:u<r?u:r:h<u?h<r?h:r:u<r?u:r,i=a>l?a>c?a>i?a:i:c>i?c:i:l>c?l>i?l:i:c>i?c:i,n=o>h?o>u?o>n?o:n:u>n?u:n:h>u?h>n?h:n:u>n?u:n),e()},this.addRectangle=function(a){s===!0?(s=!1,t=a.getLeft(),r=a.getTop(),i=a.getRight(),
n=a.getBottom()):(t=t<a.getLeft()?t:a.getLeft(),r=r<a.getTop()?r:a.getTop(),i=i>a.getRight()?i:a.getRight(),n=n>a.getBottom()?n:a.getBottom()),e()},this.inflate=function(a){t-=a,r-=a,i+=a,n+=a,e()},this.minSelf=function(a){t=t>a.getLeft()?t:a.getLeft(),r=r>a.getTop()?r:a.getTop(),i=i<a.getRight()?i:a.getRight(),n=n<a.getBottom()?n:a.getBottom(),e()},this.intersects=function(e){return!(i<e.getLeft()||t>e.getRight()||n<e.getTop()||r>e.getBottom())},this.empty=function(){s=!0,n=i=r=t=0,e()},this.isEmpty=function(){return s}},a.Math={clamp:function(e,t,r){return e<t?t:e>r?r:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0}},a.Object3D=function(){this.id=a.Object3DCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new a.Vector3(0,1,0),this.position=new a.Vector3,this.rotation=new a.Vector3,this.eulerOrder="XYZ",this.scale=new a.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new a.Matrix4,this.matrixWorld=new a.Matrix4,this.matrixRotationWorld=new a.Matrix4,this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.quaternion=new a.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this._vector=new a.Vector3},a.Object3D.prototype={constructor:a.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix),e=(new a.Matrix4).extractRotation(this.matrix),this.rotation.setEulerFromRotationMatrix(e,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return this.matrixWorld.multiplyVector3(e)},worldToLocal:function(e){return a.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(e)},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},add:function(e){if(e===this)console.warn("THR51.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof a.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof a.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){for(e.parent=void 0,this.children.splice(t,1),t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof a.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var r,i,n;for(r=0,i=this.children.length;r<i;r++){if(n=this.children[r],n.name===e)return n;if(t&&(n=n.getChildByName(e,t),void 0!==n))return n}},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;t<r;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&e!==!0||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},clone:function(){}},a.Object3D.__m1=new a.Matrix4,a.Object3DCount=0,a.Projector=function(){function e(){if(o===v){var e=new a.RenderableObject;return g.push(e),v++,o++,e}return g[o++]}function t(){if(l===x){var e=new a.RenderableVertex;return y.push(e),x++,l++,e}return y[l++]}function r(e,t){return t.z-e.z}function i(e,t){var r=0,i=1,n=e.z+e.w,a=t.z+t.w,o=-e.z+e.w,s=-t.z+t.w;return n>=0&&a>=0&&o>=0&&s>=0||!(n<0&&a<0||o<0&&s<0)&&(n<0?r=Math.max(r,n/(n-a)):a<0&&(i=Math.min(i,n/(n-a))),o<0?r=Math.max(r,o/(o-s)):s<0&&(i=Math.min(i,o/(o-s))),!(i<r)&&(e.lerpSelf(t,r),t.lerpSelf(e,1-i),!0))}var n,o,s,l,h,c,u,d,f,p,m,g=[],v=0,y=[],x=0,b=[],_=0,w=[],S=0,M=[],T=0,A=[],C=0,E={objects:[],sprites:[],lights:[],elements:[]},L=new a.Vector3,R=new a.Vector4,P=new a.Matrix4,F=new a.Matrix4,D=new a.Frustum,U=new a.Vector4,N=new a.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),P.multiply(t.projectionMatrix,t.matrixWorldInverse),P.multiplyVector3(e),e},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),P.multiply(t.matrixWorld,t.projectionMatrixInverse),P.multiplyVector3(e),e},this.pickingRay=function(e,t){var r;return e.z=-1,r=new a.Vector3(e.x,e.y,1),this.unprojectVector(e,t),this.unprojectVector(r,t),r.subSelf(e).normalize(),new a.Ray(e,r)},this.projectScene=function(g,v,x,O){var B,V,I,z,k,W,G,H,j,X,Y,q,K,Z,Q,J,$=v.near,ee=v.far,te=!1;m=f=u=c=0,E.elements.length=0,g.updateMatrixWorld(),void 0===v.parent&&v.updateMatrixWorld(),v.matrixWorldInverse.getInverse(v.matrixWorld),P.multiply(v.projectionMatrix,v.matrixWorldInverse),D.setFromMatrix(P),o=0,E.objects.length=0,E.sprites.length=0,E.lights.length=0;var re=function ne(t){for(var r=0,i=t.children.length;r<i;r++){var o=t.children[r];o.visible!==!1&&(o instanceof a.Light?E.lights.push(o):o instanceof a.Mesh||o instanceof a.Line?o.frustumCulled!==!1&&D.contains(o)!==!0||(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(L.copy(o.matrixWorld.getPosition()),P.multiplyVector3(L),n.z=L.z),E.objects.push(n)):o instanceof a.Sprite||o instanceof a.Particle?(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(L.copy(o.matrixWorld.getPosition()),P.multiplyVector3(L),n.z=L.z),E.sprites.push(n)):(n=e(),n.object=o,null!==o.renderDepth?n.z=o.renderDepth:(L.copy(o.matrixWorld.getPosition()),P.multiplyVector3(L),n.z=L.z),E.objects.push(n)),ne(o))}};for(re(g),x===!0&&E.objects.sort(r),g=0,x=E.objects.length;g<x;g++)if(H=E.objects[g].object,j=H.matrixWorld,l=0,H instanceof a.Mesh){for(X=H.geometry,Y=H.geometry.materials,I=X.vertices,q=X.faces,Z=X.faceVertexUvs,X=H.matrixRotationWorld.extractRotation(j),J=H.material instanceof a.MeshFaceMaterial,B=0,V=I.length;B<V;B++)s=t(),s.positionWorld.copy(I[B]),j.multiplyVector3(s.positionWorld),s.positionScreen.copy(s.positionWorld),P.multiplyVector4(s.positionScreen),s.positionScreen.x=s.positionScreen.x/s.positionScreen.w,s.positionScreen.y=s.positionScreen.y/s.positionScreen.w,s.visible=s.positionScreen.z>$&&s.positionScreen.z<ee;for(I=0,B=q.length;I<B;I++)if(G=q[I],V=J===!0?Y[G.materialIndex]:H.material,void 0!==V){if(W=V.side,G instanceof a.Face3){if(z=y[G.a],k=y[G.b],K=y[G.c],z.visible!==!0||k.visible!==!0||K.visible!==!0)continue;if(te=(K.positionScreen.x-z.positionScreen.x)*(k.positionScreen.y-z.positionScreen.y)-(K.positionScreen.y-z.positionScreen.y)*(k.positionScreen.x-z.positionScreen.x)<0,W!==a.DoubleSide&&te!==(W===a.FrontSide))continue;c===_?(Q=new a.RenderableFace3,b.push(Q),_++,c++,h=Q):h=b[c++],h.v1.copy(z),h.v2.copy(k),h.v3.copy(K)}else if(G instanceof a.Face4){if(z=y[G.a],k=y[G.b],K=y[G.c],Q=y[G.d],z.visible!==!0||k.visible!==!0||K.visible!==!0||Q.visible!==!0)continue;if(te=(Q.positionScreen.x-z.positionScreen.x)*(k.positionScreen.y-z.positionScreen.y)-(Q.positionScreen.y-z.positionScreen.y)*(k.positionScreen.x-z.positionScreen.x)<0||(k.positionScreen.x-K.positionScreen.x)*(Q.positionScreen.y-K.positionScreen.y)-(k.positionScreen.y-K.positionScreen.y)*(Q.positionScreen.x-K.positionScreen.x)<0,W!==a.DoubleSide&&te!==(W===a.FrontSide))continue;if(u===S){var ie=new a.RenderableFace4;w.push(ie),S++,u++,h=ie}else h=w[u++];h.v1.copy(z),h.v2.copy(k),h.v3.copy(K),h.v4.copy(Q)}for(h.normalWorld.copy(G.normal),te===!1&&(W===a.BackSide||W===a.DoubleSide)&&h.normalWorld.negate(),X.multiplyVector3(h.normalWorld),h.centroidWorld.copy(G.centroid),j.multiplyVector3(h.centroidWorld),h.centroidScreen.copy(h.centroidWorld),P.multiplyVector3(h.centroidScreen),G=G.vertexNormals,z=0,k=G.length;z<k;z++)K=h.vertexNormalsWorld[z],K.copy(G[z]),te===!1&&(W===a.BackSide||W===a.DoubleSide)&&K.negate(),X.multiplyVector3(K);for(h.vertexNormalsLength=G.length,z=0,k=Z.length;z<k;z++)if(K=Z[z][I],void 0!==K)for(W=0,G=K.length;W<G;W++)h.uvs[z][W]=K[W];h.material=V,h.z=h.centroidScreen.z,E.elements.push(h)}}else if(H instanceof a.Line)for(F.multiply(P,j),I=H.geometry.vertices,z=t(),z.positionScreen.copy(I[0]),F.multiplyVector4(z.positionScreen),j=H.type===a.LinePieces?2:1,B=1,V=I.length;B<V;B++)z=t(),z.positionScreen.copy(I[B]),F.multiplyVector4(z.positionScreen),(B+1)%j>0||(k=y[l-2],U.copy(z.positionScreen),N.copy(k.positionScreen),i(U,N)===!0&&(U.multiplyScalar(1/U.w),N.multiplyScalar(1/N.w),f===T?(Y=new a.RenderableLine,M.push(Y),T++,f++,d=Y):d=M[f++],d.v1.positionScreen.copy(U),d.v2.positionScreen.copy(N),d.z=Math.max(U.z,N.z),d.material=H.material,E.elements.push(d)));for(g=0,x=E.sprites.length;g<x;g++)H=E.sprites[g].object,j=H.matrixWorld,H instanceof a.Particle&&(R.set(j.elements[12],j.elements[13],j.elements[14],1),P.multiplyVector4(R),R.z=R.z/R.w,R.z>0&&R.z<1&&(m===C?($=new a.RenderableParticle,A.push($),C++,m++,p=$):p=A[m++],p.object=H,p.x=R.x/R.w,p.y=R.y/R.w,p.z=R.z,p.rotation=H.rotation.z,p.scale.x=H.scale.x*Math.abs(p.x-(R.x+v.projectionMatrix.elements[0])/(R.w+v.projectionMatrix.elements[12])),p.scale.y=H.scale.y*Math.abs(p.y-(R.y+v.projectionMatrix.elements[5])/(R.w+v.projectionMatrix.elements[13])),p.material=H.material,E.elements.push(p)));return O===!0&&E.elements.sort(r),E}},a.Quaternion=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},a.Quaternion.prototype={constructor:a.Quaternion,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var r=Math.cos(e.x/2),i=Math.cos(e.y/2),n=Math.cos(e.z/2),a=Math.sin(e.x/2),o=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=a*i*n+r*o*s,this.y=r*o*n-a*i*s,this.z=r*i*s+a*o*n,this.w=r*i*n-a*o*s):"YXZ"===t?(this.x=a*i*n+r*o*s,this.y=r*o*n-a*i*s,this.z=r*i*s-a*o*n,this.w=r*i*n+a*o*s):"ZXY"===t?(this.x=a*i*n-r*o*s,this.y=r*o*n+a*i*s,this.z=r*i*s+a*o*n,this.w=r*i*n-a*o*s):"ZYX"===t?(this.x=a*i*n-r*o*s,this.y=r*o*n+a*i*s,this.z=r*i*s-a*o*n,this.w=r*i*n+a*o*s):"YZX"===t?(this.x=a*i*n+r*o*s,this.y=r*o*n+a*i*s,this.z=r*i*s-a*o*n,this.w=r*i*n-a*o*s):"XZY"===t&&(this.x=a*i*n-r*o*s,this.y=r*o*n-a*i*s,this.z=r*i*s+a*o*n,this.w=r*i*n+a*o*s),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(r),this},setFromRotationMatrix:function(e){var t=e.elements,r=t[0],e=t[4],i=t[8],n=t[1],a=t[5],o=t[9],s=t[2],l=t[6],t=t[10],h=r+a+t;return h>0?(r=.5/Math.sqrt(h+1),this.w=.25/r,this.x=(l-o)*r,this.y=(i-s)*r,this.z=(n-e)*r):r>a&&r>t?(r=2*Math.sqrt(1+r-a-t),this.w=(l-o)/r,this.x=.25*r,this.y=(e+n)/r,this.z=(i+s)/r):a>t?(r=2*Math.sqrt(1+a-r-t),this.w=(i-s)/r,this.x=(e+n)/r,this.y=.25*r,this.z=(o+l)/r):(r=2*Math.sqrt(1+t-r-a),this.w=(n-e)/r,this.x=(i+s)/r,this.y=(o+l)/r,this.z=.25*r),this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x=this.x*-1,this.y=this.y*-1,this.z=this.z*-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){var r=e.x,i=e.y,n=e.z,a=e.w,o=t.x,s=t.y,l=t.z,h=t.w;return this.x=r*h+i*l-n*s+a*o,this.y=-r*l+i*h+n*o+a*s,this.z=r*s-i*o+n*h+a*l,this.w=-r*o-i*s-n*l+a*h,this},multiplySelf:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,a=e.x,o=e.y,s=e.z,e=e.w;return this.x=t*e+n*a+r*s-i*o,this.y=r*e+n*o+i*a-t*s,this.z=i*e+n*s+t*o-r*a,this.w=n*e-t*a-r*o-i*s,this},multiplyVector3:function(e,t){t||(t=e);var r=e.x,i=e.y,n=e.z,a=this.x,o=this.y,s=this.z,l=this.w,h=l*r+o*n-s*i,c=l*i+s*r-a*n,u=l*n+a*i-o*r,r=-a*r-o*i-s*n;return t.x=h*l+r*-a+c*-s-u*-o,t.y=c*l+r*-o+u*-a-h*-s,t.z=u*l+r*-s+h*-o-c*-a,t},slerpSelf:function(e,t){var r=this.x,i=this.y,n=this.z,a=this.w,o=a*e.w+r*e.x+i*e.y+n*e.z;if(o<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,o=-o):this.copy(e),o>=1)return this.w=a,this.x=r,this.y=i,this.z=n,this;var s=Math.acos(o),l=Math.sqrt(1-o*o);return Math.abs(l)<.001?(this.w=.5*(a+this.w),this.x=.5*(r+this.x),this.y=.5*(i+this.y),this.z=.5*(n+this.z),this):(o=Math.sin((1-t)*s)/l,s=Math.sin(t*s)/l,this.w=a*o+this.w*s,this.x=r*o+this.x*s,this.y=i*o+this.y*s,this.z=n*o+this.z*s,this)},clone:function(){return new a.Quaternion(this.x,this.y,this.z,this.w)}},a.Quaternion.slerp=function(e,t,r,i){var n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n<0?(r.w=-t.w,r.x=-t.x,r.y=-t.y,r.z=-t.z,n=-n):r.copy(t),Math.abs(n)>=1)return r.w=e.w,r.x=e.x,r.y=e.y,r.z=e.z,r;var t=Math.acos(n),a=Math.sqrt(1-n*n);return Math.abs(a)<.001?(r.w=.5*(e.w+r.w),r.x=.5*(e.x+r.x),r.y=.5*(e.y+r.y),r.z=.5*(e.z+r.z),r):(n=Math.sin((1-i)*t)/a,i=Math.sin(i*t)/a,r.w=e.w*n+r.w*i,r.x=e.x*n+r.x*i,r.y=e.y*n+r.y*i,r.z=e.z*n+r.z*i,r)},a.Vertex=function(e){return console.warn("THR51.Vertex has been DEPRECATED. Use THR51.Vector3 instead."),e},a.Face3=function(e,t,r,i,n,o){this.a=e,this.b=t,this.c=r,this.normal=i instanceof a.Vector3?i:new a.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=n instanceof a.Color?n:new a.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=o,this.centroid=new a.Vector3},a.Face3.prototype={constructor:a.Face3,clone:function(){var e=new a.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;t<r;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;t<r;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;t<r;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},a.Face4=function(e,t,r,i,n,o,s){this.a=e,this.b=t,this.c=r,this.d=i,this.normal=n instanceof a.Vector3?n:new a.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof a.Color?o:new a.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=s,this.centroid=new a.Vector3},a.Face4.prototype={constructor:a.Face4,clone:function(){var e=new a.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;t<r;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;t<r;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;t<r;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},a.UV=function(e,t){this.u=e||0,this.v=t||0},a.UV.prototype={constructor:a.UV,set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.u=e.u,this.v=e.v,this},lerpSelf:function(e,t){return this.u=this.u+(e.u-this.u)*t,this.v=this.v+(e.v-this.v)*t,this},clone:function(){return new a.UV(this.u,this.v)}},a.Geometry=function(){this.id=a.GeometryCount++,this.name="",this.vertices=[],this.colors=[],this.materials=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0},a.Geometry.prototype={constructor:a.Geometry,applyMatrix:function(e){var t=new a.Matrix4;t.extractRotation(e);for(var r=0,i=this.vertices.length;r<i;r++)e.multiplyVector3(this.vertices[r]);for(r=0,i=this.faces.length;r<i;r++){var n=this.faces[r];t.multiplyVector3(n.normal);for(var o=0,s=n.vertexNormals.length;o<s;o++)t.multiplyVector3(n.vertexNormals[o]);e.multiplyVector3(n.centroid)}},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],r.centroid.set(0,0,0),r instanceof a.Face3?(r.centroid.addSelf(this.vertices[r.a]),r.centroid.addSelf(this.vertices[r.b]),r.centroid.addSelf(this.vertices[r.c]),r.centroid.divideScalar(3)):r instanceof a.Face4&&(r.centroid.addSelf(this.vertices[r.a]),r.centroid.addSelf(this.vertices[r.b]),r.centroid.addSelf(this.vertices[r.c]),r.centroid.addSelf(this.vertices[r.d]),r.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,r,i,n,o,s=new a.Vector3,l=new a.Vector3;for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],i=this.vertices[r.a],n=this.vertices[r.b],o=this.vertices[r.c],s.sub(o,n),l.sub(i,n),s.crossSelf(l),s.isZero()||s.normalize(),r.normal.copy(s)},computeVertexNormals:function(){var e,t,r,i;if(void 0===this.__tmpVertices){for(i=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;e<t;e++)i[e]=new a.Vector3;for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],r instanceof a.Face3?r.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3]:r instanceof a.Face4&&(r.vertexNormals=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3])}else for(i=this.__tmpVertices,e=0,t=this.vertices.length;e<t;e++)i[e].set(0,0,0);for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],r instanceof a.Face3?(i[r.a].addSelf(r.normal),i[r.b].addSelf(r.normal),i[r.c].addSelf(r.normal)):r instanceof a.Face4&&(i[r.a].addSelf(r.normal),i[r.b].addSelf(r.normal),i[r.c].addSelf(r.normal),i[r.d].addSelf(r.normal));for(e=0,t=this.vertices.length;e<t;e++)i[e].normalize();for(e=0,t=this.faces.length;e<t;e++)r=this.faces[e],r instanceof a.Face3?(r.vertexNormals[0].copy(i[r.a]),r.vertexNormals[1].copy(i[r.b]),r.vertexNormals[2].copy(i[r.c])):r instanceof a.Face4&&(r.vertexNormals[0].copy(i[r.a]),r.vertexNormals[1].copy(i[r.b]),r.vertexNormals[2].copy(i[r.c]),r.vertexNormals[3].copy(i[r.d]))},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;r<i;r++)for(n=this.faces[r],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new a.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,l,h=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)n=this.faces[r],s=new a.Vector3,l=n instanceof a.Face3?{a:new a.Vector3,b:new a.Vector3,c:new a.Vector3}:{a:new a.Vector3,b:new a.Vector3,c:new a.Vector3,d:new a.Vector3},h.push(s),c.push(l)}for(h=this.morphNormals[e],o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)n=this.faces[r],s=h.faceNormals[r],l=h.vertexNormals[r],s.copy(n.normal),n instanceof a.Face3?(l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])):(l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2]),l.d.copy(n.vertexNormals[3]))}for(r=0,i=this.faces.length;r<i;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){function e(e,t,r,i,n,a,o){l=e.vertices[t],h=e.vertices[r],c=e.vertices[i],u=s[n],d=s[a],f=s[o],p=h.x-l.x,m=c.x-l.x,g=h.y-l.y,v=c.y-l.y,y=h.z-l.z,x=c.z-l.z,b=d.u-u.u,_=f.u-u.u,w=d.v-u.v,S=f.v-u.v,M=1/(b*S-_*w),E.set((S*p-w*m)*M,(S*g-w*v)*M,(S*y-w*x)*M),L.set((b*m-_*p)*M,(b*v-_*g)*M,(b*x-_*y)*M),A[t].addSelf(E),A[r].addSelf(E),A[i].addSelf(E),C[t].addSelf(L),C[r].addSelf(L),C[i].addSelf(L)}var t,r,i,n,o,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,S,M,T,A=[],C=[],E=new a.Vector3,L=new a.Vector3,R=new a.Vector3,P=new a.Vector3,F=new a.Vector3;for(t=0,r=this.vertices.length;t<r;t++)A[t]=new a.Vector3,C[t]=new a.Vector3;for(t=0,r=this.faces.length;t<r;t++)o=this.faces[t],s=this.faceVertexUvs[0][t],o instanceof a.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof a.Face4&&(e(this,o.a,o.b,o.d,0,1,3),e(this,o.b,o.c,o.d,1,2,3));var D=["a","b","c","d"];for(t=0,r=this.faces.length;t<r;t++)for(o=this.faces[t],i=0;i<o.vertexNormals.length;i++)F.copy(o.vertexNormals[i]),n=o[D[i]],T=A[n],R.copy(T),R.subSelf(F.multiplyScalar(F.dot(T))).normalize(),P.cross(o.vertexNormals[i],T),n=P.dot(C[n]),n=n<0?-1:1,o.vertexTangents[i]=new a.Vector4(R.x,R.y,R.z,n);this.hasTangents=!0},computeBoundingBox:function(){if(this.boundingBox||(this.boundingBox={min:new a.Vector3,max:new a.Vector3}),this.vertices.length>0){var e;e=this.vertices[0],this.boundingBox.min.copy(e),this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,r=this.boundingBox.max,i=1,n=this.vertices.length;i<n;i++)e=this.vertices[i],e.x<t.x?t.x=e.x:e.x>r.x&&(r.x=e.x),e.y<t.y?t.y=e.y:e.y>r.y&&(r.y=e.y),e.z<t.z?t.z=e.z:e.z>r.z&&(r.z=e.z)}else this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=0;null===this.boundingSphere&&(this.boundingSphere={radius:0});for(var t=0,r=this.vertices.length;t<r;t++){var i=this.vertices[t].lengthSq();i>e&&(e=i)}this.boundingSphere.radius=Math.sqrt(e)},mergeVertices:function(){var e,t,r,i,n,o={},s=[],l=[],h=Math.pow(10,4);for(t=0,r=this.vertices.length;t<r;t++)e=this.vertices[t],e=[Math.round(e.x*h),Math.round(e.y*h),Math.round(e.z*h)].join("_"),void 0===o[e]?(o[e]=t,s.push(this.vertices[t]),l[t]=s.length-1):l[t]=l[o[e]];for(t=0,r=this.faces.length;t<r;t++)if(o=this.faces[t],o instanceof a.Face3)o.a=l[o.a],o.b=l[o.b],o.c=l[o.c];else if(o instanceof a.Face4)for(o.a=l[o.a],o.b=l[o.b],o.c=l[o.c],o.d=l[o.d],e=[o.a,o.b,o.c,o.d],h=3;h>0;h--)if(e.indexOf(o["abcd"[h]])!==h){for(e.splice(h,1),this.faces[t]=new a.Face3(e[0],e[1],e[2],o.normal,o.color,o.materialIndex),e=0,i=this.faceVertexUvs.length;e<i;e++)(n=this.faceVertexUvs[e][t])&&n.splice(h,1);this.faces[t].vertexColors=o.vertexColors;break}return l=this.vertices.length-s.length,this.vertices=s,l},clone:function(){}},a.GeometryCount=0,a.BufferGeometry=function(){this.id=a.GeometryCount++,this.attributes={},this.dynamic=!1,this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.morphTargets=[]},a.BufferGeometry.prototype={constructor:a.BufferGeometry,applyMatrix:function(e){var t,r;this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==r&&(t=new a.Matrix4,t.extractRotation(e),t.multiplyVector3Array(r),this.normalsNeedUpdate=!0)},computeBoundingBox:function(){this.boundingBox||(this.boundingBox={min:new a.Vector3(1/0,1/0,1/0),max:new a.Vector3((-(1/0)),(-(1/0)),(-(1/0)))});var e=this.attributes.position.array;if(e)for(var t,r,i,n=this.boundingBox,o=0,s=e.length;o<s;o+=3)t=e[o],r=e[o+1],i=e[o+2],t<n.min.x?n.min.x=t:t>n.max.x&&(n.max.x=t),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),i<n.min.z?n.min.z=i:i>n.max.z&&(n.max.z=i);void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){this.boundingSphere||(this.boundingSphere={radius:0});var e=this.attributes.position.array;if(e){for(var t,r,i,n=0,a=0,o=e.length;a<o;a+=3)t=e[a],r=e[a+1],i=e[a+2],t=t*t+r*r+i*i,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes.position&&this.attributes.index){var e,t,r,i;if(e=this.attributes.position.array.length,void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e),numItems:e};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var n,o,s,l,h,c,u=this.offsets,d=this.attributes.index.array,f=this.attributes.position.array,p=this.attributes.normal.array,m=new a.Vector3,g=new a.Vector3,v=new a.Vector3,y=new a.Vector3,x=new a.Vector3;for(r=0,i=u.length;r<i;++r){t=u[r].start,n=u[r].count;var b=u[r].index;for(e=t,t+=n;e<t;e+=3)n=b+d[e],o=b+d[e+1],s=b+d[e+2],l=f[3*n],h=f[3*n+1],c=f[3*n+2],m.set(l,h,c),l=f[3*o],h=f[3*o+1],c=f[3*o+2],g.set(l,h,c),l=f[3*s],h=f[3*s+1],c=f[3*s+2],v.set(l,h,c),y.sub(v,g),x.sub(m,g),y.crossSelf(x),p[3*n]=p[3*n]+y.x,p[3*n+1]=p[3*n+1]+y.y,p[3*n+2]=p[3*n+2]+y.z,p[3*o]=p[3*o]+y.x,p[3*o+1]=p[3*o+1]+y.y,p[3*o+2]=p[3*o+2]+y.z,p[3*s]=p[3*s]+y.x,p[3*s+1]=p[3*s+1]+y.y,p[3*s+2]=p[3*s+2]+y.z}for(e=0,t=p.length;e<t;e+=3)l=p[e],h=p[e+1],c=p[e+2],r=1/Math.sqrt(l*l+h*h+c*c),p[e]=p[e]*r,p[e+1]=p[e+1]*r,p[e+2]=p[e+2]*r;this.normalsNeedUpdate=!0}},computeTangents:function(){function e(e){z.x=i[3*e],z.y=i[3*e+1],z.z=i[3*e+2],k.copy(z),O=h[e],V.copy(O),V.subSelf(z.multiplyScalar(z.dot(O))).normalize(),I.cross(k,O),B=I.dot(c[e]),N=B<0?-1:1,l[4*e]=V.x,l[4*e+1]=V.y,l[4*e+2]=V.z,l[4*e+3]=N}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var t=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,n=this.attributes.uv.array,o=r.length/3;if(void 0===this.attributes.tangent){var s=4*o;this.attributes.tangent={itemSize:4,array:new Float32Array(s),numItems:s}}for(var l=this.attributes.tangent.array,h=[],c=[],s=0;s<o;s++)h[s]=new a.Vector3,c[s]=new a.Vector3;var u,d,f,p,m,g,v,y,x,b,_,w,S,M,T,A,C,E,L,R,P,F,o=new a.Vector3,s=new a.Vector3,D=this.offsets;for(E=0,L=D.length;E<L;++E){C=D[E].start,R=D[E].count;var U=D[E].index;for(A=C,C+=R;A<C;A+=3)R=U+t[A],P=U+t[A+1],F=U+t[A+2],u=r[3*R],d=r[3*R+1],f=r[3*R+2],p=r[3*P],m=r[3*P+1],g=r[3*P+2],v=r[3*F],y=r[3*F+1],x=r[3*F+2],b=n[2*R],_=n[2*R+1],w=n[2*P],S=n[2*P+1],M=n[2*F],T=n[2*F+1],p-=u,u=v-u,m-=d,d=y-d,g-=f,f=x-f,w-=b,b=M-b,S-=_,_=T-_,T=1/(w*_-b*S),o.set((_*p-S*u)*T,(_*m-S*d)*T,(_*g-S*f)*T),s.set((w*u-b*p)*T,(w*d-b*m)*T,(w*f-b*g)*T),h[R].addSelf(o),h[P].addSelf(o),h[F].addSelf(o),c[R].addSelf(s),c[P].addSelf(s),c[F].addSelf(s)}var N,O,B,V=new a.Vector3,I=new a.Vector3,z=new a.Vector3,k=new a.Vector3;for(E=0,L=D.length;E<L;++E)for(C=D[E].start,R=D[E].count,U=D[E].index,A=C,C+=R;A<C;A+=3)R=U+t[A],P=U+t[A+1],F=U+t[A+2],e(R),e(P),e(F);this.tangentsNeedUpdate=this.hasTangents=!0}}},a.Spline=function(e){function t(e,t,r,i,n,a,o){return e=.5*(r-e),i=.5*(i-t),(2*(t-r)+e+i)*o+(-3*(t-r)-2*e-i)*a+e*n+t}this.points=e;var r,i,n,o,s,l,h,c,u,d=[],f={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),n=r-i,d[0]=0===i?i:i-1,d[1]=i,d[2]=i>this.points.length-2?this.points.length-1:i+1,d[3]=i>this.points.length-3?this.points.length-1:i+2,l=this.points[d[0]],h=this.points[d[1]],c=this.points[d[2]],u=this.points[d[3]],o=n*n,s=n*o,f.x=t(l.x,h.x,c.x,u.x,n,o,s),f.y=t(l.y,h.y,c.y,u.y,n,o,s),f.z=t(l.z,h.z,c.z,u.z,n,o,s),f},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;e<r;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n=t=t=0,o=new a.Vector3,s=new a.Vector3,l=[],h=0;for(l[0]=0,e||(e=100),r=this.points.length*e,o.copy(this.points[0]),e=1;e<r;e++)t=e/r,i=this.getPoint(t),s.copy(i),h+=s.distanceTo(o),o.copy(i),t=(this.points.length-1)*t,t=Math.floor(t),t!=n&&(l[t]=h,n=t);return l[l.length]=h,{chunks:l,total:h}},this.reparametrizeByArcLength=function(e){var t,r,i,n,o,s,l=[],h=new a.Vector3,c=this.getLength();for(l.push(h.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(r=c.chunks[t]-c.chunks[t-1],s=Math.ceil(e*r/c.total),n=(t-1)/(this.points.length-1),o=t/(this.points.length-1),r=1;r<s-1;r++)i=n+r*(1/s)*(o-n),i=this.getPoint(i),l.push(h.copy(i).clone());l.push(h.copy(this.points[t]).clone())}this.points=l}},a.Camera=function(){a.Object3D.call(this),this.matrixWorldInverse=new a.Matrix4,this.projectionMatrix=new a.Matrix4,this.projectionMatrixInverse=new a.Matrix4},a.Camera.prototype=(0,n.default)(a.Object3D.prototype),a.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate===!0&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},a.OrthographicCamera=function(e,t,r,i,n,o){a.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},a.OrthographicCamera.prototype=(0,n.default)(a.Camera.prototype),a.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},a.PerspectiveCamera=function(e,t,r,i){a.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype=(0,n.default)(a.Camera.prototype),a.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*Math.atan(t/(2*e))*(180/Math.PI),this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,a){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=a,this.updateProjectionMatrix()},a.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,r=-t,i=e*r,e=Math.abs(e*t-i),r=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*e/this.fullWidth,i+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*r/this.fullHeight,t-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},a.Light=function(e){a.Object3D.call(this),this.color=new a.Color(e)},a.Light.prototype=(0,n.default)(a.Object3D.prototype),a.AmbientLight=function(e){a.Light.call(this,e)},a.AmbientLight.prototype=(0,n.default)(a.Light.prototype),a.DirectionalLight=function(e,t,r){a.Light.call(this,e),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new a.Vector3(0,0,(-1e3)),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},a.DirectionalLight.prototype=(0,n.default)(a.Light.prototype),a.HemisphereLight=function(e,t,r){a.Light.call(this,e),this.groundColor=new a.Color(t),this.position=new a.Vector3(0,100,0),this.intensity=void 0!==r?r:1},a.HemisphereLight.prototype=(0,n.default)(a.Light.prototype),a.PointLight=function(e,t,r){
a.Light.call(this,e),this.position=new a.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},a.PointLight.prototype=(0,n.default)(a.Light.prototype),a.SpotLight=function(e,t,r,i,n){a.Light.call(this,e),this.position=new a.Vector3(0,1,0),this.target=new a.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/2,this.exponent=void 0!==n?n:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},a.SpotLight.prototype=(0,n.default)(a.Light.prototype),a.Loader=function(e){this.statusDomElement=(this.showStatus=e)?a.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},a.Loader.prototype={constructor:a.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),e.pop(),(e.length<1?".":e.join("/"))+"/"},initMaterials:function(e,t,r){e.materials=[];for(var i=0;i<t.length;++i)e.materials[i]=a.Loader.prototype.createMaterial(t[i],r)},hasNormals:function(e){var t,r,i=e.materials.length;for(r=0;r<i;r++)if(t=e.materials[r],t instanceof a.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function r(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function i(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function n(e,n,o,l,h,c,u){var d=o.toLowerCase().endsWith(".dds"),f=t+"/"+o;if(d){var p=a.ImageUtils.loadCompressedTexture(f);e[n]=p}else p=document.createElement("canvas"),e[n]=new a.Texture(p);if(e[n].sourceFile=o,l&&(e[n].repeat.set(l[0],l[1]),1!==l[0]&&(e[n].wrapS=a.RepeatWrapping),1!==l[1]&&(e[n].wrapT=a.RepeatWrapping)),h&&e[n].offset.set(h[0],h[1]),c&&(o={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping},void 0!==o[c[0]]&&(e[n].wrapS=o[c[0]]),void 0!==o[c[1]]&&(e[n].wrapT=o[c[1]])),u&&(e[n].anisotropy=u),!d){var m=e[n],e=new Image;e.onload=function(){if(r(this.width)&&r(this.height))m.image=this;else{var e=i(this.width),t=i(this.height);m.image.width=e,m.image.height=t,m.image.getContext("2d").drawImage(this,0,0,e,t)}m.needsUpdate=!0},e.crossOrigin=s.crossOrigin,e.src=f}}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?l="MeshPhongMaterial":"basic"===c&&(l="MeshBasicMaterial")}return void 0!==e.blending&&void 0!==a[e.blending]&&(h.blending=a[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(h.transparent=e.transparent),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.visible&&(h.visible=e.visible),void 0!==e.flipSided&&(h.side=a.BackSide),void 0!==e.doubleSided&&(h.side=a.DoubleSide),void 0!==e.wireframe&&(h.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=a.FaceColors:e.vertexColors&&(h.vertexColors=a.VertexColors)),e.colorDiffuse?h.color=o(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=o(e.colorSpecular)),e.colorAmbient&&(h.ambient=o(e.colorAmbient)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&n(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&n(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&n(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&n(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&n(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormal?(l=a.ShaderUtils.lib.normal,c=a.UniformsUtils.clone(l.uniforms),c.tNormal.value=h.normalMap,e.mapNormalFactor&&c.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),h.map&&(c.tDiffuse.value=h.map,c.enableDiffuse.value=!0),h.specularMap&&(c.tSpecular.value=h.specularMap,c.enableSpecular.value=!0),h.lightMap&&(c.tAO.value=h.lightMap,c.enableAO.value=!0),c.uDiffuseColor.value.setHex(h.color),c.uSpecularColor.value.setHex(h.specular),c.uAmbientColor.value.setHex(h.ambient),c.uShininess.value=h.shininess,void 0!==h.opacity&&(c.uOpacity.value=h.opacity),h=new a.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:!0,fog:!0})):h=new a[l](h),void 0!==e.DbgName&&(h.name=e.DbgName),h}},a.BinaryLoader=function(e){a.Loader.call(this,e)},a.BinaryLoader.prototype=(0,n.default)(a.Loader.prototype),a.BinaryLoader.prototype.load=function(e,t,r,i){var r=r?r:this.extractUrlBase(e),i=i?i:this.extractUrlBase(e),n=this.showProgress?a.Loader.prototype.updateProgress:null;this.onLoadStart(),this.loadAjaxJSON(this,e,t,r,i,n)},a.BinaryLoader.prototype.loadAjaxJSON=function(e,t,r,i,n,a){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==o.status){var s=JSON.parse(o.responseText);e.loadAjaxBuffers(s,r,n,i,a)}else console.error("THR51.BinaryLoader: Couldn't load ["+t+"] ["+o.status+"]")},o.open("GET",t,!0),o.send(null)},a.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,r,i,n){var o=new XMLHttpRequest,s=r+"/"+e.buffers,l=0;o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status||0==o.status){var r=o.response;void 0===r&&(r=new Uint8Array(o.responseBody).buffer),a.BinaryLoader.prototype.createBinModel(r,t,i,e.materials)}else console.error("THR51.BinaryLoader: Couldn't load ["+s+"] ["+o.status+"]");else 3==o.readyState?n&&(0==l&&(l=o.getResponseHeader("Content-Length")),n({total:l,loaded:o.responseText.length})):2==o.readyState&&(l=o.getResponseHeader("Content-Length"))},o.open("GET",s,!0),o.responseType="arraybuffer",o.send(null)},a.BinaryLoader.prototype.createBinModel=function(e,t,r,i){var o=function s(t){function r(e){return e%4?4-e%4:0}function n(e,t){return new Uint8Array(e,t,1)[0]}function o(e,t){return new Uint32Array(e,t,1)[0]}function l(t,r){var i,n,o,s,l,h,c,u,d=new Uint32Array(e,r,3*t);for(i=0;i<t;i++){n=d[3*i],o=d[3*i+1],s=d[3*i+2],l=U[2*n],n=U[2*n+1],h=U[2*o],c=U[2*o+1],o=U[2*s],u=U[2*s+1],s=P.faceVertexUvs[0];var f=[];f.push(new a.UV(l,n)),f.push(new a.UV(h,c)),f.push(new a.UV(o,u)),s.push(f)}}function h(t,r){var i,n,o,s,l,h,c,u,d,f,p=new Uint32Array(e,r,4*t);for(i=0;i<t;i++){n=p[4*i],o=p[4*i+1],s=p[4*i+2],l=p[4*i+3],h=U[2*n],n=U[2*n+1],c=U[2*o],d=U[2*o+1],u=U[2*s],f=U[2*s+1],s=U[2*l],o=U[2*l+1],l=P.faceVertexUvs[0];var m=[];m.push(new a.UV(h,n)),m.push(new a.UV(c,d)),m.push(new a.UV(u,f)),m.push(new a.UV(s,o)),l.push(m)}}function c(t,r,i){for(var n,o,s,l,r=new Uint32Array(e,r,3*t),h=new Uint16Array(e,i,t),i=0;i<t;i++)n=r[3*i],o=r[3*i+1],s=r[3*i+2],l=h[i],P.faces.push(new a.Face3(n,o,s,null,null,l))}function u(t,r,i){for(var n,o,s,l,h,r=new Uint32Array(e,r,4*t),c=new Uint16Array(e,i,t),i=0;i<t;i++)n=r[4*i],o=r[4*i+1],s=r[4*i+2],l=r[4*i+3],h=c[i],P.faces.push(new a.Face4(n,o,s,l,null,null,h))}function d(t,r,i,n){for(var o,s,l,h,c,u,d,r=new Uint32Array(e,r,3*t),i=new Uint32Array(e,i,3*t),f=new Uint16Array(e,n,t),n=0;n<t;n++){o=r[3*n],s=r[3*n+1],l=r[3*n+2],c=i[3*n],u=i[3*n+1],d=i[3*n+2],h=f[n];var p=D[3*u],m=D[3*u+1];u=D[3*u+2];var g=D[3*d],v=D[3*d+1];d=D[3*d+2],P.faces.push(new a.Face3(o,s,l,[new a.Vector3(D[3*c],D[3*c+1],D[3*c+2]),new a.Vector3(p,m,u),new a.Vector3(g,v,d)],null,h))}}function f(t,r,i,n){for(var o,s,l,h,c,u,d,f,p,r=new Uint32Array(e,r,4*t),i=new Uint32Array(e,i,4*t),m=new Uint16Array(e,n,t),n=0;n<t;n++){o=r[4*n],s=r[4*n+1],l=r[4*n+2],h=r[4*n+3],u=i[4*n],d=i[4*n+1],f=i[4*n+2],p=i[4*n+3],c=m[n];var g=D[3*d],v=D[3*d+1];d=D[3*d+2];var y=D[3*f],x=D[3*f+1];f=D[3*f+2];var b=D[3*p],_=D[3*p+1];p=D[3*p+2],P.faces.push(new a.Face4(o,s,l,h,[new a.Vector3(D[3*u],D[3*u+1],D[3*u+2]),new a.Vector3(g,v,d),new a.Vector3(y,x,f),new a.Vector3(b,_,p)],null,c))}}var p,s,m,g,v,y,x,b,_,w,S,M,T,A,C,E,L,R,P=this,F=0,D=[],U=[];for(a.Geometry.call(this),a.Loader.prototype.initMaterials(P,i,t),C=e,L=F,t=new Uint8Array(C,L,12),w="",T=0;T<12;T++)w+=String.fromCharCode(t[L+T]);p=n(C,L+12),n(C,L+13),n(C,L+14),n(C,L+15),s=n(C,L+16),m=n(C,L+17),g=n(C,L+18),v=n(C,L+19),y=o(C,L+20),x=o(C,L+20+4),b=o(C,L+20+8),_=o(C,L+20+12),w=o(C,L+20+16),S=o(C,L+20+20),M=o(C,L+20+24),T=o(C,L+20+28),t=o(C,L+20+32),A=o(C,L+20+36),C=o(C,L+20+40),F+=p,L=3*s+v,R=4*s+v,E=_*L,p=w*(L+3*m),s=S*(L+3*g),v=M*(L+3*m+3*g),L=T*R,m=t*(R+4*m),g=A*(R+4*g),R=F;var N,O,B,V,F=new Float32Array(e,F,3*y);for(N=0;N<y;N++)O=F[3*N],B=F[3*N+1],V=F[3*N+2],P.vertices.push(new a.Vector3(O,B,V));if(y=F=R+3*y*Float32Array.BYTES_PER_ELEMENT,x)for(F=new Int8Array(e,F,3*x),R=0;R<x;R++)N=F[3*R],O=F[3*R+1],B=F[3*R+2],D.push(N/127,O/127,B/127);if(F=y+3*x*Int8Array.BYTES_PER_ELEMENT,x=F+=r(3*x),b)for(F=new Float32Array(e,F,2*b),y=0;y<b;y++)R=F[2*y],N=F[2*y+1],U.push(R,N);b=F=x+2*b*Float32Array.BYTES_PER_ELEMENT,E=b+E+r(2*_),x=E+p+r(2*w),p=x+s+r(2*S),s=p+v+r(2*M),L=s+L+r(2*T),v=L+m+r(2*t),m=v+g+r(2*A),S&&(g=x+S*Uint32Array.BYTES_PER_ELEMENT*3,c(S,x,g+S*Uint32Array.BYTES_PER_ELEMENT*3),l(S,g)),M&&(S=p+M*Uint32Array.BYTES_PER_ELEMENT*3,g=S+M*Uint32Array.BYTES_PER_ELEMENT*3,d(M,p,S,g+M*Uint32Array.BYTES_PER_ELEMENT*3),l(M,g)),A&&(M=v+A*Uint32Array.BYTES_PER_ELEMENT*4,u(A,v,M+A*Uint32Array.BYTES_PER_ELEMENT*4),h(A,M)),C&&(A=m+C*Uint32Array.BYTES_PER_ELEMENT*4,M=A+C*Uint32Array.BYTES_PER_ELEMENT*4,f(C,m,A,M+C*Uint32Array.BYTES_PER_ELEMENT*4),h(C,M)),_&&c(_,b,b+_*Uint32Array.BYTES_PER_ELEMENT*3),w&&(_=E+w*Uint32Array.BYTES_PER_ELEMENT*3,d(w,E,_,_+w*Uint32Array.BYTES_PER_ELEMENT*3)),T&&u(T,s,s+T*Uint32Array.BYTES_PER_ELEMENT*4),t&&(w=L+t*Uint32Array.BYTES_PER_ELEMENT*4,f(t,L,w,w+t*Uint32Array.BYTES_PER_ELEMENT*4)),this.computeCentroids(),this.computeFaceNormals(),a.Loader.prototype.hasNormals(this)&&this.computeTangents()};o.prototype=(0,n.default)(a.Geometry.prototype),t(new o(r))},a.ImageLoader=function(){a.EventTarget.call(this),this.crossOrigin=null},a.ImageLoader.prototype={constructor:a.ImageLoader,load:function(e,t){var r=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){r.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.crossOrigin&&(t.crossOrigin=r.crossOrigin),t.src=e}},a.JSONLoader=function(e){a.Loader.call(this,e)},a.JSONLoader.prototype=(0,n.default)(a.Loader.prototype),a.JSONLoader.prototype.load=function(e,t,r){r=r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},a.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,n){var a=new XMLHttpRequest,o=0;a.onreadystatechange=function(){if(a.readyState===a.DONE)if(200===a.status||0===a.status){if(a.responseText){var s=JSON.parse(a.responseText);e.createModel(s,r,i)}else console.warn("THR51.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THR51.JSONLoader: Couldn't load ["+t+"] ["+a.status+"]");else a.readyState===a.LOADING?n&&(0===o&&(o=a.getResponseHeader("Content-Length")),n({total:o,loaded:a.responseText.length})):a.readyState===a.HEADERS_RECEIVED&&(o=a.getResponseHeader("Content-Length"))},a.open("GET",t,!0),a.send(null)},a.JSONLoader.prototype.createModel=function(e,t,r){var i=new a.Geometry,n=void 0!==e.scale?1/e.scale:1;this.initMaterials(i,e.materials,r);var o,s,l,h,c,u,d,f,p,m,g,v,y,x,b=e.faces;p=e.vertices;var _=e.normals,w=e.colors,S=0;for(o=0;o<e.uvs.length;o++)e.uvs[o].length&&S++;for(o=0;o<S;o++)i.faceUvs[o]=[],i.faceVertexUvs[o]=[];for(r=0,h=p.length;r<h;)c=new a.Vector3,c.x=p[r++]*n,c.y=p[r++]*n,c.z=p[r++]*n,i.vertices.push(c);for(r=0,h=b.length;r<h;){if(p=b[r++],c=1&p,l=2&p,o=4&p,s=8&p,d=16&p,u=32&p,m=64&p,p=128&p,c?(g=new a.Face4,g.a=b[r++],g.b=b[r++],g.c=b[r++],g.d=b[r++],c=4):(g=new a.Face3,g.a=b[r++],g.b=b[r++],g.c=b[r++],c=3),l&&(l=b[r++],g.materialIndex=l),l=i.faces.length,o)for(o=0;o<S;o++)v=e.uvs[o],f=b[r++],x=v[2*f],f=v[2*f+1],i.faceUvs[o][l]=new a.UV(x,f);if(s)for(o=0;o<S;o++){for(v=e.uvs[o],y=[],s=0;s<c;s++)f=b[r++],x=v[2*f],f=v[2*f+1],y[s]=new a.UV(x,f);i.faceVertexUvs[o][l]=y}if(d&&(d=3*b[r++],s=new a.Vector3,s.x=_[d++],s.y=_[d++],s.z=_[d],g.normal=s),u)for(o=0;o<c;o++)d=3*b[r++],s=new a.Vector3,s.x=_[d++],s.y=_[d++],s.z=_[d],g.vertexNormals.push(s);if(m&&(u=b[r++],u=new a.Color(w[u]),g.color=u),p)for(o=0;o<c;o++)u=b[r++],u=new a.Color(w[u]),g.vertexColors.push(u);i.faces.push(g)}if(e.skinWeights)for(r=0,h=e.skinWeights.length;r<h;r+=2)b=e.skinWeights[r],_=e.skinWeights[r+1],i.skinWeights.push(new a.Vector4(b,_,0,0));if(e.skinIndices)for(r=0,h=e.skinIndices.length;r<h;r+=2)b=e.skinIndices[r],_=e.skinIndices[r+1],i.skinIndices.push(new a.Vector4(b,_,0,0));if(i.bones=e.bones,i.animation=e.animation,void 0!==e.morphTargets)for(r=0,h=e.morphTargets.length;r<h;r++)for(i.morphTargets[r]={},i.morphTargets[r].name=e.morphTargets[r].name,i.morphTargets[r].vertices=[],w=i.morphTargets[r].vertices,S=e.morphTargets[r].vertices,b=0,_=S.length;b<_;b+=3)p=new a.Vector3,p.x=S[b]*n,p.y=S[b+1]*n,p.z=S[b+2]*n,w.push(p);if(void 0!==e.morphColors)for(r=0,h=e.morphColors.length;r<h;r++)for(i.morphColors[r]={},i.morphColors[r].name=e.morphColors[r].name,i.morphColors[r].colors=[],_=i.morphColors[r].colors,w=e.morphColors[r].colors,n=0,b=w.length;n<b;n+=3)S=new a.Color(16755200),S.setRGB(w[n],w[n+1],w[n+2]),_.push(S);i.computeCentroids(),i.computeFaceNormals(),this.hasNormals(i)&&i.computeTangents(),t(i)},a.GeometryLoader=function(){a.EventTarget.call(this),this.path=this.crossOrigin=null},a.GeometryLoader.prototype={constructor:a.GeometryLoader,load:function(e){var t=this,r=null;if(null===t.path){var i=e.split("/");i.pop(),t.path=i.length<1?".":i.join("/")}i=new XMLHttpRequest,i.addEventListener("load",function(i){i.target.responseText?r=t.parse(JSON.parse(i.target.responseText),n):t.dispatchEvent({type:"error",message:"Invalid file ["+e+"]"})},!1),i.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),i.open("GET",e,!0),i.send(null);var n=new a.LoadingMonitor;n.addEventListener("load",function(){t.dispatchEvent({type:"load",content:r})}),n.add(i)},parse:function(e,t){var r=this,i=new a.Geometry,n=void 0!==e.scale?1/e.scale:1;if(e.materials){i.materials=[];for(var o=0;o<e.materials.length;++o){var s=e.materials[o],l=function(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e},h=function(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))},c=function(e,i,n,o,s,c){e[i]=new a.Texture,e[i].sourceFile=n,o&&(e[i].repeat.set(o[0],o[1]),1!==o[0]&&(e[i].wrapS=a.RepeatWrapping),1!==o[1]&&(e[i].wrapT=a.RepeatWrapping)),s&&e[i].offset.set(s[0],s[1]),c&&(o={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping},void 0!==o[c[0]]&&(e[i].wrapS=o[c[0]]),void 0!==o[c[1]]&&(e[i].wrapT=o[c[1]]));var u=e[i],e=new a.ImageLoader;e.addEventListener("load",function(e){if(e=e.content,l(e.width)&&l(e.height))u.image=e;else{var t=h(e.width),r=h(e.height);u.image=document.createElement("canvas"),u.image.width=t,u.image.height=r,u.image.getContext("2d").drawImage(e,0,0,t,r)}u.needsUpdate=!0}),e.crossOrigin=r.crossOrigin,e.load(r.path+"/"+n),t&&t.add(e)},u=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},d="MeshLambertMaterial",f={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(s.shading){var p=s.shading.toLowerCase();"phong"===p?d="MeshPhongMaterial":"basic"===p&&(d="MeshBasicMaterial")}void 0!==s.blending&&void 0!==a[s.blending]&&(f.blending=a[s.blending]),(void 0!==s.transparent||s.opacity<1)&&(f.transparent=s.transparent),void 0!==s.depthTest&&(f.depthTest=s.depthTest),void 0!==s.depthWrite&&(f.depthWrite=s.depthWrite),void 0!==s.vertexColors&&("face"==s.vertexColors?f.vertexColors=a.FaceColors:s.vertexColors&&(f.vertexColors=a.VertexColors)),s.colorDiffuse?f.color=u(s.colorDiffuse):s.DbgColor&&(f.color=s.DbgColor),s.colorSpecular&&(f.specular=u(s.colorSpecular)),s.colorAmbient&&(f.ambient=u(s.colorAmbient)),s.transparency&&(f.opacity=s.transparency),s.specularCoef&&(f.shininess=s.specularCoef),void 0!==s.visible&&(f.visible=s.visible),void 0!==s.flipSided&&(f.side=a.BackSide),void 0!==s.doubleSided&&(f.side=a.DoubleSide),void 0!==s.wireframe&&(f.wireframe=s.wireframe),s.mapDiffuse&&c(f,"map",s.mapDiffuse,s.mapDiffuseRepeat,s.mapDiffuseOffset,s.mapDiffuseWrap),s.mapLight&&c(f,"lightMap",s.mapLight,s.mapLightRepeat,s.mapLightOffset,s.mapLightWrap),s.mapBump&&c(f,"bumpMap",s.mapBump,s.mapBumpRepeat,s.mapBumpOffset,s.mapBumpWrap),s.mapNormal&&c(f,"normalMap",s.mapNormal,s.mapNormalRepeat,s.mapNormalOffset,s.mapNormalWrap),s.mapSpecular&&c(f,"specularMap",s.mapSpecular,s.mapSpecularRepeat,s.mapSpecularOffset,s.mapSpecularWrap),s.mapNormal?(c=a.ShaderUtils.lib.normal,u=a.UniformsUtils.clone(c.uniforms),u.tNormal.value=f.normalMap,s.mapNormalFactor&&u.uNormalScale.value.set(s.mapNormalFactor,s.mapNormalFactor),f.map&&(u.tDiffuse.value=f.map,u.enableDiffuse.value=!0),f.specularMap&&(u.tSpecular.value=f.specularMap,u.enableSpecular.value=!0),f.lightMap&&(u.tAO.value=f.lightMap,u.enableAO.value=!0),u.uDiffuseColor.value.setHex(f.color),u.uSpecularColor.value.setHex(f.specular),u.uAmbientColor.value.setHex(f.ambient),u.uShininess.value=f.shininess,void 0!==f.opacity&&(u.uOpacity.value=f.opacity),f=new a.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:u,lights:!0,fog:!0})):f=new a[d](f),void 0!==s.DbgName&&(f.name=s.DbgName),i.materials[o]=f}}var s=e.faces,m=e.vertices,f=e.normals,c=e.colors,u=0;if(e.uvs)for(o=0;o<e.uvs.length;o++)e.uvs[o].length&&u++;for(o=0;o<u;o++)i.faceUvs[o]=[],i.faceVertexUvs[o]=[];for(d=0,p=m.length;d<p;){var g=new a.Vector3;g.x=m[d++]*n,g.y=m[d++]*n,g.z=m[d++]*n,i.vertices.push(g)}for(d=0,p=s.length;d<p;){var v=s[d++],y=2&v,o=4&v,x=8&v,b=16&v,m=32&v,_=64&v,g=128&v;if(1&v){v=new a.Face4,v.a=s[d++],v.b=s[d++],v.c=s[d++],v.d=s[d++];var w=4}else v=new a.Face3,v.a=s[d++],v.b=s[d++],v.c=s[d++],w=3;y&&(y=s[d++],v.materialIndex=y);var S=i.faces.length;if(o)for(o=0;o<u;o++){var M=e.uvs[o],y=s[d++],T=M[2*y],y=M[2*y+1];i.faceUvs[o][S]=new a.UV(T,y)}if(x)for(o=0;o<u;o++){for(var M=e.uvs[o],x=[],A=0;A<w;A++)y=s[d++],T=M[2*y],y=M[2*y+1],x[A]=new a.UV(T,y);i.faceVertexUvs[o][S]=x}if(b&&(b=3*s[d++],y=new a.Vector3,y.x=f[b++],y.y=f[b++],y.z=f[b],v.normal=y),m)for(o=0;o<w;o++)b=3*s[d++],y=new a.Vector3,y.x=f[b++],y.y=f[b++],y.z=f[b],v.vertexNormals.push(y);if(_&&(m=s[d++],v.color=new a.Color(c[m])),g)for(o=0;o<w;o++)m=s[d++],v.vertexColors.push(new a.Color(c[m]));i.faces.push(v)}if(e.skinWeights)for(o=0,s=e.skinWeights.length;o<s;o+=2)i.skinWeights.push(new a.Vector4(e.skinWeights[o],e.skinWeights[o+1],0,0));if(e.skinIndices)for(o=0,s=e.skinIndices.length;o<s;o+=2)f=0,i.skinIndices.push(new a.Vector4(e.skinIndices[o],e.skinIndices[o+1],f,0));if(i.bones=e.bones,i.animation=e.animation,e.morphTargets)for(o=0,s=e.morphTargets.length;o<s;o++)for(i.morphTargets[o]={},i.morphTargets[o].name=e.morphTargets[o].name,i.morphTargets[o].vertices=[],f=i.morphTargets[o].vertices,c=e.morphTargets[o].vertices,y=0,u=c.length;y<u;y+=3)g=new a.Vector3,g.x=c[y]*n,g.y=c[y+1]*n,g.z=c[y+2]*n,f.push(g);if(e.morphColors)for(o=0,s=e.morphColors.length;o<s;o++)for(i.morphColors[o]={},i.morphColors[o].name=e.morphColors[o].name,i.morphColors[o].colors=[],n=i.morphColors[o].colors,c=e.morphColors[o].colors,f=0,u=c.length;f<u;f+=3)d=new a.Color(16755200),d.setRGB(c[f],c[f+1],c[f+2]),n.push(d);return i.computeCentroids(),i.computeFaceNormals(),i}},a.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.addGeometryHandler("ascii",a.JSONLoader),this.addGeometryHandler("binary",a.BinaryLoader)},a.SceneLoader.prototype.constructor=a.SceneLoader,a.SceneLoader.prototype.load=function(e,t){var r=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0===i.status){var n=JSON.parse(i.responseText);r.parse(n,t,e)}else console.error("THR51.SceneLoader: Couldn't load ["+e+"] ["+i.status+"]")},i.open("GET",e,!0),i.send(null)},a.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},a.SceneLoader.prototype.parse=function(e,t,r){function i(e,t){return"relativeToHTML"==t?e:U+"/"+e}function n(e,t){for(var r in t)if(void 0===F.objects[r]){var i=t[r],o=null;if(void 0!==i.geometry?(S=F.geometries[i.geometry])&&(o=!1,M=F.materials[i.materials[0]],(o=M instanceof a.ShaderMaterial)&&S.computeTangents(),v=i.position,y=i.rotation,x=i.quaternion,b=i.scale,m=i.matrix,x=0,0===i.materials.length&&(M=new a.MeshFaceMaterial),i.materials.length>1&&(M=new a.MeshFaceMaterial),i.morph?(o=new a.MorphAnimMesh(S,M),void 0!==i.duration&&(o.duration=i.duration),void 0!==i.time&&(o.time=i.time),void 0!==i.mirroredLoop&&(o.mirroredLoop=i.mirroredLoop),M.morphNormals&&S.computeMorphNormals()):o=new a.Mesh(S,M),o.name=r,m?(o.matrixAutoUpdate=!1,o.matrix.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15])):(o.position.set(v[0],v[1],v[2]),x?(o.quaternion.set(x[0],x[1],x[2],x[3]),o.useQuaternion=!0):o.rotation.set(y[0],y[1],y[2]),o.scale.set(b[0],b[1],b[2])),o.visible=i.visible,o.castShadow=i.castShadow,o.receiveShadow=i.receiveShadow,e.add(o),F.objects[r]=o):(v=i.position,y=i.rotation,x=i.quaternion,b=i.scale,x=0,o=new a.Object3D,o.name=r,o.position.set(v[0],v[1],v[2]),x?(o.quaternion.set(x[0],x[1],x[2],x[3]),o.useQuaternion=!0):o.rotation.set(y[0],y[1],y[2]),o.scale.set(b[0],b[1],b[2]),o.visible=void 0!==i.visible&&i.visible,e.add(o),F.objects[r]=o,F.empties[r]=o),o){if(void 0!==i.properties)for(var s in i.properties)o.properties[s]=i.properties[s];void 0!==i.children&&n(o,i.children)}}}function o(e){return function(t){F.geometries[e]=t,n(F.scene,N.objects),E-=1,D.onLoadComplete(),l()}}function s(e){return function(t){F.geometries[e]=t}}function l(){D.callbackProgress({totalModels:R,totalTextures:P,loadedModels:R-E,loadedTextures:P-L},F),D.onLoadProgress(),0===E&&0===L&&t(F)}var h,c,u,d,f,p,m,g,v,y,x,b,_,w,S,M,T,A,C,E,L,R,P,F,D=this,U=a.Loader.prototype.extractUrlBase(r),N=e;for(_ in this.geometryHandlerMap)this.geometryHandlerMap[_].loaderObject=new this.geometryHandlerMap[_].loaderClass;L=E=0,F={scene:new a.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}},N.transform&&(e=N.transform.position,r=N.transform.rotation,_=N.transform.scale,e&&F.scene.position.set(e[0],e[1],e[2]),r&&F.scene.rotation.set(r[0],r[1],r[2]),_&&F.scene.scale.set(_[0],_[1],_[2]),(e||r||_)&&(F.scene.updateMatrix(),F.scene.updateMatrixWorld())),e=function(e){return function(){L-=e,l(),D.onLoadComplete()}};for(d in N.cameras)_=N.cameras[d],"perspective"===_.type?T=new a.PerspectiveCamera(_.fov,_.aspect,_.near,_.far):"ortho"===_.type&&(T=new a.OrthographicCamera(_.left,_.right,_.top,_.bottom,_.near,_.far)),v=_.position,r=_.target,_=_.up,T.position.set(v[0],v[1],v[2]),T.target=new a.Vector3(r[0],r[1],r[2]),_&&T.up.set(_[0],_[1],_[2]),F.cameras[d]=T;for(u in N.lights)r=N.lights[u],d=void 0!==r.color?r.color:16777215,T=void 0!==r.intensity?r.intensity:1,"directional"===r.type?(v=r.direction,g=new a.DirectionalLight(d,T),g.position.set(v[0],v[1],v[2]),g.position.normalize()):"point"===r.type?(v=r.position,g=r.distance,g=new a.PointLight(d,T,g),g.position.set(v[0],v[1],v[2])):"ambient"===r.type&&(g=new a.AmbientLight(d)),F.scene.add(g),F.lights[u]=g;for(f in N.fogs)u=N.fogs[f],"linear"===u.type?A=new a.Fog(0,u.near,u.far):"exp2"===u.type&&(A=new a.FogExp2(0,u.density)),_=u.color,A.color.setRGB(_[0],_[1],_[2]),F.fogs[f]=A;F.cameras&&N.defaults.camera&&(F.currentCamera=F.cameras[N.defaults.camera]),F.fogs&&N.defaults.fog&&(F.scene.fog=F.fogs[N.defaults.fog]),_=N.defaults.bgcolor,F.bgColor=new a.Color,F.bgColor.setRGB(_[0],_[1],_[2]),F.bgColorAlpha=N.defaults.bgalpha;for(h in N.geometries)f=N.geometries[h],f.type in this.geometryHandlerMap&&(E+=1,D.onLoadStart());R=E;for(h in N.geometries)if(f=N.geometries[h],"cube"===f.type)S=new a.CubeGeometry(f.width,f.height,f.depth,f.segmentsWidth,f.segmentsHeight,f.segmentsDepth,null,f.flipped,f.sides),F.geometries[h]=S;else if("plane"===f.type)S=new a.PlaneGeometry(f.width,f.height,f.segmentsWidth,f.segmentsHeight),F.geometries[h]=S;else if("sphere"===f.type)S=new a.SphereGeometry(f.radius,f.segmentsWidth,f.segmentsHeight),F.geometries[h]=S;else if("cylinder"===f.type)S=new a.CylinderGeometry(f.topRad,f.botRad,f.height,f.radSegs,f.heightSegs),F.geometries[h]=S;else if("torus"===f.type)S=new a.TorusGeometry(f.radius,f.tube,f.segmentsR,f.segmentsT),F.geometries[h]=S;else if("icosahedron"===f.type)S=new a.IcosahedronGeometry(f.radius,f.subdivisions),F.geometries[h]=S;else if(f.type in this.geometryHandlerMap){A={};for(C in f)"type"!==C&&"url"!==C&&(A[C]=f[C]);this.geometryHandlerMap[f.type].loaderObject.load(i(f.url,N.urlBaseType),o(h),A)}else"embedded"===f.type&&(f=N.embeds[f.id],f.metadata=N.metadata,f&&this.geometryHandlerMap.ascii.loaderObject.createModel(f,s(h),""));for(p in N.textures)if(h=N.textures[p],h.url instanceof Array)for(L+=h.url.length,C=0;C<h.url.length;C++)D.onLoadStart();else L+=1,D.onLoadStart();P=L;for(p in N.textures){if(h=N.textures[p],void 0!==h.mapping&&void 0!==a[h.mapping]&&(h.mapping=new a[h.mapping]),h.url instanceof Array){for(f=h.url.length,A=[],C=0;C<f;C++)A[C]=i(h.url[C],N.urlBaseType);C=(C=A[0].endsWith(".dds"))?a.ImageUtils.loadCompressedTextureCube(A,h.mapping,e(f)):a.ImageUtils.loadTextureCube(A,h.mapping,e(f))}else C=h.url.toLowerCase().endsWith(".dds"),f=i(h.url,N.urlBaseType),A=e(1),C=C?a.ImageUtils.loadCompressedTexture(f,h.mapping,A):a.ImageUtils.loadTexture(f,h.mapping,A),void 0!==a[h.minFilter]&&(C.minFilter=a[h.minFilter]),void 0!==a[h.magFilter]&&(C.magFilter=a[h.magFilter]),h.anisotropy&&(C.anisotropy=h.anisotropy),h.repeat&&(C.repeat.set(h.repeat[0],h.repeat[1]),1!==h.repeat[0]&&(C.wrapS=a.RepeatWrapping),1!==h.repeat[1]&&(C.wrapT=a.RepeatWrapping)),h.offset&&C.offset.set(h.offset[0],h.offset[1]),h.wrap&&(f={repeat:a.RepeatWrapping,mirror:a.MirroredRepeatWrapping},void 0!==f[h.wrap[0]]&&(C.wrapS=f[h.wrap[0]]),void 0!==f[h.wrap[1]]&&(C.wrapT=f[h.wrap[1]]));F.textures[p]=C}for(c in N.materials){m=N.materials[c];for(w in m.parameters)"envMap"===w||"map"===w||"lightMap"===w||"bumpMap"===w?m.parameters[w]=F.textures[m.parameters[w]]:"shading"===w?m.parameters[w]="flat"===m.parameters[w]?a.FlatShading:a.SmoothShading:"side"===w?m.parameters[w]="double"==m.parameters[w]?a.DoubleSide:"back"==m.parameters[w]?a.BackSide:a.FrontSide:"blending"===w?m.parameters[w]=m.parameters[w]in a?a[m.parameters[w]]:a.NormalBlending:"combine"===w?m.parameters[w]="MixOperation"==m.parameters[w]?a.MixOperation:a.MultiplyOperation:"vertexColors"===w?"face"==m.parameters[w]?m.parameters[w]=a.FaceColors:m.parameters[w]&&(m.parameters[w]=a.VertexColors):"wrapRGB"===w&&(p=m.parameters[w],m.parameters[w]=new a.Vector3(p[0],p[1],p[2]));void 0!==m.parameters.opacity&&m.parameters.opacity<1&&(m.parameters.transparent=!0),m.parameters.normalMap?(p=a.ShaderUtils.lib.normal,e=a.UniformsUtils.clone(p.uniforms),h=m.parameters.color,C=m.parameters.specular,f=m.parameters.ambient,A=m.parameters.shininess,e.tNormal.value=F.textures[m.parameters.normalMap],m.parameters.normalScale&&e.uNormalScale.value.set(m.parameters.normalScale[0],m.parameters.normalScale[1]),m.parameters.map&&(e.tDiffuse.value=m.parameters.map,e.enableDiffuse.value=!0),m.parameters.envMap&&(e.tCube.value=m.parameters.envMap,e.enableReflection.value=!0,e.uReflectivity.value=m.parameters.reflectivity),m.parameters.lightMap&&(e.tAO.value=m.parameters.lightMap,e.enableAO.value=!0),m.parameters.specularMap&&(e.tSpecular.value=F.textures[m.parameters.specularMap],e.enableSpecular.value=!0),m.parameters.displacementMap&&(e.tDisplacement.value=F.textures[m.parameters.displacementMap],e.enableDisplacement.value=!0,e.uDisplacementBias.value=m.parameters.displacementBias,e.uDisplacementScale.value=m.parameters.displacementScale),e.uDiffuseColor.value.setHex(h),e.uSpecularColor.value.setHex(C),e.uAmbientColor.value.setHex(f),e.uShininess.value=A,m.parameters.opacity&&(e.uOpacity.value=m.parameters.opacity),M=new a.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:e,lights:!0,fog:!0})):M=new a[m.type](m.parameters),F.materials[c]=M}n(F.scene,N.objects),D.callbackSync(F),l()},a.TextureLoader=function(){a.EventTarget.call(this),this.crossOrigin=null},a.TextureLoader.prototype={constructor:a.TextureLoader,load:function(e){var t=this,r=new Image;r.addEventListener("load",function(){var e=new a.Texture(r);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),r.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.src=e}},a.Material=function(){this.id=a.MaterialCount++,this.name="",this.side=a.FrontSide,this.opacity=1,this.transparent=!1,this.blending=a.NormalBlending,this.blendSrc=a.SrcAlphaFactor,this.blendDst=a.OneMinusSrcAlphaFactor,this.blendEquation=a.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.overdraw=!1,this.needsUpdate=this.visible=!0},a.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0===r)console.warn("THR51.Material: '"+t+"' parameter is undefined.");else if(t in this){var i=this[t];i instanceof a.Color&&r instanceof a.Color?i.copy(r):i instanceof a.Color&&"number"==typeof r?i.setHex(r):i instanceof a.Vector3&&r instanceof a.Vector3?i.copy(r):this[t]=r}}},a.Material.prototype.clone=function(e){return void 0===e&&(e=new a.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},a.MaterialCount=0,a.LineBasicMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},a.LineBasicMaterial.prototype=(0,n.default)(a.Material.prototype),a.LineBasicMaterial.prototype.clone=function(){var e=new a.LineBasicMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},a.MeshBasicMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",
this.vertexColors=a.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},a.MeshBasicMaterial.prototype=(0,n.default)(a.Material.prototype),a.MeshBasicMaterial.prototype.clone=function(){var e=new a.MeshBasicMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},a.MeshLambertMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.ambient=new a.Color(16777215),this.emissive=new a.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=a.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},a.MeshLambertMaterial.prototype=(0,n.default)(a.Material.prototype),a.MeshLambertMaterial.prototype.clone=function(){var e=new a.MeshLambertMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},a.MeshPhongMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.ambient=new a.Color(16777215),this.emissive=new a.Color(0),this.specular=new a.Color(1118481),this.shininess=30,this.wrapAround=this.perPixel=this.metal=!1,this.wrapRGB=new a.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new a.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=a.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=a.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},a.MeshPhongMaterial.prototype=(0,n.default)(a.Material.prototype),a.MeshPhongMaterial.prototype.clone=function(){var e=new a.MeshPhongMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},a.MeshDepthMaterial=function(e){a.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},a.MeshDepthMaterial.prototype=(0,n.default)(a.Material.prototype),a.MeshDepthMaterial.prototype.clone=function(){var e=new a.LineBasicMaterial;return a.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},a.MeshNormalMaterial=function(e){a.Material.call(this,e),this.shading=a.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},a.MeshNormalMaterial.prototype=(0,n.default)(a.Material.prototype),a.MeshNormalMaterial.prototype.clone=function(){var e=new a.MeshNormalMaterial;return a.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},a.MeshFaceMaterial=function(){},a.MeshFaceMaterial.prototype.clone=function(){return new a.MeshFaceMaterial},a.ParticleBasicMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},a.ParticleBasicMaterial.prototype=(0,n.default)(a.Material.prototype),a.ParticleBasicMaterial.prototype.clone=function(){var e=new a.ParticleBasicMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},a.ParticleCanvasMaterial=function(e){a.Material.call(this),this.color=new a.Color(16777215),this.program=function(){},this.setValues(e)},a.ParticleCanvasMaterial.prototype=(0,n.default)(a.Material.prototype),a.ParticleCanvasMaterial.prototype.clone=function(){var e=new a.ParticleCanvasMaterial;return a.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},a.ParticleDOMMaterial=function(e){this.element=e},a.ParticleDOMMaterial.prototype.clone=function(){return new a.ParticleDOMMaterial(this.element)},a.ShaderMaterial=function(e){a.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.attributes=null,this.shading=a.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=a.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},a.ShaderMaterial.prototype=(0,n.default)(a.Material.prototype),a.ShaderMaterial.prototype.clone=function(){var e=new a.ShaderMaterial;return a.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=this.uniforms,e.attributes=this.attributes,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},a.Texture=function(e,t,r,i,n,o,s,l,h){this.id=a.TextureCount++,this.image=e,this.mapping=void 0!==t?t:new a.UVMapping,this.wrapS=void 0!==r?r:a.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:a.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:a.LinearFilter,this.minFilter=void 0!==o?o:a.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==s?s:a.RGBAFormat,this.type=void 0!==l?l:a.UnsignedByteType,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.needsUpdate=!1,this.onUpdate=null},a.Texture.prototype={constructor:a.Texture,clone:function(){var e=new a.Texture;return e.image=this.image,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e}},a.TextureCount=0,a.CompressedTexture=function(e,t,r,i,n,o,s,l,h,c){a.Texture.call(this,null,o,s,l,h,c,i,n),this.image={width:t,height:r},this.mipmaps=e},a.CompressedTexture.prototype=(0,n.default)(a.Texture.prototype),a.CompressedTexture.prototype.clone=function(){var e=new a.CompressedTexture;return e.image=this.image,e.mipmaps=this.mipmaps,e.format=this.format,e.type=this.type,e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},a.DataTexture=function(e,t,r,i,n,o,s,l,h,c){a.Texture.call(this,null,o,s,l,h,c,i,n),this.image={data:e,width:t,height:r}},a.DataTexture.prototype=(0,n.default)(a.Texture.prototype),a.DataTexture.prototype.clone=function(){var e=new a.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);return e.offset.copy(this.offset),e.repeat.copy(this.repeat),e},a.Particle=function(e){a.Object3D.call(this),this.material=e},a.Particle.prototype=(0,n.default)(a.Object3D.prototype),a.ParticleSystem=function(e,t){a.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new a.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius),this.frustumCulled=!1},a.ParticleSystem.prototype=(0,n.default)(a.Object3D.prototype),a.Line=function(e,t,r){a.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new a.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:a.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},a.LineStrip=0,a.LinePieces=1,a.Line.prototype=(0,n.default)(a.Object3D.prototype),a.Mesh=function(e,t){if(a.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new a.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0;r<this.geometry.morphTargets.length;r++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[r].name]=r}},a.Mesh.prototype=(0,n.default)(a.Object3D.prototype),a.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THR51.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},a.Bone=function(e){a.Object3D.call(this),this.skin=e,this.skinMatrix=new a.Matrix4},a.Bone.prototype=(0,n.default)(a.Object3D.prototype),a.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i=this.children.length;for(r=0;r<i;r++)this.children[r].update(this.skinMatrix,t)},a.SkinnedMesh=function(e,t,r){a.Mesh.call(this,e,t),this.useVertexTexture=void 0===r||r,this.identityMatrix=new a.Matrix4,this.bones=[],this.boneMatrices=[];var i,n,o;if(void 0!==this.geometry.bones){for(e=0;e<this.geometry.bones.length;e++)r=this.geometry.bones[e],i=r.pos,n=r.rotq,o=r.scl,t=this.addBone(),t.name=r.name,t.position.set(i[0],i[1],i[2]),t.quaternion.set(n[0],n[1],n[2],n[3]),t.useQuaternion=!0,void 0!==o?t.scale.set(o[0],o[1],o[2]):t.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)r=this.geometry.bones[e],t=this.bones[e],r.parent===-1?this.add(t):this.bones[r.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=e>256?64:e>64?32:e>16?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new a.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,a.RGBAFormat,a.FloatType),this.boneTexture.minFilter=a.NearestFilter,this.boneTexture.magFilter=a.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},a.SkinnedMesh.prototype=(0,n.default)(a.Mesh.prototype),a.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new a.Bone(this)),this.bones.push(e),e},a.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1);for(var e=0,t=this.children.length;e<t;e++){var r=this.children[e];r instanceof a.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)r=new a.Matrix4,r.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(r);for(e=0,t=this.bones.length;e<t;e++)a.SkinnedMesh.offsetMatrix.multiply(this.bones[e].skinMatrix,this.boneInverses[e]),a.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*e);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},a.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},a.SkinnedMesh.offsetMatrix=new a.Matrix4,a.MorphAnimMesh=function(e,t){a.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},a.MorphAnimMesh.prototype=(0,n.default)(a.Mesh.prototype),a.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},a.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},a.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},a.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\d+)/,n=0,a=e.morphTargets.length;n<a;n++){var o=e.morphTargets[n].name.match(i);if(o&&o.length>1){o=o[1],r[o]||(r[o]={start:1/0,end:-(1/0)});var s=r[o];n<s.start&&(s.start=n),n>s.end&&(s.end=n),t||(t=o)}}e.firstAnimation=t},a.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},a.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},a.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction=this.direction*-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time=this.time+this.duration)),e=this.startKeyframe+a.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},a.Ribbon=function(e,t){a.Object3D.call(this),this.geometry=e,this.material=t},a.Ribbon.prototype=(0,n.default)(a.Object3D.prototype),a.LOD=function(){a.Object3D.call(this),this.LODs=[]},a.LOD.prototype=(0,n.default)(a.Object3D.prototype),a.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0);for(var t=Math.abs(t),r=0;r<this.LODs.length&&!(t<this.LODs[r].visibleAtDistance);r++);this.LODs.splice(r,0,{visibleAtDistance:t,object3D:e}),this.add(e)},a.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld),e=e.matrixWorldInverse,e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]),this.LODs[0].object3D.visible=!0;for(var t=1;t<this.LODs.length&&e>=this.LODs[t].visibleAtDistance;t++)this.LODs[t-1].object3D.visible=!1,this.LODs[t].object3D.visible=!0;for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=!1}},a.Sprite=function(e){a.Object3D.call(this),this.color=void 0!==e.color?new a.Color(e.color):new a.Color(16777215),this.map=void 0!==e.map?e.map:new a.Texture,this.blending=void 0!==e.blending?e.blending:a.NormalBlending,this.blendSrc=void 0!==e.blendSrc?e.blendSrc:a.SrcAlphaFactor,this.blendDst=void 0!==e.blendDst?e.blendDst:a.OneMinusSrcAlphaFactor,this.blendEquation=void 0!==e.blendEquation?e.blendEquation:a.AddEquation,this.useScreenCoordinates=void 0===e.useScreenCoordinates||e.useScreenCoordinates,this.mergeWith3D=void 0!==e.mergeWith3D?e.mergeWith3D:!this.useScreenCoordinates,this.affectedByDistance=void 0!==e.affectedByDistance?e.affectedByDistance:!this.useScreenCoordinates,this.scaleByViewport=void 0!==e.scaleByViewport?e.scaleByViewport:!this.affectedByDistance,this.alignment=e.alignment instanceof a.Vector2?e.alignment:a.SpriteAlignment.center,this.rotation3d=this.rotation,this.rotation=0,this.opacity=1,this.uvOffset=new a.Vector2(0,0),this.uvScale=new a.Vector2(1,1)},a.Sprite.prototype=(0,n.default)(a.Object3D.prototype),a.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)),this.matrixWorldNeedsUpdate=!0},a.SpriteAlignment={},a.SpriteAlignment.topLeft=new a.Vector2(1,(-1)),a.SpriteAlignment.topCenter=new a.Vector2(0,(-1)),a.SpriteAlignment.topRight=new a.Vector2((-1),(-1)),a.SpriteAlignment.centerLeft=new a.Vector2(1,0),a.SpriteAlignment.center=new a.Vector2(0,0),a.SpriteAlignment.centerRight=new a.Vector2((-1),0),a.SpriteAlignment.bottomLeft=new a.Vector2(1,1),a.SpriteAlignment.bottomCenter=new a.Vector2(0,1),a.SpriteAlignment.bottomRight=new a.Vector2((-1),1),a.Scene=function(){a.Object3D.call(this),this.overrideMaterial=this.fog=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},a.Scene.prototype=(0,n.default)(a.Object3D.prototype),a.Scene.prototype.__addObject=function(e){if(e instanceof a.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof a.Camera||e instanceof a.Bone)&&this.__objects.indexOf(e)===-1){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},a.Scene.prototype.__removeObject=function(e){if(e instanceof a.Light){var t=this.__lights.indexOf(e);t!==-1&&this.__lights.splice(t,1)}else e instanceof a.Camera||(t=this.__objects.indexOf(e),t!==-1&&(this.__objects.splice(t,1),this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),t!==-1&&this.__objectsAdded.splice(t,1)));for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},a.Fog=function(e,t,r){this.color=new a.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},a.FogExp2=function(e,t){this.color=new a.Color(e),this.density=void 0!==t?t:25e-5},a.CanvasRenderer=function(e){function t(e){Q!==e&&(Q=q.globalAlpha=e)}function r(e){J!==e&&(e===a.NormalBlending?q.globalCompositeOperation="source-over":e===a.AdditiveBlending?q.globalCompositeOperation="lighter":e===a.SubtractiveBlending&&(q.globalCompositeOperation="darker"),J=e)}function i(e){$!==e&&($=q.strokeStyle=e)}function n(e){ee!==e&&(ee=q.fillStyle=e)}console.log("THR51.CanvasRenderer",a.REVISION);var o,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w,S,M,T,A,C,E,L,R,P,F,D,U,N,O,B,V,I,z,k,W,G,H,e=e||{},j=this,X=new a.Projector,Y=void 0!==e.canvas?e.canvas:document.createElement("canvas"),q=Y.getContext("2d"),K=new a.Color(0),Z=0,Q=1,J=0,$=null,ee=null,te=null,re=null,ie=null,ne=new a.RenderableVertex,ae=new a.RenderableVertex,oe=new a.Color,se=new a.Color,le=new a.Color,he=new a.Color,ce=new a.Color,ue={},de={},fe=new a.Rectangle,pe=new a.Rectangle,me=new a.Rectangle,ge=!1,ve=new a.Color,ye=new a.Color,xe=new a.Color,be=new a.Vector3,e=16;I=document.createElement("canvas"),I.width=I.height=2,z=I.getContext("2d"),z.fillStyle="rgba(0,0,0,1)",z.fillRect(0,0,2,2),k=z.getImageData(0,0,2,2),W=k.data,G=document.createElement("canvas"),G.width=G.height=e,H=G.getContext("2d"),H.translate(-e/2,-e/2),H.scale(e,e),e--,this.domElement=Y,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.setSize=function(e,t){h=e,c=t,u=Math.floor(h/2),d=Math.floor(c/2),Y.width=h,Y.height=c,fe.set(-u,-d,u,d),pe.set(-u,-d,u,d),Q=1,J=0,ie=re=te=ee=$=null},this.setClearColor=function(e,t){K.copy(e),Z=void 0!==t?t:1,pe.set(-u,-d,u,d)},this.setClearColorHex=function(e,t){K.setHex(e),Z=void 0!==t?t:1,pe.set(-u,-d,u,d)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){q.setTransform(1,0,0,-1,u,d),pe.isEmpty()===!1&&(pe.minSelf(fe),pe.inflate(2),Z<1&&q.clearRect(Math.floor(pe.getX()),Math.floor(pe.getY()),Math.floor(pe.getWidth()),Math.floor(pe.getHeight())),Z>0&&(r(a.NormalBlending),t(1),n("rgba("+Math.floor(255*K.r)+","+Math.floor(255*K.g)+","+Math.floor(255*K.b)+","+Z+")"),q.fillRect(Math.floor(pe.getX()),Math.floor(pe.getY()),Math.floor(pe.getWidth()),Math.floor(pe.getHeight()))),pe.empty())},this.render=function(e,h){function c(e,t,r){for(var i=0,n=l.length;i<n;i++){var o=l[i],s=o.color;if(o instanceof a.DirectionalLight){var h=o.matrixWorld.getPosition().normalize(),c=t.dot(h);c<=0||(c*=o.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c)}else o instanceof a.PointLight&&(h=o.matrixWorld.getPosition(),c=t.dot(be.sub(h,e).normalize()),c<=0||(c*=0==o.distance?1:1-Math.min(e.distanceTo(h)/o.distance,1),0!=c&&(c*=o.intensity,r.r=r.r+s.r*c,r.g=r.g+s.g*c,r.b=r.b+s.b*c)))}}function Y(e,i,n,o,s,l,u,d){j.info.render.vertices=j.info.render.vertices+3,j.info.render.faces++,t(d.opacity),r(d.blending),v=e.positionScreen.x,y=e.positionScreen.y,x=i.positionScreen.x,b=i.positionScreen.y,_=n.positionScreen.x,w=n.positionScreen.y,K(v,y,x,b,_,w),(d instanceof a.MeshLambertMaterial||d instanceof a.MeshPhongMaterial)&&null===d.map&&null===d.map?ge===!0?(o=d.color,s=d.emissive,d.wireframe===!1&&d.shading==a.SmoothShading&&3==u.vertexNormalsLength?(se.r=le.r=he.r=ve.r,se.g=le.g=he.g=ve.g,se.b=le.b=he.b=ve.b,c(u.v1.positionWorld,u.vertexNormalsWorld[0],se),c(u.v2.positionWorld,u.vertexNormalsWorld[1],le),c(u.v3.positionWorld,u.vertexNormalsWorld[2],he),se.r=o.r*se.r+s.r,se.g=o.g*se.g+s.g,se.b=o.b*se.b+s.b,le.r=o.r*le.r+s.r,le.g=o.g*le.g+s.g,le.b=o.b*le.b+s.b,he.r=o.r*he.r+s.r,he.g=o.g*he.g+s.g,he.b=o.b*he.b+s.b,ce.r=.5*(le.r+he.r),ce.g=.5*(le.g+he.g),ce.b=.5*(le.b+he.b),P=_e(se,le,he,ce),ee(v,y,x,b,_,w,0,0,1,0,0,1,P)):(oe.r=ve.r,oe.g=ve.g,oe.b=ve.b,c(u.centroidWorld,u.normalWorld,oe),oe.r=o.r*oe.r+s.r,oe.g=o.g*oe.g+s.g,oe.b=o.b*oe.b+s.b,d.wireframe===!0?Q(oe,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):J(oe))):d.wireframe===!0?Q(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):J(d.color):d instanceof a.MeshBasicMaterial||d instanceof a.MeshLambertMaterial||d instanceof a.MeshPhongMaterial?null!==d.map?d.map.mapping instanceof a.UVMapping&&(F=u.uvs[0],$(v,y,x,b,_,w,F[o].u,F[o].v,F[s].u,F[s].v,F[l].u,F[l].v,d.map)):null!==d.envMap?d.envMap.mapping instanceof a.SphericalReflectionMapping&&(e=h.matrixWorldInverse,be.copy(u.vertexNormalsWorld[o]),D=.5*(be.x*e.elements[0]+be.y*e.elements[4]+be.z*e.elements[8])+.5,U=.5*(be.x*e.elements[1]+be.y*e.elements[5]+be.z*e.elements[9])+.5,be.copy(u.vertexNormalsWorld[s]),N=.5*(be.x*e.elements[0]+be.y*e.elements[4]+be.z*e.elements[8])+.5,O=.5*(be.x*e.elements[1]+be.y*e.elements[5]+be.z*e.elements[9])+.5,be.copy(u.vertexNormalsWorld[l]),B=.5*(be.x*e.elements[0]+be.y*e.elements[4]+be.z*e.elements[8])+.5,V=.5*(be.x*e.elements[1]+be.y*e.elements[5]+be.z*e.elements[9])+.5,$(v,y,x,b,_,w,D,U,N,O,B,V,d.envMap)):d.wireframe===!0?Q(d.color,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):J(d.color):d instanceof a.MeshDepthMaterial?(L=h.near,R=h.far,se.r=se.g=se.b=1-we(e.positionScreen.z,L,R),le.r=le.g=le.b=1-we(i.positionScreen.z,L,R),he.r=he.g=he.b=1-we(n.positionScreen.z,L,R),ce.r=.5*(le.r+he.r),ce.g=.5*(le.g+he.g),ce.b=.5*(le.b+he.b),P=_e(se,le,he,ce),ee(v,y,x,b,_,w,0,0,1,0,0,1,P)):d instanceof a.MeshNormalMaterial&&(oe.r=Se(u.normalWorld.x),oe.g=Se(u.normalWorld.y),oe.b=Se(u.normalWorld.z),d.wireframe===!0?Q(oe,d.wireframeLinewidth,d.wireframeLinecap,d.wireframeLinejoin):J(oe))}function K(e,t,r,i,n,a){q.beginPath(),q.moveTo(e,t),q.lineTo(r,i),q.lineTo(n,a),q.closePath()}function Z(e,t,r,i,n,a,o,s){q.beginPath(),q.moveTo(e,t),q.lineTo(r,i),q.lineTo(n,a),q.lineTo(o,s),q.closePath()}function Q(e,t,r,n){te!==t&&(te=q.lineWidth=t),re!==r&&(re=q.lineCap=r),ie!==n&&(ie=q.lineJoin=n),i(e.getContextStyle()),q.stroke(),me.inflate(2*t)}function J(e){n(e.getContextStyle()),q.fill()}function $(e,t,r,i,o,s,l,h,c,u,d,f,p){if(!(p instanceof a.DataTexture||void 0===p.image||0==p.image.width)){if(p.needsUpdate===!0){var m=p.wrapS==a.RepeatWrapping,g=p.wrapT==a.RepeatWrapping;ue[p.id]=q.createPattern(p.image,m===!0&&g===!0?"repeat":m===!0&&g===!1?"repeat-x":m===!1&&g===!0?"repeat-y":"no-repeat"),p.needsUpdate=!1}n(void 0===ue[p.id]?"rgba(0,0,0,1)":ue[p.id]);var m=p.offset.x/p.repeat.x,g=p.offset.y/p.repeat.y,v=p.image.width*p.repeat.x,y=p.image.height*p.repeat.y,l=(l+m)*v,h=(1-h+g)*y,r=r-e,i=i-t,o=o-e,s=s-t,c=(c+m)*v-l,u=(1-u+g)*y-h,d=(d+m)*v-l,f=(1-f+g)*y-h,m=c*f-d*u;0===m?(void 0===de[p.id]&&(t=document.createElement("canvas"),t.width=p.image.width,t.height=p.image.height,t=t.getContext("2d"),t.drawImage(p.image,0,0),de[p.id]=t.getImageData(0,0,p.image.width,p.image.height).data),t=de[p.id],l=4*(Math.floor(l)+Math.floor(h)*p.image.width),oe.setRGB(t[l]/255,t[l+1]/255,t[l+2]/255),J(oe)):(m=1/m,p=(f*r-u*o)*m,u=(f*i-u*s)*m,r=(c*o-d*r)*m,i=(c*s-d*i)*m,e=e-p*l-r*h,l=t-u*l-i*h,q.save(),q.transform(p,u,r,i,e,l),q.fill(),q.restore())}}function ee(e,t,r,i,n,a,o,s,l,h,c,u,d){var f,p;f=d.width-1,p=d.height-1,o*=f,s*=p,r-=e,i-=t,n-=e,a-=t,l=l*f-o,h=h*p-s,c=c*f-o,u=u*p-s,p=1/(l*u-c*h),f=(u*r-h*n)*p,h=(u*i-h*a)*p,r=(l*n-c*r)*p,i=(l*a-c*i)*p,e=e-f*o-r*s,t=t-h*o-i*s,q.save(),q.transform(f,h,r,i,e,t),q.clip(),q.drawImage(d,0,0),q.restore()}function _e(e,t,r,i){return W[0]=255*e.r|0,W[1]=255*e.g|0,W[2]=255*e.b|0,W[4]=255*t.r|0,W[5]=255*t.g|0,W[6]=255*t.b|0,W[8]=255*r.r|0,W[9]=255*r.g|0,W[10]=255*r.b|0,W[12]=255*i.r|0,W[13]=255*i.g|0,W[14]=255*i.b|0,z.putImageData(k,0,0),H.drawImage(I,0,0),G}function we(e,t,r){return e=(e-t)/(r-t),e*e*(3-2*e)}function Se(e){return e=.5*(e+1),e<0?0:e>1?1:e}function Me(e,t){var r=t.x-e.x,i=t.y-e.y,n=r*r+i*i;0!==n&&(n=1/Math.sqrt(n),r*=n,i*=n,t.x=t.x+r,t.y=t.y+i,e.x=e.x-r,e.y=e.y-i)}if(h instanceof a.Camera==!1)console.error("THR51.CanvasRenderer.render: camera is not an instance of THR51.Camera.");else{var Te,Ae,Ce,Ee;if(this.autoClear===!0?this.clear():q.setTransform(1,0,0,-1,u,d),j.info.render.vertices=0,j.info.render.faces=0,o=X.projectScene(e,h,this.sortObjects,this.sortElements),s=o.elements,l=o.lights,ge=l.length>0,ge===!0)for(ve.setRGB(0,0,0),ye.setRGB(0,0,0),xe.setRGB(0,0,0),Te=0,Ae=l.length;Te<Ae;Te++){Ee=l[Te];var Le=Ee.color;Ee instanceof a.AmbientLight?(ve.r=ve.r+Le.r,ve.g=ve.g+Le.g,ve.b=ve.b+Le.b):Ee instanceof a.DirectionalLight?(ye.r=ye.r+Le.r,ye.g=ye.g+Le.g,ye.b=ye.b+Le.b):Ee instanceof a.PointLight&&(xe.r=xe.r+Le.r,xe.g=xe.g+Le.g,xe.b=xe.b+Le.b)}for(Te=0,Ae=s.length;Te<Ae;Te++)if(Ce=s[Te],Ee=Ce.material,void 0!==Ee&&Ee.visible!==!1){if(me.empty(),Ce instanceof a.RenderableParticle){f=Ce,f.x=f.x*u,f.y=f.y*d;var Le=f,Re=Ce;t(Ee.opacity),r(Ee.blending);var Pe=void 0,Fe=void 0,De=void 0,Ue=void 0,Ne=void 0,Oe=Ce=void 0;Ee instanceof a.ParticleBasicMaterial?null===Ee.map?(De=Re.object.scale.x,Ue=Re.object.scale.y,De=De*Re.scale.x*u,Ue=Ue*Re.scale.y*d,me.set(Le.x-De,Le.y-Ue,Le.x+De,Le.y+Ue),fe.intersects(me)!==!1&&(n(Ee.color.getContextStyle()),q.save(),q.translate(Le.x,Le.y),q.rotate(-Re.rotation),q.scale(De,Ue),q.fillRect(-1,-1,2,2),q.restore())):(Ne=Ee.map.image,Ce=Ne.width>>1,Oe=Ne.height>>1,De=Re.scale.x*u,Ue=Re.scale.y*d,Pe=De*Ce,Fe=Ue*Oe,me.set(Le.x-Pe,Le.y-Fe,Le.x+Pe,Le.y+Fe),fe.intersects(me)!==!1&&(q.save(),q.translate(Le.x,Le.y),q.rotate(-Re.rotation),q.scale(De,-Ue),q.translate(-Ce,-Oe),q.drawImage(Ne,0,0),q.restore())):Ee instanceof a.ParticleCanvasMaterial&&(Pe=Re.scale.x*u,Fe=Re.scale.y*d,me.set(Le.x-Pe,Le.y-Fe,Le.x+Pe,Le.y+Fe),fe.intersects(me)!==!1&&(i(Ee.color.getContextStyle()),n(Ee.color.getContextStyle()),q.save(),q.translate(Le.x,Le.y),q.rotate(-Re.rotation),q.scale(Pe,Fe),Ee.program(q),q.restore()))}else Ce instanceof a.RenderableLine?(f=Ce.v1,p=Ce.v2,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*d,p.positionScreen.x=p.positionScreen.x*u,p.positionScreen.y=p.positionScreen.y*d,me.addPoint(f.positionScreen.x,f.positionScreen.y),me.addPoint(p.positionScreen.x,p.positionScreen.y),fe.intersects(me)===!0&&(Le=f,Re=p,t(Ee.opacity),r(Ee.blending),q.beginPath(),q.moveTo(Le.positionScreen.x,Le.positionScreen.y),q.lineTo(Re.positionScreen.x,Re.positionScreen.y),Ee instanceof a.LineBasicMaterial&&(Le=Ee.linewidth,te!==Le&&(te=q.lineWidth=Le),Le=Ee.linecap,re!==Le&&(re=q.lineCap=Le),Le=Ee.linejoin,ie!==Le&&(ie=q.lineJoin=Le),i(Ee.color.getContextStyle()),q.stroke(),me.inflate(2*Ee.linewidth)))):Ce instanceof a.RenderableFace3?(f=Ce.v1,p=Ce.v2,m=Ce.v3,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*d,p.positionScreen.x=p.positionScreen.x*u,p.positionScreen.y=p.positionScreen.y*d,m.positionScreen.x=m.positionScreen.x*u,m.positionScreen.y=m.positionScreen.y*d,Ee.overdraw===!0&&(Me(f.positionScreen,p.positionScreen),Me(p.positionScreen,m.positionScreen),Me(m.positionScreen,f.positionScreen)),me.add3Points(f.positionScreen.x,f.positionScreen.y,p.positionScreen.x,p.positionScreen.y,m.positionScreen.x,m.positionScreen.y),fe.intersects(me)===!0&&Y(f,p,m,0,1,2,Ce,Ee,e)):Ce instanceof a.RenderableFace4&&(f=Ce.v1,p=Ce.v2,m=Ce.v3,g=Ce.v4,f.positionScreen.x=f.positionScreen.x*u,f.positionScreen.y=f.positionScreen.y*d,p.positionScreen.x=p.positionScreen.x*u,p.positionScreen.y=p.positionScreen.y*d,m.positionScreen.x=m.positionScreen.x*u,m.positionScreen.y=m.positionScreen.y*d,g.positionScreen.x=g.positionScreen.x*u,g.positionScreen.y=g.positionScreen.y*d,ne.positionScreen.copy(p.positionScreen),ae.positionScreen.copy(g.positionScreen),Ee.overdraw===!0&&(Me(f.positionScreen,p.positionScreen),Me(p.positionScreen,g.positionScreen),Me(g.positionScreen,f.positionScreen),Me(m.positionScreen,ne.positionScreen),Me(m.positionScreen,ae.positionScreen)),me.addPoint(f.positionScreen.x,f.positionScreen.y),me.addPoint(p.positionScreen.x,p.positionScreen.y),me.addPoint(m.positionScreen.x,m.positionScreen.y),me.addPoint(g.positionScreen.x,g.positionScreen.y),fe.intersects(me)===!0&&(Re=f,Pe=p,Fe=m,De=g,Ue=ne,Ne=ae,Le=Ce,Ce=e,j.info.render.vertices=j.info.render.vertices+4,j.info.render.faces++,t(Ee.opacity),r(Ee.blending),void 0!==Ee.map&&null!==Ee.map||void 0!==Ee.envMap&&null!==Ee.envMap?(Y(Re,Pe,De,0,1,3,Le,Ee,Ce),Y(Ue,Fe,Ne,1,2,3,Le,Ee,Ce)):(v=Re.positionScreen.x,y=Re.positionScreen.y,x=Pe.positionScreen.x,b=Pe.positionScreen.y,
_=Fe.positionScreen.x,w=Fe.positionScreen.y,S=De.positionScreen.x,M=De.positionScreen.y,T=Ue.positionScreen.x,A=Ue.positionScreen.y,C=Ne.positionScreen.x,E=Ne.positionScreen.y,Ee instanceof a.MeshLambertMaterial||Ee instanceof a.MeshPhongMaterial?ge===!0?(Re=Ee.color,Pe=Ee.emissive,Ee.wireframe===!1&&Ee.shading==a.SmoothShading&&4==Le.vertexNormalsLength?(se.r=le.r=he.r=ce.r=ve.r,se.g=le.g=he.g=ce.g=ve.g,se.b=le.b=he.b=ce.b=ve.b,c(Le.v1.positionWorld,Le.vertexNormalsWorld[0],se),c(Le.v2.positionWorld,Le.vertexNormalsWorld[1],le),c(Le.v4.positionWorld,Le.vertexNormalsWorld[3],he),c(Le.v3.positionWorld,Le.vertexNormalsWorld[2],ce),se.r=Re.r*se.r+Pe.r,se.g=Re.g*se.g+Pe.g,se.b=Re.b*se.b+Pe.b,le.r=Re.r*le.r+Pe.r,le.g=Re.g*le.g+Pe.g,le.b=Re.b*le.b+Pe.b,he.r=Re.r*he.r+Pe.r,he.g=Re.g*he.g+Pe.g,he.b=Re.b*he.b+Pe.b,ce.r=Re.r*ce.r+Pe.r,ce.g=Re.g*ce.g+Pe.g,ce.b=Re.b*ce.b+Pe.b,P=_e(se,le,he,ce),K(v,y,x,b,S,M),ee(v,y,x,b,S,M,0,0,1,0,0,1,P),K(T,A,_,w,C,E),ee(T,A,_,w,C,E,1,0,1,1,0,1,P)):(oe.r=ve.r,oe.g=ve.g,oe.b=ve.b,c(Le.centroidWorld,Le.normalWorld,oe),oe.r=Re.r*oe.r+Pe.r,oe.g=Re.g*oe.g+Pe.g,oe.b=Re.b*oe.b+Pe.b,Z(v,y,x,b,_,w,S,M),Ee.wireframe===!0?Q(oe,Ee.wireframeLinewidth,Ee.wireframeLinecap,Ee.wireframeLinejoin):J(oe))):(Z(v,y,x,b,_,w,S,M),Ee.wireframe===!0?Q(Ee.color,Ee.wireframeLinewidth,Ee.wireframeLinecap,Ee.wireframeLinejoin):J(Ee.color)):Ee instanceof a.MeshBasicMaterial?(Z(v,y,x,b,_,w,S,M),Ee.wireframe===!0?Q(Ee.color,Ee.wireframeLinewidth,Ee.wireframeLinecap,Ee.wireframeLinejoin):J(Ee.color)):Ee instanceof a.MeshNormalMaterial?(oe.r=Se(Le.normalWorld.x),oe.g=Se(Le.normalWorld.y),oe.b=Se(Le.normalWorld.z),Z(v,y,x,b,_,w,S,M),Ee.wireframe===!0?Q(oe,Ee.wireframeLinewidth,Ee.wireframeLinecap,Ee.wireframeLinejoin):J(oe)):Ee instanceof a.MeshDepthMaterial&&(L=h.near,R=h.far,se.r=se.g=se.b=1-we(Re.positionScreen.z,L,R),le.r=le.g=le.b=1-we(Pe.positionScreen.z,L,R),he.r=he.g=he.b=1-we(De.positionScreen.z,L,R),ce.r=ce.g=ce.b=1-we(Fe.positionScreen.z,L,R),P=_e(se,le,he,ce),K(v,y,x,b,S,M),ee(v,y,x,b,S,M,0,0,1,0,0,1,P),K(T,A,_,w,C,E),ee(T,A,_,w,C,E,1,0,1,1,0,1,P)))));pe.addRectangle(me)}q.setTransform(1,0,0,1,0,0)}}},a.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 mPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -viewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, N_BONE_PIXEL_X );\nfloat y = floor( j / N_BONE_PIXEL_X );\nconst float dx = 1.0 / N_BONE_PIXEL_X;\nconst float dy = 1.0 / N_BONE_PIXEL_Y;\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned \t  += boneMatY * skinVertex * skinWeight.y;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix \t+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},a.UniformsUtils={merge:function(e){var t,r,i,n={};for(t=0;t<e.length;t++){i=this.clone(e[t]);for(r in i)n[r]=i[r]}return n},clone:function(e){var t,r,i,n={};for(t in e){n[t]={};for(r in e[t])i=e[t][r],n[t][r]=i instanceof a.Color||i instanceof a.Vector2||i instanceof a.Vector3||i instanceof a.Vector4||i instanceof a.Matrix4||i instanceof a.Texture?i.clone():i instanceof Array?i.slice():i}return n}},a.UniformsLib={common:{diffuse:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new a.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new a.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightPosition:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new a.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new a.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},a.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.shadowmap]),vertexShader:[a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,"#ifdef USE_ENVMAP",a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,"#endif",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_lambert_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.lights_lambert_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:a.UniformsUtils.merge([a.UniformsLib.common,a.UniformsLib.bump,a.UniformsLib.normalmap,a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{ambient:{type:"c",value:new a.Color(16777215)},emissive:{type:"c",value:new a.Color(0)},specular:{type:"c",value:new a.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",a.ShaderChunk.map_pars_vertex,a.ShaderChunk.lightmap_pars_vertex,a.ShaderChunk.envmap_pars_vertex,a.ShaderChunk.lights_phong_pars_vertex,a.ShaderChunk.color_pars_vertex,a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.map_vertex,a.ShaderChunk.lightmap_vertex,a.ShaderChunk.color_vertex,a.ShaderChunk.morphnormal_vertex,a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,a.ShaderChunk.defaultnormal_vertex,"vNormal = transformedNormal;",a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",a.ShaderChunk.worldpos_vertex,a.ShaderChunk.envmap_vertex,a.ShaderChunk.lights_phong_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_pars_fragment,a.ShaderChunk.lightmap_pars_fragment,a.ShaderChunk.envmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.lights_phong_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.bumpmap_pars_fragment,a.ShaderChunk.normalmap_pars_fragment,a.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",a.ShaderChunk.map_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.specularmap_fragment,a.ShaderChunk.lights_phong_fragment,a.ShaderChunk.lightmap_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.envmap_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:a.UniformsUtils.merge([a.UniformsLib.particle,a.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",a.ShaderChunk.color_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",a.ShaderChunk.worldpos_vertex,a.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",a.ShaderChunk.color_pars_fragment,a.ShaderChunk.map_particle_pars_fragment,a.ShaderChunk.fog_pars_fragment,a.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",a.ShaderChunk.map_particle_fragment,a.ShaderChunk.alphatest_fragment,a.ShaderChunk.color_fragment,a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[a.ShaderChunk.morphtarget_pars_vertex,a.ShaderChunk.skinning_pars_vertex,"void main() {",a.ShaderChunk.skinbase_vertex,a.ShaderChunk.morphtarget_vertex,a.ShaderChunk.skinning_vertex,a.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},a.WebGLRenderer=function(e){function t(e,t){var r=e.vertices.length,i=t.material;if(i.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var n in i.attributes){var a=i.attributes[n];if(!a.__webglInitialized||a.createUniqueBuffers){a.__webglInitialized=!0;var o=1;"v2"===a.type?o=2:"v3"===a.type?o=3:"v4"===a.type?o=4:"c"===a.type&&(o=3),a.size=o,a.array=new Float32Array(r*o),a.buffer=k.createBuffer(),a.buffer.belongsToAttribute=n,a.needsUpdate=!0}e.__webglCustomAttributesList.push(a)}}}function r(e,t){return!e.material||e.material instanceof a.MeshFaceMaterial?t.materialIndex>=0?e.geometry.materials[t.materialIndex]:void 0:e.material}function i(e){return!(e instanceof a.MeshBasicMaterial&&!e.envMap||e instanceof a.MeshDepthMaterial)&&(e&&void 0!==e.shading&&e.shading===a.SmoothShading?a.SmoothShading:a.FlatShading)}function n(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof a.ShaderMaterial)}function o(e){var t,r,i;for(t in e.attributes)i="index"===t?k.ELEMENT_ARRAY_BUFFER:k.ARRAY_BUFFER,r=e.attributes[t],r.buffer=k.createBuffer(),k.bindBuffer(i,r.buffer),k.bufferData(i,r.array,k.STATIC_DRAW)}function s(e,t,r){var i,n,a,o,s=e.vertices;o=s.length;var l=e.colors,h=l.length,c=e.__vertexArray,u=e.__colorArray,d=e.__sortArray,f=e.verticesNeedUpdate,p=e.colorsNeedUpdate,m=e.__webglCustomAttributesList;if(r.sortParticles){for(be.copy(xe),be.multiplySelf(r.matrixWorld),i=0;i<o;i++)n=s[i],_e.copy(n),be.multiplyVector3(_e),d[i]=[_e.z,i];for(d.sort(function(e,t){return t[0]-e[0]}),i=0;i<o;i++)n=s[d[i][1]],a=3*i,c[a]=n.x,c[a+1]=n.y,c[a+2]=n.z;for(i=0;i<h;i++)a=3*i,n=l[d[i][1]],u[a]=n.r,u[a+1]=n.g,u[a+2]=n.b;if(m)for(l=0,h=m.length;l<h;l++)if(s=m[l],void 0===s.boundTo||"vertices"===s.boundTo)if(a=0,n=s.value.length,1===s.size)for(i=0;i<n;i++)o=d[i][1],s.array[i]=s.value[o];else if(2===s.size)for(i=0;i<n;i++)o=d[i][1],o=s.value[o],s.array[a]=o.x,s.array[a+1]=o.y,a+=2;else if(3===s.size)if("c"===s.type)for(i=0;i<n;i++)o=d[i][1],o=s.value[o],s.array[a]=o.r,s.array[a+1]=o.g,s.array[a+2]=o.b,a+=3;else for(i=0;i<n;i++)o=d[i][1],o=s.value[o],s.array[a]=o.x,s.array[a+1]=o.y,s.array[a+2]=o.z,a+=3;else if(4===s.size)for(i=0;i<n;i++)o=d[i][1],o=s.value[o],s.array[a]=o.x,s.array[a+1]=o.y,s.array[a+2]=o.z,s.array[a+3]=o.w,a+=4}else{if(f)for(i=0;i<o;i++)n=s[i],a=3*i,c[a]=n.x,c[a+1]=n.y,c[a+2]=n.z;if(p)for(i=0;i<h;i++)n=l[i],a=3*i,u[a]=n.r,u[a+1]=n.g,u[a+2]=n.b;if(m)for(l=0,h=m.length;l<h;l++)if(s=m[l],s.needsUpdate&&(void 0===s.boundTo||"vertices"===s.boundTo))if(n=s.value.length,a=0,1===s.size)for(i=0;i<n;i++)s.array[i]=s.value[i];else if(2===s.size)for(i=0;i<n;i++)o=s.value[i],s.array[a]=o.x,s.array[a+1]=o.y,a+=2;else if(3===s.size)if("c"===s.type)for(i=0;i<n;i++)o=s.value[i],s.array[a]=o.r,s.array[a+1]=o.g,s.array[a+2]=o.b,a+=3;else for(i=0;i<n;i++)o=s.value[i],s.array[a]=o.x,s.array[a+1]=o.y,s.array[a+2]=o.z,a+=3;else if(4===s.size)for(i=0;i<n;i++)o=s.value[i],s.array[a]=o.x,s.array[a+1]=o.y,s.array[a+2]=o.z,s.array[a+3]=o.w,a+=4}if((f||r.sortParticles)&&(k.bindBuffer(k.ARRAY_BUFFER,e.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,c,t)),(p||r.sortParticles)&&(k.bindBuffer(k.ARRAY_BUFFER,e.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,u,t)),m)for(l=0,h=m.length;l<h;l++)s=m[l],(s.needsUpdate||r.sortParticles)&&(k.bindBuffer(k.ARRAY_BUFFER,s.buffer),k.bufferData(k.ARRAY_BUFFER,s.array,t))}function l(e,t,r){var i=e.attributes,n=i.index,a=i.position,o=i.normal,s=i.uv,l=i.color,i=i.tangent;if(e.elementsNeedUpdate&&void 0!==n&&(k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.buffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,n.array,t)),e.verticesNeedUpdate&&void 0!==a&&(k.bindBuffer(k.ARRAY_BUFFER,a.buffer),k.bufferData(k.ARRAY_BUFFER,a.array,t)),e.normalsNeedUpdate&&void 0!==o&&(k.bindBuffer(k.ARRAY_BUFFER,o.buffer),k.bufferData(k.ARRAY_BUFFER,o.array,t)),e.uvsNeedUpdate&&void 0!==s&&(k.bindBuffer(k.ARRAY_BUFFER,s.buffer),k.bufferData(k.ARRAY_BUFFER,s.array,t)),e.colorsNeedUpdate&&void 0!==l&&(k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.bufferData(k.ARRAY_BUFFER,l.array,t)),e.tangentsNeedUpdate&&void 0!==i&&(k.bindBuffer(k.ARRAY_BUFFER,i.buffer),k.bufferData(k.ARRAY_BUFFER,i.array,t)),r)for(var h in e.attributes)delete e.attributes[h].array}function h(e,t){return t.z-e.z}function c(e,t){return t[1]-e[1]}function u(e,t,r){if(e.length)for(var i=0,n=e.length;i<n;i++)Q=Y=null,K=Z=te=ee=se=oe=re=-1,Se=!0,e[i].render(t,r,ge,ve),Q=Y=null,K=Z=te=ee=se=oe=re=-1,Se=!0}function d(e,t,r,i,n,o,s,l){var h,c,u,d;t?(c=e.length-1,d=t=-1):(c=0,t=e.length,d=1);for(var f=c;f!==t;f+=d)if(h=e[f],h.render){if(c=h.object,u=h.buffer,l)h=l;else{if(h=h[r],!h)continue;s&&H.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),H.setDepthTest(h.depthTest),H.setDepthWrite(h.depthWrite),M(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}H.setMaterialFaces(h),u instanceof a.BufferGeometry?H.renderBufferDirect(i,n,o,h,u,c):H.renderBuffer(i,n,o,h,u,c)}}function f(e,t,r,i,n,a,o){for(var s,l,h=0,c=e.length;h<c;h++)if(s=e[h],l=s.object,l.visible){if(o)s=o;else{if(s=s[t],!s)continue;a&&H.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst),H.setDepthTest(s.depthTest),H.setDepthWrite(s.depthWrite),M(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}H.renderImmediateObject(r,i,n,s,l)}}function p(e,t,r){e.push({buffer:t,object:r,opaque:null,transparent:null})}function m(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function g(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function v(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function y(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function x(e,t,r,i,n){$=0,i.needsUpdate&&(i.program&&H.deallocateMaterial(i),H.initMaterial(i,t,r,n),i.needsUpdate=!1),i.morphTargets&&!n.__webglMorphTargetInfluences&&(n.__webglMorphTargetInfluences=new Float32Array(H.maxMorphTargets));var o=!1,s=i.program,l=s.uniforms,h=i.uniforms;if(s!==Y&&(k.useProgram(s),Y=s,o=!0),i.id!==K&&(K=i.id,o=!0),(o||e!==Q)&&(k.uniformMatrix4fv(l.projectionMatrix,!1,e._projectionMatrixArray),e!==Q&&(Q=e)),i.skinning)if(Re&&n.useVertexTexture){if(null!==l.boneTexture){var c=b();k.uniform1i(l.boneTexture,c),H.setTexture(n.boneTexture,c)}}else null!==l.boneGlobalMatrices&&k.uniformMatrix4fv(l.boneGlobalMatrices,!1,n.boneMatrices);if(o){if(r&&i.fog&&(h.fogColor.value=r.color,r instanceof a.Fog?(h.fogNear.value=r.near,h.fogFar.value=r.far):r instanceof a.FogExp2&&(h.fogDensity.value=r.density)),i instanceof a.MeshPhongMaterial||i instanceof a.MeshLambertMaterial||i.lights){if(Se){for(var u,d,f,p,m=0,g=0,v=0,y=Me,x=y.directional.colors,_=y.directional.positions,M=y.point.colors,T=y.point.positions,A=y.point.distances,E=y.spot.colors,L=y.spot.positions,F=y.spot.distances,D=y.spot.directions,U=y.spot.angles,N=y.spot.exponents,O=y.hemi.skyColors,B=y.hemi.groundColors,V=y.hemi.positions,I=0,z=0,W=0,G=0,r=u=f=f=d=0,o=t.length;r<o;r++)c=t[r],!c.onlyShadow&&c.visible&&(u=c.color,p=c.intensity,d=c.distance,c instanceof a.AmbientLight?H.gammaInput?(m+=u.r*u.r,g+=u.g*u.g,v+=u.b*u.b):(m+=u.r,g+=u.g,v+=u.b):c instanceof a.DirectionalLight?(d=3*I,H.gammaInput?w(x,d,u,p*p):S(x,d,u,p),we.copy(c.matrixWorld.getPosition()),we.subSelf(c.target.matrixWorld.getPosition()),we.normalize(),_[d]=we.x,_[d+1]=we.y,_[d+2]=we.z,I+=1):c instanceof a.PointLight?(f=3*z,H.gammaInput?w(M,f,u,p*p):S(M,f,u,p),p=c.matrixWorld.getPosition(),T[f]=p.x,T[f+1]=p.y,T[f+2]=p.z,A[z]=d,z+=1):c instanceof a.SpotLight?(f=3*W,H.gammaInput?w(E,f,u,p*p):S(E,f,u,p),p=c.matrixWorld.getPosition(),L[f]=p.x,L[f+1]=p.y,L[f+2]=p.z,F[W]=d,we.copy(p),we.subSelf(c.target.matrixWorld.getPosition()),we.normalize(),D[f]=we.x,D[f+1]=we.y,D[f+2]=we.z,U[W]=Math.cos(c.angle),N[W]=c.exponent,W+=1):c instanceof a.HemisphereLight&&(d=c.color,f=c.groundColor,u=3*G,H.gammaInput?(p*=p,w(O,u,d,p),w(B,u,f,p)):(S(O,u,d,p),S(B,u,f,p)),p=c.matrixWorld.getPosition(),V[u]=p.x,V[u+1]=p.y,V[u+2]=p.z,G+=1));for(r=3*I,o=x.length;r<o;r++)x[r]=0;for(r=3*z,o=M.length;r<o;r++)M[r]=0;for(r=3*W,o=E.length;r<o;r++)E[r]=0;for(r=3*G,o=O.length;r<o;r++)O[r]=0;for(r=3*G,o=B.length;r<o;r++)B[r]=0;y.directional.length=I,y.point.length=z,y.spot.length=W,y.hemi.length=G,y.ambient[0]=m,y.ambient[1]=g,y.ambient[2]=v,Se=!1}r=Me,h.ambientLightColor.value=r.ambient,h.directionalLightColor.value=r.directional.colors,h.directionalLightDirection.value=r.directional.positions,h.pointLightColor.value=r.point.colors,h.pointLightPosition.value=r.point.positions,h.pointLightDistance.value=r.point.distances,h.spotLightColor.value=r.spot.colors,h.spotLightPosition.value=r.spot.positions,h.spotLightDistance.value=r.spot.distances,h.spotLightDirection.value=r.spot.directions,h.spotLightAngle.value=r.spot.angles,h.spotLightExponent.value=r.spot.exponents,h.hemisphereLightSkyColor.value=r.hemi.skyColors,h.hemisphereLightGroundColor.value=r.hemi.groundColors,h.hemisphereLightPosition.value=r.hemi.positions}if(i instanceof a.MeshBasicMaterial||i instanceof a.MeshLambertMaterial||i instanceof a.MeshPhongMaterial){h.opacity.value=i.opacity,H.gammaInput?h.diffuse.value.copyGammaToLinear(i.color):h.diffuse.value=i.color,h.map.value=i.map,h.lightMap.value=i.lightMap,h.specularMap.value=i.specularMap,i.bumpMap&&(h.bumpMap.value=i.bumpMap,h.bumpScale.value=i.bumpScale),i.normalMap&&(h.normalMap.value=i.normalMap,h.normalScale.value.copy(i.normalScale));var j;i.map?j=i.map:i.specularMap?j=i.specularMap:i.normalMap?j=i.normalMap:i.bumpMap&&(j=i.bumpMap),void 0!==j&&(r=j.offset,j=j.repeat,h.offsetRepeat.value.set(r.x,r.y,j.x,j.y)),h.envMap.value=i.envMap,h.flipEnvMap.value=i.envMap instanceof a.WebGLRenderTargetCube?1:-1,h.reflectivity.value=i.reflectivity,h.refractionRatio.value=i.refractionRatio,h.combine.value=i.combine,h.useRefract.value=i.envMap&&i.envMap.mapping instanceof a.CubeRefractionMapping}if(i instanceof a.LineBasicMaterial?(h.diffuse.value=i.color,h.opacity.value=i.opacity):i instanceof a.ParticleBasicMaterial?(h.psColor.value=i.color,h.opacity.value=i.opacity,h.size.value=i.size,h.scale.value=P.height/2,h.map.value=i.map):i instanceof a.MeshPhongMaterial?(h.shininess.value=i.shininess,H.gammaInput?(h.ambient.value.copyGammaToLinear(i.ambient),h.emissive.value.copyGammaToLinear(i.emissive),h.specular.value.copyGammaToLinear(i.specular)):(h.ambient.value=i.ambient,h.emissive.value=i.emissive,h.specular.value=i.specular),i.wrapAround&&h.wrapRGB.value.copy(i.wrapRGB)):i instanceof a.MeshLambertMaterial?(H.gammaInput?(h.ambient.value.copyGammaToLinear(i.ambient),h.emissive.value.copyGammaToLinear(i.emissive)):(h.ambient.value=i.ambient,h.emissive.value=i.emissive),i.wrapAround&&h.wrapRGB.value.copy(i.wrapRGB)):i instanceof a.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof a.MeshNormalMaterial&&(h.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&h.shadowMatrix)for(r=j=0,o=t.length;r<o;r++)c=t[r],c.castShadow&&(c instanceof a.SpotLight||c instanceof a.DirectionalLight&&!c.shadowCascade)&&(h.shadowMap.value[j]=c.shadowMap,h.shadowMapSize.value[j]=c.shadowMapSize,h.shadowMatrix.value[j]=c.shadowMatrix,h.shadowDarkness.value[j]=c.shadowDarkness,h.shadowBias.value[j]=c.shadowBias,j++);for(t=i.uniformsList,h=0,j=t.length;h<j;h++)if(o=s.uniforms[t[h][1]])if(r=t[h][0],m=r.type,c=r.value,"i"===m)k.uniform1i(o,c);else if("f"===m)k.uniform1f(o,c);else if("v2"===m)k.uniform2f(o,c.x,c.y);else if("v3"===m)k.uniform3f(o,c.x,c.y,c.z);else if("v4"===m)k.uniform4f(o,c.x,c.y,c.z,c.w);else if("c"===m)k.uniform3f(o,c.r,c.g,c.b);else if("iv1"===m)k.uniform1iv(o,c);else if("iv"===m)k.uniform3iv(o,c);else if("fv1"===m)k.uniform1fv(o,c);else if("fv"===m)k.uniform3fv(o,c);else if("v2v"===m){for(void 0===r._array&&(r._array=new Float32Array(2*c.length)),m=0,g=c.length;m<g;m++)v=2*m,r._array[v]=c[m].x,r._array[v+1]=c[m].y;k.uniform2fv(o,r._array)}else if("v3v"===m){for(void 0===r._array&&(r._array=new Float32Array(3*c.length)),m=0,g=c.length;m<g;m++)v=3*m,r._array[v]=c[m].x,r._array[v+1]=c[m].y,r._array[v+2]=c[m].z;k.uniform3fv(o,r._array)}else if("v4v"===m){for(void 0===r._array&&(r._array=new Float32Array(4*c.length)),m=0,g=c.length;m<g;m++)v=4*m,r._array[v]=c[m].x,r._array[v+1]=c[m].y,r._array[v+2]=c[m].z,r._array[v+3]=c[m].w;k.uniform4fv(o,r._array)}else if("m4"===m)void 0===r._array&&(r._array=new Float32Array(16)),c.flattenToArray(r._array),k.uniformMatrix4fv(o,!1,r._array);else if("m4v"===m){for(void 0===r._array&&(r._array=new Float32Array(16*c.length)),m=0,g=c.length;m<g;m++)c[m].flattenToArrayOffset(r._array,16*m);k.uniformMatrix4fv(o,!1,r._array)}else if("t"===m){if(v=c,c=b(),k.uniform1i(o,c),v)if(v.image instanceof Array&&6===v.image.length){if(r=v,o=c,6===r.image.length)if(r.needsUpdate){for(r.image.__webglTextureCube||(r.image.__webglTextureCube=k.createTexture()),k.activeTexture(k.TEXTURE0+o),k.bindTexture(k.TEXTURE_CUBE_MAP,r.image.__webglTextureCube),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,r.flipY),o=r instanceof a.CompressedTexture,c=[],m=0;m<6;m++)H.autoScaleCubemaps&&!o?(g=c,v=m,y=r.image[m],_=Ce,y.width<=_&&y.height<=_||(M=Math.max(y.width,y.height),x=Math.floor(y.width*_/M),_=Math.floor(y.height*_/M),M=document.createElement("canvas"),M.width=x,M.height=_,M.getContext("2d").drawImage(y,0,0,y.width,y.height,0,0,x,_),y=M),g[v]=y):c[m]=r.image[m];for(m=c[0],g=0===(m.width&m.width-1)&&0===(m.height&m.height-1),v=R(r.format),y=R(r.type),C(k.TEXTURE_CUBE_MAP,r,g),m=0;m<6;m++)if(o)for(_=c[m].mipmaps,M=0,T=_.length;M<T;M++)x=_[M],k.compressedTexImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+m,M,v,x.width,x.height,0,x.data);else k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,v,v,y,c[m]);r.generateMipmaps&&g&&k.generateMipmap(k.TEXTURE_CUBE_MAP),r.needsUpdate=!1,r.onUpdate&&r.onUpdate()}else k.activeTexture(k.TEXTURE0+o),k.bindTexture(k.TEXTURE_CUBE_MAP,r.image.__webglTextureCube)}else v instanceof a.WebGLRenderTargetCube?(r=v,k.activeTexture(k.TEXTURE0+c),k.bindTexture(k.TEXTURE_CUBE_MAP,r.__webglTexture)):H.setTexture(v,c)}else if("tv"===m){for(void 0===r._array&&(r._array=[]),m=0,g=r.value.length;m<g;m++)r._array[m]=b();for(k.uniform1iv(o,r._array),m=0,g=r.value.length;m<g;m++)v=r.value[m],c=r._array[m],v&&H.setTexture(v,c)}(i instanceof a.ShaderMaterial||i instanceof a.MeshPhongMaterial||i.envMap)&&null!==l.cameraPosition&&(t=e.matrixWorld.getPosition(),k.uniform3f(l.cameraPosition,t.x,t.y,t.z)),(i instanceof a.MeshPhongMaterial||i instanceof a.MeshLambertMaterial||i instanceof a.ShaderMaterial||i.skinning)&&null!==l.viewMatrix&&k.uniformMatrix4fv(l.viewMatrix,!1,e._viewMatrixArray)}return k.uniformMatrix4fv(l.modelViewMatrix,!1,n._modelViewMatrix.elements),l.normalMatrix&&k.uniformMatrix3fv(l.normalMatrix,!1,n._normalMatrix.elements),null!==l.modelMatrix&&k.uniformMatrix4fv(l.modelMatrix,!1,n.matrixWorld.elements),s}function b(){var e=$;return e>=Ae&&console.warn("Trying to use "+e+" texture units while this GPU supports only "+Ae),$+=1,e}function _(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function w(e,t,r,i){e[t]=r.r*r.r*i,e[t+1]=r.g*r.g*i,e[t+2]=r.b*r.b*i}function S(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function M(e,t,r){le!==e&&(e?k.enable(k.POLYGON_OFFSET_FILL):k.disable(k.POLYGON_OFFSET_FILL),le=e),!e||he===t&&ce===r||(k.polygonOffset(t,r),he=t,ce=r)}function T(e){for(var e=e.split("\n"),t=0,r=e.length;t<r;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function A(e,t){var r;return"fragment"===e?r=k.createShader(k.FRAGMENT_SHADER):"vertex"===e&&(r=k.createShader(k.VERTEX_SHADER)),k.shaderSource(r,t),k.compileShader(r),k.getShaderParameter(r,k.COMPILE_STATUS)?r:(console.error(k.getShaderInfoLog(r)),console.error(T(t)),null)}function C(e,t,r){r?(k.texParameteri(e,k.TEXTURE_WRAP_S,R(t.wrapS)),k.texParameteri(e,k.TEXTURE_WRAP_T,R(t.wrapT)),k.texParameteri(e,k.TEXTURE_MAG_FILTER,R(t.magFilter)),k.texParameteri(e,k.TEXTURE_MIN_FILTER,R(t.minFilter))):(k.texParameteri(e,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(e,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(e,k.TEXTURE_MAG_FILTER,L(t.magFilter)),k.texParameteri(e,k.TEXTURE_MIN_FILTER,L(t.minFilter))),W&&t.type!==a.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(k.texParameterf(e,W.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Ee)),t.__oldAnisotropy=t.anisotropy)}function E(e,t){k.bindRenderbuffer(k.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,t.width,t.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_STENCIL,t.width,t.height),k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_STENCIL_ATTACHMENT,k.RENDERBUFFER,e)):k.renderbufferStorage(k.RENDERBUFFER,k.RGBA4,t.width,t.height)}function L(e){return e===a.NearestFilter||e===a.NearestMipMapNearestFilter||e===a.NearestMipMapLinearFilter?k.NEAREST:k.LINEAR}function R(e){if(e===a.RepeatWrapping)return k.REPEAT;if(e===a.ClampToEdgeWrapping)return k.CLAMP_TO_EDGE;if(e===a.MirroredRepeatWrapping)return k.MIRRORED_REPEAT;if(e===a.NearestFilter)return k.NEAREST;if(e===a.NearestMipMapNearestFilter)return k.NEAREST_MIPMAP_NEAREST;if(e===a.NearestMipMapLinearFilter)return k.NEAREST_MIPMAP_LINEAR;if(e===a.LinearFilter)return k.LINEAR;if(e===a.LinearMipMapNearestFilter)return k.LINEAR_MIPMAP_NEAREST;if(e===a.LinearMipMapLinearFilter)return k.LINEAR_MIPMAP_LINEAR;if(e===a.UnsignedByteType)return k.UNSIGNED_BYTE;if(e===a.UnsignedShort4444Type)return k.UNSIGNED_SHORT_4_4_4_4;if(e===a.UnsignedShort5551Type)return k.UNSIGNED_SHORT_5_5_5_1;if(e===a.UnsignedShort565Type)return k.UNSIGNED_SHORT_5_6_5;if(e===a.ByteType)return k.BYTE;if(e===a.ShortType)return k.SHORT;if(e===a.UnsignedShortType)return k.UNSIGNED_SHORT;if(e===a.IntType)return k.INT;if(e===a.UnsignedIntType)return k.UNSIGNED_INT;if(e===a.FloatType)return k.FLOAT;if(e===a.AlphaFormat)return k.ALPHA;if(e===a.RGBFormat)return k.RGB;if(e===a.RGBAFormat)return k.RGBA;if(e===a.LuminanceFormat)return k.LUMINANCE;if(e===a.LuminanceAlphaFormat)return k.LUMINANCE_ALPHA;if(e===a.AddEquation)return k.FUNC_ADD;if(e===a.SubtractEquation)return k.FUNC_SUBTRACT;if(e===a.ReverseSubtractEquation)return k.FUNC_REVERSE_SUBTRACT;if(e===a.ZeroFactor)return k.ZERO;if(e===a.OneFactor)return k.ONE;if(e===a.SrcColorFactor)return k.SRC_COLOR;if(e===a.OneMinusSrcColorFactor)return k.ONE_MINUS_SRC_COLOR;if(e===a.SrcAlphaFactor)return k.SRC_ALPHA;if(e===a.OneMinusSrcAlphaFactor)return k.ONE_MINUS_SRC_ALPHA;if(e===a.DstAlphaFactor)return k.DST_ALPHA;if(e===a.OneMinusDstAlphaFactor)return k.ONE_MINUS_DST_ALPHA;if(e===a.DstColorFactor)return k.DST_COLOR;if(e===a.OneMinusDstColorFactor)return k.ONE_MINUS_DST_COLOR;if(e===a.SrcAlphaSaturateFactor)return k.SRC_ALPHA_SATURATE;if(void 0!==G){if(e===a.RGB_S3TC_DXT1_Format)return G.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT1_Format)return G.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===a.RGBA_S3TC_DXT3_Format)return G.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===a.RGBA_S3TC_DXT5_Format)return G.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THR51.WebGLRenderer",a.REVISION);var e=e||{},P=void 0!==e.canvas?e.canvas:document.createElement("canvas"),F=void 0!==e.precision?e.precision:"highp",D=void 0===e.alpha||e.alpha,U=void 0===e.premultipliedAlpha||e.premultipliedAlpha,N=void 0!==e.antialias&&e.antialias,O=void 0===e.stencil||e.stencil,B=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,V=void 0!==e.clearColor?new a.Color(e.clearColor):new a.Color(0),I=void 0!==e.clearAlpha?e.clearAlpha:0,z=void 0!==e.maxLights?e.maxLights:4;this.domElement=P,this.context=null,this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=!1,this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=!0,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var k,W,G,H=this,j=[],X=0,Y=null,q=null,K=-1,Z=null,Q=null,J=0,$=0,ee=-1,te=-1,re=-1,ie=-1,ne=-1,ae=-1,oe=-1,se=-1,le=null,he=null,ce=null,ue=null,de=0,fe=0,pe=0,me=0,ge=0,ve=0,ye=new a.Frustum,xe=new a.Matrix4,be=new a.Matrix4,_e=new a.Vector4,we=new a.Vector3,Se=!0,Me={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{if(!(k=P.getContext("experimental-webgl",{alpha:D,premultipliedAlpha:U,antialias:N,stencil:O,preserveDrawingBuffer:B})))throw"Error creating WebGL context."}catch(Te){console.error(Te)}e=k.getExtension("OES_texture_float"),
D=k.getExtension("OES_standard_derivatives"),W=k.getExtension("EXT_texture_filter_anisotropic")||k.getExtension("MOZ_EXT_texture_filter_anisotropic")||k.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),G=k.getExtension("WEBGL_compressed_texture_s3tc")||k.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||k.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),e||console.log("THR51.WebGLRenderer: Float textures not supported."),D||console.log("THR51.WebGLRenderer: Standard derivatives not supported."),W||console.log("THR51.WebGLRenderer: Anisotropic texture filtering not supported."),G||console.log("THR51.WebGLRenderer: S3TC compressed textures not supported."),k.clearColor(0,0,0,1),k.clearDepth(1),k.clearStencil(0),k.enable(k.DEPTH_TEST),k.depthFunc(k.LEQUAL),k.frontFace(k.CCW),k.cullFace(k.BACK),k.enable(k.CULL_FACE),k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA),k.clearColor(V.r,V.g,V.b,I),this.context=k;var Ae=k.getParameter(k.MAX_TEXTURE_IMAGE_UNITS),D=k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS);k.getParameter(k.MAX_TEXTURE_SIZE);var Ce=k.getParameter(k.MAX_CUBE_MAP_TEXTURE_SIZE),Ee=W?k.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Le=D>0,Re=Le&&e;G&&k.getParameter(k.COMPRESSED_TEXTURE_FORMATS),this.getContext=function(){return k},this.supportsVertexTextures=function(){return Le},this.getMaxAnisotropy=function(){return Ee},this.setSize=function(e,t){P.width=e,P.height=t,this.setViewport(0,0,P.width,P.height)},this.setViewport=function(e,t,r,i){de=void 0!==e?e:0,fe=void 0!==t?t:0,pe=void 0!==r?r:P.width,me=void 0!==i?i:P.height,k.viewport(de,fe,pe,me)},this.setScissor=function(e,t,r,i){k.scissor(e,t,r,i)},this.enableScissorTest=function(e){e?k.enable(k.SCISSOR_TEST):k.disable(k.SCISSOR_TEST)},this.setClearColorHex=function(e,t){V.setHex(e),I=t,k.clearColor(V.r,V.g,V.b,I)},this.setClearColor=function(e,t){V.copy(e),I=t,k.clearColor(V.r,V.g,V.b,I)},this.getClearColor=function(){return V},this.getClearAlpha=function(){return I},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=k.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=k.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=k.STENCIL_BUFFER_BIT),k.clear(i)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.deallocateObject=function(e){if(e.__webglInit)if(e.__webglInit=!1,delete e._modelViewMatrix,delete e._normalMatrix,delete e._normalMatrixArray,delete e._modelViewMatrixArray,delete e._modelMatrixArray,e instanceof a.Mesh)for(var t in e.geometry.geometryGroups){var r=e.geometry.geometryGroups[t];k.deleteBuffer(r.__webglVertexBuffer),k.deleteBuffer(r.__webglNormalBuffer),k.deleteBuffer(r.__webglTangentBuffer),k.deleteBuffer(r.__webglColorBuffer),k.deleteBuffer(r.__webglUVBuffer),k.deleteBuffer(r.__webglUV2Buffer),k.deleteBuffer(r.__webglSkinIndicesBuffer),k.deleteBuffer(r.__webglSkinWeightsBuffer),k.deleteBuffer(r.__webglFaceBuffer),k.deleteBuffer(r.__webglLineBuffer);var i=void 0,n=void 0;if(r.numMorphTargets)for(i=0,n=r.numMorphTargets;i<n;i++)k.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(r.numMorphNormals)for(i=0,n=r.numMorphNormals;i<n;i++)k.deleteBuffer(r.__webglMorphNormalsBuffers[i]);if(r.__webglCustomAttributesList){i=void 0;for(i in r.__webglCustomAttributesList)k.deleteBuffer(r.__webglCustomAttributesList[i].buffer)}H.info.memory.geometries--}else e instanceof a.Ribbon?(e=e.geometry,k.deleteBuffer(e.__webglVertexBuffer),k.deleteBuffer(e.__webglColorBuffer),H.info.memory.geometries--):e instanceof a.Line?(e=e.geometry,k.deleteBuffer(e.__webglVertexBuffer),k.deleteBuffer(e.__webglColorBuffer),H.info.memory.geometries--):e instanceof a.ParticleSystem&&(e=e.geometry,k.deleteBuffer(e.__webglVertexBuffer),k.deleteBuffer(e.__webglColorBuffer),H.info.memory.geometries--)},this.deallocateTexture=function(e){e.__webglInit&&(e.__webglInit=!1,k.deleteTexture(e.__webglTexture),H.info.memory.textures--)},this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture)if(k.deleteTexture(e.__webglTexture),e instanceof a.WebGLRenderTargetCube)for(var t=0;t<6;t++)k.deleteFramebuffer(e.__webglFramebuffer[t]),k.deleteRenderbuffer(e.__webglRenderbuffer[t]);else k.deleteFramebuffer(e.__webglFramebuffer),k.deleteRenderbuffer(e.__webglRenderbuffer)},this.deallocateMaterial=function(e){var t=e.program;if(t){e.program=void 0;var r,i,n=!1,e=0;for(r=j.length;e<r;e++)if(i=j[e],i.program===t){i.usedTimes--,0===i.usedTimes&&(n=!0);break}if(n){for(n=[],e=0,r=j.length;e<r;e++)i=j[e],i.program!==t&&n.push(i);j=n,k.deleteProgram(t),H.info.memory.programs--}}},this.updateShadowMap=function(e,t){Y=null,K=Z=se=oe=re=-1,Se=!0,te=ee=-1,this.shadowMapPlugin.update(e,t)},this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=k.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=k.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=k.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=k.createBuffer()),e.hasPositions&&(k.bindBuffer(k.ARRAY_BUFFER,e.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,e.positionArray,k.DYNAMIC_DRAW),k.enableVertexAttribArray(t.attributes.position),k.vertexAttribPointer(t.attributes.position,3,k.FLOAT,!1,0,0)),e.hasNormals){if(k.bindBuffer(k.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===a.FlatShading){var i,n,o,s,l,h,c,u,d,f,p,m=3*e.count;for(p=0;p<m;p+=9)f=e.normalArray,i=f[p],n=f[p+1],o=f[p+2],s=f[p+3],h=f[p+4],u=f[p+5],l=f[p+6],c=f[p+7],d=f[p+8],i=(i+s+l)/3,n=(n+h+c)/3,o=(o+u+d)/3,f[p]=i,f[p+1]=n,f[p+2]=o,f[p+3]=i,f[p+4]=n,f[p+5]=o,f[p+6]=i,f[p+7]=n,f[p+8]=o}k.bufferData(k.ARRAY_BUFFER,e.normalArray,k.DYNAMIC_DRAW),k.enableVertexAttribArray(t.attributes.normal),k.vertexAttribPointer(t.attributes.normal,3,k.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(k.bindBuffer(k.ARRAY_BUFFER,e.__webglUvBuffer),k.bufferData(k.ARRAY_BUFFER,e.uvArray,k.DYNAMIC_DRAW),k.enableVertexAttribArray(t.attributes.uv),k.vertexAttribPointer(t.attributes.uv,2,k.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==a.NoColors&&(k.bindBuffer(k.ARRAY_BUFFER,e.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,e.colorArray,k.DYNAMIC_DRAW),k.enableVertexAttribArray(t.attributes.color),k.vertexAttribPointer(t.attributes.color,3,k.FLOAT,!1,0,0)),k.drawArrays(k.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,o){if(i.visible!==!1)if(r=x(e,t,r,i,o),e=r.attributes,t=!1,i=16777215*n.id+2*r.id+(i.wireframe?1:0),i!==Z&&(Z=i,t=!0),o instanceof a.Mesh)for(o=n.offsets,o.length>1&&(t=!0),i=0,r=o.length;i<r;++i){var s=o[i].index;if(t){var l=n.attributes.position,h=l.itemSize;if(k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.vertexAttribPointer(e.position,h,k.FLOAT,!1,0,s*h*4),l=n.attributes.normal,e.normal>=0&&l&&(h=l.itemSize,k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.vertexAttribPointer(e.normal,h,k.FLOAT,!1,0,s*h*4)),l=n.attributes.uv,e.uv>=0&&l&&(l.buffer?(h=l.itemSize,k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.vertexAttribPointer(e.uv,h,k.FLOAT,!1,0,s*h*4),k.enableVertexAttribArray(e.uv)):k.disableVertexAttribArray(e.uv)),h=n.attributes.color,e.color>=0&&h){var c=h.itemSize;k.bindBuffer(k.ARRAY_BUFFER,h.buffer),k.vertexAttribPointer(e.color,c,k.FLOAT,!1,0,s*c*4)}l=n.attributes.tangent,e.tangent>=0&&l&&(h=l.itemSize,k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.vertexAttribPointer(e.tangent,h,k.FLOAT,!1,0,s*h*4)),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.attributes.index.buffer)}k.drawElements(k.TRIANGLES,o[i].count,k.UNSIGNED_SHORT,2*o[i].start),H.info.render.calls++,H.info.render.vertices=H.info.render.vertices+o[i].count,H.info.render.faces=H.info.render.faces+o[i].count/3}else o instanceof a.ParticleSystem&&t&&(l=n.attributes.position,h=l.itemSize,k.bindBuffer(k.ARRAY_BUFFER,l.buffer),k.vertexAttribPointer(e.position,h,k.FLOAT,!1,0,0),h=n.attributes.color,e.color>=0&&h&&(c=h.itemSize,k.bindBuffer(k.ARRAY_BUFFER,h.buffer),k.vertexAttribPointer(e.color,c,k.FLOAT,!1,0,0)),k.drawArrays(k.POINTS,0,l.numItems/3),H.info.render.calls++,H.info.render.points=H.info.render.points+l.numItems/3)},this.renderBuffer=function(e,t,r,i,n,o){if(i.visible!==!1){var s,l,r=x(e,t,r,i,o),t=r.attributes,e=!1,r=16777215*n.id+2*r.id+(i.wireframe?1:0);if(r!==Z&&(Z=r,e=!0),!i.morphTargets&&t.position>=0)e&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglVertexBuffer),k.vertexAttribPointer(t.position,3,k.FLOAT,!1,0,0));else if(o.morphTargetBase){if(r=i.program.attributes,o.morphTargetBase!==-1?(k.bindBuffer(k.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[o.morphTargetBase]),k.vertexAttribPointer(r.position,3,k.FLOAT,!1,0,0)):r.position>=0&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglVertexBuffer),k.vertexAttribPointer(r.position,3,k.FLOAT,!1,0,0)),o.morphTargetForcedOrder.length){var h=0;for(l=o.morphTargetForcedOrder,s=o.morphTargetInfluences;h<i.numSupportedMorphTargets&&h<l.length;)k.bindBuffer(k.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[l[h]]),k.vertexAttribPointer(r["morphTarget"+h],3,k.FLOAT,!1,0,0),i.morphNormals&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglMorphNormalsBuffers[l[h]]),k.vertexAttribPointer(r["morphNormal"+h],3,k.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=s[l[h]],h++}else{l=[],s=o.morphTargetInfluences;var u,d=s.length;for(u=0;u<d;u++)h=s[u],h>0&&l.push([u,h]);for(l.length>i.numSupportedMorphTargets?(l.sort(c),l.length=i.numSupportedMorphTargets):l.length>i.numSupportedMorphNormals?l.sort(c):0===l.length&&l.push([0,0]),h=0;h<i.numSupportedMorphTargets;)l[h]?(u=l[h][0],k.bindBuffer(k.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[u]),k.vertexAttribPointer(r["morphTarget"+h],3,k.FLOAT,!1,0,0),i.morphNormals&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglMorphNormalsBuffers[u]),k.vertexAttribPointer(r["morphNormal"+h],3,k.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[h]=s[u]):(k.vertexAttribPointer(r["morphTarget"+h],3,k.FLOAT,!1,0,0),i.morphNormals&&k.vertexAttribPointer(r["morphNormal"+h],3,k.FLOAT,!1,0,0),o.__webglMorphTargetInfluences[h]=0),h++}null!==i.program.uniforms.morphTargetInfluences&&k.uniform1fv(i.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(e){if(n.__webglCustomAttributesList)for(s=0,l=n.__webglCustomAttributesList.length;s<l;s++)r=n.__webglCustomAttributesList[s],t[r.buffer.belongsToAttribute]>=0&&(k.bindBuffer(k.ARRAY_BUFFER,r.buffer),k.vertexAttribPointer(t[r.buffer.belongsToAttribute],r.size,k.FLOAT,!1,0,0));t.color>=0&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglColorBuffer),k.vertexAttribPointer(t.color,3,k.FLOAT,!1,0,0)),t.normal>=0&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglNormalBuffer),k.vertexAttribPointer(t.normal,3,k.FLOAT,!1,0,0)),t.tangent>=0&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglTangentBuffer),k.vertexAttribPointer(t.tangent,4,k.FLOAT,!1,0,0)),t.uv>=0&&(n.__webglUVBuffer?(k.bindBuffer(k.ARRAY_BUFFER,n.__webglUVBuffer),k.vertexAttribPointer(t.uv,2,k.FLOAT,!1,0,0),k.enableVertexAttribArray(t.uv)):k.disableVertexAttribArray(t.uv)),t.uv2>=0&&(n.__webglUV2Buffer?(k.bindBuffer(k.ARRAY_BUFFER,n.__webglUV2Buffer),k.vertexAttribPointer(t.uv2,2,k.FLOAT,!1,0,0),k.enableVertexAttribArray(t.uv2)):k.disableVertexAttribArray(t.uv2)),i.skinning&&t.skinIndex>=0&&t.skinWeight>=0&&(k.bindBuffer(k.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),k.vertexAttribPointer(t.skinIndex,4,k.FLOAT,!1,0,0),k.bindBuffer(k.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),k.vertexAttribPointer(t.skinWeight,4,k.FLOAT,!1,0,0))}o instanceof a.Mesh?(i.wireframe?(i=i.wireframeLinewidth,i!==ue&&(k.lineWidth(i),ue=i),e&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),k.drawElements(k.LINES,n.__webglLineCount,k.UNSIGNED_SHORT,0)):(e&&k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),k.drawElements(k.TRIANGLES,n.__webglFaceCount,k.UNSIGNED_SHORT,0)),H.info.render.calls++,H.info.render.vertices=H.info.render.vertices+n.__webglFaceCount,H.info.render.faces=H.info.render.faces+n.__webglFaceCount/3):o instanceof a.Line?(o=o.type===a.LineStrip?k.LINE_STRIP:k.LINES,i=i.linewidth,i!==ue&&(k.lineWidth(i),ue=i),k.drawArrays(o,0,n.__webglLineCount),H.info.render.calls++):o instanceof a.ParticleSystem?(k.drawArrays(k.POINTS,0,n.__webglParticleCount),H.info.render.calls++,H.info.render.points=H.info.render.points+n.__webglParticleCount):o instanceof a.Ribbon&&(k.drawArrays(k.TRIANGLE_STRIP,0,n.__webglVertexCount),H.info.render.calls++)}},this.render=function(e,t,r,i){if(t instanceof a.Camera==!1)console.error("THR51.WebGLRenderer.render: camera is not an instance of THR51.Camera.");else{var n,o,s,l,c=e.__lights,p=e.fog;for(K=-1,Se=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t._viewMatrixArray||(t._viewMatrixArray=new Float32Array(16)),t._projectionMatrixArray||(t._projectionMatrixArray=new Float32Array(16)),t.matrixWorldInverse.getInverse(t.matrixWorld),t.matrixWorldInverse.flattenToArray(t._viewMatrixArray),t.projectionMatrix.flattenToArray(t._projectionMatrixArray),xe.multiply(t.projectionMatrix,t.matrixWorldInverse),ye.setFromMatrix(xe),this.autoUpdateObjects&&this.initWebGLObjects(e),u(this.renderPluginsPre,e,t),H.info.render.calls=0,H.info.render.vertices=0,H.info.render.faces=0,H.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=e.__webglObjects,i=0,n=l.length;i<n;i++)if(o=l[i],s=o.object,o.render=!1,s.visible&&(!(s instanceof a.Mesh||s instanceof a.ParticleSystem)||!s.frustumCulled||ye.contains(s))){_(s,t);var m=o,g=m.object,v=m.buffer,y=void 0,y=y=void 0,y=g.material;y instanceof a.MeshFaceMaterial?(y=v.materialIndex,y>=0&&(y=g.geometry.materials[y],y.transparent?(m.transparent=y,m.opaque=null):(m.opaque=y,m.transparent=null))):y&&(y.transparent?(m.transparent=y,m.opaque=null):(m.opaque=y,m.transparent=null)),o.render=!0,this.sortObjects===!0&&(null!==s.renderDepth?o.z=s.renderDepth:(_e.copy(s.matrixWorld.getPosition()),xe.multiplyVector3(_e),o.z=_e.z))}for(this.sortObjects&&l.sort(h),l=e.__webglObjectsImmediate,i=0,n=l.length;i<n;i++)o=l[i],s=o.object,s.visible&&(_(s,t),s=o.object.material,s.transparent?(o.transparent=s,o.opaque=null):(o.opaque=s,o.transparent=null));e.overrideMaterial?(i=e.overrideMaterial,this.setBlending(i.blending,i.blendEquation,i.blendSrc,i.blendDst),this.setDepthTest(i.depthTest),this.setDepthWrite(i.depthWrite),M(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),d(e.__webglObjects,!1,"",t,c,p,!0,i),f(e.__webglObjectsImmediate,"",t,c,p,!1,i)):(this.setBlending(a.NormalBlending),d(e.__webglObjects,!0,"opaque",t,c,p,!1),f(e.__webglObjectsImmediate,"opaque",t,c,p,!1),d(e.__webglObjects,!1,"transparent",t,c,p,!0),f(e.__webglObjectsImmediate,"transparent",t,c,p,!0)),u(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==a.NearestFilter&&r.minFilter!==a.LinearFilter&&(r instanceof a.WebGLRenderTargetCube?(k.bindTexture(k.TEXTURE_CUBE_MAP,r.__webglTexture),k.generateMipmap(k.TEXTURE_CUBE_MAP),k.bindTexture(k.TEXTURE_CUBE_MAP,null)):(k.bindTexture(k.TEXTURE_2D,r.__webglTexture),k.generateMipmap(k.TEXTURE_2D),k.bindTexture(k.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,r,i,n){var a=x(e,t,r,i,n);Z=-1,H.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(a,k,ye):n.render(function(e){H.renderBufferImmediate(e,a,i)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;){var h=e.__objectsAdded[0],c=e,u=void 0,d=void 0,f=void 0;if(!h.__webglInit)if(h.__webglInit=!0,h._modelViewMatrix=new a.Matrix4,h._normalMatrix=new a.Matrix3,h instanceof a.Mesh)if(d=h.geometry,d instanceof a.Geometry){if(void 0===d.geometryGroups){var x=d,b=void 0,_=void 0,w=void 0,S=void 0,M=void 0,T=void 0,A=void 0,C={},E=x.morphTargets.length,L=x.morphNormals.length;for(x.geometryGroups={},b=0,_=x.faces.length;b<_;b++)w=x.faces[b],S=w.materialIndex,T=void 0!==S?S:-1,void 0===C[T]&&(C[T]={hash:T,counter:0}),A=C[T].hash+"_"+C[T].counter,void 0===x.geometryGroups[A]&&(x.geometryGroups[A]={faces3:[],faces4:[],materialIndex:S,vertices:0,numMorphTargets:E,numMorphNormals:L}),M=w instanceof a.Face3?3:4,x.geometryGroups[A].vertices+M>65535&&(C[T].counter=C[T].counter+1,A=C[T].hash+"_"+C[T].counter,void 0===x.geometryGroups[A]&&(x.geometryGroups[A]={faces3:[],faces4:[],materialIndex:S,vertices:0,numMorphTargets:E,numMorphNormals:L})),w instanceof a.Face3?x.geometryGroups[A].faces3.push(b):x.geometryGroups[A].faces4.push(b),x.geometryGroups[A].vertices=x.geometryGroups[A].vertices+M;x.geometryGroupsList=[];var R=void 0;for(R in x.geometryGroups)x.geometryGroups[R].id=J++,x.geometryGroupsList.push(x.geometryGroups[R])}for(u in d.geometryGroups)if(f=d.geometryGroups[u],!f.__webglVertexBuffer){var P=f;P.__webglVertexBuffer=k.createBuffer(),P.__webglNormalBuffer=k.createBuffer(),P.__webglTangentBuffer=k.createBuffer(),P.__webglColorBuffer=k.createBuffer(),P.__webglUVBuffer=k.createBuffer(),P.__webglUV2Buffer=k.createBuffer(),P.__webglSkinIndicesBuffer=k.createBuffer(),P.__webglSkinWeightsBuffer=k.createBuffer(),P.__webglFaceBuffer=k.createBuffer(),P.__webglLineBuffer=k.createBuffer();var F=void 0,D=void 0;if(P.numMorphTargets)for(P.__webglMorphTargetsBuffers=[],F=0,D=P.numMorphTargets;F<D;F++)P.__webglMorphTargetsBuffers.push(k.createBuffer());if(P.numMorphNormals)for(P.__webglMorphNormalsBuffers=[],F=0,D=P.numMorphNormals;F<D;F++)P.__webglMorphNormalsBuffers.push(k.createBuffer());H.info.memory.geometries++;var U=f,N=h,O=N.geometry,B=U.faces3,V=U.faces4,I=3*B.length+4*V.length,z=1*B.length+2*V.length,W=3*B.length+4*V.length,G=r(N,U),j=n(G),X=i(G),Y=!!G.vertexColors&&G.vertexColors;U.__vertexArray=new Float32Array(3*I),X&&(U.__normalArray=new Float32Array(3*I)),O.hasTangents&&(U.__tangentArray=new Float32Array(4*I)),Y&&(U.__colorArray=new Float32Array(3*I)),j&&((O.faceUvs.length>0||O.faceVertexUvs.length>0)&&(U.__uvArray=new Float32Array(2*I)),(O.faceUvs.length>1||O.faceVertexUvs.length>1)&&(U.__uv2Array=new Float32Array(2*I))),N.geometry.skinWeights.length&&N.geometry.skinIndices.length&&(U.__skinIndexArray=new Float32Array(4*I),U.__skinWeightArray=new Float32Array(4*I)),U.__faceArray=new Uint16Array(3*z),U.__lineArray=new Uint16Array(2*W);var q=void 0,K=void 0;if(U.numMorphTargets)for(U.__morphTargetsArrays=[],q=0,K=U.numMorphTargets;q<K;q++)U.__morphTargetsArrays.push(new Float32Array(3*I));if(U.numMorphNormals)for(U.__morphNormalsArrays=[],q=0,K=U.numMorphNormals;q<K;q++)U.__morphNormalsArrays.push(new Float32Array(3*I));if(U.__webglFaceCount=3*z,U.__webglLineCount=2*W,G.attributes){void 0===U.__webglCustomAttributesList&&(U.__webglCustomAttributesList=[]);var Z=void 0;for(Z in G.attributes){var Q,$=G.attributes[Z],ee={};for(Q in $)ee[Q]=$[Q];if(!ee.__webglInitialized||ee.createUniqueBuffers){ee.__webglInitialized=!0;var te=1;"v2"===ee.type?te=2:"v3"===ee.type?te=3:"v4"===ee.type?te=4:"c"===ee.type&&(te=3),ee.size=te,ee.array=new Float32Array(I*te),ee.buffer=k.createBuffer(),ee.buffer.belongsToAttribute=Z,$.needsUpdate=!0,ee.__original=$}U.__webglCustomAttributesList.push(ee)}}U.__inittedArrays=!0,d.verticesNeedUpdate=!0,d.morphTargetsNeedUpdate=!0,d.elementsNeedUpdate=!0,d.uvsNeedUpdate=!0,d.normalsNeedUpdate=!0,d.tangentsNeedUpdate=!0,d.colorsNeedUpdate=!0}}else d instanceof a.BufferGeometry&&o(d);else if(h instanceof a.Ribbon){if(d=h.geometry,!d.__webglVertexBuffer){var re=d;re.__webglVertexBuffer=k.createBuffer(),re.__webglColorBuffer=k.createBuffer(),H.info.memory.geometries++;var ie=d,ne=ie.vertices.length;ie.__vertexArray=new Float32Array(3*ne),ie.__colorArray=new Float32Array(3*ne),ie.__webglVertexCount=ne,d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0}}else if(h instanceof a.Line){if(d=h.geometry,!d.__webglVertexBuffer){var ae=d;ae.__webglVertexBuffer=k.createBuffer(),ae.__webglColorBuffer=k.createBuffer(),H.info.memory.geometries++;var oe=d,se=h,le=oe.vertices.length;oe.__vertexArray=new Float32Array(3*le),oe.__colorArray=new Float32Array(3*le),oe.__webglLineCount=le,t(oe,se),d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0}}else if(h instanceof a.ParticleSystem&&(d=h.geometry,!d.__webglVertexBuffer))if(d instanceof a.Geometry){var he=d;he.__webglVertexBuffer=k.createBuffer(),he.__webglColorBuffer=k.createBuffer(),H.info.memory.geometries++;var ce=d,ue=h,de=ce.vertices.length;ce.__vertexArray=new Float32Array(3*de),ce.__colorArray=new Float32Array(3*de),ce.__sortArray=[],ce.__webglParticleCount=de,t(ce,ue),d.verticesNeedUpdate=!0,d.colorsNeedUpdate=!0}else d instanceof a.BufferGeometry&&o(d);if(!h.__webglActive){if(h instanceof a.Mesh)if(d=h.geometry,d instanceof a.BufferGeometry)p(c.__webglObjects,d,h);else for(u in d.geometryGroups)f=d.geometryGroups[u],p(c.__webglObjects,f,h);else h instanceof a.Ribbon||h instanceof a.Line||h instanceof a.ParticleSystem?(d=h.geometry,p(c.__webglObjects,d,h)):h instanceof a.ImmediateRenderObject||h.immediateRenderCallback?c.__webglObjectsImmediate.push({object:h,opaque:null,transparent:null}):h instanceof a.Sprite?c.__webglSprites.push(h):h instanceof a.LensFlare&&c.__webglFlares.push(h);h.__webglActive=!0}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var fe=e.__objectsRemoved[0],pe=e;fe instanceof a.Mesh||fe instanceof a.ParticleSystem||fe instanceof a.Ribbon||fe instanceof a.Line?v(pe.__webglObjects,fe):fe instanceof a.Sprite?y(pe.__webglSprites,fe):fe instanceof a.LensFlare?y(pe.__webglFlares,fe):(fe instanceof a.ImmediateRenderObject||fe.immediateRenderCallback)&&v(pe.__webglObjectsImmediate,fe),fe.__webglActive=!1,e.__objectsRemoved.splice(0,1)}for(var me=0,ge=e.__webglObjects.length;me<ge;me++){var ve=e.__webglObjects[me].object,ye=ve.geometry,xe=void 0,be=void 0,_e=void 0;if(ve instanceof a.Mesh)if(ye instanceof a.BufferGeometry)(ye.verticesNeedUpdate||ye.elementsNeedUpdate||ye.uvsNeedUpdate||ye.normalsNeedUpdate||ye.colorsNeedUpdate||ye.tangentsNeedUpdate)&&l(ye,k.DYNAMIC_DRAW,!ye.dynamic),ye.verticesNeedUpdate=!1,ye.elementsNeedUpdate=!1,ye.uvsNeedUpdate=!1,ye.normalsNeedUpdate=!1,ye.colorsNeedUpdate=!1,ye.tangentsNeedUpdate=!1;else{for(var we=0,Se=ye.geometryGroupsList.length;we<Se;we++)if(xe=ye.geometryGroupsList[we],_e=r(ve,xe),be=_e.attributes&&m(_e),ye.verticesNeedUpdate||ye.morphTargetsNeedUpdate||ye.elementsNeedUpdate||ye.uvsNeedUpdate||ye.normalsNeedUpdate||ye.colorsNeedUpdate||ye.tangentsNeedUpdate||be){var Me=xe,Te=ve,Ae=k.DYNAMIC_DRAW,Ce=!ye.dynamic,Ee=_e;if(Me.__inittedArrays){var Le=i(Ee),Re=!!Ee.vertexColors&&Ee.vertexColors,Pe=n(Ee),Fe=Le===a.SmoothShading,De=void 0,Ue=void 0,Ne=void 0,Oe=void 0,Be=void 0,Ve=void 0,Ie=void 0,ze=void 0,ke=void 0,We=void 0,Ge=void 0,He=void 0,je=void 0,Xe=void 0,Ye=void 0,qe=void 0,Ke=void 0,Ze=void 0,Qe=void 0,Je=void 0,$e=void 0,et=void 0,tt=void 0,rt=void 0,it=void 0,nt=void 0,at=void 0,ot=void 0,st=void 0,lt=void 0,ht=void 0,ct=void 0,ut=void 0,dt=void 0,ft=void 0,pt=void 0,mt=void 0,gt=void 0,vt=void 0,yt=void 0,xt=void 0,bt=void 0,_t=void 0,wt=void 0,St=void 0,Mt=void 0,Tt=0,At=0,Ct=0,Et=0,Lt=0,Rt=0,Pt=0,Ft=0,Dt=0,Ut=0,Nt=0,Ot=0,Bt=void 0,Vt=Me.__vertexArray,It=Me.__uvArray,zt=Me.__uv2Array,kt=Me.__normalArray,Wt=Me.__tangentArray,Gt=Me.__colorArray,Ht=Me.__skinIndexArray,jt=Me.__skinWeightArray,Xt=Me.__morphTargetsArrays,Yt=Me.__morphNormalsArrays,qt=Me.__webglCustomAttributesList,Kt=void 0,Zt=Me.__faceArray,Qt=Me.__lineArray,Jt=Te.geometry,$t=Jt.elementsNeedUpdate,er=Jt.uvsNeedUpdate,tr=Jt.normalsNeedUpdate,rr=Jt.tangentsNeedUpdate,ir=Jt.colorsNeedUpdate,nr=Jt.morphTargetsNeedUpdate,ar=Jt.vertices,or=Me.faces3,sr=Me.faces4,lr=Jt.faces,hr=Jt.faceVertexUvs[0],cr=Jt.faceVertexUvs[1],ur=Jt.skinIndices,dr=Jt.skinWeights,fr=Jt.morphTargets,pr=Jt.morphNormals;if(Jt.verticesNeedUpdate){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],He=ar[Oe.a],je=ar[Oe.b],Xe=ar[Oe.c],Vt[At]=He.x,Vt[At+1]=He.y,Vt[At+2]=He.z,Vt[At+3]=je.x,Vt[At+4]=je.y,Vt[At+5]=je.z,Vt[At+6]=Xe.x,Vt[At+7]=Xe.y,Vt[At+8]=Xe.z,At+=9;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],He=ar[Oe.a],je=ar[Oe.b],Xe=ar[Oe.c],Ye=ar[Oe.d],Vt[At]=He.x,Vt[At+1]=He.y,Vt[At+2]=He.z,Vt[At+3]=je.x,Vt[At+4]=je.y,Vt[At+5]=je.z,Vt[At+6]=Xe.x,Vt[At+7]=Xe.y,Vt[At+8]=Xe.z,Vt[At+9]=Ye.x,Vt[At+10]=Ye.y,Vt[At+11]=Ye.z,At+=12;k.bindBuffer(k.ARRAY_BUFFER,Me.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,Vt,Ae)}if(nr)for(xt=0,bt=fr.length;xt<bt;xt++){for(De=Nt=0,Ue=or.length;De<Ue;De++)St=or[De],Oe=lr[St],He=fr[xt].vertices[Oe.a],je=fr[xt].vertices[Oe.b],Xe=fr[xt].vertices[Oe.c],_t=Xt[xt],_t[Nt]=He.x,_t[Nt+1]=He.y,_t[Nt+2]=He.z,_t[Nt+3]=je.x,_t[Nt+4]=je.y,_t[Nt+5]=je.z,_t[Nt+6]=Xe.x,_t[Nt+7]=Xe.y,_t[Nt+8]=Xe.z,Ee.morphNormals&&(Fe?(Mt=pr[xt].vertexNormals[St],Je=Mt.a,$e=Mt.b,et=Mt.c):et=$e=Je=pr[xt].faceNormals[St],wt=Yt[xt],wt[Nt]=Je.x,wt[Nt+1]=Je.y,wt[Nt+2]=Je.z,wt[Nt+3]=$e.x,wt[Nt+4]=$e.y,wt[Nt+5]=$e.z,wt[Nt+6]=et.x,wt[Nt+7]=et.y,wt[Nt+8]=et.z),Nt+=9;for(De=0,Ue=sr.length;De<Ue;De++)St=sr[De],Oe=lr[St],He=fr[xt].vertices[Oe.a],je=fr[xt].vertices[Oe.b],Xe=fr[xt].vertices[Oe.c],Ye=fr[xt].vertices[Oe.d],_t=Xt[xt],_t[Nt]=He.x,_t[Nt+1]=He.y,_t[Nt+2]=He.z,_t[Nt+3]=je.x,_t[Nt+4]=je.y,_t[Nt+5]=je.z,_t[Nt+6]=Xe.x,_t[Nt+7]=Xe.y,_t[Nt+8]=Xe.z,_t[Nt+9]=Ye.x,_t[Nt+10]=Ye.y,_t[Nt+11]=Ye.z,Ee.morphNormals&&(Fe?(Mt=pr[xt].vertexNormals[St],Je=Mt.a,$e=Mt.b,et=Mt.c,tt=Mt.d):tt=et=$e=Je=pr[xt].faceNormals[St],wt=Yt[xt],wt[Nt]=Je.x,wt[Nt+1]=Je.y,wt[Nt+2]=Je.z,wt[Nt+3]=$e.x,wt[Nt+4]=$e.y,wt[Nt+5]=$e.z,wt[Nt+6]=et.x,wt[Nt+7]=et.y,wt[Nt+8]=et.z,wt[Nt+9]=tt.x,wt[Nt+10]=tt.y,wt[Nt+11]=tt.z),Nt+=12;k.bindBuffer(k.ARRAY_BUFFER,Me.__webglMorphTargetsBuffers[xt]),k.bufferData(k.ARRAY_BUFFER,Xt[xt],Ae),Ee.morphNormals&&(k.bindBuffer(k.ARRAY_BUFFER,Me.__webglMorphNormalsBuffers[xt]),k.bufferData(k.ARRAY_BUFFER,Yt[xt],Ae))}if(dr.length){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],ot=dr[Oe.a],st=dr[Oe.b],lt=dr[Oe.c],jt[Ut]=ot.x,jt[Ut+1]=ot.y,jt[Ut+2]=ot.z,jt[Ut+3]=ot.w,jt[Ut+4]=st.x,jt[Ut+5]=st.y,jt[Ut+6]=st.z,jt[Ut+7]=st.w,jt[Ut+8]=lt.x,jt[Ut+9]=lt.y,jt[Ut+10]=lt.z,jt[Ut+11]=lt.w,ct=ur[Oe.a],ut=ur[Oe.b],dt=ur[Oe.c],Ht[Ut]=ct.x,Ht[Ut+1]=ct.y,Ht[Ut+2]=ct.z,Ht[Ut+3]=ct.w,Ht[Ut+4]=ut.x,Ht[Ut+5]=ut.y,Ht[Ut+6]=ut.z,Ht[Ut+7]=ut.w,Ht[Ut+8]=dt.x,Ht[Ut+9]=dt.y,Ht[Ut+10]=dt.z,Ht[Ut+11]=dt.w,Ut+=12;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],ot=dr[Oe.a],st=dr[Oe.b],lt=dr[Oe.c],ht=dr[Oe.d],jt[Ut]=ot.x,jt[Ut+1]=ot.y,jt[Ut+2]=ot.z,jt[Ut+3]=ot.w,jt[Ut+4]=st.x,jt[Ut+5]=st.y,jt[Ut+6]=st.z,jt[Ut+7]=st.w,jt[Ut+8]=lt.x,jt[Ut+9]=lt.y,jt[Ut+10]=lt.z,jt[Ut+11]=lt.w,jt[Ut+12]=ht.x,jt[Ut+13]=ht.y,jt[Ut+14]=ht.z,jt[Ut+15]=ht.w,ct=ur[Oe.a],ut=ur[Oe.b],dt=ur[Oe.c],ft=ur[Oe.d],Ht[Ut]=ct.x,Ht[Ut+1]=ct.y,Ht[Ut+2]=ct.z,Ht[Ut+3]=ct.w,Ht[Ut+4]=ut.x,Ht[Ut+5]=ut.y,Ht[Ut+6]=ut.z,Ht[Ut+7]=ut.w,Ht[Ut+8]=dt.x,Ht[Ut+9]=dt.y,Ht[Ut+10]=dt.z,Ht[Ut+11]=dt.w,Ht[Ut+12]=ft.x,Ht[Ut+13]=ft.y,Ht[Ut+14]=ft.z,Ht[Ut+15]=ft.w,Ut+=16;Ut>0&&(k.bindBuffer(k.ARRAY_BUFFER,Me.__webglSkinIndicesBuffer),k.bufferData(k.ARRAY_BUFFER,Ht,Ae),k.bindBuffer(k.ARRAY_BUFFER,Me.__webglSkinWeightsBuffer),k.bufferData(k.ARRAY_BUFFER,jt,Ae))}if(ir&&Re){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],Ie=Oe.vertexColors,ze=Oe.color,3===Ie.length&&Re===a.VertexColors?(rt=Ie[0],it=Ie[1],nt=Ie[2]):nt=it=rt=ze,Gt[Dt]=rt.r,Gt[Dt+1]=rt.g,Gt[Dt+2]=rt.b,Gt[Dt+3]=it.r,Gt[Dt+4]=it.g,Gt[Dt+5]=it.b,Gt[Dt+6]=nt.r,Gt[Dt+7]=nt.g,Gt[Dt+8]=nt.b,Dt+=9;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],Ie=Oe.vertexColors,ze=Oe.color,4===Ie.length&&Re===a.VertexColors?(rt=Ie[0],it=Ie[1],nt=Ie[2],at=Ie[3]):at=nt=it=rt=ze,Gt[Dt]=rt.r,Gt[Dt+1]=rt.g,Gt[Dt+2]=rt.b,Gt[Dt+3]=it.r,Gt[Dt+4]=it.g,Gt[Dt+5]=it.b,Gt[Dt+6]=nt.r,Gt[Dt+7]=nt.g,Gt[Dt+8]=nt.b,Gt[Dt+9]=at.r,Gt[Dt+10]=at.g,Gt[Dt+11]=at.b,Dt+=12;Dt>0&&(k.bindBuffer(k.ARRAY_BUFFER,Me.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,Gt,Ae))}if(rr&&Jt.hasTangents){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],ke=Oe.vertexTangents,qe=ke[0],Ke=ke[1],Ze=ke[2],Wt[Pt]=qe.x,Wt[Pt+1]=qe.y,Wt[Pt+2]=qe.z,Wt[Pt+3]=qe.w,Wt[Pt+4]=Ke.x,Wt[Pt+5]=Ke.y,Wt[Pt+6]=Ke.z,Wt[Pt+7]=Ke.w,Wt[Pt+8]=Ze.x,Wt[Pt+9]=Ze.y,Wt[Pt+10]=Ze.z,Wt[Pt+11]=Ze.w,Pt+=12;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],ke=Oe.vertexTangents,qe=ke[0],Ke=ke[1],Ze=ke[2],Qe=ke[3],Wt[Pt]=qe.x,Wt[Pt+1]=qe.y,Wt[Pt+2]=qe.z,Wt[Pt+3]=qe.w,Wt[Pt+4]=Ke.x,Wt[Pt+5]=Ke.y,Wt[Pt+6]=Ke.z,Wt[Pt+7]=Ke.w,Wt[Pt+8]=Ze.x,Wt[Pt+9]=Ze.y,Wt[Pt+10]=Ze.z,Wt[Pt+11]=Ze.w,Wt[Pt+12]=Qe.x,Wt[Pt+13]=Qe.y,Wt[Pt+14]=Qe.z,Wt[Pt+15]=Qe.w,Pt+=16;k.bindBuffer(k.ARRAY_BUFFER,Me.__webglTangentBuffer),k.bufferData(k.ARRAY_BUFFER,Wt,Ae)}if(tr&&Le){for(De=0,Ue=or.length;De<Ue;De++)if(Oe=lr[or[De]],Be=Oe.vertexNormals,Ve=Oe.normal,3===Be.length&&Fe)for(pt=0;pt<3;pt++)gt=Be[pt],kt[Rt]=gt.x,kt[Rt+1]=gt.y,kt[Rt+2]=gt.z,Rt+=3;else for(pt=0;pt<3;pt++)kt[Rt]=Ve.x,kt[Rt+1]=Ve.y,kt[Rt+2]=Ve.z,Rt+=3;for(De=0,Ue=sr.length;De<Ue;De++)if(Oe=lr[sr[De]],Be=Oe.vertexNormals,Ve=Oe.normal,4===Be.length&&Fe)for(pt=0;pt<4;pt++)gt=Be[pt],kt[Rt]=gt.x,kt[Rt+1]=gt.y,kt[Rt+2]=gt.z,Rt+=3;else for(pt=0;pt<4;pt++)kt[Rt]=Ve.x,kt[Rt+1]=Ve.y,kt[Rt+2]=Ve.z,Rt+=3;k.bindBuffer(k.ARRAY_BUFFER,Me.__webglNormalBuffer),k.bufferData(k.ARRAY_BUFFER,kt,Ae)}if(er&&hr&&Pe){for(De=0,Ue=or.length;De<Ue;De++)if(Ne=or[De],We=hr[Ne],void 0!==We)for(pt=0;pt<3;pt++)vt=We[pt],It[Ct]=vt.u,It[Ct+1]=vt.v,Ct+=2;for(De=0,Ue=sr.length;De<Ue;De++)if(Ne=sr[De],We=hr[Ne],void 0!==We)for(pt=0;pt<4;pt++)vt=We[pt],It[Ct]=vt.u,It[Ct+1]=vt.v,Ct+=2;Ct>0&&(k.bindBuffer(k.ARRAY_BUFFER,Me.__webglUVBuffer),k.bufferData(k.ARRAY_BUFFER,It,Ae))}if(er&&cr&&Pe){for(De=0,Ue=or.length;De<Ue;De++)if(Ne=or[De],Ge=cr[Ne],void 0!==Ge)for(pt=0;pt<3;pt++)yt=Ge[pt],zt[Et]=yt.u,zt[Et+1]=yt.v,Et+=2;for(De=0,Ue=sr.length;De<Ue;De++)if(Ne=sr[De],Ge=cr[Ne],void 0!==Ge)for(pt=0;pt<4;pt++)yt=Ge[pt],zt[Et]=yt.u,zt[Et+1]=yt.v,Et+=2;Et>0&&(k.bindBuffer(k.ARRAY_BUFFER,Me.__webglUV2Buffer),k.bufferData(k.ARRAY_BUFFER,zt,Ae))}if($t){for(De=0,Ue=or.length;De<Ue;De++)Zt[Lt]=Tt,Zt[Lt+1]=Tt+1,Zt[Lt+2]=Tt+2,Lt+=3,Qt[Ft]=Tt,Qt[Ft+1]=Tt+1,Qt[Ft+2]=Tt,Qt[Ft+3]=Tt+2,Qt[Ft+4]=Tt+1,Qt[Ft+5]=Tt+2,Ft+=6,Tt+=3;for(De=0,Ue=sr.length;De<Ue;De++)Zt[Lt]=Tt,Zt[Lt+1]=Tt+1,Zt[Lt+2]=Tt+3,Zt[Lt+3]=Tt+1,Zt[Lt+4]=Tt+2,Zt[Lt+5]=Tt+3,Lt+=6,Qt[Ft]=Tt,Qt[Ft+1]=Tt+1,Qt[Ft+2]=Tt,Qt[Ft+3]=Tt+3,Qt[Ft+4]=Tt+1,Qt[Ft+5]=Tt+2,Qt[Ft+6]=Tt+2,Qt[Ft+7]=Tt+3,Ft+=8,Tt+=4;k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Me.__webglFaceBuffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,Zt,Ae),k.bindBuffer(k.ELEMENT_ARRAY_BUFFER,Me.__webglLineBuffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,Qt,Ae)}if(qt)for(pt=0,mt=qt.length;pt<mt;pt++)if(Kt=qt[pt],Kt.__original.needsUpdate){if(Ot=0,1===Kt.size){if(void 0===Kt.boundTo||"vertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],Kt.array[Ot]=Kt.value[Oe.a],Kt.array[Ot+1]=Kt.value[Oe.b],Kt.array[Ot+2]=Kt.value[Oe.c],Ot+=3;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],Kt.array[Ot]=Kt.value[Oe.a],Kt.array[Ot+1]=Kt.value[Oe.b],Kt.array[Ot+2]=Kt.value[Oe.c],Kt.array[Ot+3]=Kt.value[Oe.d],Ot+=4}else if("faces"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Bt=Kt.value[or[De]],Kt.array[Ot]=Bt,Kt.array[Ot+1]=Bt,Kt.array[Ot+2]=Bt,Ot+=3;for(De=0,Ue=sr.length;De<Ue;De++)Bt=Kt.value[sr[De]],Kt.array[Ot]=Bt,Kt.array[Ot+1]=Bt,Kt.array[Ot+2]=Bt,Kt.array[Ot+3]=Bt,Ot+=4}}else if(2===Kt.size){if(void 0===Kt.boundTo||"vertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=je.x,Kt.array[Ot+3]=je.y,Kt.array[Ot+4]=Xe.x,Kt.array[Ot+5]=Xe.y,Ot+=6;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Ye=Kt.value[Oe.d],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=je.x,Kt.array[Ot+3]=je.y,Kt.array[Ot+4]=Xe.x,Kt.array[Ot+5]=Xe.y,Kt.array[Ot+6]=Ye.x,Kt.array[Ot+7]=Ye.y,Ot+=8}else if("faces"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Xe=je=He=Bt=Kt.value[or[De]],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=je.x,Kt.array[Ot+3]=je.y,Kt.array[Ot+4]=Xe.x,Kt.array[Ot+5]=Xe.y,Ot+=6;for(De=0,Ue=sr.length;De<Ue;De++)Ye=Xe=je=He=Bt=Kt.value[sr[De]],
Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=je.x,Kt.array[Ot+3]=je.y,Kt.array[Ot+4]=Xe.x,Kt.array[Ot+5]=Xe.y,Kt.array[Ot+6]=Ye.x,Kt.array[Ot+7]=Ye.y,Ot+=8}}else if(3===Kt.size){var mr;if(mr="c"===Kt.type?["r","g","b"]:["x","y","z"],void 0===Kt.boundTo||"vertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Ot+=9;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Ye=Kt.value[Oe.d],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Kt.array[Ot+9]=Ye[mr[0]],Kt.array[Ot+10]=Ye[mr[1]],Kt.array[Ot+11]=Ye[mr[2]],Ot+=12}else if("faces"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Xe=je=He=Bt=Kt.value[or[De]],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Ot+=9;for(De=0,Ue=sr.length;De<Ue;De++)Ye=Xe=je=He=Bt=Kt.value[sr[De]],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Kt.array[Ot+9]=Ye[mr[0]],Kt.array[Ot+10]=Ye[mr[1]],Kt.array[Ot+11]=Ye[mr[2]],Ot+=12}else if("faceVertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Bt=Kt.value[or[De]],He=Bt[0],je=Bt[1],Xe=Bt[2],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Ot+=9;for(De=0,Ue=sr.length;De<Ue;De++)Bt=Kt.value[sr[De]],He=Bt[0],je=Bt[1],Xe=Bt[2],Ye=Bt[3],Kt.array[Ot]=He[mr[0]],Kt.array[Ot+1]=He[mr[1]],Kt.array[Ot+2]=He[mr[2]],Kt.array[Ot+3]=je[mr[0]],Kt.array[Ot+4]=je[mr[1]],Kt.array[Ot+5]=je[mr[2]],Kt.array[Ot+6]=Xe[mr[0]],Kt.array[Ot+7]=Xe[mr[1]],Kt.array[Ot+8]=Xe[mr[2]],Kt.array[Ot+9]=Ye[mr[0]],Kt.array[Ot+10]=Ye[mr[1]],Kt.array[Ot+11]=Ye[mr[2]],Ot+=12}}else if(4===Kt.size)if(void 0===Kt.boundTo||"vertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Oe=lr[or[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Ot+=12;for(De=0,Ue=sr.length;De<Ue;De++)Oe=lr[sr[De]],He=Kt.value[Oe.a],je=Kt.value[Oe.b],Xe=Kt.value[Oe.c],Ye=Kt.value[Oe.d],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Kt.array[Ot+12]=Ye.x,Kt.array[Ot+13]=Ye.y,Kt.array[Ot+14]=Ye.z,Kt.array[Ot+15]=Ye.w,Ot+=16}else if("faces"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Xe=je=He=Bt=Kt.value[or[De]],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Ot+=12;for(De=0,Ue=sr.length;De<Ue;De++)Ye=Xe=je=He=Bt=Kt.value[sr[De]],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Kt.array[Ot+12]=Ye.x,Kt.array[Ot+13]=Ye.y,Kt.array[Ot+14]=Ye.z,Kt.array[Ot+15]=Ye.w,Ot+=16}else if("faceVertices"===Kt.boundTo){for(De=0,Ue=or.length;De<Ue;De++)Bt=Kt.value[or[De]],He=Bt[0],je=Bt[1],Xe=Bt[2],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Ot+=12;for(De=0,Ue=sr.length;De<Ue;De++)Bt=Kt.value[sr[De]],He=Bt[0],je=Bt[1],Xe=Bt[2],Ye=Bt[3],Kt.array[Ot]=He.x,Kt.array[Ot+1]=He.y,Kt.array[Ot+2]=He.z,Kt.array[Ot+3]=He.w,Kt.array[Ot+4]=je.x,Kt.array[Ot+5]=je.y,Kt.array[Ot+6]=je.z,Kt.array[Ot+7]=je.w,Kt.array[Ot+8]=Xe.x,Kt.array[Ot+9]=Xe.y,Kt.array[Ot+10]=Xe.z,Kt.array[Ot+11]=Xe.w,Kt.array[Ot+12]=Ye.x,Kt.array[Ot+13]=Ye.y,Kt.array[Ot+14]=Ye.z,Kt.array[Ot+15]=Ye.w,Ot+=16}k.bindBuffer(k.ARRAY_BUFFER,Kt.buffer),k.bufferData(k.ARRAY_BUFFER,Kt.array,Ae)}Ce&&(delete Me.__inittedArrays,delete Me.__colorArray,delete Me.__normalArray,delete Me.__tangentArray,delete Me.__uvArray,delete Me.__uv2Array,delete Me.__faceArray,delete Me.__vertexArray,delete Me.__lineArray,delete Me.__skinIndexArray,delete Me.__skinWeightArray)}}ye.verticesNeedUpdate=!1,ye.morphTargetsNeedUpdate=!1,ye.elementsNeedUpdate=!1,ye.uvsNeedUpdate=!1,ye.normalsNeedUpdate=!1,ye.colorsNeedUpdate=!1,ye.tangentsNeedUpdate=!1,_e.attributes&&g(_e)}else if(ve instanceof a.Ribbon){if(ye.verticesNeedUpdate||ye.colorsNeedUpdate){var gr=ye,vr=k.DYNAMIC_DRAW,yr=void 0,xr=void 0,br=void 0,_r=void 0,wr=void 0,Sr=gr.vertices,Mr=gr.colors,Tr=Sr.length,Ar=Mr.length,Cr=gr.__vertexArray,Er=gr.__colorArray,Lr=gr.colorsNeedUpdate;if(gr.verticesNeedUpdate){for(yr=0;yr<Tr;yr++)br=Sr[yr],_r=3*yr,Cr[_r]=br.x,Cr[_r+1]=br.y,Cr[_r+2]=br.z;k.bindBuffer(k.ARRAY_BUFFER,gr.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,Cr,vr)}if(Lr){for(xr=0;xr<Ar;xr++)wr=Mr[xr],_r=3*xr,Er[_r]=wr.r,Er[_r+1]=wr.g,Er[_r+2]=wr.b;k.bindBuffer(k.ARRAY_BUFFER,gr.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,Er,vr)}}ye.verticesNeedUpdate=!1,ye.colorsNeedUpdate=!1}else if(ve instanceof a.Line){if(_e=r(ve,xe),be=_e.attributes&&m(_e),ye.verticesNeedUpdate||ye.colorsNeedUpdate||be){var Rr=ye,Pr=k.DYNAMIC_DRAW,Fr=void 0,Dr=void 0,Ur=void 0,Nr=void 0,Or=void 0,Br=Rr.vertices,Vr=Rr.colors,Ir=Br.length,zr=Vr.length,kr=Rr.__vertexArray,Wr=Rr.__colorArray,Gr=Rr.colorsNeedUpdate,Hr=Rr.__webglCustomAttributesList,jr=void 0,Xr=void 0,Yr=void 0,qr=void 0,Kr=void 0,Zr=void 0;if(Rr.verticesNeedUpdate){for(Fr=0;Fr<Ir;Fr++)Ur=Br[Fr],Nr=3*Fr,kr[Nr]=Ur.x,kr[Nr+1]=Ur.y,kr[Nr+2]=Ur.z;k.bindBuffer(k.ARRAY_BUFFER,Rr.__webglVertexBuffer),k.bufferData(k.ARRAY_BUFFER,kr,Pr)}if(Gr){for(Dr=0;Dr<zr;Dr++)Or=Vr[Dr],Nr=3*Dr,Wr[Nr]=Or.r,Wr[Nr+1]=Or.g,Wr[Nr+2]=Or.b;k.bindBuffer(k.ARRAY_BUFFER,Rr.__webglColorBuffer),k.bufferData(k.ARRAY_BUFFER,Wr,Pr)}if(Hr)for(jr=0,Xr=Hr.length;jr<Xr;jr++)if(Zr=Hr[jr],Zr.needsUpdate&&(void 0===Zr.boundTo||"vertices"===Zr.boundTo)){if(Nr=0,qr=Zr.value.length,1===Zr.size)for(Yr=0;Yr<qr;Yr++)Zr.array[Yr]=Zr.value[Yr];else if(2===Zr.size)for(Yr=0;Yr<qr;Yr++)Kr=Zr.value[Yr],Zr.array[Nr]=Kr.x,Zr.array[Nr+1]=Kr.y,Nr+=2;else if(3===Zr.size)if("c"===Zr.type)for(Yr=0;Yr<qr;Yr++)Kr=Zr.value[Yr],Zr.array[Nr]=Kr.r,Zr.array[Nr+1]=Kr.g,Zr.array[Nr+2]=Kr.b,Nr+=3;else for(Yr=0;Yr<qr;Yr++)Kr=Zr.value[Yr],Zr.array[Nr]=Kr.x,Zr.array[Nr+1]=Kr.y,Zr.array[Nr+2]=Kr.z,Nr+=3;else if(4===Zr.size)for(Yr=0;Yr<qr;Yr++)Kr=Zr.value[Yr],Zr.array[Nr]=Kr.x,Zr.array[Nr+1]=Kr.y,Zr.array[Nr+2]=Kr.z,Zr.array[Nr+3]=Kr.w,Nr+=4;k.bindBuffer(k.ARRAY_BUFFER,Zr.buffer),k.bufferData(k.ARRAY_BUFFER,Zr.array,Pr)}}ye.verticesNeedUpdate=!1,ye.colorsNeedUpdate=!1,_e.attributes&&g(_e)}else ve instanceof a.ParticleSystem&&(ye instanceof a.BufferGeometry?((ye.verticesNeedUpdate||ye.colorsNeedUpdate)&&l(ye,k.DYNAMIC_DRAW,!ye.dynamic),ye.verticesNeedUpdate=!1,ye.colorsNeedUpdate=!1):(_e=r(ve,xe),be=_e.attributes&&m(_e),(ye.verticesNeedUpdate||ye.colorsNeedUpdate||ve.sortParticles||be)&&s(ye,k.DYNAMIC_DRAW,ve),ye.verticesNeedUpdate=!1,ye.colorsNeedUpdate=!1,_e.attributes&&g(_e)))}},this.initMaterial=function(e,t,r,i){var n,o,s,l,h,c,u,d,f;if(e instanceof a.MeshDepthMaterial?f="depth":e instanceof a.MeshNormalMaterial?f="normal":e instanceof a.MeshBasicMaterial?f="basic":e instanceof a.MeshLambertMaterial?f="lambert":e instanceof a.MeshPhongMaterial?f="phong":e instanceof a.LineBasicMaterial?f="basic":e instanceof a.ParticleBasicMaterial&&(f="particle_basic"),f){var p=a.ShaderLib[f];e.uniforms=a.UniformsUtils.clone(p.uniforms),e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader}var m,g;for(m=l=o=n=p=0,s=t.length;m<s;m++)g=t[m],g.onlyShadow||(g instanceof a.DirectionalLight&&l++,g instanceof a.PointLight&&o++,g instanceof a.SpotLight&&n++,g instanceof a.HemisphereLight&&p++);for(o+n+l+p<=z?(m=l,s=n):(m=Math.ceil(z*l/(o+l)),s=o=z-m,p=m),n=m,l=p,p=d=0,m=t.length;p<m;p++)g=t[p],g.castShadow&&(g instanceof a.SpotLight&&d++,g instanceof a.DirectionalLight&&!g.shadowCascade&&d++);Re&&i&&i.useVertexTexture?u=1024:(t=k.getParameter(k.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),void 0!==i&&i instanceof a.SkinnedMesh&&(t=Math.min(i.bones.length,t),t<i.bones.length&&console.warn("WebGLRenderer: too many bones - "+i.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),u=t);var v;e:{g=e.fragmentShader,m=e.vertexShader;var y,p=e.uniforms,t=e.attributes,r={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:u,useVertexTexture:Re&&i&&i.useVertexTexture,boneTextureWidth:i&&i.boneTextureWidth,boneTextureHeight:i&&i.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:n,maxPointLights:o,maxSpotLights:s,maxHemiLights:l,maxShadows:d,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===a.DoubleSide,flipSided:e.side===a.BackSide},i=[];f?i.push(f):(i.push(g),i.push(m));for(y in r)i.push(y),i.push(r[y]);for(f=i.join(),y=0,i=j.length;y<i;y++)if(n=j[y],n.code===f){n.usedTimes++,v=n.program;break e}y=k.createProgram(),i=["precision "+F+" float;",Le?"#define VERTEX_TEXTURES":"",H.gammaInput?"#define GAMMA_INPUT":"",H.gammaOutput?"#define GAMMA_OUTPUT":"",H.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,"#define MAX_BONES "+r.maxBones,r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.vertexColors?"#define USE_COLOR":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.boneTextureWidth?"#define N_BONE_PIXEL_X "+r.boneTextureWidth.toFixed(1):"",r.boneTextureHeight?"#define N_BONE_PIXEL_Y "+r.boneTextureHeight.toFixed(1):"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals?"#define USE_MORPHNORMALS":"",r.perPixel?"#define PHONG_PER_PIXEL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapSoft?"#define SHADOWMAP_SOFT":"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),n=["precision "+F+" float;",r.bumpMap||r.normalMap?"#extension GL_OES_standard_derivatives : enable":"","#define MAX_DIR_LIGHTS "+r.maxDirLights,"#define MAX_POINT_LIGHTS "+r.maxPointLights,"#define MAX_SPOT_LIGHTS "+r.maxSpotLights,"#define MAX_HEMI_LIGHTS "+r.maxHemiLights,"#define MAX_SHADOWS "+r.maxShadows,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"",H.gammaInput?"#define GAMMA_INPUT":"",H.gammaOutput?"#define GAMMA_OUTPUT":"",H.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fog instanceof a.FogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.lightMap?"#define USE_LIGHTMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.vertexColors?"#define USE_COLOR":"",r.metal?"#define METAL":"",r.perPixel?"#define PHONG_PER_PIXEL":"",r.wrapAround?"#define WRAP_AROUND":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapSoft?"#define SHADOWMAP_SOFT":"",r.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",r.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),n=A("fragment",n+g),i=A("vertex",i+m),k.attachShader(y,i),k.attachShader(y,n),k.linkProgram(y),k.getProgramParameter(y,k.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+k.getProgramParameter(y,k.VALIDATE_STATUS)+", gl error ["+k.getError()+"]"),k.deleteShader(n),k.deleteShader(i),y.uniforms={},y.attributes={};var x,i=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];r.useVertexTexture?i.push("boneTexture"):i.push("boneGlobalMatrices");for(x in p)i.push(x);for(x=i,i=0,p=x.length;i<p;i++)n=x[i],y.uniforms[n]=k.getUniformLocation(y,n);for(i=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight"],x=0;x<r.maxMorphTargets;x++)i.push("morphTarget"+x);for(x=0;x<r.maxMorphNormals;x++)i.push("morphNormal"+x);for(v in t)i.push(v);for(v=i,x=0,r=v.length;x<r;x++)i=v[x],y.attributes[i]=k.getAttribLocation(y,i);y.id=X++,j.push({program:y,code:f,usedTimes:1}),H.info.memory.programs=j.length,v=y}if(e.program=v,v=e.program.attributes,v.position>=0&&k.enableVertexAttribArray(v.position),v.color>=0&&k.enableVertexAttribArray(v.color),v.normal>=0&&k.enableVertexAttribArray(v.normal),v.tangent>=0&&k.enableVertexAttribArray(v.tangent),e.skinning&&v.skinIndex>=0&&v.skinWeight>=0&&(k.enableVertexAttribArray(v.skinIndex),k.enableVertexAttribArray(v.skinWeight)),e.attributes)for(c in e.attributes)void 0!==v[c]&&v[c]>=0&&k.enableVertexAttribArray(v[c]);if(e.morphTargets)for(e.numSupportedMorphTargets=0,y="morphTarget",c=0;c<this.maxMorphTargets;c++)x=y+c,v[x]>=0&&(k.enableVertexAttribArray(v[x]),e.numSupportedMorphTargets++);if(e.morphNormals)for(e.numSupportedMorphNormals=0,y="morphNormal",c=0;c<this.maxMorphNormals;c++)x=y+c,v[x]>=0&&(k.enableVertexAttribArray(v[x]),e.numSupportedMorphNormals++);e.uniformsList=[];for(h in e.uniforms)e.uniformsList.push([e.uniforms[h],h])},this.setFaceCulling=function(e,t){e?(t&&"ccw"!==t?k.frontFace(k.CW):k.frontFace(k.CCW),"back"===e?k.cullFace(k.BACK):"front"===e?k.cullFace(k.FRONT):k.cullFace(k.FRONT_AND_BACK),k.enable(k.CULL_FACE)):k.disable(k.CULL_FACE)},this.setMaterialFaces=function(e){var t=e.side===a.DoubleSide,e=e.side===a.BackSide;ee!==t&&(t?k.disable(k.CULL_FACE):k.enable(k.CULL_FACE),ee=t),te!==e&&(e?k.frontFace(k.CW):k.frontFace(k.CCW),te=e)},this.setDepthTest=function(e){oe!==e&&(e?k.enable(k.DEPTH_TEST):k.disable(k.DEPTH_TEST),oe=e)},this.setDepthWrite=function(e){se!==e&&(k.depthMask(e),se=e)},this.setBlending=function(e,t,r,i){e!==re&&(e===a.NoBlending?k.disable(k.BLEND):e===a.AdditiveBlending?(k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.SRC_ALPHA,k.ONE)):e===a.SubtractiveBlending?(k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.ZERO,k.ONE_MINUS_SRC_COLOR)):e===a.MultiplyBlending?(k.enable(k.BLEND),k.blendEquation(k.FUNC_ADD),k.blendFunc(k.ZERO,k.SRC_COLOR)):e===a.CustomBlending?k.enable(k.BLEND):(k.enable(k.BLEND),k.blendEquationSeparate(k.FUNC_ADD,k.FUNC_ADD),k.blendFuncSeparate(k.SRC_ALPHA,k.ONE_MINUS_SRC_ALPHA,k.ONE,k.ONE_MINUS_SRC_ALPHA)),re=e),e===a.CustomBlending?(t!==ie&&(k.blendEquation(R(t)),ie=t),r===ne&&i===ae||(k.blendFunc(R(r),R(i)),ne=r,ae=i)):ae=ne=ie=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.__webglTexture=k.createTexture(),H.info.memory.textures++),k.activeTexture(k.TEXTURE0+t),k.bindTexture(k.TEXTURE_2D,e.__webglTexture),k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,e.flipY),k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var r=e.image,i=0===(r.width&r.width-1)&&0===(r.height&r.height-1),n=R(e.format),o=R(e.type);if(C(k.TEXTURE_2D,e,i),e instanceof a.CompressedTexture)for(var o=e.mipmaps,s=0,l=o.length;s<l;s++)r=o[s],k.compressedTexImage2D(k.TEXTURE_2D,s,n,r.width,r.height,0,r.data);else e instanceof a.DataTexture?k.texImage2D(k.TEXTURE_2D,0,n,r.width,r.height,0,n,o,r.data):k.texImage2D(k.TEXTURE_2D,0,n,n,o,e.image);e.generateMipmaps&&i&&k.generateMipmap(k.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else k.activeTexture(k.TEXTURE0+t),k.bindTexture(k.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof a.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglTexture=k.createTexture();var r=0===(e.width&e.width-1)&&0===(e.height&e.height-1),i=R(e.format),n=R(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],k.bindTexture(k.TEXTURE_CUBE_MAP,e.__webglTexture),C(k.TEXTURE_CUBE_MAP,e,r);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=k.createFramebuffer(),e.__webglRenderbuffer[o]=k.createRenderbuffer(),k.texImage2D(k.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,e.width,e.height,0,i,n,null);var s=e,l=k.TEXTURE_CUBE_MAP_POSITIVE_X+o;k.bindFramebuffer(k.FRAMEBUFFER,e.__webglFramebuffer[o]),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,l,s.__webglTexture,0),E(e.__webglRenderbuffer[o],e)}r&&k.generateMipmap(k.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=k.createFramebuffer(),e.__webglRenderbuffer=k.createRenderbuffer(),k.bindTexture(k.TEXTURE_2D,e.__webglTexture),C(k.TEXTURE_2D,e,r),k.texImage2D(k.TEXTURE_2D,0,i,e.width,e.height,0,i,n,null),i=k.TEXTURE_2D,k.bindFramebuffer(k.FRAMEBUFFER,e.__webglFramebuffer),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,i,e.__webglTexture,0),E(e.__webglRenderbuffer,e),r&&k.generateMipmap(k.TEXTURE_2D);t?k.bindTexture(k.TEXTURE_CUBE_MAP,null):k.bindTexture(k.TEXTURE_2D,null),k.bindRenderbuffer(k.RENDERBUFFER,null),k.bindFramebuffer(k.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,r=e.width,e=e.height,n=i=0):(t=null,r=pe,e=me,i=de,n=fe),t!==q&&(k.bindFramebuffer(k.FRAMEBUFFER,t),k.viewport(i,n,r,e),q=t),ge=r,ve=e},this.shadowMapPlugin=new a.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new a.SpritePlugin),this.addPostPlugin(new a.LensFlarePlugin)},a.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:a.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:a.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:a.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:a.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new a.Vector2(0,0),this.repeat=new a.Vector2(1,1),this.format=void 0!==r.format?r.format:a.RGBAFormat,this.type=void 0!==r.type?r.type:a.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=!0},a.WebGLRenderTarget.prototype.clone=function(){var e=new a.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.anisotropy=this.anisotropy,e.minFilter=this.minFilter,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e},a.WebGLRenderTargetCube=function(e,t,r){a.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},a.WebGLRenderTargetCube.prototype=(0,n.default)(a.WebGLRenderTarget.prototype),a.RenderableVertex=function(){this.positionWorld=new a.Vector3,this.positionScreen=new a.Vector4,this.visible=!0},a.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},a.RenderableFace3=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3],this.vertexNormalsLength=0,this.material=null,this.uvs=[[]],this.z=null},a.RenderableFace4=function(){this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.v3=new a.RenderableVertex,this.v4=new a.RenderableVertex,this.centroidWorld=new a.Vector3,this.centroidScreen=new a.Vector3,this.normalWorld=new a.Vector3,this.vertexNormalsWorld=[new a.Vector3,new a.Vector3,new a.Vector3,new a.Vector3],this.vertexNormalsLength=0,this.material=null,this.uvs=[[]],this.z=null},a.RenderableObject=function(){this.z=this.object=null},a.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=this.object=null,this.scale=new a.Vector2,this.material=null},a.RenderableLine=function(){this.z=null,this.v1=new a.RenderableVertex,this.v2=new a.RenderableVertex,this.material=null},a.ColorUtils={adjustHSV:function(e,t,r,i){var n=a.ColorUtils.__hsv;a.ColorUtils.rgbToHsv(e,n),n.h=a.Math.clamp(n.h+t,0,1),n.s=a.Math.clamp(n.s+r,0,1),n.v=a.Math.clamp(n.v+i,0,1),e.setHSV(n.h,n.s,n.v)},rgbToHsv:function(e,t){var r=e.r,i=e.g,n=e.b,a=Math.max(Math.max(r,i),n),o=Math.min(Math.min(r,i),n);if(o===a)o=r=0;else{var s=a-o,o=s/a,r=(r===a?(i-n)/s:i===a?2+(n-r)/s:4+(r-i)/s)/6;r<0&&(r+=1),r>1&&(r-=1)}return void 0===t&&(t={h:0,s:0,v:0}),t.h=r,t.s=o,t.v=a,t}},a.ColorUtils.__hsv={h:0,s:0,v:0},a.GeometryUtils={merge:function(e,t){for(var r,i,n=e.vertices.length,o=t instanceof a.Mesh?t.geometry:t,s=e.vertices,l=o.vertices,h=e.faces,c=o.faces,u=e.faceVertexUvs[0],d=o.faceVertexUvs[0],f={},p=0;p<e.materials.length;p++)f[e.materials[p].id]=p;t instanceof a.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,i=new a.Matrix4,i.extractRotation(r,t.scale));for(var p=0,m=l.length;p<m;p++){var g=l[p].clone();r&&r.multiplyVector3(g),s.push(g)}for(p=0,m=c.length;p<m;p++){var v,y,s=c[p],x=s.vertexNormals,b=s.vertexColors;for(s instanceof a.Face3?v=new a.Face3(s.a+n,s.b+n,s.c+n):s instanceof a.Face4&&(v=new a.Face4(s.a+n,s.b+n,s.c+n,s.d+n)),v.normal.copy(s.normal),i&&i.multiplyVector3(v.normal),l=0,g=x.length;l<g;l++)y=x[l].clone(),i&&i.multiplyVector3(y),v.vertexNormals.push(y);for(v.color.copy(s.color),l=0,g=b.length;l<g;l++)y=b[l],v.vertexColors.push(y.clone());void 0!==s.materialIndex&&(l=o.materials[s.materialIndex],g=l.id,b=f[g],void 0===b&&(b=e.materials.length,f[g]=b,e.materials.push(l)),v.materialIndex=b),v.centroid.copy(s.centroid),r&&r.multiplyVector3(v.centroid),h.push(v)}for(p=0,m=d.length;p<m;p++){for(r=d[p],i=[],l=0,g=r.length;l<g;l++)i.push(new a.UV(r[l].u,r[l].v));u.push(i)}},clone:function(e){var t,r=new a.Geometry,i=e.vertices,n=e.faces,o=e.faceVertexUvs[0];for(e.materials&&(r.materials=e.materials.slice()),e=0,t=i.length;e<t;e++)r.vertices.push(i[e].clone());for(e=0,t=n.length;e<t;e++)r.faces.push(n[e].clone());for(e=0,t=o.length;e<t;e++){for(var i=o[e],n=[],s=0,l=i.length;s<l;s++)n.push(new a.UV(i[s].u,i[s].v));r.faceVertexUvs[0].push(n)}return r},randomPointInTriangle:function(e,t,r){var i,n,o,s=new a.Vector3,l=a.GeometryUtils.__v1;return i=a.GeometryUtils.random(),n=a.GeometryUtils.random(),i+n>1&&(i=1-i,n=1-n),o=1-i-n,s.copy(e),s.multiplyScalar(i),l.copy(t),l.multiplyScalar(n),s.addSelf(l),l.copy(r),l.multiplyScalar(o),s.addSelf(l),s},randomPointInFace:function(e,t,r){var i,n,o;if(e instanceof a.Face3)return i=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c],a.GeometryUtils.randomPointInTriangle(i,n,o);if(e instanceof a.Face4){i=t.vertices[e.a],n=t.vertices[e.b],o=t.vertices[e.c];var s,t=t.vertices[e.d];return r?e._area1&&e._area2?(r=e._area1,s=e._area2):(r=a.GeometryUtils.triangleArea(i,n,t),s=a.GeometryUtils.triangleArea(n,o,t),e._area1=r,e._area2=s):(r=a.GeometryUtils.triangleArea(i,n,t),s=a.GeometryUtils.triangleArea(n,o,t)),a.GeometryUtils.random()*(r+s)<r?a.GeometryUtils.randomPointInTriangle(i,n,t):a.GeometryUtils.randomPointInTriangle(n,o,t)}},randomPointsInGeometry:function(e,t){function r(e){function t(r,i){if(i<r)return r;var n=r+Math.floor((i-r)/2);return p[n]>e?t(r,n-1):p[n]<e?t(n+1,i):n}return t(0,p.length-1)}var i,n,o,s,l,h,c=e.faces,u=e.vertices,d=c.length,f=0,p=[];for(n=0;n<d;n++)i=c[n],i instanceof a.Face3?(o=u[i.a],s=u[i.b],l=u[i.c],i._area=a.GeometryUtils.triangleArea(o,s,l)):i instanceof a.Face4&&(o=u[i.a],s=u[i.b],l=u[i.c],h=u[i.d],i._area1=a.GeometryUtils.triangleArea(o,s,h),i._area2=a.GeometryUtils.triangleArea(s,l,h),i._area=i._area1+i._area2),f+=i._area,p[n]=f;for(i=[],n=0;n<t;n++)u=a.GeometryUtils.random()*f,u=r(u),i[n]=a.GeometryUtils.randomPointInFace(c[u],e,!0);return i},triangleArea:function(e,t,r){var i,n=a.GeometryUtils.__v1;return n.sub(e,t),i=n.length(),n.sub(e,r),e=n.length(),n.sub(t,r),r=n.length(),t=.5*(i+e+r),Math.sqrt(t*(t-i)*(t-e)*(t-r))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new a.Vector3;return r.add(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new a.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,r=e.length;t<r;t++)for(var i=e[t],n=0,a=i.length;n<a;n++)1!==i[n].u&&(i[n].u=i[n].u-Math.floor(i[n].u)),1!==i[n].v&&(i[n].v=i[n].v-Math.floor(i[n].v))},triangulateQuads:function(e){var t,r,i,n,o=[],s=[],l=[];for(t=0,r=e.faceUvs.length;t<r;t++)s[t]=[];for(t=0,r=e.faceVertexUvs.length;t<r;t++)l[t]=[];for(t=0,r=e.faces.length;t<r;t++)if(i=e.faces[t],i instanceof a.Face4){n=i.a;var h=i.b,c=i.c,u=i.d,d=new a.Face3,f=new a.Face3;for(d.color.copy(i.color),f.color.copy(i.color),d.materialIndex=i.materialIndex,f.materialIndex=i.materialIndex,d.a=n,d.b=h,d.c=u,f.a=h,f.b=c,f.c=u,4===i.vertexColors.length&&(d.vertexColors[0]=i.vertexColors[0].clone(),d.vertexColors[1]=i.vertexColors[1].clone(),d.vertexColors[2]=i.vertexColors[3].clone(),f.vertexColors[0]=i.vertexColors[1].clone(),f.vertexColors[1]=i.vertexColors[2].clone(),f.vertexColors[2]=i.vertexColors[3].clone()),o.push(d,f),i=0,n=e.faceVertexUvs.length;i<n;i++)e.faceVertexUvs[i].length&&(d=e.faceVertexUvs[i][t],h=d[1],c=d[2],u=d[3],d=[d[0].clone(),h.clone(),u.clone()],h=[h.clone(),c.clone(),u.clone()],l[i].push(d,h));for(i=0,n=e.faceUvs.length;i<n;i++)e.faceUvs[i].length&&(h=e.faceUvs[i][t],s[i].push(h,h))}else{for(o.push(i),i=0,n=e.faceUvs.length;i<n;i++)s[i].push(e.faceUvs[i][t]);for(i=0,n=e.faceVertexUvs.length;i<n;i++)l[i].push(e.faceVertexUvs[i][t])}e.faces=o,e.faceUvs=s,e.faceVertexUvs=l,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],r=0,i=e.faces.length;r<i;r++){var n=t.length,o=e.faces[r];if(o instanceof a.Face4){var s=o.a,l=o.b,h=o.c,s=e.vertices[s],l=e.vertices[l],h=e.vertices[h],c=e.vertices[o.d];t.push(s.clone()),t.push(l.clone()),t.push(h.clone()),t.push(c.clone()),o.a=n,o.b=n+1,o.c=n+2,o.d=n+3}else s=o.a,l=o.b,h=o.c,s=e.vertices[s],l=e.vertices[l],h=e.vertices[h],t.push(s.clone()),t.push(l.clone()),t.push(h.clone()),o.a=n,o.b=n+1,o.c=n+2}e.vertices=t,delete e.__tmpVertices},tessellate:function(e,t){var r,i,n,o,s,l,h,c,u,d,f,p,m,g,v,y,x,b,_,w=[],S=[];for(r=0,i=e.faceVertexUvs.length;r<i;r++)S[r]=[];for(r=0,i=e.faces.length;r<i;r++)if(n=e.faces[r],n instanceof a.Face3)if(o=n.a,s=n.b,l=n.c,c=e.vertices[o],u=e.vertices[s],d=e.vertices[l],p=c.distanceTo(u),m=u.distanceTo(d),f=c.distanceTo(d),p>t||m>t||f>t)for(h=e.vertices.length,b=n.clone(),_=n.clone(),p>=m&&p>=f?(c=c.clone(),c.lerpSelf(u,.5),b.a=o,b.b=h,b.c=l,_.a=h,_.b=s,_.c=l,3===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[1],.5),b.vertexNormals[1].copy(o),_.vertexNormals[0].copy(o)),3===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[1],.5),b.vertexColors[1].copy(o),_.vertexColors[0].copy(o)),n=0):m>=p&&m>=f?(c=u.clone(),c.lerpSelf(d,.5),b.a=o,b.b=s,b.c=h,_.a=h,_.b=l,_.c=o,3===n.vertexNormals.length&&(o=n.vertexNormals[1].clone(),o.lerpSelf(n.vertexNormals[2],.5),b.vertexNormals[2].copy(o),_.vertexNormals[0].copy(o),_.vertexNormals[1].copy(n.vertexNormals[2]),_.vertexNormals[2].copy(n.vertexNormals[0])),3===n.vertexColors.length&&(o=n.vertexColors[1].clone(),o.lerpSelf(n.vertexColors[2],.5),b.vertexColors[2].copy(o),_.vertexColors[0].copy(o),_.vertexColors[1].copy(n.vertexColors[2]),_.vertexColors[2].copy(n.vertexColors[0])),n=1):(c=c.clone(),c.lerpSelf(d,.5),b.a=o,b.b=s,b.c=h,_.a=h,_.b=s,_.c=l,3===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[2],.5),b.vertexNormals[2].copy(o),_.vertexNormals[0].copy(o)),3===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[2],.5),b.vertexColors[2].copy(o),_.vertexColors[0].copy(o)),n=2),w.push(b,_),e.vertices.push(c),o=0,s=e.faceVertexUvs.length;o<s;o++)e.faceVertexUvs[o].length&&(c=e.faceVertexUvs[o][r],_=c[0],l=c[1],b=c[2],0===n?(u=_.clone(),u.lerpSelf(l,.5),c=[_.clone(),u.clone(),b.clone()],l=[u.clone(),l.clone(),b.clone()]):1===n?(u=l.clone(),u.lerpSelf(b,.5),c=[_.clone(),l.clone(),u.clone()],l=[u.clone(),b.clone(),_.clone()]):(u=_.clone(),u.lerpSelf(b,.5),c=[_.clone(),l.clone(),u.clone()],l=[u.clone(),l.clone(),b.clone()]),S[o].push(c,l));else for(w.push(n),o=0,s=e.faceVertexUvs.length;o<s;o++)S[o].push(e.faceVertexUvs[o][r]);else if(o=n.a,s=n.b,l=n.c,h=n.d,c=e.vertices[o],u=e.vertices[s],d=e.vertices[l],f=e.vertices[h],p=c.distanceTo(u),m=u.distanceTo(d),g=d.distanceTo(f),v=c.distanceTo(f),p>t||m>t||g>t||v>t)for(y=e.vertices.length,x=e.vertices.length+1,b=n.clone(),_=n.clone(),p>=m&&p>=g&&p>=v||g>=m&&g>=p&&g>=v?(p=c.clone(),p.lerpSelf(u,.5),u=d.clone(),u.lerpSelf(f,.5),b.a=o,b.b=y,b.c=x,b.d=h,_.a=y,_.b=s,_.c=l,_.d=x,4===n.vertexNormals.length&&(o=n.vertexNormals[0].clone(),o.lerpSelf(n.vertexNormals[1],.5),s=n.vertexNormals[2].clone(),s.lerpSelf(n.vertexNormals[3],.5),b.vertexNormals[1].copy(o),b.vertexNormals[2].copy(s),_.vertexNormals[0].copy(o),_.vertexNormals[3].copy(s)),4===n.vertexColors.length&&(o=n.vertexColors[0].clone(),o.lerpSelf(n.vertexColors[1],.5),s=n.vertexColors[2].clone(),s.lerpSelf(n.vertexColors[3],.5),b.vertexColors[1].copy(o),b.vertexColors[2].copy(s),_.vertexColors[0].copy(o),_.vertexColors[3].copy(s)),n=0):(p=u.clone(),p.lerpSelf(d,.5),u=f.clone(),u.lerpSelf(c,.5),b.a=o,b.b=s,b.c=y,b.d=x,_.a=x,_.b=y,_.c=l,_.d=h,4===n.vertexNormals.length&&(o=n.vertexNormals[1].clone(),o.lerpSelf(n.vertexNormals[2],.5),
s=n.vertexNormals[3].clone(),s.lerpSelf(n.vertexNormals[0],.5),b.vertexNormals[2].copy(o),b.vertexNormals[3].copy(s),_.vertexNormals[0].copy(s),_.vertexNormals[1].copy(o)),4===n.vertexColors.length&&(o=n.vertexColors[1].clone(),o.lerpSelf(n.vertexColors[2],.5),s=n.vertexColors[3].clone(),s.lerpSelf(n.vertexColors[0],.5),b.vertexColors[2].copy(o),b.vertexColors[3].copy(s),_.vertexColors[0].copy(s),_.vertexColors[1].copy(o)),n=1),w.push(b,_),e.vertices.push(p,u),o=0,s=e.faceVertexUvs.length;o<s;o++)e.faceVertexUvs[o].length&&(c=e.faceVertexUvs[o][r],_=c[0],l=c[1],b=c[2],c=c[3],0===n?(u=_.clone(),u.lerpSelf(l,.5),d=b.clone(),d.lerpSelf(c,.5),_=[_.clone(),u.clone(),d.clone(),c.clone()],l=[u.clone(),l.clone(),b.clone(),d.clone()]):(u=l.clone(),u.lerpSelf(b,.5),d=c.clone(),d.lerpSelf(_,.5),_=[_.clone(),l.clone(),u.clone(),d.clone()],l=[d.clone(),u.clone(),b.clone(),c.clone()]),S[o].push(_,l));else for(w.push(n),o=0,s=e.faceVertexUvs.length;o<s;o++)S[o].push(e.faceVertexUvs[o][r]);e.faces=w,e.faceVertexUvs=S}},a.GeometryUtils.random=a.Math.random16,a.GeometryUtils.__v1=new a.Vector3,a.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,r,i){var n=new Image,o=new a.Texture(n,t),t=new a.ImageLoader;return t.addEventListener("load",function(e){o.image=e.content,o.needsUpdate=!0,r&&r(o)}),t.addEventListener("error",function(e){i&&i(e.message)}),t.crossOrigin=this.crossOrigin,t.load(e,n),o},loadCompressedTexture:function(e,t,r,i){var n=new a.CompressedTexture;n.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=a.ImageUtils.parseDDS(o.response,!0);n.format=e.format,n.mipmaps=e.mipmaps,n.image.width=e.width,n.image.height=e.height,n.generateMipmaps=!1,n.needsUpdate=!0,r&&r(n)},o.onerror=i,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),n},loadTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var o=new a.Texture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var t=0,s=e.length;t<s;++t){var l=new Image;n[t]=l,l.onload=function(){n.loadCount=n.loadCount+1,6===n.loadCount&&(o.needsUpdate=!0,r&&r())},l.onerror=i,l.crossOrigin=this.crossOrigin,l.src=e[t]}return o},loadCompressedTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var o=new a.CompressedTexture;o.image=n,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;for(var t=function(e,t){return function(){var i=a.ImageUtils.parseDDS(e.response,!0);t.format=i.format,t.mipmaps=i.mipmaps,t.width=i.width,t.height=i.height,n.loadCount=n.loadCount+1,6===n.loadCount&&(o.format=i.format,o.needsUpdate=!0,r&&r())}},s=0,l=e.length;s<l;++s){var h={};n[s]=h;var c=new XMLHttpRequest;c.onload=t(c,h),c.onerror=i,c.open("GET",e[s],!0),c.responseType="arraybuffer",c.send(null)}return o},parseDDS:function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},n=r("DXT1"),o=r("DXT3"),s=r("DXT5"),l=new Int32Array(e,0,31);if(542327876!==l[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(4&!l[20])return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var h=l[21];switch(h){case n:n=8,i.format=a.RGB_S3TC_DXT1_Format;break;case o:n=16,i.format=a.RGBA_S3TC_DXT3_Format;break;case s:n=16,i.format=a.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(255&h,h>>8&255,h>>16&255,h>>24&255)),i}for(i.mipmapCount=1,131072&l[2]&&t!==!1&&(i.mipmapCount=Math.max(1,l[7])),i.width=l[4],i.height=l[3],l=l[1]+4,o=i.width,s=i.height,h=0;h<i.mipmapCount;h++){var c=Math.max(4,o)/4*Math.max(4,s)/4*n,u={data:new Uint8Array(e,l,c),width:o,height:s};i.mipmaps.push(u),l+=c,o=Math.max(.5*o,1),s=Math.max(.5*s,1)}return i},getNormalMap:function(e,t){var r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=1|t,i=e.width,n=e.height,a=document.createElement("canvas");a.width=i,a.height=n;var o=a.getContext("2d");o.drawImage(e,0,0);for(var s=o.getImageData(0,0,i,n).data,l=o.createImageData(i,n),h=l.data,c=0;c<i;c++)for(var u=0;u<n;u++){var d=u-1<0?0:u-1,f=u+1>n-1?n-1:u+1,p=c-1<0?0:c-1,m=c+1>i-1?i-1:c+1,g=[],v=[0,0,s[4*(u*i+c)]/255*t];for(g.push([-1,0,s[4*(u*i+p)]/255*t]),g.push([-1,-1,s[4*(d*i+p)]/255*t]),g.push([0,-1,s[4*(d*i+c)]/255*t]),g.push([1,-1,s[4*(d*i+m)]/255*t]),g.push([1,0,s[4*(u*i+m)]/255*t]),g.push([1,1,s[4*(f*i+m)]/255*t]),g.push([0,1,s[4*(f*i+c)]/255*t]),g.push([-1,1,s[4*(f*i+p)]/255*t]),d=[],p=g.length,f=0;f<p;f++){var m=g[f],y=g[(f+1)%p],m=[m[0]-v[0],m[1]-v[1],m[2]-v[2]],y=[y[0]-v[0],y[1]-v[1],y[2]-v[2]];d.push(r([m[1]*y[2]-m[2]*y[1],m[2]*y[0]-m[0]*y[2],m[0]*y[1]-m[1]*y[0]]))}for(g=[0,0,0],f=0;f<d.length;f++)g[0]=g[0]+d[f][0],g[1]=g[1]+d[f][1],g[2]=g[2]+d[f][2];g[0]=g[0]/d.length,g[1]=g[1]/d.length,g[2]=g[2]/d.length,v=4*(u*i+c),h[v]=(g[0]+1)/2*255|0,h[v+1]=(g[1]+1)/2*255|0,h[v+2]=255*g[2]|0,h[v+3]=255}return o.putImageData(l,0,0),a},generateDataTexture:function(e,t,r){for(var i=e*t,n=new Uint8Array(3*i),o=Math.floor(255*r.r),s=Math.floor(255*r.g),r=Math.floor(255*r.b),l=0;l<i;l++)n[3*l]=o,n[3*l+1]=s,n[3*l+2]=r;return e=new a.DataTexture(n,e,t,a.RGBFormat),e.needsUpdate=!0,e}},a.SceneUtils={showHierarchy:function(e,t){a.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var r,i,n=e.children.length;for(i=0;i<n;i++)r=e.children[i],t(r),a.SceneUtils.traverseHierarchy(r,t)},createMultiMaterialObject:function(e,t){var r,i=t.length,n=new a.Object3D;for(r=0;r<i;r++){var o=new a.Mesh(e,t[r]);n.add(o)}return n},cloneObject:function(e){var t;e instanceof a.MorphAnimMesh?(t=new a.MorphAnimMesh(e.geometry,e.material),t.duration=e.duration,t.mirroredLoop=e.mirroredLoop,t.time=e.time,t.lastKeyframe=e.lastKeyframe,t.currentKeyframe=e.currentKeyframe,t.direction=e.direction,t.directionBackwards=e.directionBackwards):e instanceof a.SkinnedMesh?t=new a.SkinnedMesh(e.geometry,e.material,e.useVertexTexture):e instanceof a.Mesh?t=new a.Mesh(e.geometry,e.material):e instanceof a.Line?t=new a.Line(e.geometry,e.material,e.type):e instanceof a.Ribbon?t=new a.Ribbon(e.geometry,e.material):e instanceof a.ParticleSystem?(t=new a.ParticleSystem(e.geometry,e.material),t.sortParticles=e.sortParticles):e instanceof a.Particle?t=new a.Particle(e.material):e instanceof a.Sprite?(t=new a.Sprite({}),t.color.copy(e.color),t.map=e.map,t.blending=e.blending,t.useScreenCoordinates=e.useScreenCoordinates,t.mergeWith3D=e.mergeWith3D,t.affectedByDistance=e.affectedByDistance,t.scaleByViewport=e.scaleByViewport,t.alignment=e.alignment,t.rotation3d.copy(e.rotation3d),t.rotation=e.rotation,t.opacity=e.opacity,t.uvOffset.copy(e.uvOffset),t.uvScale.copy(e.uvScale)):e instanceof a.LOD?t=new a.LOD:e instanceof a.Object3D&&(t=new a.Object3D),t.name=e.name,t.parent=e.parent,t.up.copy(e.up),t.position.copy(e.position),t.rotation instanceof a.Vector3&&t.rotation.copy(e.rotation),t.eulerOrder=e.eulerOrder,t.scale.copy(e.scale),t.dynamic=e.dynamic,t.renderDepth=e.renderDepth,t.rotationAutoUpdate=e.rotationAutoUpdate,t.matrix.copy(e.matrix),t.matrixWorld.copy(e.matrixWorld),t.matrixRotationWorld.copy(e.matrixRotationWorld),t.matrixAutoUpdate=e.matrixAutoUpdate,t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,t.quaternion.copy(e.quaternion),t.useQuaternion=e.useQuaternion,t.boundRadius=e.boundRadius,t.boundRadiusScale=e.boundRadiusScale,t.visible=e.visible,t.castShadow=e.castShadow,t.receiveShadow=e.receiveShadow,t.frustumCulled=e.frustumCulled;for(var r=0;r<e.children.length;r++){var i=a.SceneUtils.cloneObject(e.children[r]);t.children[r]=i,i.parent=t}if(e instanceof a.LOD)for(r=0;r<e.LODs.length;r++)t.LODs[r]={visibleAtDistance:e.LODs[r].visibleAtDistance,object3D:t.children[r]};return t},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new a.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},a.WebGLRenderer&&(a.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:a.UniformsUtils.merge([a.UniformsLib.fog,a.UniformsLib.lights,a.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new a.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new a.Color(16777215)},uSpecularColor:{type:"c",value:new a.Color(1118481)},uAmbientColor:{type:"c",value:new a.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new a.Vector2(0,0)},uRepeat:{type:"v2",value:new a.Vector2(1,1)},wrapRGB:{type:"v3",value:new a.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float uRefractionRatio;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",a.ShaderChunk.shadowmap_pars_fragment,a.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );\nvec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += uDiffuseColor * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );\nvec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n#else\nhemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, uRefractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",a.ShaderChunk.shadowmap_fragment,a.ShaderChunk.linear_to_gamma_fragment,a.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",a.ShaderChunk.skinning_pars_vertex,a.ShaderChunk.shadowmap_pars_vertex,"void main() {",a.ShaderChunk.skinbase_vertex,a.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalMatrix * skinnedNormal.xyz;\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalMatrix * skinnedTangent.xyz;\n#else\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\n#endif\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned \t  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned \t  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 mPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = mPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = modelMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}}),a.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),r=this.size/t.resolution,i=0,n=String(e).split(""),o=n.length,s=[],e=0;e<o;e++){var l=new a.Path,l=this.extractGlyphPoints(n[e],t,r,i,l),i=i+l.offset;s.push(l.path)}return{paths:s,offset:i/2}},extractGlyphPoints:function(e,t,r,i,n){var o,s,l,h,c,u,d,f,p,m,g,v=[],y=t.glyphs[e]||t.glyphs["?"];if(y){if(y.o)for(t=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),h=t.length,e=0;e<h;)switch(l=t[e++]){case"m":l=t[e++]*r+i,c=t[e++]*r,n.moveTo(l,c);break;case"l":l=t[e++]*r+i,c=t[e++]*r,n.lineTo(l,c);break;case"q":if(l=t[e++]*r+i,c=t[e++]*r,f=t[e++]*r+i,p=t[e++]*r,n.quadraticCurveTo(f,p,l,c),o=v[v.length-1])for(u=o.x,d=o.y,o=1,s=this.divisions;o<=s;o++){var x=o/s;a.Shape.Utils.b2(x,u,f,l),a.Shape.Utils.b2(x,d,p,c)}break;case"b":if(l=t[e++]*r+i,c=t[e++]*r,f=t[e++]*r+i,p=t[e++]*-r,m=t[e++]*r+i,g=t[e++]*-r,n.bezierCurveTo(l,c,f,p,m,g),o=v[v.length-1])for(u=o.x,d=o.y,o=1,s=this.divisions;o<=s;o++)x=o/s,a.Shape.Utils.b3(x,u,f,m,l),a.Shape.Utils.b3(x,d,p,g,c)}return{offset:y.ha*r,path:n}}}},a.FontUtils.generateShapes=function(e,t){var t=t||{},r=void 0!==t.curveSegments?t.curveSegments:4,i=void 0!==t.font?t.font:"helvetiker",n=void 0!==t.weight?t.weight:"normal",o=void 0!==t.style?t.style:"normal";for(a.FontUtils.size=void 0!==t.size?t.size:100,a.FontUtils.divisions=r,a.FontUtils.face=i,a.FontUtils.weight=n,a.FontUtils.style=o,r=a.FontUtils.drawText(e).paths,i=[],n=0,o=r.length;n<o;n++)Array.prototype.push.apply(i,r[n].toShapes());return i},function(e){var t=function r(e){for(var r=e.length,t=0,i=r-1,n=0;n<r;i=n++)t+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*t};return e.Triangulate=function(e,r){var i=e.length;if(i<3)return null;var n,a,o,s=[],l=[],h=[];if(t(e)>0)for(a=0;a<i;a++)l[a]=a;else for(a=0;a<i;a++)l[a]=i-1-a;var c=2*i;for(a=i-1;i>2;){if(c--<=0){console.log("Warning, unable to triangulate polygon!");break}n=a,i<=n&&(n=0),a=n+1,i<=a&&(a=0),o=a+1,i<=o&&(o=0);var u;e:{u=e;var d=n,f=a,p=o,m=i,g=l,v=void 0,y=void 0,x=void 0,b=void 0,_=void 0,w=void 0,S=void 0,M=void 0,T=void 0,y=u[g[d]].x,x=u[g[d]].y,b=u[g[f]].x,_=u[g[f]].y,w=u[g[p]].x,S=u[g[p]].y;if(1e-10>(b-y)*(S-x)-(_-x)*(w-y))u=!1;else{for(v=0;v<m;v++)if(v!=d&&v!=f&&v!=p){var M=u[g[v]].x,T=u[g[v]].y,A=void 0,C=void 0,E=void 0,L=void 0,R=void 0,P=void 0,F=void 0,D=void 0,U=void 0,N=void 0,O=void 0,B=void 0,A=E=R=void 0,A=w-b,C=S-_,E=y-w,L=x-S,R=b-y,P=_-x,F=M-y,D=T-x,U=M-b,N=T-_,O=M-w,B=T-S,A=A*N-C*U,R=R*D-P*F,E=E*B-L*O;if(A>=0&&E>=0&&R>=0){u=!1;break e}}u=!0}}if(u){for(s.push([e[l[n]],e[l[a]],e[l[o]]]),h.push([l[n],l[a],l[o]]),n=a,o=a+1;o<i;n++,o++)l[n]=l[o];i--,c=2*i}}return r?h:s},e.Triangulate.area=t,e}(a.FontUtils),self._typeface_js={faces:a.FontUtils.faces,loadFace:a.FontUtils.loadFace},a.Curve=function(){},a.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},a.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},a.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},a.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},a.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},a.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),a=0;for(i.push(0),r=1;r<=e;r++)t=this.getPoint(r/e),a+=t.distanceTo(n),i.push(a),n=t;return this.cacheArcLengths=i},a.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},a.Curve.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),n=0,a=i.length;r=t?t:e*i[a-1];for(var o,s=0,l=a-1;s<=l;)if(n=Math.floor(s+(l-s)/2),o=i[n]-r,o<0)s=n+1;else{if(!(o>0)){l=n;break}l=n-1}return n=l,i[n]==r?n/(a-1):(s=i[n],i=(n+(r-s)/(i[n+1]-s))/(a-1))},a.Curve.prototype.getNormalVector=function(e){return e=this.getTangent(e),new a.Vector2((-e.y),e.x)},a.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;return t<0&&(t=0),e>1&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().subSelf(t).normalize()},a.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},a.LineCurve=function(e,t){this.v1=e,this.v2=t},a.LineCurve.prototype=(0,n.default)(a.Curve.prototype),a.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);return t.multiplyScalar(e).addSelf(this.v1),t},a.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},a.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()},a.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},a.QuadraticBezierCurve.prototype=(0,n.default)(a.Curve.prototype),a.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=a.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=a.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new a.Vector2(t,e)},a.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=a.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=a.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new a.Vector2(t,e),t.normalize(),t},a.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},a.CubicBezierCurve.prototype=(0,n.default)(a.Curve.prototype),a.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=a.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=a.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new a.Vector2(t,e)},a.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=a.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=a.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new a.Vector2(t,e),t.normalize(),t},a.SplineCurve=function(e){this.points=void 0==e?[]:e},a.SplineCurve.prototype=(0,n.default)(a.Curve.prototype),a.SplineCurve.prototype.getPoint=function(e){var t,r=new a.Vector2,i=[],n=this.points;return t=(n.length-1)*e,e=Math.floor(t),t-=e,i[0]=0==e?e:e-1,i[1]=e,i[2]=e>n.length-2?n.length-1:e+1,i[3]=e>n.length-3?n.length-1:e+2,r.x=a.Curve.Utils.interpolate(n[i[0]].x,n[i[1]].x,n[i[2]].x,n[i[3]].x,t),r.y=a.Curve.Utils.interpolate(n[i[0]].y,n[i[1]].y,n[i[2]].y,n[i[3]].y,t),r},a.EllipseCurve=function(e,t,r,i,n,a,o){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=o},a.EllipseCurve.prototype=(0,n.default)(a.Curve.prototype),a.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;return this.aClockwise||(e=1-e),t=this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new a.Vector2(e,t)},a.ArcCurve=function(e,t,r,i,n,o){a.EllipseCurve.call(this,e,t,r,r,i,n,o)},a.ArcCurve.prototype=(0,n.default)(a.EllipseCurve.prototype),a.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,i,n){var e=.5*(r-e),i=.5*(i-t),a=n*n;return(2*t-2*r+e+i)*n*a+(-3*t+3*r-2*e-i)*a+e*n+t}},a.Curve.create=function(e,t){
return e.prototype=(0,n.default)(a.Curve.prototype),e.prototype.getPoint=t,e},a.LineCurve3=a.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new a.Vector3;return t.sub(this.v2,this.v1),t.multiplyScalar(e),t.addSelf(this.v1),t}),a.QuadraticBezierCurve3=a.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r;return t=a.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=a.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=a.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new a.Vector3(t,r,e)}),a.CubicBezierCurve3=a.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t,r;return t=a.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=a.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=a.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new a.Vector3(t,r,e)}),a.SplineCurve3=a.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r=new a.Vector3,i=[],n=this.points,e=(n.length-1)*e;t=Math.floor(e),e-=t,i[0]=0==t?t:t-1,i[1]=t,i[2]=t>n.length-2?n.length-1:t+1,i[3]=t>n.length-3?n.length-1:t+2,t=n[i[0]];var o=n[i[1]],s=n[i[2]],i=n[i[3]];return r.x=a.Curve.Utils.interpolate(t.x,o.x,s.x,i.x,e),r.y=a.Curve.Utils.interpolate(t.y,o.y,s.y,i.y,e),r.z=a.Curve.Utils.interpolate(t.z,o.z,s.z,i.z,e),r}),a.ClosedSplineCurve3=a.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r=new a.Vector3,i=[],n=this.points;return t=(n.length-0)*e,e=Math.floor(t),t-=e,e+=e>0?0:(Math.floor(Math.abs(e)/n.length)+1)*n.length,i[0]=(e-1)%n.length,i[1]=e%n.length,i[2]=(e+1)%n.length,i[3]=(e+2)%n.length,r.x=a.Curve.Utils.interpolate(n[i[0]].x,n[i[1]].x,n[i[2]].x,n[i[3]].x,t),r.y=a.Curve.Utils.interpolate(n[i[0]].y,n[i[1]].y,n[i[2]].y,n[i[3]].y,t),r.z=a.Curve.Utils.interpolate(n[i[0]].z,n[i[1]].z,n[i[2]].z,n[i[3]].z,t),r}),a.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},a.CurvePath.prototype=(0,n.default)(a.Curve.prototype),a.CurvePath.prototype.add=function(e){this.curves.push(e)},a.CurvePath.prototype.checkConnection=function(){},a.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new a.LineCurve(t,e))},a.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),e=0;e<r.length;){if(r[e]>=t)return t=r[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},a.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},a.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;e<i;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t},a.CurvePath.prototype.getBoundingBox=function(){var e,t,r,i,n,o,s=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var l,h,c,u,d=s[0]instanceof a.Vector3;for(u=d?new a.Vector3:new a.Vector2,h=0,c=s.length;h<c;h++)l=s[h],l.x>e?e=l.x:l.x<i&&(i=l.x),l.y>t?t=l.y:l.y<n&&(n=l.y),d&&(l.z>r?r=l.z:l.z<o&&(o=l.z)),u.addSelf(l);return s={minX:i,minY:n,maxX:e,maxY:t,centroid:u.divideScalar(c)},d&&(s.maxZ=r,s.minZ=o),s},a.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},a.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},a.CurvePath.prototype.createGeometry=function(e){for(var t=new a.Geometry,r=0;r<e.length;r++)t.vertices.push(new a.Vector3(e[r].x,e[r].y,e[r].z||0));return t},a.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},a.CurvePath.prototype.getTransformedPoints=function(e,t){var r,i,n=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},a.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,i,n=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},a.CurvePath.prototype.getWrapPoints=function(e,t){var r,i,n,a,o,s,l=this.getBoundingBox();for(r=0,i=e.length;r<i;r++)n=e[r],a=n.x,o=n.y,s=a/l.maxX,s=t.getUtoTmapping(s,a),a=t.getPoint(s),o=t.getNormalVector(s).multiplyScalar(o),n.x=a.x+o.x,n.y=a.y+o.y;return e},a.Gyroscope=function(){a.Object3D.call(this)},a.Gyroscope.prototype=(0,n.default)(a.Object3D.prototype),a.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)},a.Gyroscope.prototype.translationWorld=new a.Vector3,a.Gyroscope.prototype.translationObject=new a.Vector3,a.Gyroscope.prototype.rotationWorld=new a.Quaternion,a.Gyroscope.prototype.rotationObject=new a.Quaternion,a.Gyroscope.prototype.scaleWorld=new a.Vector3,a.Gyroscope.prototype.scaleObject=new a.Vector3,a.Path=function(e){a.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},a.Path.prototype=(0,n.default)(a.CurvePath.prototype),a.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},a.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},a.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:a.PathActions.MOVE_TO,args:r})},a.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=new a.LineCurve(new a.Vector2(i[i.length-2],i[i.length-1]),new a.Vector2(e,t));this.curves.push(i),this.actions.push({action:a.PathActions.LINE_TO,args:r})},a.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new a.QuadraticBezierCurve(new a.Vector2(o[o.length-2],o[o.length-1]),new a.Vector2(e,t),new a.Vector2(r,i));this.curves.push(o),this.actions.push({action:a.PathActions.QUADRATIC_CURVE_TO,args:n})},a.Path.prototype.bezierCurveTo=function(e,t,r,i,n,o){var s=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,l=new a.CubicBezierCurve(new a.Vector2(l[l.length-2],l[l.length-1]),new a.Vector2(e,t),new a.Vector2(r,i),new a.Vector2(n,o));this.curves.push(l),this.actions.push({action:a.PathActions.BEZIER_CURVE_TO,args:s})},a.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=[new a.Vector2(r[r.length-2],r[r.length-1])];Array.prototype.push.apply(r,e),r=new a.SplineCurve(r),this.curves.push(r),this.actions.push({action:a.PathActions.CSPLINE_THRU,args:t})},a.Path.prototype.arc=function(e,t,r,i,n,a){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],r,i,n,a)},a.Path.prototype.absarc=function(e,t,r,i,n,a){this.absellipse(e,t,r,r,i,n,a)},a.Path.prototype.ellipse=function(e,t,r,i,n,a,o){var s=this.actions[this.actions.length-1].args;this.absellipse(e+s[s.length-2],t+s[s.length-1],r,i,n,a,o)},a.Path.prototype.absellipse=function(e,t,r,i,n,o,s){var l=Array.prototype.slice.call(arguments),h=new a.EllipseCurve(e,t,r,i,n,o,s);this.curves.push(h),h=h.getPoint(s?1:0),l.push(h.x),l.push(h.y),this.actions.push({action:a.PathActions.ELLIPSE,args:l})},a.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],r=0;r<e;r++)t.push(this.getPoint(r/e));return t},a.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);var r,i,n,o,s,l,h,c,u,d,f,p,m,e=e||12,g=[];for(r=0,i=this.actions.length;r<i;r++)switch(n=this.actions[r],o=n.action,n=n.args,o){case a.PathActions.MOVE_TO:g.push(new a.Vector2(n[0],n[1]));break;case a.PathActions.LINE_TO:g.push(new a.Vector2(n[0],n[1]));break;case a.PathActions.QUADRATIC_CURVE_TO:for(s=n[2],l=n[3],u=n[0],d=n[1],g.length>0?(o=g[g.length-1],f=o.x,p=o.y):(o=this.actions[r-1].args,f=o[o.length-2],p=o[o.length-1]),n=1;n<=e;n++)m=n/e,o=a.Shape.Utils.b2(m,f,u,s),m=a.Shape.Utils.b2(m,p,d,l),g.push(new a.Vector2(o,m));break;case a.PathActions.BEZIER_CURVE_TO:for(s=n[4],l=n[5],u=n[0],d=n[1],h=n[2],c=n[3],g.length>0?(o=g[g.length-1],f=o.x,p=o.y):(o=this.actions[r-1].args,f=o[o.length-2],p=o[o.length-1]),n=1;n<=e;n++)m=n/e,o=a.Shape.Utils.b3(m,f,u,h,s),m=a.Shape.Utils.b3(m,p,d,c,l),g.push(new a.Vector2(o,m));break;case a.PathActions.CSPLINE_THRU:for(o=this.actions[r-1].args,m=[new a.Vector2(o[o.length-2],o[o.length-1])],o=e*n[0].length,m=m.concat(n[0]),m=new a.SplineCurve(m),n=1;n<=o;n++)g.push(m.getPointAt(n/o));break;case a.PathActions.ARC:for(s=n[0],l=n[1],d=n[2],h=n[3],o=n[4],u=!!n[5],f=o-h,p=2*e,n=1;n<=p;n++)m=n/p,u||(m=1-m),m=h+m*f,o=s+d*Math.cos(m),m=l+d*Math.sin(m),g.push(new a.Vector2(o,m));break;case a.PathActions.ELLIPSE:for(s=n[0],l=n[1],d=n[2],c=n[3],h=n[4],o=n[5],u=!!n[6],f=o-h,p=2*e,n=1;n<=p;n++)m=n/p,u||(m=1-m),m=h+m*f,o=s+d*Math.cos(m),m=l+c*Math.sin(m),g.push(new a.Vector2(o,m))}return r=g[g.length-1],Math.abs(r.x-g[0].x)<1e-10&&Math.abs(r.y-g[0].y)<1e-10&&g.splice(g.length-1,1),t&&g.push(g[0]),g},a.Path.prototype.toShapes=function(){var e,t,r,i,n=[],o=new a.Path;for(e=0,t=this.actions.length;e<t;e++)r=this.actions[e],i=r.args,r=r.action,r==a.PathActions.MOVE_TO&&0!=o.actions.length&&(n.push(o),o=new a.Path),o[r].apply(o,i);if(0!=o.actions.length&&n.push(o),0==n.length)return[];var s;if(i=[],e=!a.Shape.Utils.isClockWise(n[0].getPoints()),1==n.length)return o=n[0],s=new a.Shape,s.actions=o.actions,s.curves=o.curves,i.push(s),i;if(e)for(s=new a.Shape,e=0,t=n.length;e<t;e++)o=n[e],a.Shape.Utils.isClockWise(o.getPoints())?(s.actions=o.actions,s.curves=o.curves,i.push(s),s=new a.Shape):s.holes.push(o);else{for(e=0,t=n.length;e<t;e++)o=n[e],a.Shape.Utils.isClockWise(o.getPoints())?(s&&i.push(s),s=new a.Shape,s.actions=o.actions,s.curves=o.curves):s.holes.push(o);i.push(s)}return i},a.Shape=function(){a.Path.apply(this,arguments),this.holes=[]},a.Shape.prototype=(0,n.default)(a.Path.prototype),a.Shape.prototype.extrude=function(e){return new a.ExtrudeGeometry(this,e)},a.Shape.prototype.makeGeometry=function(e){return new a.ShapeGeometry(this,e)},a.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},a.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;t<r;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},a.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},a.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},a.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},a.Shape.Utils={removeHoles:function(e,t){var r,i,n,o,s,l,h,c,u,d,f=e.concat(),p=f.concat(),m=[];for(s=0;s<t.length;s++){for(l=t[s],Array.prototype.push.apply(p,l),i=Number.POSITIVE_INFINITY,r=0;r<l.length;r++)for(u=l[r],d=[],c=0;c<f.length;c++)h=f[c],h=u.distanceToSquared(h),d.push(h),h<i&&(i=h,n=r,o=c);r=o-1>=0?o-1:f.length-1,i=n-1>=0?n-1:l.length-1;var g=[l[n],f[o],f[r]];c=a.FontUtils.Triangulate.area(g);var v=[l[n],l[i],f[o]];u=a.FontUtils.Triangulate.area(v),d=o,h=n,o+=1,n+=-1,o<0&&(o+=f.length),o%=f.length,n<0&&(n+=l.length),n%=l.length,r=o-1>=0?o-1:f.length-1,i=n-1>=0?n-1:l.length-1,g=[l[n],f[o],f[r]],g=a.FontUtils.Triangulate.area(g),v=[l[n],l[i],f[o]],v=a.FontUtils.Triangulate.area(v),c+u>g+v&&(o=d,n=h,o<0&&(o+=f.length),o%=f.length,n<0&&(n+=l.length),n%=l.length,r=o-1>=0?o-1:f.length-1,i=n-1>=0?n-1:l.length-1),c=f.slice(0,o),u=f.slice(o),d=l.slice(n),h=l.slice(0,n),i=[l[n],l[i],f[o]],m.push([l[n],f[o],f[r]]),m.push(i),f=c.concat(d).concat(h).concat(u)}return{shape:f,isolatedPts:m,allpoints:p}},triangulateShape:function(e,t){var r,i,n,o,s=a.Shape.Utils.removeHoles(e,t),l=s.allpoints,h=s.isolatedPts,s=a.FontUtils.Triangulate(s.shape,!1),c={};for(r=0,i=l.length;r<i;r++)o=l[r].x+":"+l[r].y,void 0!==c[o]&&console.log("Duplicate point",o),c[o]=r;for(r=0,i=s.length;r<i;r++)for(n=s[r],l=0;l<3;l++)o=n[l].x+":"+n[l].y,o=c[o],void 0!==o&&(n[l]=o);for(r=0,i=h.length;r<i;r++)for(n=h[r],l=0;l<3;l++)o=n[l].x+":"+n[l].y,o=c[o],void 0!==o&&(n[l]=o);return s.concat(h)},isClockWise:function(e){return a.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},a.AnimationHandler=function(){var e=[],t={},r={update:function(t){for(var r=0;r<e.length;r++)e[r].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),t!==-1&&e.splice(t,1)},add:function(e){if(void 0!==t[e.name]&&console.log("THR51.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,e.initialized!==!0){for(var r=0;r<e.hierarchy.length;r++){for(var i=0;i<e.hierarchy[r].keys.length;i++)if(e.hierarchy[r].keys[i].time<0&&(e.hierarchy[r].keys[i].time=0),void 0!==e.hierarchy[r].keys[i].rot&&!(e.hierarchy[r].keys[i].rot instanceof a.Quaternion)){var n=e.hierarchy[r].keys[i].rot;e.hierarchy[r].keys[i].rot=new a.Quaternion(n[0],n[1],n[2],n[3])}if(e.hierarchy[r].keys.length&&void 0!==e.hierarchy[r].keys[0].morphTargets){for(n={},i=0;i<e.hierarchy[r].keys.length;i++)for(var o=0;o<e.hierarchy[r].keys[i].morphTargets.length;o++){var s=e.hierarchy[r].keys[i].morphTargets[o];n[s]=-1}for(e.hierarchy[r].usedMorphTargets=n,i=0;i<e.hierarchy[r].keys.length;i++){var l={};for(s in n){for(o=0;o<e.hierarchy[r].keys[i].morphTargets.length;o++)if(e.hierarchy[r].keys[i].morphTargets[o]===s){l[s]=e.hierarchy[r].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[r].keys[i].morphTargets.length&&(l[s]=0)}e.hierarchy[r].keys[i].morphTargetsInfluences=l}}for(i=1;i<e.hierarchy[r].keys.length;i++)e.hierarchy[r].keys[i].time===e.hierarchy[r].keys[i-1].time&&(e.hierarchy[r].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[r].keys.length;i++)e.hierarchy[r].keys[i].index=i}for(i=parseInt(e.length*e.fps,10),e.JIT={},e.JIT.hierarchy=[],r=0;r<e.hierarchy.length;r++)e.JIT.hierarchy.push(Array(i));e.initialized=!0}},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THR51.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof a.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else i(e,t);return t}},i=function n(e,t){t.push(e);for(var r=0;r<e.children.length;r++)n(e.children[r],t)};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),a.Animation=function(e,t,r){this.root=e,this.data=a.AnimationHandler.get(t),this.hierarchy=a.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=void 0!==r?r:a.AnimationHandler.LINEAR,this.points=[],this.target=new a.Vector3},a.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var r,i,n=this.hierarchy.length;for(r=0;r<n;r++){i=this.hierarchy[r],this.interpolationType!==a.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof a.Bone?i.skinMatrix:i.matrix);var o=i.animationCache.prevKey;i=i.animationCache.nextKey,o.pos=this.data.hierarchy[r].keys[0],o.rot=this.data.hierarchy[r].keys[0],o.scl=this.data.hierarchy[r].keys[0],i.pos=this.getNextKeyWith("pos",r,1),i.rot=this.getNextKeyWith("rot",r,1),i.scl=this.getNextKeyWith("scl",r,1)}this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.Animation.prototype.pause=function(){this.isPaused===!0?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,a.AnimationHandler.removeFromUpdate(this)},a.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,r,i,n,o,s,l,h,c,u=["pos","rot","scl"];c=this.currentTime=this.currentTime+e*this.timeScale,h=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(h*this.data.fps,this.data.length*this.data.fps),10);for(var d=0,f=this.hierarchy.length;d<f;d++){e=this.hierarchy[d],l=e.animationCache;for(var p=0;p<3;p++){if(t=u[p],o=l.prevKey[t],s=l.nextKey[t],s.time<=c){if(h<c){if(!this.loop)return void this.stop();for(o=this.data.hierarchy[d].keys[0],s=this.getNextKeyWith(t,d,1);s.time<h;)o=s,s=this.getNextKeyWith(t,d,s.index+1)}else do o=s,s=this.getNextKeyWith(t,d,s.index+1);while(s.time<h);l.prevKey[t]=o,l.nextKey[t]=s}e.matrixAutoUpdate=!0,e.matrixWorldNeedsUpdate=!0,r=(h-o.time)/(s.time-o.time),i=o[t],n=s[t],(r<0||r>1)&&(console.log("THR51.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+d),r=r<0?0:1),"pos"===t?(t=e.position,this.interpolationType===a.AnimationHandler.LINEAR?(t.x=i[0]+(n[0]-i[0])*r,t.y=i[1]+(n[1]-i[1])*r,t.z=i[2]+(n[2]-i[2])*r):this.interpolationType!==a.AnimationHandler.CATMULLROM&&this.interpolationType!==a.AnimationHandler.CATMULLROM_FORWARD||(this.points[0]=this.getPrevKeyWith("pos",d,o.index-1).pos,this.points[1]=i,this.points[2]=n,this.points[3]=this.getNextKeyWith("pos",d,s.index+1).pos,r=.33*r+.33,i=this.interpolateCatmullRom(this.points,r),t.x=i[0],t.y=i[1],t.z=i[2],this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD&&(r=this.interpolateCatmullRom(this.points,1.01*r),this.target.set(r[0],r[1],r[2]),this.target.subSelf(t),this.target.y=0,this.target.normalize(),r=Math.atan2(this.target.x,this.target.z),e.rotation.set(0,r,0)))):"rot"===t?a.Quaternion.slerp(i,n,e.quaternion,r):"scl"===t&&(t=e.scale,t.x=i[0]+(n[0]-i[0])*r,t.y=i[1]+(n[1]-i[1])*r,t.z=i[2]+(n[2]-i[2])*r)}}}},a.Animation.prototype.interpolateCatmullRom=function(e,t){var r,i,n,a,o,s,l=[],h=[];return r=(e.length-1)*t,i=Math.floor(r),r-=i,l[0]=0===i?i:i-1,l[1]=i,l[2]=i>e.length-2?i:i+1,l[3]=i>e.length-3?i:i+2,i=e[l[0]],a=e[l[1]],o=e[l[2]],s=e[l[3]],l=r*r,n=r*l,h[0]=this.interpolate(i[0],a[0],o[0],s[0],r,l,n),h[1]=this.interpolate(i[1],a[1],o[1],s[1],r,l,n),h[2]=this.interpolate(i[2],a[2],o[2],s[2],r,l,n),h},a.Animation.prototype.interpolate=function(e,t,r,i,n,a,o){return e=.5*(r-e),i=.5*(i-t),(2*(t-r)+e+i)*o+(-3*(t-r)-2*e-i)*a+e*n+t},a.Animation.prototype.getNextKeyWith=function(e,t,r){for(var i=this.data.hierarchy[t].keys,r=this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?r<i.length-1?r:i.length-1:r%i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},a.Animation.prototype.getPrevKeyWith=function(e,t,r){for(var i=this.data.hierarchy[t].keys,r=this.interpolationType===a.AnimationHandler.CATMULLROM||this.interpolationType===a.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},a.KeyFrameAnimation=function(e,t,r){for(this.root=e,this.data=a.AnimationHandler.get(t),this.hierarchy=a.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0,this.JITCompile=void 0===r||r,e=0,t=this.hierarchy.length;e<t;e++){var r=this.data.hierarchy[e].sids,i=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&r){for(var n=0;n<r.length;n++){var o=r[n],s=this.getNextKeyWith(o,e,0);s&&s.apply(o)}i.matrixAutoUpdate=!1,this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}},a.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var r,i,n,o=this.hierarchy.length;for(r=0;r<o;r++)i=this.hierarchy[r],n=this.data.hierarchy[r],i.useQuaternion=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i instanceof a.Bone?i.skinMatrix:i.matrix),i=this.data.hierarchy[r].keys,i.length&&(n.animationCache.prevKey=i[0],n.animationCache.nextKey=i[1],this.startTime=Math.min(i[0].time,this.startTime),this.endTime=Math.max(i[i.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,a.AnimationHandler.addToUpdate(this)},a.KeyFrameAnimation.prototype.pause=function(){this.isPaused?a.AnimationHandler.addToUpdate(this):a.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},a.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,a.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof a.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},a.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,r,i,n,o,s,l,h=this.data.JIT.hierarchy;if(s=this.currentTime=this.currentTime+e*this.timeScale,o=this.currentTime=this.currentTime%this.data.length,o<this.startTimeMs&&(o=this.currentTime=this.startTimeMs+o),n=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10),(l=o<s)&&!this.loop){for(var e=0,c=this.hierarchy.length;e<c;e++){var u=this.data.hierarchy[e].keys,h=this.data.hierarchy[e].sids;if(i=u.length-1,n=this.hierarchy[e],u.length){for(u=0;u<h.length;u++)o=h[u],(s=this.getPrevKeyWith(o,e,i))&&s.apply(o);this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(o<this.startTime)){for(e=0,c=this.hierarchy.length;e<c;e++){i=this.hierarchy[e],t=this.data.hierarchy[e];var u=t.keys,d=t.animationCache;if(this.JITCompile&&void 0!==h[e][n])i instanceof a.Bone?(i.skinMatrix=h[e][n],i.matrixWorldNeedsUpdate=!1):(i.matrix=h[e][n],i.matrixWorldNeedsUpdate=!0);else if(u.length){if(this.JITCompile&&d&&(i instanceof a.Bone?i.skinMatrix=d.originalMatrix:i.matrix=d.originalMatrix),t=d.prevKey,r=d.nextKey,t&&r){if(r.time<=s){if(l&&this.loop)for(t=u[0],r=u[1];r.time<o;)t=r,r=u[t.index+1];else if(!l)for(var f=u.length-1;r.time<o&&r.index!==f;)t=r,r=u[t.index+1];d.prevKey=t,d.nextKey=r}r.time>=o?t.interpolate(r,o):t.interpolate(r,r.time)}this.data.hierarchy[e].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===h[0][n])for(this.hierarchy[0].updateMatrixWorld(!0),e=0;e<this.hierarchy.length;e++)h[e][n]=this.hierarchy[e]instanceof a.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}},a.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){for(t=this.data.hierarchy[t].keys,r%=t.length;r<t.length;r++)if(t[r].hasTarget(e))return t[r];return t[0]},a.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){for(t=this.data.hierarchy[t].keys,r=r>=0?r:r+t.length;r>=0;r--)if(t[r].hasTarget(e))return t[r];return t[t.length-1]},a.CubeCamera=function(e,t,r){a.Object3D.call(this);var i=new a.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new a.Vector3(1,0,0)),this.add(i);var n=new a.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new a.Vector3((-1),0,0)),this.add(n);var o=new a.PerspectiveCamera(90,1,e,t);o.up.set(0,0,1),o.lookAt(new a.Vector3(0,1,0)),this.add(o);var s=new a.PerspectiveCamera(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new a.Vector3(0,(-1),0)),this.add(s);var l=new a.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new a.Vector3(0,0,1)),this.add(l);var h=new a.PerspectiveCamera(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new a.Vector3(0,0,(-1))),this.add(h),this.renderTarget=new a.WebGLRenderTargetCube(r,r,{format:a.RGBFormat,magFilter:a.LinearFilter,minFilter:a.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,a=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,i,r),r.activeCubeFace=1,e.render(t,n,r),r.activeCubeFace=2,e.render(t,o,r),r.activeCubeFace=3,e.render(t,s,r),r.activeCubeFace=4,e.render(t,l,r),r.generateMipmaps=a,r.activeCubeFace=5,e.render(t,h,r)}},a.CubeCamera.prototype=(0,n.default)(a.Object3D.prototype),a.CombinedCamera=function(e,t,r,i,n,o,s){a.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new a.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,s),this.cameraP=new a.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.toPerspective()},a.CombinedCamera.prototype=(0,n.default)(a.Camera.prototype),a.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},a.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},a.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},a.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},a.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*Math.atan(t/(2*e))*(180/Math.PI);return this.setFov(r),r},a.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},a.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},a.FirstPersonControls=function(e,t){function r(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.target=new a.Vector3(0,0,0),this.domElement=void 0!==t?t:document,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0,this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1,this.viewHalfY=this.viewHalfX=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(e){if(e.preventDefault(),e.stopPropagation(),this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0;break;case 81:this.freeze=!this.freeze}},this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(e){var t=0;if(!this.freeze){this.heightSpeed?(t=a.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin,this.autoSpeedFactor=e*t*this.heightCoef):this.autoSpeedFactor=0,t=e*this.movementSpeed,(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t),e*=this.lookSpeed,this.activeLook||(e=0),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var t=this.target,r=this.object.position;t.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=r.y+100*Math.cos(this.phi),t.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),t=1,this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin)),this.lon=this.lon+this.mouseX*e,this.lookVertical&&(this.lat=this.lat-this.mouseY*e*t),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180,this.constrainVertical&&(this.phi=a.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)),t=this.target,r=this.object.position,t.x=r.x+100*Math.sin(this.phi)*Math.cos(this.theta),t.y=r.y+100*Math.cos(this.phi),t.z=r.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(t)}},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",r(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",r(this,this.onMouseUp),!1),this.domElement.addEventListener("keydown",r(this,this.onKeyDown),!1),this.domElement.addEventListener("keyup",r(this,this.onKeyUp),!1),this.handleResize()},a.PathControls=function(e,t){function r(e){return(e=2*e)<1?.5*e*e:-.5*(--e*(e-2)-1)}function i(e,t){return function(){t.apply(e,arguments)}}function n(e,t,r,i){
var n,o={name:r,fps:.6,length:i,hierarchy:[]},s=t.getControlPointsArray(),l=t.getLength(),h=s.length,c=0;for(n=h-1,t={parent:-1,keys:[]},t.keys[0]={time:0,pos:s[0],rot:[0,0,0,1],scl:[1,1,1]},t.keys[n]={time:i,pos:s[n],rot:[0,0,0,1],scl:[1,1,1]},n=1;n<h-1;n++)c=i*l.chunks[n]/l.total,t.keys[n]={time:c,pos:s[n]};return o.hierarchy[0]=t,a.AnimationHandler.add(o),new a.Animation(e,r,a.AnimationHandler.CATMULLROM_FORWARD,(!1))}function o(e,t){var r,i,n=new a.Geometry;for(r=0;r<e.points.length*t;r++)i=r/(e.points.length*t),i=e.getPoint(i),n.vertices[r]=new a.Vector3(i.x,i.y,i.z);return n}this.object=e,this.domElement=void 0!==t?t:document,this.id="PathControls"+a.PathControlsIdCounter++,this.duration=1e4,this.waypoints=[],this.useConstantSpeed=!0,this.resamplingCoef=50,this.debugPath=new a.Object3D,this.debugDummy=new a.Object3D,this.animationParent=new a.Object3D,this.lookSpeed=.005,this.lookHorizontal=this.lookVertical=!0,this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]},this.target=new a.Object3D,this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;var s=2*Math.PI,l=Math.PI/180;this.viewHalfY=this.viewHalfX=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.update=function(e){var t;this.lookHorizontal&&(this.lon=this.lon+this.mouseX*this.lookSpeed*e),this.lookVertical&&(this.lat=this.lat-this.mouseY*this.lookSpeed*e),this.lon=Math.max(0,Math.min(360,this.lon)),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*l,this.theta=this.lon*l,e=this.phi%s,this.phi=e>=0?e:e+s,t=this.verticalAngleMap.srcRange,e=this.verticalAngleMap.dstRange,t=a.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var i=e[1]-e[0];this.phi=r((t-e[0])/i)*i+e[0],t=this.horizontalAngleMap.srcRange,e=this.horizontalAngleMap.dstRange,t=a.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]),i=e[1]-e[0],this.theta=r((t-e[0])/i)*i+e[0],e=this.target.position,e.x=100*Math.sin(this.phi)*Math.cos(this.theta),e.y=100*Math.cos(this.phi),e.z=100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(this.target.position)},this.onMouseMove=function(e){this.domElement===document?(this.mouseX=e.pageX-this.viewHalfX,this.mouseY=e.pageY-this.viewHalfY):(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)},this.init=function(){if(this.spline=new a.Spline,this.spline.initFromArray(this.waypoints),this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef),this.createDebugDummy){var e=new a.MeshLambertMaterial({color:30719}),t=new a.MeshLambertMaterial({color:65280}),r=new a.CubeGeometry(10,10,20),s=new a.CubeGeometry(2,2,10);this.animationParent=new a.Mesh(r,e),e=new a.Mesh(s,t),e.position.set(0,10,0),this.animation=n(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.object),this.animationParent.add(this.target),this.animationParent.add(e)}else this.animation=n(this.animationParent,this.spline,this.id,this.duration),this.animationParent.add(this.target),this.animationParent.add(this.object);if(this.createDebugPath){var e=this.debugPath,t=this.spline,s=o(t,10),r=o(t,10),l=new a.LineBasicMaterial({color:16711680,linewidth:3}),s=new a.Line(s,l),r=new a.ParticleSystem(r,new a.ParticleBasicMaterial({color:16755200,size:3}));s.scale.set(1,1,1),e.add(s),r.scale.set(1,1,1),e.add(r);for(var s=new a.SphereGeometry(1,16,8),l=new a.MeshBasicMaterial({color:65280}),h=0;h<t.points.length;h++)r=new a.Mesh(s,l),r.position.copy(t.points[h]),e.add(r)}this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),!1)},this.handleResize()},a.PathControlsIdCounter=0,a.FlyControls=function(e,t){function r(e,t){return function(){t.apply(e,arguments)}}this.object=e,this.domElement=void 0!==t?t:document,t&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.autoForward=this.dragToLook=!1,this.object.useQuaternion=!0,this.tmpQuaternion=new a.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new a.Vector3(0,0,0),this.rotationVector=new a.Vector3(0,0,0),this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=!0;break;case 2:this.object.moveBackward=!0}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),r=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.updateRotationVector()},this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize(),this.object.quaternion.multiplySelf(this.tmpQuaternion),this.object.matrix.setPosition(this.object.position),this.object.matrix.setRotationFromQuaternion(this.object.quaternion),this.object.matrixWorldNeedsUpdate=!0},this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("mousemove",r(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",r(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",r(this,this.mouseup),!1),this.domElement.addEventListener("keydown",r(this,this.keydown),!1),this.domElement.addEventListener("keyup",r(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},a.RollControls=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.mouseLook=!0,this.autoForward=!1,this.rollSpeed=this.movementSpeed=this.lookSpeed=1,this.constrainVertical=[-.9,.9],this.object.matrixAutoUpdate=!1,this.forward=new a.Vector3(0,0,1),this.roll=0;var r=new a.Vector3,i=new a.Vector3,n=new a.Vector3,o=new a.Matrix4,s=!1,l=1,h=0,c=0,u=0,d=0,f=0,p=0,m=0;this.handleResize=function(){p=window.innerWidth/2,m=window.innerHeight/2},this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*d),this.rotateVertically(t*f)}t=e*this.movementSpeed,this.object.translateZ(-t*(h>0||this.autoForward&&!(h<0)?1:h)),this.object.translateX(t*c),this.object.translateY(t*u),s&&(this.roll=this.roll+this.rollSpeed*e*l),this.forward.y>this.constrainVertical[1]?(this.forward.y=this.constrainVertical[1],this.forward.normalize()):this.forward.y<this.constrainVertical[0]&&(this.forward.y=this.constrainVertical[0],this.forward.normalize()),n.copy(this.forward),i.set(0,1,0),r.cross(i,n).normalize(),i.cross(n,r).normalize(),this.object.matrix.elements[0]=r.x,this.object.matrix.elements[4]=i.x,this.object.matrix.elements[8]=n.x,this.object.matrix.elements[1]=r.y,this.object.matrix.elements[5]=i.y,this.object.matrix.elements[9]=n.y,this.object.matrix.elements[2]=r.z,this.object.matrix.elements[6]=i.z,this.object.matrix.elements[10]=n.z,o.identity(),o.elements[0]=Math.cos(this.roll),o.elements[4]=-Math.sin(this.roll),o.elements[1]=Math.sin(this.roll),o.elements[5]=Math.cos(this.roll),this.object.matrix.multiplySelf(o),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.elements[12]=this.object.position.x,this.object.matrix.elements[13]=this.object.position.y,this.object.matrix.elements[14]=this.object.position.z},this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e},this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e,this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e,this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e},this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e,this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e,this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e},this.rotateHorizontally=function(e){r.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]),r.multiplyScalar(e),this.forward.subSelf(r),this.forward.normalize()},this.rotateVertically=function(e){i.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]),i.multiplyScalar(e),this.forward.addSelf(i),this.forward.normalize()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){d=(e.clientX-p)/window.innerWidth,f=(e.clientY-m)/window.innerHeight},!1),this.domElement.addEventListener("mousedown",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:h=1;break;case 2:h=-1}},!1),this.domElement.addEventListener("mouseup",function(e){switch(e.preventDefault(),e.stopPropagation(),e.button){case 0:h=0;break;case 2:h=0}},!1),this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:h=1;break;case 37:case 65:c=-1;break;case 40:case 83:h=-1;break;case 39:case 68:c=1;break;case 81:s=!0,l=1;break;case 69:s=!0,l=-1;break;case 82:u=1;break;case 70:u=-1}},!1),this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:h=0;break;case 37:case 65:c=0;break;case 40:case 83:h=0;break;case 39:case 68:c=0;break;case 81:s=!1;break;case 69:s=!1;break;case 82:u=0;break;case 70:u=0}},!1),this.handleResize()},a.TrackballControls=function(e,t){function r(e){if(i.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),u.y=u.y+1/t*.05}}a.EventTarget.call(this);var i=this;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new a.Vector3;var n=new a.Vector3,o=!1,s=-1,l=new a.Vector3,h=new a.Vector3,c=new a.Vector3,u=new a.Vector2,d=new a.Vector2,f=new a.Vector2,p=new a.Vector2,m={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.getMouseOnScreen=function(e,t){return new a.Vector2((e-i.screen.offsetLeft)/i.radius*.5,(t-i.screen.offsetTop)/i.radius*.5)},this.getMouseProjectionOnBall=function(e,t){var r=new a.Vector3((e-.5*i.screen.width-i.screen.offsetLeft)/i.radius,(.5*i.screen.height+i.screen.offsetTop-t)/i.radius,0),n=r.length();return n>1?r.normalize():r.z=Math.sqrt(1-n*n),l.copy(i.object.position).subSelf(i.target),n=i.object.up.clone().setLength(r.y),n.addSelf(i.object.up.clone().crossSelf(l).setLength(r.x)),n.addSelf(l.setLength(r.z)),n},this.rotateCamera=function(){var e=Math.acos(h.dot(c)/h.length()/c.length());if(e){var t=(new a.Vector3).cross(h,c).normalize(),r=new a.Quaternion,e=e*i.rotateSpeed;r.setFromAxisAngle(t,-e),r.multiplyVector3(l),r.multiplyVector3(i.object.up),r.multiplyVector3(c),i.staticMoving?h.copy(c):(r.setFromAxisAngle(t,e*(i.dynamicDampingFactor-1)),r.multiplyVector3(h))}},this.zoomCamera=function(){var e=1+(d.y-u.y)*i.zoomSpeed;1!==e&&e>0&&(l.multiplyScalar(e),i.staticMoving?u.copy(d):u.y=u.y+(d.y-u.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=p.clone().subSelf(f);if(e.lengthSq()){e.multiplyScalar(l.length()*i.panSpeed);var t=l.clone().crossSelf(i.object.up).setLength(e.x);t.addSelf(i.object.up.clone().setLength(e.y)),i.object.position.addSelf(t),i.target.addSelf(t),i.staticMoving?f=p:f.addSelf(e.sub(p,f).multiplyScalar(i.dynamicDampingFactor))}},this.checkDistances=function(){i.noZoom&&i.noPan||(i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance),l.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,l.setLength(i.minDistance)))},this.update=function(){l.copy(i.object.position).subSelf(i.target),i.noRotate||i.rotateCamera(),i.noZoom||i.zoomCamera(),i.noPan||i.panCamera(),i.object.position.add(i.target,l),i.checkDistances(),i.object.lookAt(i.target),n.distanceToSquared(i.object.position)>0&&(i.dispatchEvent(m),n.copy(i.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousemove",function(e){i.enabled&&(o&&(h=c=i.getMouseProjectionOnBall(e.clientX,e.clientY),u=d=i.getMouseOnScreen(e.clientX,e.clientY),f=p=i.getMouseOnScreen(e.clientX,e.clientY),o=!1),s!==-1&&(0!==s||i.noRotate?1!==s||i.noZoom?2===s&&!i.noPan&&(p=i.getMouseOnScreen(e.clientX,e.clientY)):d=i.getMouseOnScreen(e.clientX,e.clientY):c=i.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mousedown",function(e){i.enabled&&(e.preventDefault(),e.stopPropagation(),s===-1&&(s=e.button,0!==s||i.noRotate?1!==s||i.noZoom?this.noPan||(f=p=i.getMouseOnScreen(e.clientX,e.clientY)):u=d=i.getMouseOnScreen(e.clientX,e.clientY):h=c=i.getMouseProjectionOnBall(e.clientX,e.clientY)))},!1),this.domElement.addEventListener("mouseup",function(e){i.enabled&&(e.preventDefault(),e.stopPropagation(),s=-1)},!1),this.domElement.addEventListener("DOMMouseScroll",r,!1),this.domElement.addEventListener("mousewheel",r,!1),window.addEventListener("keydown",function(e){i.enabled&&s===-1&&(e.keyCode!==i.keys[0]||i.noRotate?e.keyCode!==i.keys[1]||i.noZoom?e.keyCode===i.keys[2]&&!i.noPan&&(s=2):s=1:s=0,s!==-1&&(o=!0))},!1),window.addEventListener("keyup",function(){i.enabled&&s!==-1&&(s=-1)},!1),this.handleResize()},a.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*o.autoRotateSpeed}function i(e){e.preventDefault(),x===y.ROTATE?(h.set(e.clientX,e.clientY),c.sub(h,l),o.rotateLeft(2*Math.PI*c.x/s*o.userRotateSpeed),o.rotateUp(2*Math.PI*c.y/s*o.userRotateSpeed),l.copy(h)):x===y.ZOOM&&(d.set(e.clientX,e.clientY),f.sub(d,u),f.y>0?o.zoomIn():o.zoomOut(),u.copy(d))}function n(){o.userRotate&&(document.removeEventListener("mousemove",i,!1),document.removeEventListener("mouseup",n,!1),x=y.NONE)}a.EventTarget.call(this),this.object=e,this.domElement=void 0!==t?t:document,this.center=new a.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.autoRotate=!1,this.autoRotateSpeed=2;var o=this,s=1800,l=new a.Vector2,h=new a.Vector2,c=new a.Vector2,u=new a.Vector2,d=new a.Vector2,f=new a.Vector2,p=0,m=0,g=1,v=new a.Vector3,y={NONE:-1,ROTATE:0,ZOOM:1},x=y.NONE,b={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=r()),m-=e},this.rotateRight=function(e){void 0===e&&(e=r()),m+=e},this.rotateUp=function(e){void 0===e&&(e=r()),p-=e},this.rotateDown=function(e){void 0===e&&(e=r()),p+=e},this.zoomIn=function(e){void 0===e&&(e=Math.pow(.95,o.userZoomSpeed)),g/=e},this.zoomOut=function(e){void 0===e&&(e=Math.pow(.95,o.userZoomSpeed)),g*=e},this.update=function(){var e=this.object.position,t=e.clone().subSelf(this.center),i=Math.atan2(t.x,t.z),n=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(r());var i=i+m,n=n+p,n=Math.max(1e-6,Math.min(Math.PI-1e-6,n)),a=t.length();t.x=a*Math.sin(n)*Math.sin(i),t.y=a*Math.cos(n),t.z=a*Math.sin(n)*Math.cos(i),t.multiplyScalar(g),e.copy(this.center).addSelf(t),this.object.lookAt(this.center),p=m=0,g=1,v.distanceTo(this.object.position)>0&&(this.dispatchEvent(b),v.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){o.userRotate&&(e.preventDefault(),0===e.button||2===e.button?(x=y.ROTATE,l.set(e.clientX,e.clientY)):1===e.button&&(x=y.ZOOM,u.set(e.clientX,e.clientY)),document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",n,!1))},!1),this.domElement.addEventListener("mousewheel",function(e){o.userZoom&&(e.wheelDelta>0?o.zoomOut():o.zoomIn())},!1)},a.CircleGeometry=function(e,t,r,i){a.Geometry.call(this);var n,e=e||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,t=void 0!==t?Math.max(3,t):8,o=[];n=new a.Vector3;var s=new a.UV(.5,.5);for(this.vertices.push(n),o.push(s),n=0;n<=t;n++){var l=new a.Vector3;l.x=e*Math.cos(r+n/t*i),l.y=e*Math.sin(r+n/t*i),this.vertices.push(l),o.push(new a.UV((l.x/e+1)/2,-(l.y/e+1)/2+1))}for(r=new a.Vector3(0,0,(-1)),n=1;n<=t;n++)this.faces.push(new a.Face3(n,n+1,0,[r,r,r])),this.faceVertexUvs[0].push([o[n],o[n+1],s]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},a.CircleGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.CubeGeometry=function(e,t,r,i,n,o,s,l){function h(e,t,r,s,l,h,c,u){var d,f=i||1,p=n||1,m=l/2,v=h/2,y=g.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?d="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(d="y",p=o||1):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(d="x",f=o||1);var x=f+1,b=p+1,_=l/f,w=h/p,S=new a.Vector3;for(S[d]=c>0?1:-1,l=0;l<b;l++)for(h=0;h<x;h++){var M=new a.Vector3;M[e]=(h*_-m)*r,M[t]=(l*w-v)*s,M[d]=c,g.vertices.push(M)}for(l=0;l<p;l++)for(h=0;h<f;h++)e=new a.Face4(h+x*l+y,h+x*(l+1)+y,h+1+x*(l+1)+y,h+1+x*l+y),e.normal.copy(S),e.vertexNormals.push(S.clone(),S.clone(),S.clone(),S.clone()),e.materialIndex=u,g.faces.push(e),g.faceVertexUvs[0].push([new a.UV(h/f,1-l/p),new a.UV(h/f,1-(l+1)/p),new a.UV((h+1)/f,1-(l+1)/p),new a.UV((h+1)/f,1-l/p)])}a.Geometry.call(this);var c,u,d,f,p,m,g=this,v=e/2,y=t/2,x=r/2;if(void 0!==s){if(s instanceof Array)this.materials=s;else for(this.materials=[],c=0;c<6;c++)this.materials.push(s);c=0,f=1,u=2,p=3,d=4,m=5}else this.materials=[];if(this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0},void 0!=l)for(var b in l)void 0!==this.sides[b]&&(this.sides[b]=l[b]);this.sides.px&&h("z","y",-1,-1,r,t,v,c),this.sides.nx&&h("z","y",1,-1,r,t,-v,f),this.sides.py&&h("x","z",1,1,e,r,y,u),this.sides.ny&&h("x","z",1,-1,e,r,-y,p),this.sides.pz&&h("x","y",1,-1,e,t,x,d),this.sides.nz&&h("x","y",-1,-1,e,t,-x,m),this.computeCentroids(),this.mergeVertices()},a.CubeGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.CylinderGeometry=function(e,t,r,i,n,o){a.Geometry.call(this);var s,l,e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100,h=r/2,i=i||8,n=n||1,c=[],u=[];for(l=0;l<=n;l++){var d=[],f=[],p=l/n,m=p*(t-e)+e;for(s=0;s<=i;s++){var g=s/i,v=new a.Vector3;v.x=m*Math.sin(g*Math.PI*2),v.y=-p*r+h,v.z=m*Math.cos(g*Math.PI*2),this.vertices.push(v),d.push(this.vertices.length-1),f.push(new a.UV(g,1-p))}c.push(d),u.push(f)}for(r=(t-e)/r,s=0;s<i;s++)for(0!==e?(d=this.vertices[c[0][s]].clone(),f=this.vertices[c[0][s+1]].clone()):(d=this.vertices[c[1][s]].clone(),f=this.vertices[c[1][s+1]].clone()),d.setY(Math.sqrt(d.x*d.x+d.z*d.z)*r).normalize(),f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*r).normalize(),l=0;l<n;l++){var p=c[l][s],m=c[l+1][s],g=c[l+1][s+1],v=c[l][s+1],y=d.clone(),x=d.clone(),b=f.clone(),_=f.clone(),w=u[l][s].clone(),S=u[l+1][s].clone(),M=u[l+1][s+1].clone(),T=u[l][s+1].clone();this.faces.push(new a.Face4(p,m,g,v,[y,x,b,_])),this.faceVertexUvs[0].push([w,S,M,T])}if(!o&&e>0)for(this.vertices.push(new a.Vector3(0,h,0)),s=0;s<i;s++)p=c[0][s],m=c[0][s+1],g=this.vertices.length-1,y=new a.Vector3(0,1,0),x=new a.Vector3(0,1,0),b=new a.Vector3(0,1,0),w=u[0][s].clone(),S=u[0][s+1].clone(),M=new a.UV(S.u,0),this.faces.push(new a.Face3(p,m,g,[y,x,b])),this.faceVertexUvs[0].push([w,S,M]);if(!o&&t>0)for(this.vertices.push(new a.Vector3(0,(-h),0)),s=0;s<i;s++)p=c[l][s+1],m=c[l][s],g=this.vertices.length-1,y=new a.Vector3(0,(-1),0),x=new a.Vector3(0,(-1),0),b=new a.Vector3(0,(-1),0),w=u[l][s+1].clone(),S=u[l][s].clone(),M=new a.UV(S.u,1),this.faces.push(new a.Face3(p,m,g,[y,x,b])),this.faceVertexUvs[0].push([w,S,M]);this.computeCentroids(),this.computeFaceNormals()},a.CylinderGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(a.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},a.ExtrudeGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;i<r;i++)this.addShape(e[i],t)},a.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).addSelf(e)}function i(e,t,r){var i=a.ExtrudeGeometry.__v1,n=a.ExtrudeGeometry.__v2,o=a.ExtrudeGeometry.__v3,s=a.ExtrudeGeometry.__v4,l=a.ExtrudeGeometry.__v5,h=a.ExtrudeGeometry.__v6;return i.set(e.x-t.x,e.y-t.y),n.set(e.x-r.x,e.y-r.y),i=i.normalize(),n=n.normalize(),o.set(-i.y,i.x),s.set(n.y,-n.x),l.copy(e).addSelf(o),h.copy(e).addSelf(s),l.equals(h)?s.clone():(l.copy(t).addSelf(o),h.copy(r).addSelf(s),o=i.dot(s),s=h.subSelf(l).dot(s),0===o&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),s/=o,s<0?(t=Math.atan2(t.y-e.y,t.x-e.x),e=Math.atan2(r.y-e.y,r.x-e.x),t>e&&(e+=2*Math.PI),r=(t+e)/2,e=-Math.cos(r),r=-Math.sin(r),new a.Vector2(e,r)):i.multiplyScalar(s).addSelf(l).subSelf(e).clone())}function n(r,i){var n,o;for(I=r.length;--I>=0;){n=I,o=I-1,o<0&&(o=r.length-1);for(var s=0,l=y+2*g,s=0;s<l;s++){var h=O*s,c=O*(s+1),u=i+n+h,h=i+o+h,d=i+o+c,c=i+n+c,f=r,p=s,m=l,v=n,x=o,u=u+E,h=h+E,d=d+E,c=c+E;C.faces.push(new a.Face4(u,h,d,c,null,null,w)),u=S.generateSideWallUV(C,e,f,t,u,h,d,c,p,m,v,x),C.faceVertexUvs[0].push(u)}}}function o(e,t,r){C.vertices.push(new a.Vector3(e,t,r))}function s(r,i,n,o){r+=E,i+=E,n+=E,C.faces.push(new a.Face3(r,i,n,null,null,_)),r=o?S.generateBottomUV(C,e,t,r,i,n):S.generateTopUV(C,e,t,r,i,n),C.faceVertexUvs[0].push(r)}var l,h,c,u,d,f=void 0!==t.amount?t.amount:100,p=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:p-2,g=void 0!==t.bevelSegments?t.bevelSegments:3,v=void 0===t.bevelEnabled||t.bevelEnabled,y=void 0!==t.steps?t.steps:1,x=t.extrudePath,b=!1,_=t.material,w=t.extrudeMaterial,S=void 0!==t.UVGenerator?t.UVGenerator:a.ExtrudeGeometry.WorldUVGenerator;x&&(l=x.getSpacedPoints(y),b=!0,v=!1,h=void 0!==t.frames?t.frames:new a.TubeGeometry.FrenetFrames(x,y,(!1)),c=new a.Vector3,u=new a.Vector3,d=new a.Vector3),v||(m=p=g=0);var M,T,A,C=this,E=this.vertices.length,x=e.extractPoints(),L=x.shape,x=x.holes,R=!a.Shape.Utils.isClockWise(L);if(R){for(L=L.reverse(),T=0,A=x.length;T<A;T++)M=x[T],a.Shape.Utils.isClockWise(M)&&(x[T]=M.reverse());R=!1}var P=a.Shape.Utils.triangulateShape(L,x),R=L;for(T=0,A=x.length;T<A;T++)M=x[T],L=L.concat(M);var F,D,U,N,O=L.length,B=P.length,V=[],I=0,z=R.length;for(F=z-1,D=I+1;I<z;I++,F++,D++)F===z&&(F=0),D===z&&(D=0),V[I]=i(R[I],R[F],R[D]);var k,W=[],G=V.concat();for(T=0,A=x.length;T<A;T++){for(M=x[T],k=[],I=0,z=M.length,F=z-1,D=I+1;I<z;I++,F++,D++)F===z&&(F=0),D===z&&(D=0),k[I]=i(M[I],M[F],M[D]);W.push(k),G=G.concat(k)}for(F=0;F<g;F++){for(M=F/g,U=p*(1-M),D=m*Math.sin(M*Math.PI/2),I=0,z=R.length;I<z;I++)N=r(R[I],V[I],D),o(N.x,N.y,-U);for(T=0,A=x.length;T<A;T++)for(M=x[T],k=W[T],I=0,z=M.length;I<z;I++)N=r(M[I],k[I],D),o(N.x,N.y,-U)}for(D=m,I=0;I<O;I++)N=v?r(L[I],G[I],D):L[I],b?(u.copy(h.normals[0]).multiplyScalar(N.x),c.copy(h.binormals[0]).multiplyScalar(N.y),d.copy(l[0]).addSelf(u).addSelf(c),o(d.x,d.y,d.z)):o(N.x,N.y,0);for(M=1;M<=y;M++)for(I=0;I<O;I++)N=v?r(L[I],G[I],D):L[I],b?(u.copy(h.normals[M]).multiplyScalar(N.x),c.copy(h.binormals[M]).multiplyScalar(N.y),d.copy(l[M]).addSelf(u).addSelf(c),o(d.x,d.y,d.z)):o(N.x,N.y,f/y*M);for(F=g-1;F>=0;F--){for(M=F/g,U=p*(1-M),D=m*Math.sin(M*Math.PI/2),I=0,z=R.length;I<z;I++)N=r(R[I],V[I],D),o(N.x,N.y,f+U);for(T=0,A=x.length;T<A;T++)for(M=x[T],k=W[T],I=0,z=M.length;I<z;I++)N=r(M[I],k[I],D),b?o(N.x,N.y+l[y-1].y,l[y-1].x+U):o(N.x,N.y,f+U)}if(v){for(p=0*O,I=0;I<B;I++)f=P[I],s(f[2]+p,f[1]+p,f[0]+p,!0);for(p=O*(y+2*g),I=0;I<B;I++)f=P[I],s(f[0]+p,f[1]+p,f[2]+p,!1)}else{for(I=0;I<B;I++)f=P[I],s(f[2],f[1],f[0],!0);for(I=0;I<B;I++)f=P[I],s(f[0]+O*y,f[1]+O*y,f[2]+O*y,!1)}for(f=0,n(R,f),f+=R.length,T=0,A=x.length;T<A;T++)M=x[T],n(M,f),f+=M.length},a.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,n,o){return t=e.vertices[n].x,n=e.vertices[n].y,r=e.vertices[o].x,o=e.vertices[o].y,[new a.UV(e.vertices[i].x,e.vertices[i].y),new a.UV(t,n),new a.UV(r,o)]},generateBottomUV:function(e,t,r,i,n,a){return this.generateTopUV(e,t,r,i,n,a)},generateSideWallUV:function(e,t,r,i,n,o,s,l){var t=e.vertices[n].x,r=e.vertices[n].y,n=e.vertices[n].z,i=e.vertices[o].x,h=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[s].x,u=e.vertices[s].y,s=e.vertices[s].z,d=e.vertices[l].x,f=e.vertices[l].y,e=e.vertices[l].z;return Math.abs(r-h)<.01?[new a.UV(t,1-n),new a.UV(i,1-o),new a.UV(c,1-s),new a.UV(d,1-e)]:[new a.UV(r,1-n),new a.UV(h,1-o),new a.UV(u,1-s),new a.UV(f,1-e)]}},a.ExtrudeGeometry.__v1=new a.Vector2,a.ExtrudeGeometry.__v2=new a.Vector2,a.ExtrudeGeometry.__v3=new a.Vector2,a.ExtrudeGeometry.__v4=new a.Vector2,a.ExtrudeGeometry.__v5=new a.Vector2,a.ExtrudeGeometry.__v6=new a.Vector2,a.ShapeGeometry=function(e,t){a.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},a.ShapeGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;r<i;r++)this.addShape(e[r],t);return this},a.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,o=t.material,s=void 0===t.UVGenerator?a.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,l=this.vertices.length;r=e.extractPoints();var h=r.shape,c=r.holes;if(!a.Shape.Utils.isClockWise(h))for(h=h.reverse(),r=0,i=c.length;r<i;r++)n=c[r],a.Shape.Utils.isClockWise(n)&&(c[r]=n.reverse());var u=a.Shape.Utils.triangulateShape(h,c);for(r=0,i=c.length;r<i;r++)n=c[r],h=h.concat(n);for(c=h.length,i=u.length,r=0;r<c;r++)n=h[r],this.vertices.push(new a.Vector3(n.x,n.y,0));for(r=0;r<i;r++)c=u[r],h=c[2]+l,n=c[1]+l,c=c[0]+l,this.faces.push(new a.Face3(h,n,c,null,null,o)),this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,h,n,c))},a.LatheGeometry=function(e,t,r){a.Geometry.call(this);for(var t=t||12,r=r||2*Math.PI,i=[],n=(new a.Matrix4).makeRotationZ(r/t),o=0;o<e.length;o++)i[o]=e[o].clone(),this.vertices.push(i[o]);for(var s=t+1,r=0;r<s;r++)for(o=0;o<i.length;o++)i[o]=n.multiplyVector3(i[o].clone()),this.vertices.push(i[o]);for(r=0;r<t;r++)for(i=0,n=e.length;i<n-1;i++)this.faces.push(new a.Face4(r*n+i,(r+1)%s*n+i,(r+1)%s*n+(i+1)%n,r*n+(i+1)%n)),this.faceVertexUvs[0].push([new a.UV(1-r/t,i/n),new a.UV(1-(r+1)/t,i/n),new a.UV(1-(r+1)/t,(i+1)/n),new a.UV(1-r/t,(i+1)/n)]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.LatheGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.PlaneGeometry=function(e,t,r,i){a.Geometry.call(this);for(var n=e/2,o=t/2,r=r||1,i=i||1,s=r+1,l=i+1,h=e/r,c=t/i,u=new a.Vector3(0,0,1),e=0;e<l;e++)for(t=0;t<s;t++)this.vertices.push(new a.Vector3(t*h-n,(-(e*c-o)),0));for(e=0;e<i;e++)for(t=0;t<r;t++)n=new a.Face4(t+s*e,t+s*(e+1),t+1+s*(e+1),t+1+s*e),n.normal.copy(u),n.vertexNormals.push(u.clone(),u.clone(),u.clone(),u.clone()),this.faces.push(n),this.faceVertexUvs[0].push([new a.UV(t/r,1-e/i),new a.UV(t/r,1-(e+1)/i),new a.UV((t+1)/r,1-(e+1)/i),new a.UV((t+1)/r,1-e/i)]);this.computeCentroids()},a.PlaneGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.SphereGeometry=function(e,t,r,i,n,o,s){a.Geometry.call(this);var l,h,e=e||50,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),c=[],u=[];for(h=0;h<=r;h++){var d=[],f=[];for(l=0;l<=t;l++){var p=l/t,m=h/r,g=new a.Vector3;g.x=-e*Math.cos(i+p*n)*Math.sin(o+m*s),g.y=e*Math.cos(o+m*s),g.z=e*Math.sin(i+p*n)*Math.sin(o+m*s),this.vertices.push(g),d.push(this.vertices.length-1),f.push(new a.UV(p,1-m))}c.push(d),u.push(f)}for(h=0;h<r;h++)for(l=0;l<t;l++){var i=c[h][l+1],n=c[h][l],o=c[h+1][l],s=c[h+1][l+1],d=this.vertices[i].clone().normalize(),f=this.vertices[n].clone().normalize(),p=this.vertices[o].clone().normalize(),m=this.vertices[s].clone().normalize(),g=u[h][l+1].clone(),v=u[h][l].clone(),y=u[h+1][l].clone(),x=u[h+1][l+1].clone();Math.abs(this.vertices[i].y)==e?(this.faces.push(new a.Face3(i,o,s,[d,p,m])),this.faceVertexUvs[0].push([g,y,x])):Math.abs(this.vertices[o].y)==e?(this.faces.push(new a.Face3(i,n,o,[d,f,p])),this.faceVertexUvs[0].push([g,v,y])):(this.faces.push(new a.Face4(i,n,o,s,[d,f,p,m])),this.faceVertexUvs[0].push([g,v,y,x]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere={radius:e}},a.SphereGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.TextGeometry=function(e,t){var r=a.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),a.ExtrudeGeometry.call(this,r,t)},a.TextGeometry.prototype=(0,n.default)(a.ExtrudeGeometry.prototype),
a.TorusGeometry=function(e,t,r,i,n){for(a.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.segmentsR=r||8,this.segmentsT=i||6,this.arc=n||2*Math.PI,n=new a.Vector3,e=[],t=[],r=0;r<=this.segmentsR;r++)for(i=0;i<=this.segmentsT;i++){var o=i/this.segmentsT*this.arc,s=r/this.segmentsR*Math.PI*2;n.x=this.radius*Math.cos(o),n.y=this.radius*Math.sin(o);var l=new a.Vector3;l.x=(this.radius+this.tube*Math.cos(s))*Math.cos(o),l.y=(this.radius+this.tube*Math.cos(s))*Math.sin(o),l.z=this.tube*Math.sin(s),this.vertices.push(l),e.push(new a.UV(i/this.segmentsT,r/this.segmentsR)),t.push(l.clone().subSelf(n).normalize())}for(r=1;r<=this.segmentsR;r++)for(i=1;i<=this.segmentsT;i++){var n=(this.segmentsT+1)*r+i-1,o=(this.segmentsT+1)*(r-1)+i-1,s=(this.segmentsT+1)*(r-1)+i,l=(this.segmentsT+1)*r+i,h=new a.Face4(n,o,s,l,[t[n],t[o],t[s],t[l]]);h.normal.addSelf(t[n]),h.normal.addSelf(t[o]),h.normal.addSelf(t[s]),h.normal.addSelf(t[l]),h.normal.normalize(),this.faces.push(h),this.faceVertexUvs[0].push([e[n].clone(),e[o].clone(),e[s].clone(),e[l].clone()])}this.computeCentroids()},a.TorusGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.TorusKnotGeometry=function(e,t,r,i,n,o,s){function l(e,t,r,i,n,o){var s=Math.cos(e);return Math.cos(t),t=Math.sin(e),e=r/i*e,r=Math.cos(e),s=n*(2+r)*.5*s,t=n*(2+r)*t*.5,n=o*n*Math.sin(e)*.5,new a.Vector3(s,t,n)}for(a.Geometry.call(this),this.radius=e||200,this.tube=t||40,this.segmentsR=r||64,this.segmentsT=i||8,this.p=n||2,this.q=o||3,this.heightScale=s||1,this.grid=Array(this.segmentsR),r=new a.Vector3,i=new a.Vector3,n=new a.Vector3,e=0;e<this.segmentsR;++e)for(this.grid[e]=Array(this.segmentsT),t=0;t<this.segmentsT;++t){var h=e/this.segmentsR*2*this.p*Math.PI,s=t/this.segmentsT*2*Math.PI,o=l(h,s,this.q,this.p,this.radius,this.heightScale),h=l(h+.01,s,this.q,this.p,this.radius,this.heightScale);r.sub(h,o),i.add(h,o),n.cross(r,i),i.cross(n,r),n.normalize(),i.normalize(),h=-this.tube*Math.cos(s),s=this.tube*Math.sin(s),o.x=o.x+(h*i.x+s*n.x),o.y=o.y+(h*i.y+s*n.y),o.z=o.z+(h*i.z+s*n.z),this.grid[e][t]=this.vertices.push(new a.Vector3(o.x,o.y,o.z))-1}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var n=(e+1)%this.segmentsR,o=(t+1)%this.segmentsT,r=this.grid[e][t],i=this.grid[n][t],n=this.grid[n][o],o=this.grid[e][o],s=new a.UV(e/this.segmentsR,t/this.segmentsT),h=new a.UV((e+1)/this.segmentsR,t/this.segmentsT),c=new a.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),u=new a.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new a.Face4(r,i,n,o)),this.faceVertexUvs[0].push([s,h,c,u])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TorusKnotGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.TubeGeometry=function(e,t,r,i,n,o){a.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=r||1,this.segmentsRadius=i||8,this.closed=n||!1,o&&(this.debug=new a.Object3D),this.grid=[];var s,l,h,c,u,d,f,p,o=this.segments+1,m=new a.Vector3,t=new a.TubeGeometry.FrenetFrames(e,t,n);for(d=t.tangents,f=t.normals,p=t.binormals,this.tangents=d,this.normals=f,this.binormals=p,t=0;t<o;t++)for(this.grid[t]=[],i=t/(o-1),u=e.getPointAt(i),i=d[t],s=f[t],l=p[t],this.debug&&(this.debug.add(new a.ArrowHelper(i,u,r,255)),this.debug.add(new a.ArrowHelper(s,u,r,16711680)),this.debug.add(new a.ArrowHelper(l,u,r,65280))),i=0;i<this.segmentsRadius;i++)h=i/this.segmentsRadius*2*Math.PI,c=-this.radius*Math.cos(h),h=this.radius*Math.sin(h),m.copy(u),m.x=m.x+(c*s.x+h*l.x),m.y=m.y+(c*s.y+h*l.y),m.z=m.z+(c*s.z+h*l.z),this.grid[t][i]=this.vertices.push(new a.Vector3(m.x,m.y,m.z))-1;for(t=0;t<this.segments;t++)for(i=0;i<this.segmentsRadius;i++)o=n?(t+1)%this.segments:t+1,m=(i+1)%this.segmentsRadius,e=this.grid[t][i],r=this.grid[o][i],o=this.grid[o][m],m=this.grid[t][m],d=new a.UV(t/this.segments,i/this.segmentsRadius),f=new a.UV((t+1)/this.segments,i/this.segmentsRadius),p=new a.UV((t+1)/this.segments,(i+1)/this.segmentsRadius),s=new a.UV(t/this.segments,(i+1)/this.segmentsRadius),this.faces.push(new a.Face4(e,r,o,m)),this.faceVertexUvs[0].push([d,f,p,s]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.TubeGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.TubeGeometry.FrenetFrames=function(e,t,r){new a.Vector3;var i=new a.Vector3;new a.Vector3;var n,o,s,l=[],h=[],c=[],u=new a.Vector3,d=new a.Matrix4,t=t+1;for(this.tangents=l,this.normals=h,this.binormals=c,n=0;n<t;n++)o=n/(t-1),l[n]=e.getTangentAt(o),l[n].normalize();for(h[0]=new a.Vector3,c[0]=new a.Vector3,e=Number.MAX_VALUE,n=Math.abs(l[0].x),o=Math.abs(l[0].y),s=Math.abs(l[0].z),n<=e&&(e=n,i.set(1,0,0)),o<=e&&(e=o,i.set(0,1,0)),s<=e&&i.set(0,0,1),u.cross(l[0],i).normalize(),h[0].cross(l[0],u),c[0].cross(l[0],h[0]),n=1;n<t;n++)h[n]=h[n-1].clone(),c[n]=c[n-1].clone(),u.cross(l[n-1],l[n]),u.length()>1e-4&&(u.normalize(),i=Math.acos(l[n-1].dot(l[n])),d.makeRotationAxis(u,i).multiplyVector3(h[n])),c[n].cross(l[n],h[n]);if(r)for(i=Math.acos(h[0].dot(h[t-1])),i/=t-1,l[0].dot(u.cross(h[0],h[t-1]))>0&&(i=-i),n=1;n<t;n++)d.makeRotationAxis(l[n],i*n).multiplyVector3(h[n]),c[n].cross(l[n],h[n])},a.PolyhedronGeometry=function(e,t,r,i){function n(e){var t=e.normalize().clone();t.index=h.vertices.push(t)-1;var r=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;return t.uv=new a.UV(r,1-e),t}function o(e,t,r,i){i<1?(i=new a.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]),i.centroid.addSelf(e).addSelf(t).addSelf(r).divideScalar(3),i.normal=i.centroid.clone().normalize(),h.faces.push(i),i=Math.atan2(i.centroid.z,-i.centroid.x),h.faceVertexUvs[0].push([l(e.uv,e,i),l(t.uv,t,i),l(r.uv,r,i)])):(i-=1,o(e,s(e,t),s(e,r),i),o(s(e,t),t,s(t,r),i),o(s(e,r),s(t,r),r,i),o(s(e,t),s(t,r),s(e,r),i))}function s(e,t){d[e.index]||(d[e.index]=[]),d[t.index]||(d[t.index]=[]);var r=d[e.index][t.index];return void 0===r&&(d[e.index][t.index]=d[t.index][e.index]=r=n((new a.Vector3).add(e,t).divideScalar(2))),r}function l(e,t,r){return r<0&&1===e.u&&(e=new a.UV(e.u-1,e.v)),0===t.x&&0===t.z&&(e=new a.UV(r/2/Math.PI+.5,e.v)),e}a.Geometry.call(this);for(var r=r||1,i=i||0,h=this,c=0,u=e.length;c<u;c++)n(new a.Vector3(e[c][0],e[c][1],e[c][2]));for(var d=[],e=this.vertices,c=0,u=t.length;c<u;c++)o(e[t[c][0]],e[t[c][1]],e[t[c][2]],i);for(this.mergeVertices(),c=0,u=this.vertices.length;c<u;c++)this.vertices[c].multiplyScalar(r);this.computeCentroids(),this.boundingSphere={radius:r}},a.PolyhedronGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2;a.PolyhedronGeometry.call(this,[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},a.IcosahedronGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.OctahedronGeometry=function(e,t){a.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},a.OctahedronGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.TetrahedronGeometry=function(e,t){a.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},a.TetrahedronGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.ParametricGeometry=function(e,t,r,i){a.Geometry.call(this);var n,o,s,l,h=this.vertices,c=this.faces,u=this.faceVertexUvs[0],i=void 0!==i&&i,d=t+1;for(n=0;n<=r;n++)for(l=n/r,o=0;o<=t;o++)s=o/t,s=e(s,l),h.push(s);var f,p,m,g;for(n=0;n<r;n++)for(o=0;o<t;o++)e=n*d+o,h=n*d+o+1,l=(n+1)*d+o,s=(n+1)*d+o+1,f=new a.UV(o/t,n/r),p=new a.UV((o+1)/t,n/r),m=new a.UV(o/t,(n+1)/r),g=new a.UV((o+1)/t,(n+1)/r),i?(c.push(new a.Face3(e,h,l)),c.push(new a.Face3(h,s,l)),u.push([f,p,m]),u.push([p,g,m])):(c.push(new a.Face4(e,h,s,l)),u.push([f,p,g,m]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.ParametricGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.ConvexGeometry=function(e){function t(e){var t=e.length();return new a.UV(e.x/t,e.y/t)}a.Geometry.call(this);for(var r=[[0,1,2],[0,2,1]],i=3;i<e.length;i++){var n=i,o=e[n].clone(),s=o.length();o.x=o.x+s*(Math.random()-.5)*2e-6,o.y=o.y+s*(Math.random()-.5)*2e-6,o.z=o.z+s*(Math.random()-.5)*2e-6;for(var s=[],l=0;l<r.length;){var h,c=r[l],u=o,d=e[c[0]];h=d;var f=e[c[1]],p=e[c[2]],m=new a.Vector3,g=new a.Vector3;if(m.sub(p,f),g.sub(h,f),m.crossSelf(g),m.isZero()||m.normalize(),h=m,d=h.dot(d),h.dot(u)>=d){for(u=0;u<3;u++){for(d=[c[u],c[(u+1)%3]],h=!0,f=0;f<s.length;f++)if(s[f][0]===d[1]&&s[f][1]===d[0]){s[f]=s[s.length-1],s.pop(),h=!1;break}h&&s.push(d)}r[l]=r[r.length-1],r.pop()}else l++}for(f=0;f<s.length;f++)r.push([s[f][0],s[f][1],n])}for(n=0,o=Array(e.length),i=0;i<r.length;i++)for(s=r[i],l=0;l<3;l++)void 0===o[s[l]]&&(o[s[l]]=n++,this.vertices.push(e[s[l]])),s[l]=o[s[l]];for(i=0;i<r.length;i++)this.faces.push(new a.Face3(r[i][0],r[i][1],r[i][2]));for(i=0;i<this.faces.length;i++)s=this.faces[i],this.faceVertexUvs[0].push([t(this.vertices[s.a]),t(this.vertices[s.b]),t(this.vertices[s.c])]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},a.ConvexGeometry.prototype=(0,n.default)(a.Geometry.prototype),a.AxisHelper=function(){a.Object3D.call(this);var e=new a.Geometry;e.vertices.push(new a.Vector3),e.vertices.push(new a.Vector3(0,100,0));var t,r=new a.CylinderGeometry(0,5,25,5,1);t=new a.Line(e,new a.LineBasicMaterial({color:16711680})),t.rotation.z=-Math.PI/2,this.add(t),t=new a.Mesh(r,new a.MeshBasicMaterial({color:16711680})),t.position.x=100,t.rotation.z=-Math.PI/2,this.add(t),t=new a.Line(e,new a.LineBasicMaterial({color:65280})),this.add(t),t=new a.Mesh(r,new a.MeshBasicMaterial({color:65280})),t.position.y=100,this.add(t),t=new a.Line(e,new a.LineBasicMaterial({color:255})),t.rotation.x=Math.PI/2,this.add(t),t=new a.Mesh(r,new a.MeshBasicMaterial({color:255})),t.position.z=100,t.rotation.x=Math.PI/2,this.add(t)},a.AxisHelper.prototype=(0,n.default)(a.Object3D.prototype),a.ArrowHelper=function(e,t,r,i){a.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=20);var n=new a.Geometry;n.vertices.push(new a.Vector3(0,0,0)),n.vertices.push(new a.Vector3(0,1,0)),this.line=new a.Line(n,new a.LineBasicMaterial({color:i})),this.add(this.line),n=new a.CylinderGeometry(0,.05,.25,5,1),this.cone=new a.Mesh(n,new a.MeshBasicMaterial({color:i})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof a.Vector3&&(this.position=t),this.setDirection(e),this.setLength(r)},a.ArrowHelper.prototype=(0,n.default)(a.Object3D.prototype),a.ArrowHelper.prototype.setDirection=function(e){var t=new a.Vector3(0,1,0).crossSelf(e),e=Math.acos(new a.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new a.Matrix4).makeRotationAxis(t.normalize(),e),this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},a.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},a.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},a.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.geometry.vertices.push(new a.Vector3),i.geometry.colors.push(new a.Color(t)),void 0===i.pointMap[e]&&(i.pointMap[e]=[]),i.pointMap[e].push(i.geometry.vertices.length-1)}a.Line.call(this);var i=this;this.geometry=new a.Geometry,this.material=new a.LineBasicMaterial({color:16777215,vertexColors:a.FaceColors}),this.type=a.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={},t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),this.camera=e,this.update(e)},a.CameraHelper.prototype=(0,n.default)(a.Line.prototype),a.CameraHelper.prototype.update=function(){function e(e,r,i,n){if(a.CameraHelper.__v.set(r,i,n),a.CameraHelper.__projector.unprojectVector(a.CameraHelper.__v,a.CameraHelper.__c),e=t.pointMap[e],void 0!==e)for(r=0,i=e.length;r<i;r++)t.geometry.vertices[e[r]].copy(a.CameraHelper.__v)}var t=this;a.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0},a.CameraHelper.__projector=new a.Projector,a.CameraHelper.__v=new a.Vector3,a.CameraHelper.__c=new a.Camera,a.SubdivisionModifier=function(e){this.subdivisions=void 0===e?1:e,this.useOldVertexColors=!1,this.supportUVs=!0,this.debug=!1},a.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-- >0;)this.smooth(e)},a.SubdivisionModifier.prototype.smooth=function(e){function t(){g.debug&&console.log.apply(console,arguments)}function r(){console&&console.log.apply(console,arguments)}function i(e,r,i,n,s,l,h){var c=new a.Face4(e,r,i,n,null,s.color,s.materialIndex);if(g.useOldVertexColors){c.vertexColors=[];for(var u,d,f,v=0;v<4;v++){f=l[v],u=new a.Color,u.setRGB(0,0,0);for(var y=0;y<f.length;y++)d=s.vertexColors[f[y]-1],u.r=u.r+d.r,u.g=u.g+d.g,u.b=u.b+d.b;u.r=u.r/f.length,u.g=u.g/f.length,u.b=u.b/f.length,c.vertexColors[v]=u}}p.push(c),g.supportUVs&&(s=[o(e,""),o(r,h),o(i,h),o(n,h)],s[0]?s[1]?s[2]?s[3]?m.push(s):t("d :( ",n+":"+h):t("c :( ",i+":"+h):t("b :( ",r+":"+h):t("a :( ",e+":"+h))}function n(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function o(e,i){var n=e+":"+i,a=w[n];return a?a:(t(e>=S&&e<S+y.length?"face pt":"edge pt"),r("warning, UV not found for",n),null)}function s(e,t,i){var n=e+":"+t;n in w?r("dup vertexNo",e,"oldFaceNo",t,"value",i,"key",n,w[n]):w[n]=i}var l,h,c,u,d,f=[],p=[],m=[],g=this,v=e.vertices,y=e.faces,f=v.concat(),x=[],b={},_={},w={},S=v.length,M=e.faceVertexUvs[0];if(t("originalFaces, uvs, originalVerticesLength",y.length,M.length,S),g.supportUVs)for(l=0,h=M.length;l<h;l++)for(c=0,u=M[l].length;c<u;c++)d=y[l]["abcd".charAt(c)],s(d,l,M[l][c]);0==M.length&&(g.supportUVs=!1),l=0;for(var T in w)l++;l||(g.supportUVs=!1,t("no uvs")),t("-- Original Faces + Vertices UVs completed",w,"vs",M.length);var A;for(l=0,h=y.length;l<h;l++)d=y[l],x.push(d.centroid),f.push(d.centroid),g.supportUVs&&(A=new a.UV,d instanceof a.Face3?(A.u=o(d.a,l).u+o(d.b,l).u+o(d.c,l).u,A.v=o(d.a,l).v+o(d.b,l).v+o(d.c,l).v,A.u=A.u/3,A.v=A.v/3):d instanceof a.Face4&&(A.u=o(d.a,l).u+o(d.b,l).u+o(d.c,l).u+o(d.d,l).u,A.v=o(d.a,l).v+o(d.b,l).v+o(d.c,l).v+o(d.d,l).v,A.u=A.u/4,A.v=A.v/4),s(S+l,"",A));t("-- added UVs for new Faces",w),T=function(e,t){void 0===C[e]&&(C[e]=[]),C[e].push(t)};var C={},M=0;for(h=e.faces.length;M<h;M++)d=e.faces[M],d instanceof a.Face3?(A=n(d.a,d.b),T(A,M),A=n(d.b,d.c),T(A,M),A=n(d.c,d.a),T(A,M)):d instanceof a.Face4&&(A=n(d.a,d.b),T(A,M),A=n(d.b,d.c),T(A,M),A=n(d.c,d.d),T(A,M),A=n(d.d,d.a),T(A,M));h=C;var E,L,R=0;T={},M={};for(l in h){for(A=h[l],E=l.split("_"),L=E[0],E=E[1],c=L,d=[L,E],void 0===T[c]&&(T[c]=[]),T[c].push(d),c=E,d=[L,E],void 0===T[c]&&(T[c]=[]),T[c].push(d),c=0,u=A.length;c<u;c++){d=A[c];var P=L,F=d,D=l;void 0===M[P]&&(M[P]={}),M[P][F]=D,P=E,F=l,void 0===M[P]&&(M[P]={}),M[P][d]=F}A.length<2&&(_[l]=!0)}t("vertexEdgeMap",T,"vertexFaceMap",M);for(l in h)A=h[l],d=A[0],u=A[1],E=l.split("_"),L=E[0],E=E[1],A=new a.Vector3,_[l]?(A.addSelf(v[L]),A.addSelf(v[E]),A.multiplyScalar(.5)):(A.addSelf(x[d]),A.addSelf(x[u]),A.addSelf(v[L]),A.addSelf(v[E]),A.multiplyScalar(.25)),b[l]=S+y.length+R,f.push(A),R++,g.supportUVs&&(A=new a.UV,A.u=o(L,d).u+o(E,d).u,A.v=o(L,d).v+o(E,d).v,A.u=A.u/2,A.v=A.v/2,s(b[l],d,A),_[l]||(A=new a.UV,A.u=o(L,u).u+o(E,u).u,A.v=o(L,u).v+o(E,u).v,A.u=A.u/2,A.v=A.v/2,s(b[l],u,A)));t("-- Step 2 done");var U,N;E=["123","12","2","23"],u=["123","23","3","31"];var P=["123","31","1","12"],F=["1234","12","2","23"],D=["1234","23","3","34"],O=["1234","34","4","41"],B=["1234","41","1","12"];for(l=0,h=x.length;l<h;l++)d=y[l],A=S+l,d instanceof a.Face3?(R=n(d.a,d.b),L=n(d.b,d.c),U=n(d.c,d.a),i(A,b[R],d.b,b[L],d,E,l),i(A,b[L],d.c,b[U],d,u,l),i(A,b[U],d.a,b[R],d,P,l)):d instanceof a.Face4?(R=n(d.a,d.b),L=n(d.b,d.c),U=n(d.c,d.d),N=n(d.d,d.a),i(A,b[R],d.b,b[L],d,F,l),i(A,b[L],d.c,b[U],d,D,l),i(A,b[U],d.d,b[N],d,O,l),i(A,b[N],d.a,b[R],d,B,l)):t("face should be a face!",d);for(b=new a.Vector3,d=new a.Vector3,l=0,h=v.length;l<h;l++)if(void 0!==T[l]){b.set(0,0,0),d.set(0,0,0),L=new a.Vector3(0,0,0),A=0;for(c in M[l])b.addSelf(x[c]),A++;for(E=0,R=T[l].length,c=0;c<R;c++)_[n(T[l][c][0],T[l][c][1])]&&E++;if(2!=E){for(b.divideScalar(A),c=0;c<R;c++)A=T[l][c],A=v[A[0]].clone().addSelf(v[A[1]]).divideScalar(2),d.addSelf(A);d.divideScalar(R),L.addSelf(v[l]),L.multiplyScalar(R-3),L.addSelf(b),L.addSelf(d.multiplyScalar(2)),L.divideScalar(R),f[l]=L}}e.vertices=f,e.faces=p,e.faceVertexUvs[0]=m,delete e.__tmpVertices,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals()},a.ImmediateRenderObject=function(){a.Object3D.call(this),this.render=function(){}},a.ImmediateRenderObject.prototype=(0,n.default)(a.Object3D.prototype),a.LensFlare=function(e,t,r,i,n){a.Object3D.call(this),this.lensFlares=[],this.positionScreen=new a.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)},a.LensFlare.prototype=(0,n.default)(a.Object3D.prototype),a.LensFlare.prototype.add=function(e,t,r,i,n,o){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===n&&(n=new a.Color(16777215)),void 0===i&&(i=a.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:n,blending:i})},a.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<r;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation=t.rotation+.25*(t.wantedRotation-t.rotation)},a.MorphBlendMesh=function(e,t){a.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)},a.MorphBlendMesh.prototype=(0,n.default)(a.Mesh.prototype),a.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){t={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},a.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)(\d+)/,i={},n=this.geometry,a=0,o=n.morphTargets.length;a<o;a++){var s=n.morphTargets[a].name.match(r);if(s&&s.length>1){var l=s[1];i[l]||(i[l]={start:1/0,end:-(1/0)}),s=i[l],a<s.start&&(s.start=a),a>s.end&&(s.end=a),t||(t=l)}}for(l in i)s=i[l],this.createAnimation(l,s.start,s.end,e);this.firstAnimation=t},a.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){(e=this.animationsMap[e])&&(e.direction=1,e.directionBackwards=!1)},a.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){(e=this.animationsMap[e])&&(e.direction=-1,e.directionBackwards=!0)},a.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},a.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},a.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},a.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},a.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;return(e=this.animationsMap[e])&&(t=e.time),t},a.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;return(e=this.animationsMap[e])&&(t=e.duration),t},a.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},a.MorphBlendMesh.prototype.stopAnimation=function(e){(e=this.animationsMap[e])&&(e.active=!1)},a.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;t<r;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time=i.time+i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction=i.direction*-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time=i.time+i.duration));var o=i.startFrame+a.Math.clamp(Math.floor(i.time/n),0,i.length-1),s=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o),n=i.time%n/n,i.directionBackwards&&(n=1-n),this.morphTargetInfluences[i.currentFrame]=n*s,this.morphTargetInfluences[i.lastFrame]=(1-n)*s}}},a.LensFlarePlugin=function(){function e(e){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),n=t.createShader(t.VERTEX_SHADER);return t.shaderSource(i,e.fragmentShader),t.shaderSource(n,e.vertexShader),t.compileShader(i),t.compileShader(n),t.attachShader(r,i),t.attachShader(r,n),t.linkProgram(r),r}var t,r,i,n,o,s,l,h,c,u,d,f,p;this.init=function(m){t=m.context,r=m,i=new Float32Array(16),n=new Uint16Array(6),m=0,i[m++]=-1,i[m++]=-1,i[m++]=0,i[m++]=0,i[m++]=1,i[m++]=-1,i[m++]=1,i[m++]=0,i[m++]=1,i[m++]=1,i[m++]=1,i[m++]=1,i[m++]=-1,i[m++]=1,i[m++]=0,i[m++]=1,m=0,n[m++]=0,n[m++]=1,n[m++]=2,n[m++]=0,n[m++]=2,n[m++]=3,o=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),l=t.createTexture(),h=t.createTexture(),t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(c=!1,u=e(a.ShaderFlares.lensFlare)):(c=!0,u=e(a.ShaderFlares.lensFlareVertexTexture)),d={},f={},d.vertex=t.getAttribLocation(u,"position"),d.uv=t.getAttribLocation(u,"uv"),f.renderType=t.getUniformLocation(u,"renderType"),f.map=t.getUniformLocation(u,"map"),f.occlusionMap=t.getUniformLocation(u,"occlusionMap"),f.opacity=t.getUniformLocation(u,"opacity"),f.color=t.getUniformLocation(u,"color"),f.scale=t.getUniformLocation(u,"scale"),f.rotation=t.getUniformLocation(u,"rotation"),f.screenPosition=t.getUniformLocation(u,"screenPosition"),p=!1},this.render=function(e,i,n,m){var e=e.__webglFlares,g=e.length;if(g){var v=new a.Vector3,y=m/n,x=.5*n,b=.5*m,_=16/m,w=new a.Vector2(_*y,_),S=new a.Vector3(1,1,0),M=new a.Vector2(1,1),T=f,_=d;t.useProgram(u),p||(t.enableVertexAttribArray(d.vertex),t.enableVertexAttribArray(d.uv),p=!0),t.uniform1i(T.occlusionMap,0),t.uniform1i(T.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(_.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(_.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.disable(t.CULL_FACE),t.depthMask(!1);var A,C,E,L,R;for(A=0;A<g;A++)if(_=16/m,w.set(_*y,_),L=e[A],v.set(L.matrixWorld.elements[12],L.matrixWorld.elements[13],L.matrixWorld.elements[14]),i.matrixWorldInverse.multiplyVector3(v),i.projectionMatrix.multiplyVector3(v),S.copy(v),M.x=S.x*x+x,M.y=S.y*b+b,c||M.x>0&&M.x<n&&M.y>0&&M.y<m)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,M.x-8,M.y-8,16,16,0),t.uniform1i(T.renderType,0),t.uniform2f(T.scale,w.x,w.y),t.uniform3f(T.screenPosition,S.x,S.y,S.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,h),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,M.x-8,M.y-8,16,16,0),t.uniform1i(T.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,l),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),L.positionScreen.copy(S),L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares(),t.uniform1i(T.renderType,2),t.enable(t.BLEND),C=0,E=L.lensFlares.length;C<E;C++)R=L.lensFlares[C],R.opacity>.001&&R.scale>.001&&(S.x=R.x,S.y=R.y,S.z=R.z,_=R.size*R.scale/m,w.x=_*y,w.y=_,t.uniform3f(T.screenPosition,S.x,S.y,S.z),t.uniform2f(T.scale,w.x,w.y),t.uniform1f(T.rotation,R.rotation),t.uniform1f(T.opacity,R.opacity),t.uniform3f(T.color,R.color.r,R.color.g,R.color.b),r.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst),r.setTexture(R.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},a.ShadowMapPlugin=function(){var e,t,r,i,n,o,s=new a.Frustum,l=new a.Matrix4,h=new a.Vector3,c=new a.Vector3;this.init=function(s){e=s.context,t=s;var s=a.ShaderLib.depthRGBA,l=a.UniformsUtils.clone(s.uniforms);r=new a.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l}),i=new a.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0}),n=new a.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,skinning:!0}),o=new a.ShaderMaterial({fragmentShader:s.fragmentShader,vertexShader:s.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,n._shadowPass=!0,o._shadowPass=!0},this.render=function(e,r){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,r)},this.update=function(u,d){var f,p,m,g,v,y,x,b,_,w=[];for(g=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),f=0,p=u.__lights.length;f<p;f++)if(m=u.__lights[f],m.castShadow)if(m instanceof a.DirectionalLight&&m.shadowCascade)for(v=0;v<m.shadowCascadeCount;v++){var S;if(m.shadowCascadeArray[v])S=m.shadowCascadeArray[v];else{_=m,x=v,S=new a.DirectionalLight,S.isVirtual=!0,S.onlyShadow=!0,S.castShadow=!0,S.shadowCameraNear=_.shadowCameraNear,S.shadowCameraFar=_.shadowCameraFar,S.shadowCameraLeft=_.shadowCameraLeft,S.shadowCameraRight=_.shadowCameraRight,S.shadowCameraBottom=_.shadowCameraBottom,S.shadowCameraTop=_.shadowCameraTop,S.shadowCameraVisible=_.shadowCameraVisible,S.shadowDarkness=_.shadowDarkness,S.shadowBias=_.shadowCascadeBias[x],S.shadowMapWidth=_.shadowCascadeWidth[x],S.shadowMapHeight=_.shadowCascadeHeight[x],S.pointsWorld=[],S.pointsFrustum=[],b=S.pointsWorld,y=S.pointsFrustum;for(var M=0;M<8;M++)b[M]=new a.Vector3,y[M]=new a.Vector3;b=_.shadowCascadeNearZ[x],_=_.shadowCascadeFarZ[x],y[0].set(-1,-1,b),y[1].set(1,-1,b),y[2].set(-1,1,b),y[3].set(1,1,b),y[4].set(-1,-1,_),y[5].set(1,-1,_),y[6].set(-1,1,_),y[7].set(1,1,_),S.originalCamera=d,y=new a.Gyroscope,y.position=m.shadowCascadeOffset,y.add(S),y.add(S.target),d.add(y),m.shadowCascadeArray[v]=S,console.log("Created virtualLight",S)}x=m,b=v,_=x.shadowCascadeArray[b],_.position.copy(x.position),_.target.position.copy(x.target.position),_.lookAt(_.target),_.shadowCameraVisible=x.shadowCameraVisible,_.shadowDarkness=x.shadowDarkness,_.shadowBias=x.shadowCascadeBias[b],y=x.shadowCascadeNearZ[b],x=x.shadowCascadeFarZ[b],_=_.pointsFrustum,_[0].z=y,_[1].z=y,_[2].z=y,_[3].z=y,_[4].z=x,_[5].z=x,_[6].z=x,_[7].z=x,w[g]=S,g++}else w[g]=m,g++;for(f=0,p=w.length;f<p;f++){if(m=w[f],m.shadowMap||(m.shadowMap=new a.WebGLRenderTarget(m.shadowMapWidth,m.shadowMapHeight,{minFilter:a.LinearFilter,magFilter:a.LinearFilter,format:a.RGBAFormat}),m.shadowMapSize=new a.Vector2(m.shadowMapWidth,m.shadowMapHeight),m.shadowMatrix=new a.Matrix4),!m.shadowCamera){if(m instanceof a.SpotLight)m.shadowCamera=new a.PerspectiveCamera(m.shadowCameraFov,m.shadowMapWidth/m.shadowMapHeight,m.shadowCameraNear,m.shadowCameraFar);else{if(!(m instanceof a.DirectionalLight)){console.error("Unsupported light type for shadow");continue}m.shadowCamera=new a.OrthographicCamera(m.shadowCameraLeft,m.shadowCameraRight,m.shadowCameraTop,m.shadowCameraBottom,m.shadowCameraNear,m.shadowCameraFar)}u.add(m.shadowCamera),t.autoUpdateScene&&u.updateMatrixWorld()}if(m.shadowCameraVisible&&!m.cameraHelper&&(m.cameraHelper=new a.CameraHelper(m.shadowCamera),m.shadowCamera.add(m.cameraHelper)),m.isVirtual&&S.originalCamera==d){for(v=d,g=m.shadowCamera,y=m.pointsFrustum,_=m.pointsWorld,h.set(1/0,1/0,1/0),c.set(-(1/0),-(1/0),-(1/0)),x=0;x<8;x++)b=_[x],b.copy(y[x]),a.ShadowMapPlugin.__projector.unprojectVector(b,v),g.matrixWorldInverse.multiplyVector3(b),b.x<h.x&&(h.x=b.x),b.x>c.x&&(c.x=b.x),b.y<h.y&&(h.y=b.y),b.y>c.y&&(c.y=b.y),b.z<h.z&&(h.z=b.z),b.z>c.z&&(c.z=b.z);g.left=h.x,g.right=c.x,g.top=c.y,g.bottom=h.y,g.updateProjectionMatrix()}for(g=m.shadowMap,y=m.shadowMatrix,v=m.shadowCamera,v.position.copy(m.matrixWorld.getPosition()),v.lookAt(m.target.matrixWorld.getPosition()),v.updateMatrixWorld(),v.matrixWorldInverse.getInverse(v.matrixWorld),m.cameraHelper&&(m.cameraHelper.visible=m.shadowCameraVisible),m.shadowCameraVisible&&m.cameraHelper.update(),y.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),y.multiplySelf(v.projectionMatrix),y.multiplySelf(v.matrixWorldInverse),v._viewMatrixArray||(v._viewMatrixArray=new Float32Array(16)),v._projectionMatrixArray||(v._projectionMatrixArray=new Float32Array(16)),v.matrixWorldInverse.flattenToArray(v._viewMatrixArray),v.projectionMatrix.flattenToArray(v._projectionMatrixArray),l.multiply(v.projectionMatrix,v.matrixWorldInverse),s.setFromMatrix(l),t.setRenderTarget(g),t.clear(),_=u.__webglObjects,m=0,g=_.length;m<g;m++)x=_[m],y=x.object,x.render=!1,!y.visible||!y.castShadow||y instanceof a.Mesh&&y.frustumCulled&&!s.contains(y)||(y._modelViewMatrix.multiply(v.matrixWorldInverse,y.matrixWorld),x.render=!0);for(m=0,g=_.length;m<g;m++)x=_[m],x.render&&(y=x.object,x=x.buffer,b=y.customDepthMaterial?y.customDepthMaterial:y instanceof a.SkinnedMesh?y.geometry.morphTargets.length?o:n:y.geometry.morphTargets.length?i:r,x instanceof a.BufferGeometry?t.renderBufferDirect(v,u.__lights,null,b,x,y):t.renderBuffer(v,u.__lights,null,b,x,y));for(_=u.__webglObjectsImmediate,m=0,g=_.length;m<g;m++)x=_[m],y=x.object,y.visible&&y.castShadow&&(y._modelViewMatrix.multiply(v.matrixWorldInverse,y.matrixWorld),t.renderImmediateObject(v,u.__lights,null,r,y))}f=t.getClearColor(),p=t.getClearAlpha(),e.clearColor(f.r,f.g,f.b,p),e.enable(e.BLEND),t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}},a.ShadowMapPlugin.__projector=new a.Projector,a.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,r,i,n,o,s,l,h,c,u;this.init=function(e){t=e.context,r=e,i=new Float32Array(16),n=new Uint16Array(6),e=0,i[e++]=-1,i[e++]=-1,i[e++]=0,i[e++]=0,i[e++]=1,i[e++]=-1,i[e++]=1,i[e++]=0,i[e++]=1,i[e++]=1,i[e++]=1,i[e++]=1,i[e++]=-1,i[e++]=1,i[e++]=0,i[e++]=1,e=0,n[e++]=0,n[e++]=1,n[e++]=2,n[e++]=0,n[e++]=2,n[e++]=3,o=t.createBuffer(),s=t.createBuffer(),
t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW);var e=a.ShaderSprite.sprite,d=t.createProgram(),f=t.createShader(t.FRAGMENT_SHADER),p=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,e.fragmentShader),t.shaderSource(p,e.vertexShader),t.compileShader(f),t.compileShader(p),t.attachShader(d,f),t.attachShader(d,p),t.linkProgram(d),l=d,h={},c={},h.position=t.getAttribLocation(l,"position"),h.uv=t.getAttribLocation(l,"uv"),c.uvOffset=t.getUniformLocation(l,"uvOffset"),c.uvScale=t.getUniformLocation(l,"uvScale"),c.rotation=t.getUniformLocation(l,"rotation"),c.scale=t.getUniformLocation(l,"scale"),c.alignment=t.getUniformLocation(l,"alignment"),c.color=t.getUniformLocation(l,"color"),c.map=t.getUniformLocation(l,"map"),c.opacity=t.getUniformLocation(l,"opacity"),c.useScreenCoordinates=t.getUniformLocation(l,"useScreenCoordinates"),c.affectedByDistance=t.getUniformLocation(l,"affectedByDistance"),c.screenPosition=t.getUniformLocation(l,"screenPosition"),c.modelViewMatrix=t.getUniformLocation(l,"modelViewMatrix"),c.projectionMatrix=t.getUniformLocation(l,"projectionMatrix"),u=!1},this.render=function(i,n,a,d){var i=i.__webglSprites,f=i.length;if(f){var p=h,m=c,g=d/a,a=.5*a,v=.5*d,y=!0;t.useProgram(l),u||(t.enableVertexAttribArray(p.position),t.enableVertexAttribArray(p.uv),u=!0),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.depthMask(!0),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(p.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(p.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.uniformMatrix4fv(m.projectionMatrix,!1,n._projectionMatrixArray),t.activeTexture(t.TEXTURE0),t.uniform1i(m.map,0);for(var x,b=[],p=0;p<f;p++)x=i[p],x.visible&&0!==x.opacity&&(x.useScreenCoordinates?x.z=-x.position.z:(x._modelViewMatrix.multiply(n.matrixWorldInverse,x.matrixWorld),x.z=-x._modelViewMatrix.elements[14]));for(i.sort(e),p=0;p<f;p++)x=i[p],x.visible&&0!==x.opacity&&x.map&&x.map.image&&x.map.image.width&&(x.useScreenCoordinates?(t.uniform1i(m.useScreenCoordinates,1),t.uniform3f(m.screenPosition,(x.position.x-a)/a,(v-x.position.y)/v,Math.max(0,Math.min(1,x.position.z)))):(t.uniform1i(m.useScreenCoordinates,0),t.uniform1i(m.affectedByDistance,x.affectedByDistance?1:0),t.uniformMatrix4fv(m.modelViewMatrix,!1,x._modelViewMatrix.elements)),n=x.map.image.width/(x.scaleByViewport?d:1),b[0]=n*g*x.scale.x,b[1]=n*x.scale.y,t.uniform2f(m.uvScale,x.uvScale.x,x.uvScale.y),t.uniform2f(m.uvOffset,x.uvOffset.x,x.uvOffset.y),t.uniform2f(m.alignment,x.alignment.x,x.alignment.y),t.uniform1f(m.opacity,x.opacity),t.uniform3f(m.color,x.color.r,x.color.g,x.color.b),t.uniform1f(m.rotation,x.rotation),t.uniform2fv(m.scale,b),x.mergeWith3D&&!y?(t.enable(t.DEPTH_TEST),y=!0):!x.mergeWith3D&&y&&(t.disable(t.DEPTH_TEST),y=!1),r.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),r.setTexture(x.map,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},a.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,r,i,n=new a.Frustum,o=new a.Matrix4;this.init=function(n){e=n.context,t=n;var n=a.ShaderLib.depthRGBA,o=a.UniformsUtils.clone(n.uniforms);r=new a.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o}),i=new a.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o,morphTargets:!0}),r._shadowPass=!0,i._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(s,l){var h,c,u,d,f,p;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&s.updateMatrixWorld(),l._viewMatrixArray||(l._viewMatrixArray=new Float32Array(16)),l._projectionMatrixArray||(l._projectionMatrixArray=new Float32Array(16)),l.matrixWorldInverse.getInverse(l.matrixWorld),l.matrixWorldInverse.flattenToArray(l._viewMatrixArray),l.projectionMatrix.flattenToArray(l._projectionMatrixArray),o.multiply(l.projectionMatrix,l.matrixWorldInverse),n.setFromMatrix(o),t.setRenderTarget(this.renderTarget),t.clear(),p=s.__webglObjects,h=0,c=p.length;h<c;h++)u=p[h],f=u.object,u.render=!1,!f.visible||f instanceof a.Mesh&&f.frustumCulled&&!n.contains(f)||(f._modelViewMatrix.multiply(l.matrixWorldInverse,f.matrixWorld),u.render=!0);for(h=0,c=p.length;h<c;h++)u=p[h],u.render&&(f=u.object,u=u.buffer,f.material&&t.setMaterialFaces(f.material),d=f.customDepthMaterial?f.customDepthMaterial:f.geometry.morphTargets.length?i:r,u instanceof a.BufferGeometry?t.renderBufferDirect(l,s.__lights,null,d,u,f):t.renderBuffer(l,s.__lights,null,d,u,f));for(p=s.__webglObjectsImmediate,h=0,c=p.length;h<c;h++)u=p[h],f=u.object,f.visible&&f.castShadow&&(f._modelViewMatrix.multiply(l.matrixWorldInverse,f.matrixWorld),t.renderImmediateObject(l,s.__lights,null,r,f));h=t.getClearColor(),c=t.getClearAlpha(),e.clearColor(h.r,h.g,h.b,c),e.enable(e.BLEND)}},a.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},a.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};var o=a,s=o;t.default=s;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(a,"THR51","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/three.min.js"),__REACT_HOT_LOADER__.register(o,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/three.min.js"),__REACT_HOT_LOADER__.register(s,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/three.min.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2436:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var n,a=r(352),o=(i(a),r(2429)),s=i(o),l=r(2431),h=i(l),c=r(2433),u=i(c);!function(i,a){n=function(){return a()}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(void 0,function(){function e(){this.visibleLayers={},this.visibleLayers[e.LayerId.BOTTOM_COPPER]=!0,this.visibleLayers[e.LayerId.BOTTOM_SILKSCREEN]=!0,this.visibleLayers[e.LayerId.BOTTOM_DOCUMENTATION]=!0,this.visibleLayers[e.LayerId.DIM_BOARD]=!0,this.visibleLayers[e.LayerId.TOP_COPPER]=!0,this.visibleLayers[e.LayerId.TOP_SILKSCREEN]=!0,this.visibleLayers[e.LayerId.TOP_DOCUMENTATION]=!0,this.visibleLayers[e.LayerId.VIAS]=!0,this.visibleLayers[e.LayerId.OUTLINE]=!0,this.renderLayerOrder=[],this.renderLayerOrder.push(e.LayerId.BOTTOM_DOCUMENTATION),this.renderLayerOrder.push(e.LayerId.BOTTOM_SILKSCREEN),this.renderLayerOrder.push(e.LayerId.BOTTOM_COPPER),this.renderLayerOrder.push(e.LayerId.DIM_BOARD),this.renderLayerOrder.push(e.LayerId.OUTLINE),this.renderLayerOrder.push(e.LayerId.TOP_COPPER),this.renderLayerOrder.push(e.LayerId.VIAS),this.renderLayerOrder.push(e.LayerId.TOP_SILKSCREEN),this.renderLayerOrder.push(e.LayerId.TOP_DOCUMENTATION),this.reverseRenderLayerOrder=[],this.reverseRenderLayerOrder.push(e.LayerId.TOP_DOCUMENTATION),this.reverseRenderLayerOrder.push(e.LayerId.TOP_SILKSCREEN),this.reverseRenderLayerOrder.push(e.LayerId.TOP_COPPER),this.reverseRenderLayerOrder.push(e.LayerId.DIM_BOARD),this.reverseRenderLayerOrder.push(e.LayerId.OUTLINE),this.reverseRenderLayerOrder.push(e.LayerId.BOTTOM_COPPER),this.reverseRenderLayerOrder.push(e.LayerId.VIAS),this.reverseRenderLayerOrder.push(e.LayerId.BOTTOM_SILKSCREEN),this.reverseRenderLayerOrder.push(e.LayerId.BOTTOM_DOCUMENTATION),this.layerRenderFunctions={},this.layerRenderFunctions[e.LayerId.BOTTOM_COPPER]=function(e,t,r){e.drawSignalWires(t.eagleLayersByName.Bottom,r),e.drawElements(t.eagleLayersByName.Bottom,r),e.drawPlainTexts(t.eagleLayersByName.Bottom,r)},this.layerRenderFunctions[e.LayerId.BOTTOM_SILKSCREEN]=function(e,t,r){e.drawElements(t.eagleLayersByName.bNames,r),e.drawElements(t.eagleLayersByName.bValues,r),e.drawElements(t.eagleLayersByName.bPlace,r),e.drawPlainTexts(t.eagleLayersByName.bNames,r),e.drawPlainTexts(t.eagleLayersByName.bValues,r),e.drawPlainTexts(t.eagleLayersByName.bPlace,r),e.drawPlainWires(t.eagleLayersByName.bNames,r),e.drawPlainWires(t.eagleLayersByName.bValues,r),e.drawPlainWires(t.eagleLayersByName.bPlace,r)},this.layerRenderFunctions[e.LayerId.BOTTOM_DOCUMENTATION]=function(e,t,r){e.drawElements(t.eagleLayersByName.bKeepout,r),e.drawElements(t.eagleLayersByName.bDocu,r),e.drawPlainTexts(t.eagleLayersByName.bKeepout,r),e.drawPlainTexts(t.eagleLayersByName.bDocu,r)},this.layerRenderFunctions[e.LayerId.TOP_COPPER]=function(e,t,r){e.drawSignalWires(t.eagleLayersByName.Top,r),e.drawElements(t.eagleLayersByName.Top,r),e.drawPlainTexts(t.eagleLayersByName.Top,r)},this.layerRenderFunctions[e.LayerId.TOP_SILKSCREEN]=function(e,t,r){e.drawElements(t.eagleLayersByName.tNames,r),e.drawElements(t.eagleLayersByName.tValues,r),e.drawElements(t.eagleLayersByName.tPlace,r),e.drawPlainTexts(t.eagleLayersByName.tNames,r),e.drawPlainTexts(t.eagleLayersByName.tValues,r),e.drawPlainTexts(t.eagleLayersByName.tPlace,r),e.drawPlainWires(t.eagleLayersByName.tNames,r),e.drawPlainWires(t.eagleLayersByName.tValues,r),e.drawPlainWires(t.eagleLayersByName.tPlace,r)},this.layerRenderFunctions[e.LayerId.TOP_DOCUMENTATION]=function(e,t,r){e.drawElements(t.eagleLayersByName.tKeepout,r),e.drawElements(t.eagleLayersByName.tDocu,r),e.drawPlainTexts(t.eagleLayersByName.tKeepout,r),e.drawPlainTexts(t.eagleLayersByName.tDocu,r)},this.layerRenderFunctions[e.LayerId.DIM_BOARD]=function(e,t,r){e.dimCanvas(t.dimBoardAlpha,r)},this.layerRenderFunctions[e.LayerId.VIAS]=function(e,t,r){e.drawSignalVias("1-16",r,t.viaPadColor())},this.layerRenderFunctions[e.LayerId.OUTLINE]=function(e,t,r){e._drawShapeFromWires(t.eagleLayersByName.Dimension,r),e.drawPlainHoles(t.eagleLayersByName.Dimension,r)},this.render=o,this.draw=i,this.redraw=n,this.initRenderer=a,this.calculateBounds=v,this.scaleToFit=t,this.setScale=r,this.layerColor=l,this.mirrorLayer=p,this.angleForRot=d,this.matrixForRot=f,this.viaPadColor=c,this.colorPalette=[[127,127,127],[35,35,141],[35,141,35],[35,141,141],[141,35,35],[141,35,141],[141,141,35],[141,141,141],[39,39,39],[0,0,180],[0,180,0],[0,180,180],[180,0,0],[180,0,180],[180,180,0],[63,63,63]]}function t(e){var t=this.canvas,r=t.width,i=t.height,n=r/this.nativeSize[0],a=i/this.nativeSize[1],o=Math.min(n,a);this.baseScale=o,this.minScale=o/10,this.maxScale=10*o,this.setScale(1)}function r(e,t){console.time&&console.time("scale"),this.scale=e;var r=this.scaleToFitSelector?document.querySelector(this.scaleToFitSelector):this.canvas;if(r){var i=(r.offsetWidth,r.offsetHeight,(r.scrollLeft+r.clientWidth/2)/r.scrollWidth),n=(r.scrollTop+r.clientHeight/2)/r.scrollHeight;if("svg"in this)this.svg.style.width=e*this.baseScale*this.nativeSize[0]+"px",this.svg.style.height=e*this.baseScale*this.nativeSize[1]+"px";else if("canvas"in this){var a=this.canvas,o=a.getContext("2d"),s=window.devicePixelRatio||1,l=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1,h=s/l;t||(a.width=e*this.baseScale*this.nativeSize[0]*h,a.height=e*this.baseScale*this.nativeSize[1]*h,a.style.width=e*this.baseScale*this.nativeSize[0]+"px",a.style.height=e*this.baseScale*this.nativeSize[1]+"px"),this.canvasWidth=e*this.baseScale*this.nativeSize[0]*h,this.canvasHeight=e*this.baseScale*this.nativeSize[0]*h,this.ratio=h}r.scrollLeft=i*r.scrollWidth-r.clientWidth/2,r.scrollTop=n*r.scrollHeight-r.clientHeight/2,this.redraw()}}function i(){this.renderer||this.initRenderer(),this.renderer.draw(),this.drawCallback&&this.drawCallback()}function n(){this.renderer||this.initRenderer(),this.renderer.redraw()}function a(){this.renderer=new u.default(this)}function o(e,t){this.canvas=e,this.scaleToFit(),this.draw()}function l(e){var t=this.colorPalette[e];return t||(console.warn("color %s not defined, using default color",e,this.colorPalette[0]),t=this.colorPalette[e]=this.colorPalette[0]),"rgb("+t[0]+","+t[1]+","+t[2]+")"}function c(){return"#0b0"}function d(e){if(!e)return{degrees:0};var t=e.indexOf("S")>=0,r=e.indexOf("M")>=0,i=parseFloat(e.split("R")[1]);return{spin:t,flipped:r,degrees:i}}function f(e){var t=this.angleForRot(e),r=(t.spin,t.flipped),i=t.degrees,n=i*Math.PI/180,a=r?-1:1,o=[a*Math.cos(n),a*-Math.sin(n),Math.sin(n),Math.cos(n)];return o}function p(e){if(1==e)return 16;if(16==e)return 1;var t=this.layersByNumber[e].name,r=t.substring(0,1);if("t"==r){var i="b"+t.substring(1),n=this.eagleLayersByName[i];if(n)return n.number}else if("b"==r){var i="t"+t.substring(1),n=this.eagleLayersByName[i];if(n)return n.number}return e}function m(){var e=[].slice.call(arguments);return Math.max.apply(Math,e.filter(function(e){return!isNaN(e)}))}function g(){var e=[].slice.call(arguments);return Math.min.apply(Math,e.filter(function(e){return!isNaN(e)}))}function v(){var t=e.LARGE_NUMBER,r=e.LARGE_NUMBER,i=-e.LARGE_NUMBER,n=-e.LARGE_NUMBER;for(var a in this.plainWires){var o=this.plainWires[a];for(var s in o){var l=o[s],h=l.x1,c=l.x2,u=l.y1,d=l.y2,f=l.width||this.minLineWidth;t=g(t,h-f,h+f,c-f,c+f),i=m(i,h-f,h+f,c-f,c+f),r=g(r,u-f,u+f,d-f,d+f),n=m(n,u-f,u+f,d-f,d+f)}}for(var p in this.signalItems)for(var a in this.signalItems[p]){var o=this.signalItems[p][a].wires;for(var s in o){var l=o[s],h=l.x1,c=l.x2,u=l.y1,d=l.y2,f=l.width||this.minLineWidth;t=g(t,h-f,h+f,c-f,c+f),i=m(i,h-f,h+f,c-f,c+f),r=g(r,u-f,u+f,d-f,d+f),n=m(n,u-f,u+f,d-f,d+f)}}for(var v in this.elements){var y=this.elements[v],x="string"==typeof y.pkg?this.packagesByName[y.pkg]:y.pkg,b=y.matrix;for(var _ in x.smds){var w=x.smds[_],h=y.x+b[0]*w.x1+b[1]*w.y1,u=y.y+b[2]*w.x1+b[3]*w.y1,c=y.x+b[0]*w.x2+b[1]*w.y2,d=y.y+b[2]*w.x2+b[3]*w.y2;t=g(t,h,c),i=m(i,h,c),r=g(r,u,d),n=m(n,u,d)}for(var S in x.wires){var M=x.wires[S],h=y.x+b[0]*M.x1+b[1]*M.y1,u=y.y+b[2]*M.x1+b[3]*M.y1,c=y.x+b[0]*M.x2+b[1]*M.y2,d=y.y+b[2]*M.x2+b[3]*M.y2,f=M.width||this.minLineWidth;t=g(t,h-f,h+f,c-f,c+f),i=m(i,h-f,h+f,c-f,c+f),r=g(r,u-f,u+f,d-f,d+f),n=m(n,u-f,u+f,d-f,d+f)}}return[t,r,i,n]}return e.LayerId={BOTTOM_COPPER:1,BOTTOM_SILKSCREEN:2,BOTTOM_DOCUMENTATION:3,DIM_BOARD:4,TOP_COPPER:5,TOP_SILKSCREEN:6,TOP_DOCUMENTATION:7,VIAS:8,OUTLINE:9},e.LARGE_NUMBER=99999,e.warnings={},e.prototype.scale=1,e.prototype.minScale=.1,e.prototype.maxScale=10,e.prototype.minLineWidth=.05,e.prototype.boardFlipped=!1,e.prototype.dimBoardAlpha=.7,e.parsers=[],s.default&&e.parsers.push(s.default),h.default&&e.parsers.push(h.default),e.prototype.findParser=function(t){var r={},i=e.parsers.some(function(e){if(e&&e.supports(t)){var e=("parsing using "+e.name,new e(this));e.parse(t);var i=this.calculateBounds();return r=this,r.bounds={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]},r.type="pcb",this.nativeBounds=i,this.nativeSize=[this.nativeBounds[2]-this.nativeBounds[0],this.nativeBounds[3]-this.nativeBounds[1]],!0}},this);return i||(r.error="Cannot find parser for selected file"),r},e.prototype.calcBBox=function(t){var r=[e.LARGE_NUMBER,e.LARGE_NUMBER,-e.LARGE_NUMBER,-e.LARGE_NUMBER];return t.forEach(function(e){e.x1<r[0]&&(r[0]=e.x1),e.x1>r[2]&&(r[2]=e.x1),e.y1<r[1]&&(r[1]=e.y1),e.y1>r[3]&&(r[3]=e.y1),e.x2<r[0]&&(r[0]=e.x2),e.x2>r[2]&&(r[2]=e.x2),e.y2<r[1]&&(r[1]=e.y2),e.y2>r[3]&&(r[3]=e.y2)}),(r[0]>=r[2]||r[1]>=r[3])&&(r=null),r},e.prototype.highlightColor=function(e){var t=this.colorPalette[e];return t||(console.warn("color %s not defined, using default color",e,this.colorPalette[0]),t=this.colorPalette[e]=this.colorPalette[0]),"rgb("+(t[0]+50)+","+(t[1]+50)+","+(t[2]+50)+")"},e});(function(){"undefined"==typeof __REACT_HOT_LOADER__})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},2437:function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(353),a=i(n),o=r(2416),s=i(o),l=r(2413),h=i(l),c=r(2397),u=i(c),d=r(2436),f=i(d),p=r(2430),m=i(p),g=r(2435),v=i(g),y=r(2428),x=i(y),b=r(2432),_=i(b);r(354),window.THR51=v.default;var w=function(){function e(e){var t;return w.utils.isPcb(e.name)?(t=new f.default,w.parser=t,t.findParser(e.data)):(t=new m.default,t.parse(e.data,e.name))}function t(e){w.isFlipped=e,w.boardControls.object.useQuaternion=!0;var t=w.isFlipped?{x:0,y:0,z:1,w:0}:{x:0,y:0,z:0,w:1};(0,h.default)(w.boardControls.object.quaternion,t)}function r(){w.center(),w.boardControls.screen.width=window.innerWidth,w.boardControls.screen.height=window.innerHeight,w.boardControls.radius=(window.innerWidth+window.innerHeight)/4}function i(){if(window.removeResizeListener(w.domParent,r),w.domParent)for(;w.domParent.hasChildNodes();)w.domParent.removeChild(w.domParent.lastChild);cancelAnimationFrame(this.id),w.scene=null,w.projector=null,w.camera=null,w.controls=null,w.destroyed=!0}function n(){if(w.renderer&&w.camera&&w.boardControls){w.renderer.setSize(w.domParent.offsetWidth,w.domParent.offsetHeight),w.camera.aspect=w.domParent.offsetWidth/w.domParent.offsetHeight,w.camera.updateProjectionMatrix(),w.boardControls.object.useQuaternion=!0;var e=w.isFlipped?{x:0,y:0,z:1,w:0}:{x:0,y:0,z:0,w:1};(0,h.default)(w.boardControls.object.quaternion,e)}}function o(e,t,i){w.domParent=t,w.layers=e,w.limits=(0,s.default)(w.layers,function(e,t){return{minX:e.minX<t.bounds.minX?e.minX:t.bounds.minX,minY:e.minY<t.bounds.minY?e.minY:t.bounds.minY,maxX:e.maxX>t.bounds.maxX?e.maxX:t.bounds.maxX,maxY:e.maxY>t.bounds.maxY?e.maxY:t.bounds.maxY}},{}),(0,a.default)(w.layers,function(e){e.enabled=!0}),w.boards.width=w.limits.maxX-w.limits.minX,w.boards.height=w.limits.maxY-w.limits.minY;var n=!0;try{w.renderer=new v.default.WebGLRenderer({antialias:!0}),w.renderer.sortObjects=!1}catch(o){console.error("Got WebGL error, falling back to 2D canvas."),n=!1,w.constants.ppmm=20,w.renderer=new v.default.CanvasRenderer({antialias:!0})}w.scene=new v.default.Scene,w.camera=new v.default.PerspectiveCamera(40),w.camera.up.set(0,0,-1),w.scene.add(w.camera);var h=new v.default.AmbientLight(13421772);if(w.scene.add(h),n){var c=new v.default.SpotLight(13421772,.3);c.position.set(0,15e4,0),w.scene.add(c)}var u=n?v.default.MeshPhongMaterial:v.default.MeshBasicMaterial;w.boards.bottom.canvas=w.boards.makeBoard(w.boards.width,w.boards.height),w.boards.top.canvas=w.boards.makeBoard(w.boards.width,w.boards.height,!0),w.boards.bottom.texture=new v.default.Texture(w.boards.bottom.canvas),w.boards.top.texture=new v.default.Texture(w.boards.top.canvas),w.boards.clearBoard(w.boards.bottom.canvas),w.boards.clearBoard(w.boards.top.canvas),w.boards.bottom.texture.needsUpdate=!0,w.boards.top.texture.needsUpdate=!0;var d=[null,null,new u({shininess:80,ambient:11184810,specular:13421772,map:w.boards.top.texture}),new u({shininess:80,ambient:11184810,specular:13421772,map:w.boards.bottom.texture}),null,null];n||(d[2].overdraw=!0,d[3].overdraw=!0),w.board=new v.default.Mesh(new v.default.CubeGeometry(w.boards.width,w.constants.geometry.boardThickness,w.boards.height,n?1:Math.ceil(w.boards.width/3),1,n?1:Math.ceil(w.boards.height/3),d,{px:0,nx:0,pz:0,nz:0}),new v.default.MeshFaceMaterial),w.board.position.y=-100,n&&w.scene.add(w.board);var f=new v.default.CubeGeometry(w.boards.width,w.constants.geometry.boardThickness,w.boards.height,1,1,1,(void 0),{py:0,ny:0}),p=new u(w.constants.materials.board);f=new v.default.Mesh(f,p),w.board.add(f),l(p),n||w.scene.add(w.board),w.camera.lookAt(w.board.position),w.boardControls=new x.default(w.board,w.renderer.domElement,i),w.boardControls.camera=w.camera,w.boardControls.eye=w.camera.position.clone().subSelf(w.board.position),window.addResizeListener(w.domParent,r),setTimeout(r,1),t.appendChild(w.renderer.domElement),w.layers.sort(function(e,t){return(e.type||10)-(t.type||10)}),w.repaint=0,w.render()}function l(e){var t=e.clone();t.side=v.default.BackSide,w.layers[0].isGerber?(0,a.default)(w.layers,function(e){e.type==w.index.BOARD&&(0,a.default)(e.cmds,function(r){var i=e.scale*e.shapes[r[1]][1]/2,n=new v.default.CylinderGeometry(i,i,w.constants.geometry.boardThickness,32,0,(!0));n=new v.default.Mesh(n,t),n.position.x=r[2]*e.scale-w.limits.minX-w.boards.width/2,n.position.z=w.boards.height/2-(r[3]*e.scale-w.limits.minY),w.board.add(n)})}):(0,a.default)(w.layers[0].plainHoles,function(e){var r=e.drill/2,i=new v.default.CylinderGeometry(r,r,w.constants.geometry.boardThickness,32,0,(!0));i=new v.default.Mesh(i,t),i.position.x=e.x-w.boards.width/2,i.position.z=w.boards.height/2-e.y,w.board.add(i)})}function c(){if(!w.destroyed){if(requestAnimationFrame(c),null!==w.repaint)if(w.callbacks&&w.callbacks.renderStart&&w.callbacks.renderStart(),0===w.repaint)w.boards.clearBoard(w.boards.bottom.canvas),w.boards.clearBoard(w.boards.top.canvas),w.repaint++;else{for(;w.repaint<=w.layers.length&&!w.layers[w.repaint-1].enabled;)w.repaint++;w.repaint<=w.layers.length&&(w.layers[w.repaint-1].side==w.index.TOP?w.renderLayer(w.boards.top.canvas,w.layers[w.repaint-1],w.limits):w.layers[w.repaint-1].side==w.index.BOTTOM?w.renderLayer(w.boards.bottom.canvas,w.layers[w.repaint-1],w.limits):w.layers[w.repaint-1].side==w.index.BOTH&&(w.renderLayer(w.boards.top.canvas,w.layers[w.repaint-1],w.limits),w.renderLayer(w.boards.bottom.canvas,w.layers[w.repaint-1],w.limits))),w.repaint>w.layers.length?(w.repaint=null,w.boards.bottom.texture.needsUpdate=!0,w.boards.top.texture.needsUpdate=!0,w.callbacks&&w.callbacks.renderComplete&&w.callbacks.renderComplete()):w.repaint++}w.boardControls.update(),w.renderer.render(w.scene,w.camera)}}function d(e,t,r){t.canvas||(t.canvas=document.createElement("canvas"),t.canvas.width=e.width,t.canvas.height=e.height,t.isGerber?_.default.renderLayer(t.canvas,t,r):t.render(e));var i=e.getContext("2d");i.globalCompositeOperation=t.type?"source-over":"destination-out",e.inverted?i.setTransform(1,0,0,-1,0,e.height):i.setTransform(1,0,0,1,0,0),i.drawImage(t.canvas,0,0)}function p(e,t,r){var i=document.createElement("canvas");i.width=b(e*w.constants.ppmm),i.height=b(t*w.constants.ppmm);var n=i.width/i.height;return n>4?i.width--:n<.25&&i.height--,i.inverted=r,i}function g(e){var t=e.getContext("2d");t.globalCompositeOperation="source-over",t.fillStyle=u.default.colors.board,t.fillRect(0,0,e.width,e.height)}function y(e){var t=e.split(".");return w.constants.pcbFileTypes.indexOf(t[t.length-1])!=-1}function b(e){e=Math.min(Math.max(e,w.constants.minTexSize),w.constants.maxTexSize);for(var t=1;t<e;)t<<=1;return t}var w={};return w.parser=void 0,w.domParent=void 0,w.constants={ppmm:40,maxTexSize:4096,minTexSize:256,pcbFileTypes:["pcb","brd","kicad_pcb"],geometry:{boardThickness:1.54},materials:{board:{shininess:80,ambient:3355443,specular:13421772,color:2445317}}},w.index={BOTTOM:1,TOP:2,BOTH:3,BOARD:0,COPPER:1,SOLDER:2,PASTE:3,SILK:4,OUTLINE:5},w.isFlipped=!1,w.utils={isPcb:y},w.boards={bottom:{},top:{},makeBoard:p,clearBoard:g},w.init=o,w.parse=e,w.destroy=i,w.flip=t,w.render=c,w.renderLayer=d,w.center=n,w},S=w;t.default=S;(function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(w,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/webGerber.js"),__REACT_HOT_LOADER__.register(S,"default","C:/Users/david/repositories/stemn-frontend/electronNew/app/node_modules/stemn-frontend-shared/src/misc/Files/PreviewFile/PreviewPcb/viewer/webGerber.js"))})(),function(){"undefined"==typeof __REACT_HOT_LOADER__}()},278:function(e,t,r){function i(e){return n(function(t,r){var i=-1,n=r.length,o=n>1?r[n-1]:void 0,s=n>2?r[2]:void 0;for(o=e.length>3&&"function"==typeof o?(n--,o):void 0,s&&a(r[0],r[1],s)&&(o=n<3?void 0:o,n=1),t=Object(t);++i<n;){var l=r[i];l&&e(t,l,i,o)}return t})}var n=r(74),a=r(109);e.exports=i},355:function(e,t,r){function i(e){return n(e,a)}var n=r(160),a=4;e.exports=i}});